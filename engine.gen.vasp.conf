# Regarding execution order
# = requirement should come before != requirement. otherwise, false alarm is raised.
# Any condition and requirement that fails are appended to the end of the queue
# Anything optional are appended to the end of the queue
# 
# # Regarding grammar and semantics
# Whitespaces are unimportant.
# null means [''] or undefined. 
# optional means 'almost necessary'.
# 
# # Regarding grouping
# Be forgiving. Group by the sprit or the cause.
#
# # Regarding compute engine
# Gen is intended to be an engine-independent module. Thus, engine keyword is used. (For now, though, we assume engine=vasp).
#
# # Regarding grammar of this file
# 'ref:' means reference. 'source:' means source. '==' means definition.
# 
# kwname!=kwval|!modname && !(func) || kwname !null     : kwname!=kwval|(funcname), !modname, if_exp which CANNOT BE REALIZED BY FORGOING       : optional  : explanations. colon is necessary.
# 
# 
# 材料元素
qd                                            : cond=insu, kpoints=1 1 1 G                                                                 :          : NEEDS WORK! qd == material info applicable to any PbS QD.
                                              : spin=fm|afm|ncl|para                                                                       :          :
spin=fm|spin=afm                              : magmom=(magmom)                                                                            : optional : user can specify magmom
spin=ncl || hse&npar                          : nbands=(nbands)                                                                            :          : Source of nbands == I read from vasp source code. Not quite reliable.
pbs & bulk                                    : cond=insu                                                                                  :          :
# 求值元素
                                              : engine=vasp, engine internal                                                               :          :
opt                                           : ibrion=2, isif !null                                                                       :          : opt == relaxation. Use good conjugate-gradient. Ref                                                                    : vasp guide 6.22.
opt                                           : ediffg !null                                                                               :          :
opt & fix=none                                : isif=3                                                                                     :          : Ref                                                                                                                    : vasp guide 6.24
opt & fix=base                                : isif=0                                                                                     :          :
eigenfunction                                 :                                                                                            :          :
dos                                           : nedos=1500, lorbit=11                                                                      : optional :
dos                                           : lorbit=11                                                                                  :          : dos == non-self-consistent calculation where CHGCAR is read.
bader                                         : laechg=.TRUE.                                                                              :          : Source                                                                                                                 : bader website.
# 简化近似元素
ldau                                          : ldau=.TRUE.                                                                                :          :
ldau                                          : ldauu=(ldauu), ldauj=(ldauj)                                                               : optional : user can specify u and j values
ldau | spin=ncl                               : lmaxmix=(lmaxmix)                                                                          :          : Source                                                                                                                 : https : //cms.mpi.univie.ac.at/wiki/index.php/LMAXMIX.  https : //cms.mpi.univie.ac.at/vasp/vasp/LSORBIT_tag.html
spin=ncl                                      : lsorbit=.TRUE., gga_compat=.FALSE.                                                         :          :
spin=fm | spin=afm                            : ispin=2                                                                                    :          :
spin=para                                     : ispin=1                                                                                    :          :
# 其他近似参数
                                              : kpoints !null, isym !null, prec !null, ediff !null, encut !null, lreal !null, ismear !null :          :
                                              : spin !null, cond !null, (kpointscheck)                                                     :          : spin == para/fm/afm/ncl, cond == metal/insu
ismear=0                                      : sigma !null                                                                                :          :
cond=insu & (ismear5check) || cond=metal&!opt : ismear=-5                                                                                  :          : Although ismear=0 and good sigma usually also works when ismear=-5 works. Source                                       : my testing.
cond=insu & !(ismear5check)                   : ismear=0                                                                                   :          :
opt & cond=metal                              : ismear=1|2, sigma=0.2                                                                      :          : The infamous 3-rules. Source                                                                                           : https : //cms.mpi.univie.ac.at/wiki/index.php/ISMEAR
spin=ncl                                      : isym=-1, icharg=11                                                                         : optional : Recommend isym=-1. They used icharg=11. Source                                                                         : https : //cms.mpi.univie.ac.at/wiki/index.php/LSORBIT
# 辅助行为参数
                                              : algo=Normal                                                                                : optional : Source == kept running into instability and inaccuracy with Algo = Fast. However, I used to endorse Algo=Fast.
                                              : npar !null, kpar !null, ncore_node !null, mem_node !null, nnode !null                      :          :
                                              : istart !null, icharg !null                                                                 :          :
dos                                           : read=cc                                                                                    : optional : Often good. Usually CHGCAR converges well with k-mesh. Source                                                          : vasp guide somewhere.
opt                                           : nsw !null                                                                                  :          :
spin=ncl                                      : istart=0                                                                                   : optional : Ncl run changes symmetry. Thus, plane-wave coefficient can change. This may produce error when reading WAVECAR. Source : http  : //cms.mpi.univie.ac.at/vasp-forum/viewtopic.php?f=3&t=10150
## ISTART, ICHARG
read=n                                        : istart=0, icharg=2                                                                         : optional : Often good. Always invoke read parameter optionally.
read=wc                                       : istart=1, icharg=1                                                                         : optional :
read=cc                                       : istart=1, icharg=11                                                                        : optional :
## 计算平台
platform=dellpc                               : nnode=1, ncore_node=20,mem_node=94                                                         :          : dellpc == aux parameters optimal for dellpc
platform=dellpc                               : npar=20, kpar=1                                                                            : optional : Source == benchmarks.md
platform=nanaimo                              : ncore_node=24, mem_node=128                                                                :          :
platform=irmik                                : ncore_node=12, mem_node=48                                                                 :          :
platform=hodduk                               : ncore_node=16, mem_node=64                                                                 :          :
platform=nanaimo|irmik|hodduk                 : npar=2, kpar=2                                                                             : optional :
# preset
ismear=0 & good                               : sigma=0.01                                                                                     :        :
pbs & good                                    : prec=Normal, encut=40l, kpoints=11 11 11 G                                       :          : good == 误差合理。
pbs & bulk & good & !ncl                      : ediff=1E-4, isym=2                                                     :          : 
opt & good     :    ediffg=-0.01    :   :
#
#
#
#
#
# Regarding internal parameters:
# Internal status is entirely unrelated to the data logic. It only has to do with writing INCAR.
#
# Regarding grammar and semantics:
# Same.
# 
# kwname!=kwval|!modname && !(func) || kwname !null     : kwname internal                               : optional  : explanations. colon is necessary.
# 
                                              : ncore_node internal, mem_node internal                                                     :          :
                                              : read internal                                                                              :          :
                                              : hseprec internal                                                                           :          :
                                              : spin internal, cond internal                                                               :          :
                                              : platform internal                                                                          :          :
                                              : fix internal, nnode internal                                                               :          :
                                              : kpoints internal                                                                           :          :
icharg=10 | icharg=11 | icharg=12             : magmom internal                                                                            :          :
