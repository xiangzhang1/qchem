# Regarding execution order
# = requirement should come before != requirement. otherwise, false alarm is raised.
# Any condition and requirement that fails are appended to the end of the queue
# Anything optional are appended to the end of the queue
# 
# # Regarding grammar and semantics
# Whitespaces are unimportant.
# null means [''] or undefined. 
# optional means 'almost necessary'. common means 'not really nonsense'
# 
# # Regarding grouping
# Be forgiving. Group by the sprit or the cause.
#
# # Regarding compute engine
# Gen is intended to be an engine-independent module. Thus, engine keyword is used. (For now, though, we assume engine=vasp).
#
# # Regarding grammar of this file
# 'ref:' means reference. 'source:' means source. ':=' means definition.
# 
# kwname!=kwval|!modname && !(func) || kwname !null 	: kwname!=kwval|(funcname), !modname, if_expression					: optional 	: explanations. colon is necessary.
# 
# 材料元素
qd & spin!=ncl				: cond=insu, spin=fm, kpoints=1 1 1									        :		    : NEEDS WORK! qd:= material info applicable to any PbS QD.
					        : spin=fm|spin=afm|spin=ncl, spin!=fm|spin!=afm								:		    :
spin=fm|spin=afm			: magmom=(magmom)											                : optional	: user can specify magmom
spin=fm|spin=afm|spin=ncl || hse&npar	: nbands=(nbands)											    :		    : Source: I read from vasp source code. Not quite reliable.
# 求值元素
					        : engine=vasp												: engine :=
opt					        : ibrion=2, isif !null											:		: opt := relaxation. Use good conjugate-gradient. Ref: vasp guide 6.22.
opt					        : ediffg !null												:		:
opt & fix=none				: isif=3												:		: Ref: vasp guide 6.24
opt & fix=cell				: isif=0												:		:		
static					: 													:		: NEEDS WORK! static := intermediate stage. 
dos					: nedos=1500, lorbit=11											: optional	: 
dos					: lorbit=11												:		: dos := non-self-consistent calculation where CHGCAR is read.
bader					: laechg=.TRUE.												:		: Source: bader website.		
# 简化近似元素
ldau					: ldau=.TRUE.												:		:
ldau					: ldauu=(ldauu), ldauj=(ldauj)										: optional	: user can specify u and j values
ldau | ncl				: lmaxmix=(lmaxmix)											:		: Source: https://cms.mpi.univie.ac.at/wiki/index.php/LMAXMIX.  https://cms.mpi.univie.ac.at/vasp/vasp/LSORBIT_tag.html
ncl					: lsorbit=.TRUE., gga_compat=.FALSE.									:		:
# 其他近似参数
					: kpoints !null, isym !null, prec !null, ediff !null, encut !null, lreal !null, ismear !null		: 		:
					: spin !null, cond !null, (kpointscheck)										:		: spin := para/fm/afm/ncl, cond := metal/insu
common					: ediff=1E-4, prec=Normal										:		:
cond=insu&(ismear5check) || cond=metal&!opt		: ismear=-5										: optional	: Ismear=0 and good sigma usually also work when ismear=-5 works. Source: my testing.  
cond=insu & !(ismear5check)		: ismear=0, sigma=0.05											:		:
opt & cond=metal			: ismear=1|2, sigma=0.2											:		: The infamous 3-rules. Source: https://cms.mpi.univie.ac.at/wiki/index.php/ISMEAR
ncl					: isym=-1, icharg=11											: optional	: Recommend isym=-1. They used icharg=11. Source: https://cms.mpi.univie.ac.at/wiki/index.php/LSORBIT
# 辅助行为参数
					: algo=fast												: optional	: Often good. Ref: vasp guide 6.46.
					: npar !null, kpar !null, corespernode !null, mempernode !null, nodes !null				: 		:  
nodes, corespernode			: totalnumbercores=(totalnumbercores)									:		:
read=n					: istart=0, icharg=2											: optional	: Often good. Always invoke read parameter optionally.
read=cw					: istart=1, icharg=1											: optional	: 
read=cc					: istart=1, icharg=11											: optional	: 
dos					: read=cc												: optional	: Often good. Usually CHGCAR converges well with k-mesh. Source: vasp guide somewhere.
opt					: nsw !null												:		:
opt & common				: nsw=30												:		: common := parameters that produce sane (but not Accurate or your-wanted) results.
dos & common				: emax=-10, emin=10											:		:
ncl					: istart=0												: optional	: Ncl run changes symmetry. Thus, plane-wave coefficient can change. This may produce error when reading WAVECAR. Source: http://cms.mpi.univie.ac.at/vasp-forum/viewtopic.php?f=3&t=10150 
## 计算平台
platform=dellpc				: totalnumbercores=20,corespernode=20,mempernode=94							:		: dellpc := aux parameters optimal for dellpc
platform=dellpc				: npar=20,kpar=1											: optional	: Fastest, but takes more memory.
#
#
#
#
#
# Regarding internal parameters:
# Internal status is entirely unrelated to the data logic. It only has to do with writing INCAR.
#
# Regarding grammar and semantics:
# Same.
# 
# kwname!=kwval|!modname && !(func) || kwname !null 	: kwname internal									: optional 	: explanations. colon is necessary.
# 
					: corespernode internal, totalnumbercores internal, mempernode internal					:		:
					: read internal												:		: 
					: hseprec internal											:		:
					: spin internal, cond internal										:		:
					: platform internal											:		:
					: kpoints internal											:		:
icharg=10 | icharg=11 | icharg=12	: magmom internal											:		:
