/**
 * Ogma
 * @description Graph visualization library
 * @version 2.4.3 (built on Fri Jul 06 2018 16:01:32 GMT+0200 (CEST))
 * @author Linkurious SAS
 * @license (c) Linkurious 2018. All rights reserved.
 * @preserve
 */
(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t():typeof define==="function"&&define.amd?define(t):e.Ogma=t()})(this,function(){"use strict";function e(value){if(this==null){throw new TypeError("this is null or not defined")}var e=Object(this);var t=e.length>>>0;var r=arguments[1];var i=r>>0;var n=i<0?Math.max(t+i,0):Math.min(i,t);var a=arguments[2];var o=a===undefined?t:a>>0;var s=o<0?Math.max(t+o,0):Math.min(o,t);while(n<s){e[n]=value;n++}return e}function t(e,t,r){if(this===null){throw new TypeError("this is null or not defined")}var i=Object(this);var n=i.length>>>0;var a=e>>0;var o=a<0?Math.max(n+a,0):Math.min(a,n);var s=t>>0;var u=s<0?Math.max(n+s,0):Math.min(s,n);var l=r===undefined?n:r>>0;var f=l<0?Math.max(n+l,0):Math.min(l,n);var h=Math.min(f-u,n-o);var v=1;if(u<o&&o<u+h){v=-1;u+=h-1;o+=h-1}while(h>0){if(u in i){i[o]=i[u]}else{delete i[o]}u+=v;o+=v;h--}return i}function r(e){var t,r,i=Object(this),n=i.length>>>0;if(n===0){return-1}t=n-1;if(arguments.length>1){t=Number(arguments[1]);if(t!==t){t=0}else if(t!==0&&t!==1/0&&t!==-(1/0)){t=(t>0||-1)*Math.floor(Math.abs(t))}}for(r=t>=0?Math.min(t,n-1):n-Math.abs(t);r>=0;r--){if(r in i&&i[r]===e){return r}}return-1}if(!Array.from){Array.from=function(){var e=Object.prototype.toString;var t=function(t){return typeof t==="function"||e.call(t)==="[object Function]"};var r=function(value){var e=Number(value);if(isNaN(e)){return 0}if(e===0||!isFinite(e)){return e}return(e>0?1:-1)*Math.floor(Math.abs(e))};var i=Math.pow(2,53)-1;var n=function(value){var e=r(value);return Math.min(Math.max(e,0),i)};return function e(r){var i=this;var a=Object(r);if(r==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var o=arguments.length>1?arguments[1]:void undefined;var s;if(typeof o!=="undefined"){if(!t(o)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){s=arguments[2]}}var u=n(a.length);var l=t(i)?Object(new i(u)):new Array(u);var f=0;var h;while(f<u){h=a[f];if(o){l[f]=typeof s==="undefined"?o(h,f):o.call(s,h,f)}else{l[f]=h}f+=1}l.length=u;return l}}()}var i=[Uint32Array,Uint16Array,Uint8Array,Int32Array,Int16Array,Int8Array,Float32Array,Float64Array,Array];var n=["join","slice","reverse","forEach","map","reduce","indexOf","sort","filter","every"];for(var a=0,o=i.length;a<o;++a){var s=i[a].prototype;if(!s.fill){s.fill=e}if(!s.copyWithin){s.copyWithin=t}if(!s.lastIndexOf){s.lastIndexOf=r}if(a<o-1){for(var u=0,l=n.length;u<l;u++){var f=n[u];if(!s[f]){s[f]=Array.prototype[f]}}}}if(!ArrayBuffer.isView){ArrayBuffer.isView=function(e){for(var t=0;t<i.length;++t){if(e instanceof i[t]){return true}}return false}}if(!Float32Array.prototype.from){(function(){Float32Array.prototype.from=function(e,t,r){var i,n;var a=Int8Array.prototype;if(typeof this!=="function"){throw new TypeError("# is not a constructor")}if(this.prototype!==a){throw new TypeError("this is not a typed array.")}t=t||function(e){return e};if(typeof t!=="function"){throw new TypeError("specified argument is not a function")}e=Object(e);if(!e.length){return new this(0)}var o=[];for(i=0,n=e.length;i<n;i++){o.push(e[i])}o=o.map(t,r);var s=new this(o.length);for(i=0,n=s.length;i<n;i++){s[i]=o[i]}return s}})()}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(this==null){throw new TypeError('"this" is null or not defined')}var r=Object(this);var i=r.length>>>0;if(i===0){return false}var n=t|0;var a=Math.max(n>=0?n:i-Math.abs(n),0);function o(e,t){return e===t||typeof e==="number"&&typeof t==="number"&&isNaN(e)&&isNaN(t)}while(a<i){if(o(r[a],e)){return true}a++}return false}})}var h=function(e,t){for(t=this.length;~--t&&(!(t in this)||this[t]!==e);){}return t};Int8Array.prototype.lastIndexOf=Int8Array.prototype.lastIndexOf||h;Int16Array.prototype.lastIndexOf=Int16Array.prototype.lastIndexOf||h;Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||h;Float32Array.prototype.lastIndexOf=Float32Array.prototype.lastIndexOf||h;Float64Array.prototype.lastIndexOf=Float64Array.prototype.lastIndexOf||h;if(typeof CanvasRenderingContext2D!=="undefined"&&!CanvasRenderingContext2D.prototype.setLineDash){CanvasRenderingContext2D.prototype.setLineDash=function(){}}if(!Math.log2){Math.log2=function(e){return Math.log(e)/Math.log(2)}}if(!Number.isNaN){Number.isNaN=function(value){return typeof value==="number"&&isNaN(value)}}if(!Number.MAX_SAFE_INTEGER){Object.defineProperty(Number,"MAX_SAFE_INTEGER",{enumerable:false,configurable:false,writable:false,value:Math.pow(2,53)-1})}var v=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function d(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(){var e=setTimeout;function t(){}function r(e,t){return function(){e.apply(t,arguments)}}function i(e){if(typeof this!=="object"){throw new TypeError("Promises must be constructed via new")}if(typeof e!=="function"){throw new TypeError("not a function")}this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];l(e,this)}function n(e,t){while(e._state===3){e=e._value}if(e._state===0){e._deferreds.push(t);return}e._handled=true;i._immediateFn(function(){var r=e._state===1?t.onFulfilled:t.onRejected;if(r===null){(e._state===1?a:o)(t.promise,e._value);return}var i;try{i=r(e._value)}catch(e){o(t.promise,e);return}a(t.promise,i)})}function a(e,t){try{if(t===e){throw new TypeError("A promise cannot be resolved with itself.")}if(t&&(typeof t==="object"||typeof t==="function")){var n=t.then;if(t instanceof i){e._state=3;e._value=t;s(e);return}else if(typeof n==="function"){l(r(n,t),e);return}}e._state=1;e._value=t;s(e)}catch(t){o(e,t)}}function o(e,t){e._state=2;e._value=t;s(e)}function s(e){if(e._state===2&&e._deferreds.length===0){i._immediateFn(function(){if(!e._handled){i._unhandledRejectionFn(e._value)}})}for(var t=0,r=e._deferreds.length;t<r;t++){n(e,e._deferreds[t])}e._deferreds=null}function u(e,t,r){this.onFulfilled=typeof e==="function"?e:null;this.onRejected=typeof t==="function"?t:null;this.promise=r}function l(e,t){var r=false;try{e(function(value){if(r){return}r=true;a(t,value)},function(e){if(r){return}r=true;o(t,e)})}catch(e){if(r){return}r=true;o(t,e)}}i.prototype.catch=function(e){return this.then(null,e)};i.prototype.then=function(e,r){var i=new this.constructor(t);n(this,new u(e,r,i));return i};i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,r){if(t.length===0){return e([])}var i=t.length;function n(a,o){try{if(o&&(typeof o==="object"||typeof o==="function")){var s=o.then;if(typeof s==="function"){s.call(o,function(e){n(a,e)},r);return}}t[a]=o;if(--i===0){e(t)}}catch(e){r(e)}}for(var a=0;a<t.length;a++){n(a,t[a])}})};i.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===i){return value}return new i(function(e){e(value)})};i.reject=function(value){return new i(function(e,t){t(value)})};i.race=function(e){return new i(function(t,r){for(var i=0,n=e.length;i<n;i++){e[i].then(t,r)}})};i._immediateFn=typeof v.setImmediate==="function"&&function(e){v.setImmediate(e)}||function(t){e(t,0)};i._unhandledRejectionFn=function e(t){if(typeof console!=="undefined"&&console){console.warn("Possible Unhandled Promise Rejection:",t)}};i._setImmediateFn=function e(t){i._immediateFn=t};i._setUnhandledRejectionFn=function e(t){i._unhandledRejectionFn=t};if(typeof v==="object"&&!v.Promise){v.exports=i}if(typeof window==="object"&&!window.Promise){window.Promise=i}})(v);if(!String.prototype.endsWith){String.prototype.endsWith=function(e,t){var r=this.toString();if(typeof t!=="number"||!isFinite(t)||Math.floor(t)!==t||t>r.length){t=r.length}t-=e.length;var i=r.lastIndexOf(e,t);return i!==-1&&i===t}}if(!String.prototype.startsWith){String.prototype.startsWith=function(e,t){return this.substr(t||0,e.length)===e}}if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function e(t){var r=arguments;if(t==null){throw new TypeError("Cannot convert undefined or null to object")}var i=Object(t);for(var n=1;n<arguments.length;n++){var a=r[n];if(a!=null){for(var o in a){if(Object.prototype.hasOwnProperty.call(a,o)){i[o]=a[o]}}}}return i},writable:true,configurable:true})}var c=1;var _=[];var g=[];var p=[];var y=[];var m=false;var Ogma=function Ogma(e){if(e===void 0)e={};if(this===undefined||this===null||this.constructor!==Ogma){return new Ogma(e)}if(!m){m=true;for(var t=0;t<p.length;++t){p[t]()}}this._init(e)};Ogma.prototype._init=function e(t){var r=this;this._initParameters=t;this._debug=!!t.debug;this._token=c++;this.modules={};this.events={};this.view={};this.styles={};this.transformations={};this.parse={};this.export={};this.tools={};this.utils={};this.algorithms={};_.forEach(function(e){return e(r,t)});g.forEach(function(e){return e(r,t)})};Ogma.prototype._destroy=function e(){var t=this;if(!this._token){throw new Error('"destroy" called twice on the same instance of Ogma')}y.forEach(function(e){return e(t)});Object.keys(this).forEach(function(e){t[e]=undefined})};Ogma.prototype.destroy=function e(){this._destroy()};Ogma.prototype.reset=function e(){var t=this._initParameters;this._destroy();this._init(t)};function x(e,t){if(typeof t!=="function"){throw new TypeError("expected function")}e.push(t)}Ogma.extend=function(e){x(_,e)};Ogma.atInit=function(e){x(g,e)};Ogma.beforeFirstInstanceCreated=function(e){x(p,e)};Ogma.onDestroy=function(e){x(y,e)};Ogma.version="2.4.3";Ogma.build="1530885692473";var b=function(){var e=0;return typeof requestAnimationFrame!=="undefined"?requestAnimationFrame:function(t){var r=Date.now();var i=Math.min(16,Math.max(0,16-(r-e)));var n=e=r+i;return setTimeout(function(){return t(n)},i)}}();var A=typeof cancelAnimationFrame!=="undefined"?cancelAnimationFrame:function(e){return clearTimeout(e)};function w(e,t){return b(function(r){e.call(t,r)})}function E(e){if(e){A(e)}}var S=typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{};var C=null;var T=false;if(typeof window!=="undefined"&&typeof document!=="undefined"){var M={opera:!!window.opr&&!!window.opr.addons||!!window.opera||typeof navigator!=="undefined"&&navigator.userAgent.indexOf(" OPR/")>=0,firefox:typeof InstallTrigger!=="undefined",safari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ie:!!document.documentMode,edge:!document.documentMode&&!!window.StyleMedia,chrome:!!window.chrome&&!!window.chrome.webstore||/HeadlessChrome/.test(navigator.userAgent)};for(var k in M){if(M.hasOwnProperty(k)&&M[k]){C=k;break}}if(navigator.userAgent.indexOf("MSIE")>=0){T=true}}var I=!T;if(!C&&typeof S!=="undefined"){C="node"}function N(){return C}Ogma.libraries=Object.create(null);var L={},z={},D=function(){return null};if(typeof S==="object"){L=S}if(typeof window==="object"){z=window}if(typeof module==="object"&&typeof module.require==="function"){D=function(e){try{return module.require(e)}catch(e){return null}}}else if(typeof L.require==="function"){D=function(e){try{return L.require(e)}catch(e){return null}}}function P(e,t){var r=t.globalVarName;var i=t.fallback;var n=t.throwOnError;if(n===void 0)n=true;var a=null;if(!a&&e){a=Ogma.libraries[e]}if(!a&&r){a=Ogma.libraries[r]}if(!a&&e){a=D(e)}if(!a&&r){a=z[r]}if(!a&&r){a=L[r]}if(!a&&typeof i==="function"){a=i()}if(!a&&i){a=i}if(!a&&n){var o=r?" or global variable "+r:"";var s='unable to find module "'+e+'"'+o+"; make sure one of these statements is true:\n";s+="- require('"+e+"') returns the right library\n";s+="- Ogma.libraries['"+e+"'] is set to the right library\n";if(r){s+="- window['"+r+"'] is set to the right library"}throw new Error(s)}return a}var F=typeof performance!=="undefined"&&performance.now?function(){return performance.now()|0}:function(){return Date.now()};var B=F();function R(){return F()-B}function O(){return R()}function V(){var e=new Date;var t=e.getDate();var r=e.getMonth()+1;var i=e.getFullYear();if(t<10){t="0"+t}if(r<10){r="0"+r}return i+"-"+r+"-"+t}function j(){var e=new Date;var t=U((e.getUTCHours()-(e.getTimezoneOffset()/60|0))%24);var r=U(e.getUTCMinutes());var i=U(e.getUTCSeconds());var n=U(e.getUTCMilliseconds(),3);return"["+t+":"+r+":"+i+":"+n+"]"}function U(e,t){t=t||2;var r=Math.pow(10,t-1),i=e;while(r>1){if(e<r){i="0"+i}r/=10}return i}function G(){var e=null;return{fire:function(t,r){if(e){clearTimeout(e);e=null}e=setTimeout(function(){e=null;t()},r)},stop:function(){if(e){clearTimeout(e);e=null}}}}function X(e,t){for(var r=1,i=e.length;r<i;r++){var n=e[r];var a=r;while(a>0&&t.get(e[a-1])>t.get(n)){e[a]=e[a-1];--a}e[a]=n}return e}function W(e,t){for(var r=1,i=e.length;r<i;r++){var n=e[r];var a=r;while(a>0&&t.get(e[a-1])<t.get(n)){e[a]=e[a-1];--a}e[a]=n}return e}function Y(e,t){for(var r=0;r<t.length;++r){e.push(t[r])}}function H(value){return Array.isArray(value)||ArrayBuffer.isView(value)}function q(value){return Array.isArray(value)?value:[value]}function Z(e){return e!==null&&typeof e==="object"&&!H(e)&&!(e instanceof RegExp)&&(typeof HTMLElement==="undefined"||!(e instanceof HTMLElement))}function $(e){var t=Object.keys(e);var r=new Array(t.length);for(var i=0;i<t.length;++i){r[i]=e[t[i]]}return r}function K(e,t,r){if(Array.isArray(e)){e.forEach(t,r)}else if(Z(e)){var i=Object.keys(e);if(r){for(var n=0;n<i.length;++n){var a=i[n];t.call(r,e[a],a)}}else{for(n=0;n<i.length;++n){a=i[n];t(e[a],a)}}}else{throw new Error("forEach: invalid argument "+JSON.stringify(e))}}function J(e,t,r){var value=r;Object.keys(e).forEach(function(r){value=t(value,e[r])});return value}function Q(e,t){if(Array.isArray(e)){return e.map(t)}else if(Z(e)){var r={},i=Object.keys(e);for(var n=0;n<i.length;++n){var a=i[n];r[a]=t(e[a],a)}return r}else{throw new Error("map: invalid argument "+JSON.stringify(e))}}function ee(e,t){var r=Object.keys(t);for(var i=0,n=r.length;i<n;++i){var a=r[i];t[a]=e[a]}return t}function te(e){var t=arguments;var r,i,n,a;for(r=1,n=arguments.length;r<n;r++){a=t[r];for(i in a){e[i]=a[i]}}return e}function re(e,t){if(t===void 0)t={};K(e,function(value,e){t[e]=value});return t}function ie(e){if(e===undefined){return"undefined"}else{return JSON.stringify(e)}}function ne(e){if(Array.isArray(e)){t=new Array(e.length);for(i=0;i<e.length;++i){t[i]=ne(e[i])}return t}else if(e!==null&&e!==undefined&&e.constructor===Object){var t={},r=Object.keys(e);for(var i=0;i<r.length;++i){var n=r[i];t[n]=ne(e[n])}return t}else{return e}}function ae(e,t){K(t,function(t,value){if(typeof value==="object"&&value!==null){if(typeof e[t]!=="object"||e[t]===null){e[t]={}}ae(e[t],value)}else{e[t]=value}})}function oe(e,t){t.forEach(function(t){if(e.indexOf(t)===-1){e.push(t)}})}function se(e,t){if(t===null){return e}else if(typeof t==="string"){if(t.indexOf(".")===-1){return e===null||e===undefined?undefined:e[t]}var r=t.indexOf(".");while(e&&r!==-1){e=e[t.substr(0,r)];t=t.substr(r+1);r=t.indexOf(".")}return e?e[t]:undefined}else{for(var i=0,n=t.length;i<n;++i){if(!e){return undefined}e=e[t[i]]}return e}}function ue(e,t){var r=t.indexOf(".");while(e&&r!==-1){e=e[t.substr(0,r)];t=t.substr(r+1);r=t.indexOf(".")}return!!e&&e.hasOwnProperty(t)}function le(e,t,value){var r=t.indexOf(".");while(r!==-1){var i=t.substr(0,r),n=e[i];if(!n){n={};e[i]=n}t=t.substr(r+1);r=t.indexOf(".");e=n}e[t]=value}var fe=function(){};function he(e,t,r,i){var n=t.indexOf(".");while(n!==-1){var a=t.substr(0,n),o=e[a];if(!o){o={};e[a]=o}t=t.substr(n+1);n=t.indexOf(".");e=o}var s=e[t];Object.defineProperty(e,t,{get:r||function(){return s},set:i||fe,configurable:true})}function ve(e,t){var r=t.indexOf("."),i=t;while(e&&r!==-1){e=e[t.substr(0,r)];t=t.substr(r+1);r=t.indexOf(".")}if(!e){throw new Error('No property "'+i+'" exist.')}var value=e[t];Object.defineProperty(e,t,{value:value,configurable:true})}function de(){var e=arguments;var t=arguments.reduce(function(e,value){return e+(value?value.length:0)},0),r=new Array(t),i=0;for(var n=0;n<arguments;++n){if(e[n]){for(var a=0;a<arguments[n].length;++a){r[i]=e[n][a];++i}}}return r}function ce(e){var t=[];for(var r=0,i=e.length;r<i;++r){var n=e[r];if(t.indexOf(n)===-1){t.push(n)}}return t}function _e(e,t){K(t,function(t,r){Object.defineProperty(e,r,{enumerable:true,get:t})})}var ge=function(){};var pe=/\{\s*\[native code\]\s*\}/;function ye(e){return typeof e==="string"&&!pe.test(""+e)}function me(e){if(typeof e==="object"){var t=e.constructor;if(ye(t)){var r=Object.keys(t.prototype);for(var i=0;i<r.length;++i){var n=r[i];if(typeof t.prototype[n]==="function"){e[n]=ge}}}}}function xe(e,t,r){if(r===void 0)r=".";if(!t){t=function(e){return!Z(e)}}var i={},n=Object.keys(e);for(var a=0;a<n.length;++a){var o=n[a];var value=e[o];if(!t(value)){var s=xe(value,t);var u=Object.keys(s);for(var l=0;l<u.length;l++){var f=u[l];i[""+o+r+f]=s[f]}}else{i[o]=value}}return i}function be(e,t,value){var r=typeof t==="string"?t.split("."):t;for(var i=0;i<r.length-1;++i){var n=r[i],a=e[n];if(!a){a={};e[n]=a}e=a}e[r[r.length-1]]=value}function Ae(e,t){var r=typeof t==="string"?t.split("."):t;for(var i=0;i<r.length-1;++i){var n=r[i],a=e[n];if(!a){return undefined}e=a}return e[r[r.length-1]]}function we(e){var t={},r=Object.keys(e);for(var i=0;i<r.length;++i){var n=r[i];be(t,n,e[n])}return t}function Ee(e,t,r){if(r===void 0)r=[];var i=Object.keys(e);for(var n=0;n<i.length;++n){var a=i[n],value=e[a],o=t?t+a:a;if(typeof value!=="object"||value===null||Array.isArray(value)){r.push(o)}else{Ee(value,o+".",r)}}return r}function Se(e){if(e===void 0)e={};for(var t in e){if(typeof e[t]==="function"){delete e[t]}}return e}function Ce(value,e,t){if(value===undefined){return ne(e)}if(!Z(value)&&t){value={};value[t]=value}if(Z(e)){var r={};for(var i in e){var n=e[i],a=value[i];if(Z(n)){r[i]=Ce(a,n)}else if(a===undefined){r[i]=ne(n)}else{r[i]=a}}return r}else{return value}}function Te(e){var t=[];for(var r=0;r<e.length;++r){var i=e[r];if(Array.isArray(i)){for(var n=0;n<i.length;++n){t.push(i[n])}}else{t.push(i)}}return t}function Me(value){return value&&(value.constructor===Object||!value.constructor)}function ke(e,t){if(!Me(t)||!Me(e)){return t}var r=Object.assign({},e);var i=Object.keys(t);for(var n=0;n<i.length;++n){var a=i[n];r[a]=ke(r[a],t[a])}return r}var Ie=300;var Ne=150;var Le,ze,De,Pe,Fe,Be,Re;Ogma.beforeFirstInstanceCreated(function(){Le=P("xmldom",{throwOnError:false});ze=P("canvas",{throwOnError:false});Re=P("gl",{throwOnError:false});if(typeof XMLSerializer!=="undefined"){De=XMLSerializer}else if(Le){De=Le.XMLSerializer}else{De=null}if(typeof document!=="undefined"){Pe=document}else if(Le){Pe=(new Le.DOMImplementation).createDocument()}else{Pe=null}if(typeof XMLHttpRequest!=="undefined"){Fe=XMLHttpRequest}else{Fe=Xe}if(typeof FileReader!=="undefined"){Be=FileReader}else{Be=We}});function Oe(){if(Pe){return Pe}else{return{createElementNS:function e(){return null},createElement:function e(){return null},implementation:{createDocument:function e(){throw new Error('unable to create XML document; if you use Node JS install the "xmldom" package')}}}}}function Ve(e,t){var value=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!value||value==="auto")&&Oe().defaultView){var r=document.defaultView.getComputedStyle(e,null);value=r?r[t]:null}return value==="auto"?null:value}function je(){if(typeof XMLSerializer!=="undefined"){return XMLSerializer}else if(Le){return Le.XMLSerializer}else{return function(){throw new Error('unable to instantiate XMLSerializer; if you use Node JS install the "xmldom" package')}}}function Ue(){if(ze){return function(){var e=new ze(300,150);e.style={};return e}}else if(typeof document!=="undefined"){return function(){return document.createElement("canvas")}}else{return function(){return new qe}}}function Ge(e,t){var r=e.getContext("webgl",t);if(!r){r=e.getContext("experimental-webgl",t)}if(!r&&Re){r=Re(e.width,e.height,t)}return r||null}var Xe=function e(){if(e.onCreate){e.onCreate(this)}};Xe.prototype.open=function e(t,r){this.method=t;this.url=r;if(Xe.onSend){Xe.onSend(this)}};Xe.prototype.respond=function e(t,r,i){this.readyState=4;this.status=t;this.headers=r;this.responseText=this.response=i;this.onreadystatechange()};Xe.prototype.send=function e(){this.readyState=4};var We=function e(){if(e.onCreate){e.onCreate(this)}};We.prototype.readAsDataURL=function e(t){this._blob=t;if(We.onRead){We.onRead(this)}};We.prototype.load=function e(t){if(typeof t==="function"){this.result=t(this._blob)}else{this.result=t}if(this.onload){this.onload()}};var Ye=function e(){this.__dummy=true;this.style={width:"0px",height:"0px"}};var He={offsetWidth:{configurable:true},offsetHeight:{configurable:true},firstChild:{configurable:true}};He.offsetWidth.get=function(){return parseFloat(this.style.width)};He.offsetHeight.get=function(){return parseFloat(this.style.height)};He.firstChild.get=function(){return null};Ye.prototype.appendChild=function e(){};Ye.prototype.removeChild=function e(){};Ye.prototype.addEventListener=function e(){};Ye.prototype.removeEventListener=function e(){};Object.defineProperties(Ye.prototype,He);var qe=function e(){this.__context=new $e;this.style={};this.width=Ie;this.height=Ne};var Ze={__dummy:{configurable:true}};Ze.__dummy.get=function(){return true};qe.prototype.getContext=function e(t){return t==="2d"?this.__context:null};qe.prototype.toDataURL=function e(){return"data:image/png;base64,"};qe.prototype.addEventListener=function e(){};qe.prototype.removeEventListener=function e(){};qe.prototype.getBoundingClientRect=function e(){return{left:0,top:0,bottom:0,right:0,width:this.width,height:this.height}};Object.defineProperties(qe.prototype,Ze);var $e=function e(){this._fontSize=10};var Ke={font:{configurable:true}};Ke.font.set=function(e){var t=e.match(/\d+/);if(t){this._fontSize=parseFloat(t[0])}};$e.prototype.fill=function e(){};$e.prototype.stroke=function e(){};$e.prototype.clearRect=function e(){};$e.prototype.fillRect=function e(){};$e.prototype.strokeRect=function e(){};$e.prototype.beginPath=function e(){};$e.prototype.closePath=function e(){};$e.prototype.moveTo=function e(){};$e.prototype.lineTo=function e(){};$e.prototype.rect=function e(){};$e.prototype.arc=function e(){};$e.prototype.save=function e(){};$e.prototype.restore=function e(){};$e.prototype.clip=function e(){};$e.prototype.translate=function e(){};$e.prototype.rotate=function e(){};$e.prototype.fillText=function e(){};$e.prototype.setLineDash=function e(){};$e.prototype.quadraticCurveTo=function e(){};$e.prototype.bezierCurveTo=function e(){};$e.prototype.drawImage=function e(){};$e.prototype.measureText=function e(t){return{width:t.length*Math.ceil(this._fontSize*.625)}};$e.prototype.getImageData=function e(){return{width:0,height:0,data:new Uint8ClampedArray(0)}};Object.defineProperties($e.prototype,Ke);function Je(){return new Ye}function Qe(e,t){var r=Pe.createElement(e)||t&&new Ye;if(!r){throw new Error('unable to instanciate new DOM element; if you use Node JS install the "xmldom" package')}return r}function et(e,t,r){var i=Pe.createElementNS(e,t)||r&&new Ye;if(!i){throw new Error('unable to instanciate new DOM element; if you use Node JS install the "xmldom" package')}return i}function tt(){return Pe.implementation.createDocument("","",null)}function rt(e){return(new De).serializeToString(e)}function it(){var e=null;if(typeof document!=="undefined"){e=document.createElement("canvas")}else if(ze){e=new ze(Ie,Ne);e.style={}}else{e=new qe}return e}function nt(){return typeof window!=="undefined"&&window.devicePixelRatio||1}function at(e){var t=";base64,",r,i,n;if(e.indexOf(t)===-1){r=e.split(",");i=r[0].split(":")[1];n=decodeURIComponent(r[1]);return st(n,i)}r=e.split(t);i=r[0].split(":")[1];n=window.atob(r[1]);var a=n.length;var o=new Uint8Array(a);for(var s=0;s<a;++s){o[s]=n.charCodeAt(s)}return st([o],i)}function ot(e,t){this.data=e;this.type=t}function st(e,t){if(typeof Blob!=="undefined"){return new Blob(e,{type:t})}else{return new ot(e,t)}}function ut(e){if(typeof Blob!=="undefined"){return e instanceof Blob||e instanceof ot}else{return e instanceof ot}}function lt(e,t,r){if(typeof window==="undefined"||window["__OGMA_HEADLESS"]){return e}var i=null,n=null,a=null;if(window.Blob){if(r==="blob"){i=e}else if(r==="dataURL"){i=at(e)}else{i=st([e],"text/xml")}n=window.URL.createObjectURL(i)}else{a="data:text/xml;charset=UTF-8,"+encodeURIComponent('<?xml version="1.0" encoding="UTF-8"?>')+encodeURIComponent(e)}if(navigator.msSaveBlob){navigator.msSaveBlob(i,t)}else if(navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(i,t)}else{var o=document.createElement("a");o.setAttribute("href",window.Blob?n:a);o.setAttribute("download",t);document.body.appendChild(o);o.click();document.body.removeChild(o)}if(n){setTimeout(function(){window.URL.revokeObjectURL(n)},0)}return e}function ft(e,t,r,i){if(!i){i=nt()}e.style.width=t+"px";e.style.height=r+"px";e.width=t*i;e.height=r*i}function ht(e,t){K(t,function(value,t){if(value!==undefined){e.setAttribute(t,value)}})}function vt(e,t){var r=Pe.createElementNS("http://www.w3.org/2000/svg",e);if(!r.style){r.style={}}if(t){ht(r,t)}return r}function dt(e){return Pe.createTextNode(e)}function ct(e,t,r,i,n){if(n===void 0)n=false;i=i||0;var a=O();var o=i===0?r:function(e){var t=O();if(t-a>i){r(e);a=t}};e.addEventListener(t,o,n);return{listener:o,elt:e,eventName:t}}function _t(e){e.elt.removeEventListener(e.eventName,e.listener)}function gt(e){if(typeof Image==="undefined"){return Promise.resolve(null)}return new Promise(function(t){var r=new Image;r.src=e;r.onload=function(){t(r)};r.onerror=function(){t(null)}})}function pt(e){if(e.indexOf("http://")===0||e.indexOf("https://")===0){return e}var t=window.location.origin,r=window.location.pathname,i=r.lastIndexOf("/");if(i===-1){t+="/"+e}else{t+=r.substr(0,i)+"/"+e}return t}function yt(e){return new Promise(function(t,r){var i=new Fe;i.open("GET",pt(e),true);i.onreadystatechange=function(){if(i.readyState===4){var n=i.status;if(n===200){t(i.responseText)}else if(n!==0){r(new Error('cannot retrieve file at url "'+e+'"; the server responded with status code '+n+"."))}else{r(new Error('cannot send XMLHttpRequest to url "'+e+"\"; if you're using the local file protocol this is most likely the cause."))}}};i.onerror=function(){r(new Error('cannot retrieve file at url "'+e+'"; the XMLHttpRequest failed.'))};i.send()})}function mt(e){return typeof HTMLElement!=="undefined"?e instanceof HTMLElement:false}function xt(e,t){e.style.cursor=t;if(e.style.cursor!==t){e.style.cursor="-webkit-"+t}}function bt(e){if(!e.getBoundingClientRect){return null}try{return e.getBoundingClientRect()}catch(e){return null}}function At(e){if(typeof window!=="undefined"){window.addEventListener("unload",e)}}function wt(e){return new Promise(function(t,r){var i=new Fe;i.responseType="blob";i.open("GET",pt(e),true);i.onreadystatechange=function(){if(i.readyState===4){if(i.status===200){t(i.response)}else{r(i.status)}}};i.onerror=function(e){return r(e)};i.send()})}function Et(e){return wt(e).then(function(e){return new Promise(function(t,r){var i=new Be;i.onerror=r;i.onload=function(){return t(i.result)};i.readAsDataURL(e)})})}function St(e,t,r){return Array.prototype.forEach.call(e,t,r)}function Ct(e,t,r){return Array.prototype.reduce.call(e,t,r)}function Tt(e,t,r,i){if(i===void 0)i="";e.font=i+" "+r+"px "+t}function Mt(e,t){if(t===void 0)t=true;var r=t?"&#13;":"\n";return(""+e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,r).replace(/[\r\n]/g,r)}function kt(){var e=Oe();var t=e.styleSheets;if(!t||!e.location){return Promise.resolve([])}var r=e.location.href;var i=[],n=[];for(var a=0;a<t.length;a++){var o=t[a];if(o.href===null){i.push({href:r,content:o.ownerNode.textContent})}else{n.push(o.href)}}var s=/@font-face\s*\{[^}]+\}/g;return Promise.all(n.map(function(e){return yt(e).then(function(t){return{href:e,content:t}}).catch(function(){return null})})).then(function(e){return e.concat(i)}).then(function(e){var t=[];for(var r=0;r<e.length;r++){var i=e[r];if(i!==null){var n=i.href;var a=i.content;var o=a.match(s);if(o){var u=Lt(o,n);t.push.apply(t,u)}}}return t})}function It(e,t){return Promise.all(e.map(function(e){var r=e.formats;var i=e.originalRule;return Promise.all(r.map(function(e){var r=e.format;var i=e.url;if(t){return Et(i).then(function(e){return{format:r,src:e}}).catch(function(){return null})}else{return{format:r,src:i}}})).then(function(e){var t=[];for(var r=0;r<e.length;r++){var n=e[r];if(n!==null){t.push("url('"+n.src+"') format('"+n.format+"')")}}if(t.length!==0){var a="src: "+t.join(",")+";";return i.replace(/src\s*:[^;]+;/g,a)}return i})}))}var Nt={"embedded-opentype":true,svg:true};function Lt(e,t){var r=/url\(['"]?([^'")]+)['"]?\)\s+format\(['"]?([^'")]+)['"]?\)/g;var i=/font-family\s*:\s*['"]?([^;'"]+)['"]?;/;var n=[];for(var a=0;a<e.length;a++){var o=e[a];var s=o.match(i)[1];var u=[];var l=void 0;while(l=r.exec(o)){var f=l[1];var h=l[2];if(!Nt[h.toLowerCase()]){u.push({format:h,url:zt(f,t)})}}n.push({name:s,formats:u,originalRule:o})}return n}function zt(e,t){if(/^http(s)?:/.test(e)){return e}if(e[0]==="/"){var r=t.match(/((\w+:\/\/)([^/]+))/);if(r){return r[1]+e}else{return e}}var i=e.split("/");var n=t.split("/");if(t[t.length-1]!=="/"){n.pop()}while(i[0]===".."){i.shift();n.pop()}return n.concat(i).join("/").replace(/[\w](\/{2,})/g,function(e){return e[0]+"/"})}var Dt={};function Pt(e){return typeof e==="number"&&isNaN(e)}var Ft=function e(){this._keys=[];this._values=[]};Ft.prototype.set=function e(t,value){var r=this._getIndex(t);if(r===-1){this._keys.push(t.slice());this._values.push(value);return true}else{this._values[r]=value;return false}};Ft.prototype.get=function e(t){var r=this._getIndex(t);return r===-1?undefined:this._values[r]};Ft.prototype.has=function e(t){return this._getIndex(t)!==-1};Ft.prototype.delete=function e(t){var r=this._getIndex(t);if(r!==-1){this._keys.splice(r,1);this._values.splice(r,1);return true}else{return false}};Ft.prototype.keys=function e(){return this._keys.map(function(e){return e.slice()})};Ft.prototype.values=function e(){return this._values.slice()};Ft.prototype._getIndex=function e(t){var r=this;for(var i=0;i<this._keys.length;++i){var n=r._keys[i];if(n.length===t.length){var a=true;for(var o=0;o<t.length;++o){var s=n[o],u=t[o];if(s!==u&&(!Pt(s)||!Pt(u))){a=false;break}}if(a){return i}}}return-1};var Bt=function e(){this.clear()};var Rt={size:{configurable:true}};Bt.prototype.clear=function e(){this._keys=[];this._values=[];this._arrays=new Ft;this._size=0};Rt.size.get=function(){return this._size};Bt.prototype.delete=function e(t){if(H(t)){if(this._arrays.delete(t)){this._size-=1;return true}else{return false}}else{var r=Ot(this,t);if(r===-1){return false}else{this._keys.splice(r,1);this._values.splice(r,1);this._size-=1;return true}}};Bt.prototype.get=function e(t){if(H(t)){return this._arrays.get(t)}else{var r=Ot(this,t),value=r===-1?undefined:this._values[r];return value}};Bt.prototype.has=function e(t){return H(t)?Ot(this,t)!==-1:this._arrays.has(t)};Bt.prototype.set=function e(t,value){if(H(t)){if(this._arrays.set(t,value)){this._size+=1}}else{var r=Ot(this,t);if(r===-1){this._size+=1;this._keys.push(Pt(t)?Dt:t);this._values.push(value)}else{this._values[r]=value}}return this};Bt.prototype.keys=function e(){var e=this._keys.slice();for(var t=0;t<e.length;++t){if(e[t]===Dt){e[t]=NaN}}return e.concat(this._arrays.keys())};Bt.prototype.values=function e(){return this._values.slice().concat(this._arrays.values())};Object.defineProperties(Bt.prototype,Rt);function Ot(e,t){if(Pt(t)){return e._keys.indexOf(Dt)}else{return e._keys.indexOf(t)}}var Vt=function e(){this._map=new Map;this._arrays=new Ft};var jt={size:{configurable:true}};Vt.prototype.clear=function e(){this._arrays=new Ft;return this._map.clear()};Vt.prototype.delete=function e(t){return H(t)?this._arrays.delete(t):this._map.delete(t)};Vt.prototype.get=function e(t){return H(t)?this._arrays.get(t):this._map.get(t)};Vt.prototype.set=function e(t,value){if(H(t)){this._arrays.set(t,value)}else{this._map.set(t,value)}return this};Vt.prototype.keys=function e(){return Array.from(this._map.keys()).concat(this._arrays.keys())};Vt.prototype.values=function e(){return Array.from(this._map.values()).concat(this._arrays.values())};jt.size.get=function(){return this._map.size+this._arrays._keys.length};Object.defineProperties(Vt.prototype,jt);var Ut=Bt;if(typeof Map!=="undefined"&&typeof Map.prototype.keys!=="undefined"&&typeof Map.prototype.values!=="undefined"){try{(new Map).keys().next();(new Map).values().next();Ut=Vt}catch(e){}}var Gt=Ut;function Xt(e,value,t){var r=Math.abs(value-e[0]),i=0;for(var n=1;n<e.length;++n){var a=Math.abs(value-e[n]);if(a<r){r=a;i=n}}return t?i:e[i]}function Wt(e){return Ht(Math.log(e)/Math.LN2)}function Yt(e){var t=0;for(var r=0;r<e.length;++r){t+=e[r]}return t}function Ht(e){return typeof e==="number"&&e%1===0}function qt(e,t,r){if(r===1){return[e]}var i=(t-e)/(r-1),n=new Array(r);for(var a=0;a<r;++a){n[a]=e+i*a}return n}var Zt=100;function $t(e,t,r,i,n){var a=e(r)<=e(i),o=r,s=i;for(var u=0;u<Zt;++u){var l=(o+s)/2,value=e(l),f=Math.abs(value-t);if(f<=n){return l}if(value<t){if(a){o=l}else{s=l}}else{if(a){s=l}else{o=l}}}return l}function Kt(e,t,r){if(r===void 0)r=0;var value=1;while(value<e||value<r){value*=t}return value}function Jt(e,t){return Kt(e,2,t)}function Qt(value,e,t){return Math.max(e,Math.min(t,value))}function er(e,t,r){return e+(t-e)*r}function tr(){var e=0;return function(){return++e}}function rr(e){var t=typeof e;if(t==="string"){return e}else if(t==="function"||t==="number"||t==="boolean"){return e.toString()}else if(e===null){return"null"}else if(e===undefined){return"undefined"}else{return JSON.stringify(e)}}function ir(e){if(typeof e==="string"){return e.split(".")}else if(Array.isArray(e)){for(var t=0;t<e.length;++t){if(typeof e[t]!=="string"){throw new TypeError(e[t]+" is not a string")}}return e.slice()}else{throw new TypeError('invalid property path "'+e+'": expected string or array of strings')}}function nr(e,t,r){var i,n,a,o;if(t===0){return function(){e.apply(r,arguments)}}o=function(){i=false;if(n){a.apply(r,n);n=false}};a=function(){var a;if(i){n=arguments}else{a=e.apply(r,arguments);setTimeout(o,t);i=true}return a};return a}function ar(e,t,r){var i,n,a,o,s;if(t==null){t=100}function u(){var l=Date.now()-o;if(l<t&&l>=0){i=setTimeout(u,t-l)}else{i=null;if(!r){s=e.apply(a,n);a=n=null}}}var l=function(){a=this;n=arguments;o=Date.now();var l=r&&!i;if(!i){i=setTimeout(u,t)}if(l){s=e.apply(a,n);a=n=null}return s};l.clear=function(){if(i){clearTimeout(i);i=null}};l.flush=function(){if(i){s=e.apply(a,n);a=n=null;clearTimeout(i);i=null}};return l}function or(e,t,r,i,n){r(e[t],t,e,i,n).then(function(a){if(t===e.length-1){i(a)}else{or(e,t+1,r,i,n)}}).catch(n)}function sr(e,t){return new Promise(function(r,i){or(e,0,t,r,i)})}function ur(e){var t=e.toString();return t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))}var lr=/^[+-]?(?:\d+|\d*[.,]\d+)(e\d+)?$/;function fr(e){if(typeof e==="number"){return isFinite(e)?e:NaN}else if(typeof e==="string"){return lr.test(e)?parseFloat(e):NaN}else{return NaN}}function hr(e){return!isNaN(fr(e))}function vr(){return new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120}function dr(e,t){var r=e.indexOf(t);if(r!==-1){e.splice(r,1);return true}return false}function cr(e){if(!e.length){return-Infinity}var t=e[0];for(var r=1,i=e.length;r<i;++r){var n=e[r];if(n>t){t=n}}return t}function _r(e){if(!e.length){return Infinity}var t=e[0];for(var r=1,i=e.length;r<i;++r){var n=e[r];if(n<t){t=n}}return t}var gr=8;var pr=function e(t){this._constructor=t;this._array=new t(gr);this._capacity=gr;this.length=0};pr.prototype.reserve=function e(t){if(this._capacity<t){t=Math.pow(2,Math.ceil(Math.log2(t+1)));var r=new this._constructor(t);r.set(this._array);this._capacity=t;this._array=r}};pr.prototype.has=function e(value){var t=yr(this._array,value,0,this.length);return t<this.length&&this._array[t]===value};pr.prototype.add=function e(value){var t=yr(this._array,value,0,this.length),r=t<this.length&&this._array[t]===value;if(!r){if(this.length===this._capacity){this.reserve(this.length+1)}this._array.copyWithin(t+1,t,this.length);this._array[t]=value;this.length+=1}return!r};pr.prototype.remove=function e(value){var t=yr(this._array,value,0,this.length),r=t<this.length&&this._array[t]===value;if(r){this._array.copyWithin(t,t+1,this.length);this.length-=1}return r};pr.prototype.removeByPosition=function e(t){if(t>=this.length){return false}this._array.copyWithin(t,t+1,this.length);this.length-=1;return true};pr.prototype.get=function e(t){return this._array[t]};pr.prototype.clear=function e(){this.length=0};pr.prototype.slice=function e(){return this._array.slice(0,this.length)};function yr(e,t,r,i){if(r===i){return r}else{var n=r+((i-r)/2|0),value=e[n],a=t-value;if(a===0){return n}else if(a<0){return yr(e,t,r,n)}else{return yr(e,t,n+1,i)}}}function mr(e,t,r,i,n,a){if(a===void 0)a={x:0,y:0};var o=Math.cos(n),s=Math.sin(n),u=e-r,l=t-i;a.x=o*u-s*l+r;a.y=s*u+o*l+i;return a}function xr(e,t,r,i){if(r===void 0)r=0;if(i===void 0)i={};var n=e.x;var a=e.y;i.x=n+r*Math.sin(t);i.y=a+r*Math.cos(t);return i}function distance(e,t,r,i){return Math.sqrt((e-r)*(e-r)+(t-i)*(t-i))}function br(e,t,r,i){var n=e-r;var a=t-i;return n*n+a*a}function Ar(e,t){return(e.y-t.y)/(e.x-t.x)}function wr(e){return e/180*Math.PI}function Er(e){return e*180/Math.PI}function Sr(e,t){e.minX-=t;e.minY-=t;e.maxX+=t;e.maxY+=t;e.width+=2*t;e.height+=2*t;return e}function Cr(e){var t=0;var r=0;for(var i=0;i<e.length;++i){var n=e[i];t+=n.x;r+=n.y}t/=e.length;r/=e.length;return{x:t,y:r}}function Tr(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i);if(o===0){a.x=n;a.y=0}else{var s=n/distance(e,t,r,i);a.x=(r-e)*s;a.y=(i-t)*s}return a}function Mr(e,t,r,i){return e*r+t*i}function kr(e,t){return Math.sqrt(e*e+t*t)}var Ir=["x","y","ax","ay","zx","zy","ox","oy"];function Nr(){this.x=0;this.y=0;this.ax=0;this.ay=0;this.zx=0;this.zy=0;this.ox=0;this.oy=0}Nr.prototype.reset=function(){var e=this;for(var t=0;t<Ir.length;++t){e[Ir[t]]=0}return this};Nr.prototype.add=function(e){var t=this;for(var r=0;r<Ir.length;++r){var i=Ir[r];t[i]+=e[i]}return this};Nr.prototype.mergeCoordinates=function(){return{x:this.x+this.zx+this.ax+this.ox,y:this.y+this.zy+this.ay+this.oy}};Nr.prototype.set=function(e){var t=this;if(e instanceof Nr){for(var r=0;r<Ir.length;++r){var i=Ir[r];t[i]=e[i]}}else{K(e,function(value,e){this[e]=value},this)}return this};Nr.prototype.setAll=function(e,t,r,i,n,a,o,s){this.x=e;this.y=t;this.ax=n;this.ay=a;this.zx=r;this.zy=i;this.ox=o;this.oy=s;return this};Nr.prototype.setXY=function(e,t){this.x=e;this.y=t;return this};Nr.prototype.setZXY=function(e,t){this.zx=e;this.zy=t;return this};Nr.prototype.setAXY=function(e,t){this.ax=e;this.ay=t;return this};Nr.prototype.setOXY=function(e,t){this.ox=e;this.oy=t;return this};Nr.prototype.addXY=function(e,t){this.x+=e;this.y+=t;return this};Nr.prototype.addZXY=function(e,t){this.zx+=e;this.zy+=t;return this};Nr.prototype.addOXY=function(e,t){this.ox+=e;this.oy+=t;return this};Nr.prototype.clone=function(){return(new Nr).setAll(this.x,this.y,this.zx,this.zy,this.ax,this.ay,this.ox,this.oy)};function Lr(e,t,r,i,n,a){var o=e,s=t;r.x=o.x-s.x;r.y=o.y-s.y;r.ax=o.ax-s.ax;r.ay=o.ay-s.ay;r.zx=o.zx-s.zx;r.zy=o.zy-s.zy;r.ox=o.ox-s.ox;r.oy=o.oy-s.oy;i.x=o.x+s.x;i.y=o.y-s.y;i.ax=o.ax+s.ax;i.ay=o.ay-s.ay;i.zx=o.zx+s.zx;i.zy=o.zy-s.zy;i.ox=o.ox+s.ox;i.oy=o.oy-s.oy;n.x=o.x+s.x;n.y=o.y+s.y;n.ax=o.ax+s.ax;n.ay=o.ay+s.ay;n.zx=o.zx+s.zx;n.zy=o.zy+s.zy;n.ox=o.ox+s.ox;n.oy=o.oy+s.oy;a.x=o.x-s.x;a.y=o.y+s.y;a.ax=o.ax-s.ax;a.ay=o.ay+s.ay;a.zx=o.zx-s.zx;a.zy=o.zy+s.zy;a.ox=o.ox-s.ox;a.oy=o.oy+s.oy}var zr={x:0,y:0};function Dr(e,t,r,i,n,a,o,s){Tr(e.x,e.y,t.x,t.y,.5,zr);n.x=e.x-zr.y*r;n.y=e.y+zr.x*r;n.ax=e.ax-zr.y*i;n.ay=e.ay+zr.x*i;n.zx=e.zx;n.zy=e.zy;n.ox=e.ox;n.oy=e.oy;a.x=e.x+zr.y*r;a.y=e.y-zr.x*r;a.ax=e.ax+zr.y*i;a.ay=e.ay-zr.x*i;a.zx=e.zx;a.zy=e.zy;a.ox=e.ox;a.oy=e.oy;s.x=t.x-zr.y*r;s.y=t.y+zr.x*r;s.ax=t.ax-zr.y*i;s.ay=t.ay+zr.x*i;s.zx=t.zx;s.zy=t.zy;s.ox=t.ox;s.oy=t.oy;o.x=t.x+zr.y*r;o.y=t.y-zr.x*r;o.ax=t.ax+zr.y*i;o.ay=t.ay-zr.x*i;o.zx=t.zx;o.zy=t.zy;o.ox=t.ox;o.oy=t.oy}function Pr(e){var t=this;Array.call(this);Object.defineProperty(this,"__internalCounter",{value:{},writable:true});for(var r=0;r<e;++r){t.push(new Nr)}for(r=0;r<Ir.length;++r){Fr(t,Ir[r])}for(r=0;r<Br.length;++r){t.__internalCounter[Br[r]]=0}}Pr.prototype=Object.create(Array.prototype);Pr.prototype.constructor=Pr;function Fr(e,t){Object.defineProperty(e,t,{get:function(){var e=this;var r=new Array(this.length);for(var i=0;i<this.length;++i){r[i]=e[i][t]}return r},set:function(value){var e=this;for(var r=0;r<this.length;++r){e[r][t]=value}},enumerable:false})}var Br=["setXY","setZXY","setAXY","setOXY"];Pr.prototype.reset=function(){var e=this;for(var t=0;t<Br.length;++t){e.__internalCounter[Br[t]]=0}for(t=0;t<this.length;++t){e[t].reset()}return this};for(var Rr=0;Rr<Br.length;++Rr){Or(Br[Rr])}function Or(e){Pr.prototype[e]=function(t,r){this[this.__internalCounter[e]][e](t,r);this.__internalCounter[e]+=1;if(this.__internalCounter[e]===this.length){this.__internalCounter[e]=0}return this}}Pr.prototype.mergeCoordinates=function(){var e=this;var t=[];for(var r=0;r<this.length;++r){t.push(e[r].mergeCoordinates())}return t};Pr.prototype.getXYList=function(){var e=this;var t=new Array(this.length);for(var r=0;r<this.length;++r){t[r]={x:e[r].x,y:e[r].y}}return t};var Vr=[];var jr=[RegExp,Date];if(typeof HTMLElement!=="undefined"){Vr.push(HTMLElement)}function Ur(e,t){for(var r=0;r<t.length;++r){if(e instanceof t[r]){return true}}return false}var Gr=function(e){return typeof e!=="object"||e===null||H(e)||Ur(e,jr)};function Xr(e,t,r,i){if(t===void 0)t=Gr;if(r===void 0)r=[];if(i===void 0)i=[];if(Ur(e,Vr)){return}if(t(e)){r.push({path:i.slice(),value:e})}else{var n=Object.keys(e);for(var a=0;a<n.length;++a){var o=n[a],s=i.slice();s.push(o);Xr(e[o],t,r,s)}}return r}var Wr=function e(){this._keys=[];this._values=[];this._size=0;this._cachedPath=[];this._cachedIndex=-1};var Yr={size:{configurable:true}};Yr.size.get=function(){return this._size};Wr.prototype.set=function e(t,value){var r=Hr(this,t);if(r!==-1){this._values=value}else{if(qr(this._cachedPath,t)){this._cachedIndex=this._keys.length}this._keys.push(t);this._values.push(value);this._size+=1}};Wr.prototype.get=function e(t){var r=Hr(this,t);if(r!==-1){return this._values[r]}else{return undefined}};Wr.prototype.has=function e(t){return Hr(this,t)!==-1};Wr.prototype.keys=function e(){return this._keys.slice()};Object.defineProperties(Wr.prototype,Yr);function Hr(e,t){if(qr(t,e._cachedPath)){return e._cachedIndex}e._cachedPath=t.slice();for(var r=0;r<e._keys.length;++r){if(qr(e._keys[r],t)){e._cachedIndex=r;return r}}e._cachedIndex=-1;return-1}function qr(e,t){if(e.length!==t.length){return false}for(var r=0;r<e.length;++r){if(e[r]!==t[r]){return false}}return true}function Zr(e,t,r,i,n,a,o,s,u){if(o===0){return e.rectangle(t,{x:r+n/2,y:i+a/2},{zx:n/2,zy:a/2},s,u)}else{var l=e.updateComposite(t,7);l[0]=e.quadrilateral(l[0],{x:r,y:i+o-1},{x:r+n,y:i+o-1},{x:r+n,y:i+a-o+1},{x:r,y:i+a-o+1},s,u);l[1]=e.quadrilateral(l[1],{x:r+o,y:i},{x:r+n-o,y:i},{x:r+n-o,y:i+o},{x:r+o,y:i+o},s,u);l[2]=e.quadrilateral(l[2],{x:r+o,y:i+a-o},{x:r+n-o,y:i+a-o},{x:r+n-o,y:i+a},{x:r+o,y:i+a},s,u);l[3]=e.circle(l[3],{x:r+o,y:i+o},0,o,s,u);l[4]=e.circle(l[4],{x:r+n-o,y:i+o},0,o,s,u);l[5]=e.circle(l[5],{x:r+o,y:i+a-o},0,o,s,u);l[6]=e.circle(l[6],{x:r+n-o,y:i+a-o},0,o,s,u);return e.composite(t,l)}}var $r=50;function Kr(e,t,r,i,n,a,o,s){var u=e.updateComposite(t,$r),l=Math.PI*2/$r,f=a/2,h=l,v={x:r,y:i,zx:n,zy:0},d={x:r,y:i,zx:n,zy:0,ox:f,oy:0};for(var c=0;c<$r;++c){var _=Math.cos(h),g=Math.sin(h),p={x:r,y:i,zx:_*n,zy:g*n},y={x:r,y:i,zx:_*n,zy:g*n,ox:_*f,oy:g*f};u[c]=e.quadrilateral(u[c],v,p,y,d,o,s);v=p;d=y;h+=l}return e.composite(t,u)}var Jr=function e(){this._values=[]};var Qr={size:{configurable:true}};Qr.size.get=function(){return this._values.length};Jr.prototype.clear=function e(){this._values=[]};Jr.prototype.add=function e(value){if(this._getIndex(value)===-1){this._values.push(value);return true}return false};Jr.prototype.addMultiple=function e(t){var r=this;for(var i=0;i<t.length;++i){r.add(t[i])}};Jr.prototype.remove=function e(value){var t=this._getIndex(value);if(t!==-1){this._values.splice(t,1);return true}return false};Jr.prototype.has=function e(value){return this._getIndex(value)!==-1};Jr.prototype.values=function e(){return this._values.slice()};Jr.prototype.keys=function e(){return this._values};Jr.prototype._getIndex=function e(value){return this._values.indexOf(value)};Object.defineProperties(Jr.prototype,Qr);var ei=function e(){this._set=new Set};var ti={size:{configurable:true}};ti.size.get=function(){return this._set.size};ei.prototype.clear=function e(){this._set.clear()};ei.prototype.add=function e(value){var t=this._set.size;this._set.add(value);var r=this._set.size;return r!==t};ei.prototype.addMultiple=function e(t){var r=this;for(var i=0;i<t.length;++i){r.add(t[i])}};ei.prototype.remove=function e(value){return this._set.delete(value)};ei.prototype.has=function e(value){return this._set.has(value)};ei.prototype.values=function e(){return Array.from(this._set.values())};ei.prototype.keys=function e(){return Array.from(this._set.keys())};Object.defineProperties(ei.prototype,ti);var ri=Jr;if(typeof Set!=="undefined"){ri=ei;if(!Set.prototype.values){ri.prototype.values=function(){var e=new Array(this._set.size);var t=0;this._set.forEach(function(value){return e[t++]=value});return e}}}var ii=ri;var ni={1:ui(1),2:ui(2),4:ui(4),8:oi(),16:oi(),32:oi(),int8:oi(),int16:oi(),int32:oi(),float:oi(),any:oi()};var ai={1:li(1),2:li(2),4:li(4),8:si(),16:si(),32:si(),int8:si(),int16:si(),int32:si(),float:si(),any:si()};function oi(){return new Function("array","index","return array[index];")}function si(){return new Function("array","index","value","array[index] = value;")}function ui(e){var t=8/e;var r="return (array[index / "+t+" | 0] >> ((index % "+t+") * "+e+")) & "+((1<<e)-1)+";";return new Function("array","index",r)}function li(e){return new Function("array","index","value","\n    var offset = (index % "+8/e+") * "+e+",\n        finalIndex = index / "+8/e+" | 0,\n        orMask = value << offset,\n        andMask = 255 - (("+(Math.pow(2,e)-1)+" - value) << offset);\n\n    array[finalIndex] = (array[finalIndex] & andMask) | orMask;")}var fi=function e(t){var r=t.name;var i=t.storage;var n=t.size||0;var a=t.default;var o=Math.max(8,_i(n+1));var s=i==="resource"?1:i;if(a===undefined&&i!=="any"&&i!=="resource"){a=0}this._name=r;this._storage=i;this._get=ni[s];this._set=ai[s];this._elementSize=s;this._nbElements=o;this._byName=undefined;this._byIndex=undefined;this._nextIndex=undefined;this._defaultValue=a;this._BASE_VALUE=i==="any"?undefined:0;this._methods=vi;this._initialized=false;if(i==="resource"){this._methods=di;this._byName={};this._byIndex=[];this._nextIndex=1;this._byName[a]=0;this._byIndex.push(a)}};fi.prototype.getName=function e(){return this._name};fi.prototype.getValues=function e(){return this._byIndex?this._byIndex.slice():null};fi.prototype.get=function e(){return this._defaultValue};fi.prototype.initialize=function e(){if(!this._initialized){this._initialize()}return this};fi.prototype._initialize=function e(){this._initialized=true;this._buffer=gi(this._nbElements,this._elementSize);this.get=this._methods.get;this.set=this._methods.set;if(this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE){hi(this,0)}};fi.prototype.set=function e(t,value){this._initialize();return this._methods.set.call(this,t,value)};fi.prototype.increaseNbElements=function e(t){var r=this;var i=_i(t+1);if(i<=this._nbElements){return}if(this._initialized){if(this._elementSize==="any"){for(var n=this._nbElements;n<i;++n){r._buffer.push(r._defaultValue)}}else{var a=gi(i,this._elementSize);a.set(this._buffer);this._buffer=a;if(this._storage!=="resource"&&this._defaultValue!==this._BASE_VALUE){hi(this,this._nbElements)}}}this._nbElements=i};fi.prototype.increaseElementSize=function e(){var t=this._elementSize;if(typeof t!=="number"||t===32){throw new Error("FlexArray: cannot increase element size")}var r=t*2,i=ni[r],n=ai[r];if(this._initialized){var a=this._nbElements,o=this._get,s=this._buffer,u=gi(a,r);if(t>=8){u.set(s)}else{for(var l=0;l<a;++l){n(u,l,o(s,l))}}this._buffer=u}this._elementSize=r;this._get=i;this._set=n};fi.prototype.buffer=function e(){if(!this._buffer){throw new Error("flexArray: buffer not instanciated")}return this._buffer};fi.prototype.elementBitSize=function e(){return this._elementSize};fi.prototype.capacity=function e(){return this._nbElements};fi.prototype.byteSize=function e(){return this._nbElements*this._elementSize/8};fi.prototype.isInitialized=function e(){return this._initialized};fi.prototype.getMultiple=function e(t,r){var i=this;var n=t.length;if(r===undefined){r=new Array(n)}for(var a=0,o=n;a<o;++a){r[a]=i.get(t[a])}return r};fi.prototype.fill=function e(t,value){var r=this;for(var i=0,n=t.length;i<n;++i){r.set(t[i],value)}};fi.prototype.setMultiple=function e(t,r,i){var n=this;if(!i&&(Array.isArray(r)||ArrayBuffer.isView(r))){for(var a=0,o=t.length;a<o;++a){n.set(t[a],r[a])}}else{for(var s=0,u=t.length;s<u;++s){n.set(t[s],r)}}};fi.prototype.reset=function e(){if(this._initialized){hi(this,0)}};function hi(e,t){var value=e._storage==="resource"?0:e._defaultValue;if(typeof e._elementSize!=="number"||e._elementSize>=8){e._buffer.fill(value,t)}else{var r=8/e._elementSize,i=0;for(var n=0;n<r;++n){i=i<<e._elementSize;i+=value}if(t===undefined){e._buffer.fill(i)}else{var a=8-t%8,o=t+a;for(var s=t;s<o;++s){e._set(e._buffer,s,value)}e._buffer.fill(i,o/8)}}}var vi={get:function e(t){return this._get(this._buffer,t)},set:function e(t,value){this._set(this._buffer,t,value)}};var di={get:function e(t){return this._byIndex[this._get(this._buffer,t)]},set:function e(t,value){var r=this._byName[value];if(r===undefined){r=this._nextIndex++;this._byIndex.push(value);var i=ci(this);if(i>this._elementSize){this.increaseElementSize()}this._byName[value]=r}this._set(this._buffer,t,r)}};function ci(e){return Math.pow(2,Math.ceil(Math.log2(Math.log2(e._nextIndex))))}function _i(e){var t=2;while(t<e){t*=2}return t}function gi(e,t){if(t==="any"){var r=new Array(e);return r}else if(t==="float"){return new Float32Array(e)}else if(t==="int8"){return new Int8Array(e)}else if(t==="int16"){return new Int16Array(e)}else if(t==="int32"){return new Int32Array(e)}else if(t===32){return new Uint32Array(e)}else if(t===16){return new Uint16Array(e)}else{return new Uint8Array(Math.ceil(e/8*t))}}var pi=function e(t){this._isNode=t;this._name=t?"node":"edge";this._nextIndex=1;this._freeIndexes=[];this._indexesToBeFreed=[];this._idToIndex=Object.create(null);this._indexToId=[undefined];this._size=0;this._flexArrays=[];this._defaultValues=[];this._flexArraysByName={};this._indexes=[]};pi.prototype.addElements=function e(t){var r=this;var i=[];for(var n=0,a=t.length;n<a;++n){var o=t[n];var s=r._idToIndex[o];if(s===undefined){s=r._getNextIndex();r._idToIndex[o]=s;r._indexToId[s]=o}i.push(s)}this._size+=t.length;for(var u=0;u<this._flexArrays.length;++u){r._flexArrays[u].increaseNbElements(r._nextIndex)}this._indexes=this.getAllIndexes();return i};pi.prototype.removeElements=function e(t){var r=this;for(var i=0,n=t.length;i<n;++i){var a=t[i],o=r._indexToId[a];if(o!==undefined){delete r._idToIndex[o];r._removeIndex(r,a);r._size-=1}}this._indexes=this.getAllIndexes()};pi.prototype.clear=function e(){var t=this;this._idToIndex=Object.create(null);this._indexToId=[undefined];this._size=0;this._nextIndex=1;this._freeIndexes=[];this._indexes=[];for(var r=0;r<this._flexArrays.length;++r){t._flexArrays[r].reset()}};pi.prototype.has=function e(t){return this._indexToId[t]!==undefined};pi.prototype.getIndex=function e(t,r){if(r===void 0)r=false;var i=this._idToIndex[t];if(i===undefined&&r){throw new Error(this._name+' id "'+t+'" not found')}return i};pi.prototype.getAllIndexes=function e(){var t=this;var r=this._nextIndex,i=this._freeIndexes.length,n=new Array(r);for(var a=0;a<r;++a){n[a]=a}for(var o=0;o<i;++o){var s=t._freeIndexes[o];for(var u=s;n[u]!==s;--u){}n.splice(u,1)}n.shift();return n};pi.prototype.allIndexes=function e(){return this._indexes};pi.prototype.createFlexArray=function e(t){var r=t.name;if(r&&this._flexArraysByName[r]){throw new Error(this._name+' flexArray "'+r+'" already exists')}var i=t.default;if(i===undefined&&t.storage!=="any"&&t.storage!=="resource"){i=0}var n=this._nextIndex;var a=new fi({storage:t.storage,size:n,default:i,name:r});this._flexArrays.push(a);this._defaultValues.push(t.default);if(r){this._flexArraysByName[r]=a}return a};pi.prototype.removeFlexArray=function e(t){if(typeof t==="string"){var r=t;t=this._flexArraysByName[r];delete this._flexArraysByName[r]}var i=this._flexArrays.indexOf(t);if(i!==-1){this._flexArrays.splice(i,1);this._defaultValues.splice(i,1)}};pi.prototype.getFlexArray=function e(t){return this._flexArraysByName[t]||null};pi.prototype.getAllFlexArrays=function e(){return this._flexArrays.slice()};pi.prototype.getId=function e(t){return this._indexToId[t]};pi.prototype.getIdList=function e(t,r){var i=this;if(!r){r=new Array(t.length)}for(var n=0;n<t.length;++n){r[n]=i._indexToId[t[n]]}return r};pi.prototype.getMaxIndex=function e(){return this._nextIndex};pi.prototype._removeIndex=function e(t){this._indexToId[t]=undefined;this._indexesToBeFreed.push(t)};pi.prototype._getNextIndex=function e(){var t=this._freeIndexes.pop();if(t===undefined){t=this._nextIndex++}return t};pi.prototype.freeIndexes=function e(){var t=this;var r=this._indexesToBeFreed;for(var i=0;i<r.length;++i){t._freeIndexes.push(r[i])}for(var n=0;n<this._flexArrays.length;++n){var a=t._flexArrays[n];var o=t._defaultValues[n];for(var s=0;s<r.length;++s){a.set(r[s],o)}}this._indexesToBeFreed=[]};var yi=8;var mi=function e(){this._BIG_LIST=new Uint8Array([-1])[0];this._MAX_LIST_SIZE=8;this._capacity=yi;this._buffer=new Uint32Array(this._capacity*this._MAX_LIST_SIZE);this._sizes=new Uint8Array(this._capacity);this._bigLists=[];this._nextIndex=0;this._constList=new Array(this._MAX_LIST_SIZE)};mi.prototype.addEntry=function e(t){if(t===undefined){t=this._nextIndex++}if(t>=this._capacity){this._expand(t+1)}this._sizes[t]=0;return t};mi.prototype.get=function e(t){var r=this;var i=this._sizes[t],n=this._MAX_LIST_SIZE*t;if(i<=this._MAX_LIST_SIZE){this._constList.length=i;for(var a=0,o=i;a<o;++a){r._constList[a]=r._buffer[n+a]}return this._constList}else if(i===this._BIG_LIST){var s=this._buffer[n];return this._bigLists[s]}};mi.prototype.size=function e(t){var e=this._sizes[t];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[t*this._MAX_LIST_SIZE]].length};mi.prototype.sizes=function e(t){var e=this._sizes;var r=this._bigLists;var i=this._buffer;var n=this._MAX_LIST_SIZE;var a=t.length;var o=new Array(a);for(var s=0;s<a;s++){var u=t[s];var l=e[u];o[s]=l<=n?l:r[i[u*n]].length}return o};mi.prototype.addTo=function e(t,value){var r=this;var i=this._sizes[t],n=t*this._MAX_LIST_SIZE;if(i<this._MAX_LIST_SIZE){this._buffer[n+i]=value;this._sizes[t]=i+1}else if(i===this._BIG_LIST){var a=this._buffer[n];this._bigLists[a].push(value)}else{var o=new Array(this._MAX_LIST_SIZE);for(var s=0;s<this._MAX_LIST_SIZE;++s){o[s]=r._buffer[n+s]}o.push(value);this._bigLists.push(o);this._sizes[t]=this._BIG_LIST;this._buffer[n]=this._bigLists.length-1}};mi.prototype.removeFrom=function e(t,value){this.removeFromAndGetSize(t,value)};mi.prototype.removeFromAndGetSize=function e(t,value){var r=this;var i=this._sizes[t],n=this._MAX_LIST_SIZE*t;if(i<=this._MAX_LIST_SIZE){for(var a=n,o=n+i;a<o;++a){if(r._buffer[a]===value){i-=1;r._buffer[a]=r._buffer[o-1];r._sizes[t]=i;return i}}}else if(i===this._BIG_LIST){var s=this._buffer[n],u=this._bigLists[s],l=u.indexOf(value);if(l!==-1){u.splice(l,1);return u.length}}throw new Error('topology: Table: "removeFrom" failed, should not happen')};mi.prototype.reserve=function e(t){if(this._capacity<t){this._expand(t)}};mi.prototype._expand=function e(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t)));this._buffer=xi(this._buffer,this._capacity*this._MAX_LIST_SIZE);this._sizes=xi(this._sizes,this._capacity)};function xi(e,t){var r=new e.constructor(t);r.set(e);return r}function bi(e){return e===null?e:undefined}function Ai(e){return typeof e==="boolean"||e===0||e===1?e:undefined}function wi(e){return typeof e==="number"&&isFinite(e)?e:undefined}function Ei(e){return typeof e==="number"&&isFinite(e)&&e>=0?e:undefined}function Si(e){return typeof e==="number"&&isFinite(e)&&e>0?e:undefined}function Ci(e){return typeof e==="number"&&isFinite(e)&&e%1===0&&e>=-1&&e<=3?e:undefined}function Ti(e){return e===null||typeof e==="string"||typeof e==="number"?e:undefined}function Mi(e,t){return t.parseColor(e)?e:undefined}function ki(e,t){return e==="inherit"||t.parseColor(e)?e:undefined}function Ii(e,t){return e==="source"||e==="target"||!!t.parseColor(e)?e:undefined}function Ni(e){if(e===null){return null}if(typeof e!=="string"){return undefined}return e.split(",").map(function(e){var t=e.trim();var r=t.indexOf(" ")!==-1;var i=t[0];return r&&i!=='"'&&i!=="'"?'"'+t+'"':t}).join(",")}function Li(e){if(e==="none"){return"normal"}return e==="normal"||e==="italic"||e==="bold"||e==="italic bold"?e:undefined}function zi(e){return e==="left"||e==="center"?e:undefined}function Di(e){if(e==="equilateral"){return"pentagon"}return e==="circle"||e==="square"||e==="cross"||e==="diamond"||e==="pentagon"||e==="star"?e:undefined}function Pi(e){return["line","tapered","arrow","dashed","dotted"].includes(e)?e:undefined}function Fi(e){return e==="line"||e==="triangle"?e:undefined}function Bi(e){return e===null||e==="arrow"?e:undefined}function Ri(e){return e==="plain"||e==="dashed"||e==="dotted"?e:undefined}function Oi(e){return e==="top"||e==="bottom"||e==="left"||e==="right"||e==="center"?e:undefined}function Vi(e,t){if(t.parseColor(e)){return e}if(Array.isArray(e)){if(e.length<1){return undefined}for(var r=0;r<e.length;++r){if(!t.parseColor(e[r])){return undefined}}return e}return undefined}function ji(e){return new Function("x",["if (typeof x === 'number') { return (typeof x === 'number' && isFinite(x) && x >= 0) ? x : undefined; }","else if (typeof x !== 'string' || x.charAt(x.length - 1) !== '%') { return undefined; }","else { var p = parseFloat(x); return isNaN(p) ? undefined : ("+e+" * p / 100); }"].join("\n"))}var Ui=P("webworker-threads",{throwOnError:false}),Gi=null;if(Ui){Gi=Ui.Worker}function Xi(e){if(Gi){return Hi(e)}else if(typeof URL==="undefined"||navigator.appVersion.indexOf("MSIE 10")!==-1){return Yi(e)}else{return Wi(e)}}function Wi(e){try{var t=new Blob([e],{type:"application/javascript"}),r=URL.createObjectURL(t),i=new Worker(r);return i}catch(t){return new qi(e)}}function Yi(e){return new qi(e)}function Hi(e){return new Gi(new Function(e))}var qi=function e(t){this._f=new Function("self",t);this._main=true;this._listeners=[];this._terminated=false;this._otherSide=new Zi(this);this._f(this._otherSide)};qi.prototype.terminate=function e(){this._terminated=false;this._otherSide._terminated=true};qi.prototype.addEventListener=$i;qi.prototype.postMessage=Ki;var Zi=function e(t){this._main=false;this._listeners=[];this._terminated=false;this._otherSide=t};Zi.prototype.addEventListener=$i;Zi.prototype.postMessage=Ki;function $i(e,t){this._listeners.push(t)}function Ki(e){setTimeout(Ji,0,this._otherSide,{data:e})}function Ji(e,t){if(e._terminated){return}for(var r=0;r<e._listeners.length;++r){e._listeners[r](t)}}var Qi=/^rgba?\((\d+),?\s*(\d+),?\s*(\d+),?\s*((\d+)?\.?\d+)*\)$/;function en(e,t){if(t===void 0)t=[];var r=Qi.exec(e);if(r){t[0]=parseInt(r[1])/255;t[1]=parseInt(r[2])/255;t[2]=parseInt(r[3])/255;t[3]=r[4]===undefined?1:parseFloat(r[4]);return t}else{return null}}function tn(e){if(e<16){return"0"+e.toString(16)}else{return e.toString(16)}}function rn(e){var t=e[0];var r=e[1];var i=e[2];var n=e[3];if(n===void 0)n=1;return"rgba("+(t*256|0)+","+(r*256|0)+","+(i*256|0)+","+n+")"}function nn(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,r,i){return t+t+r+r+i+i});var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(r){return[parseInt(r[1],16)/255,parseInt(r[2],16)/255,parseInt(r[3],16)/255,1]}else{return null}}var an=function e(t){this._name=t;this._attributes={};this._children=[]};var on={tagName:{configurable:true},children:{configurable:true},childNodes:{configurable:true},firstChild:{configurable:true}};an.prototype.setAttribute=function e(t,value){this._attributes[t]=value};an.prototype.appendChild=function e(t){this._children.push(t)};on.tagName.get=function(){return this._name};on.children.get=function(){return this._children};on.childNodes.get=function(){return this._children};on.firstChild.get=function(){return this._children[0]||null};an.prototype.serialize=function e(){var t=this._name;var r=this._attributes;var i=this._children;var n=Object.keys(r).filter(function(e){return r[e]!==undefined});var a=n.map(function(e){return" "+e+'="'+(""+r[e])+'"'}).join("");var o=i.map(function(e){return e.serialize()}).join("");if(!o.length){return"<"+t+a+"/>"}else{return"<"+t+a+">"+o+"</"+t+">"}};an.prototype.cloneNode=function e(t){var r=this;var i=new an(this._name);for(var n in r._attributes){i.setAttribute(n,r._attributes[n])}if(t){for(var a=0;a<this._children.length;a++){i.appendChild(r._children[a].cloneNode(t))}}return i};Object.defineProperties(an.prototype,on);var sn=function e(t){this._text=t};sn.prototype.serialize=function e(){return this._text};sn.prototype.cloneNode=function e(){return new sn(this._text)};var un=function e(){this._children=[];this._meta=[]};un.prototype.appendChild=function e(t){this._children.push(t)};un.prototype.serialize=function e(){return this._meta.concat(this._children.map(function(e){return e.serialize()})).join("")};un.prototype.createElement=function e(t){return new an(t)};un.prototype.createTextNode=function e(t){return new sn(t)};function ln(){return new un}var fn=function e(t){this._keyToValue=t;this._keyToIndex=new Int32Array(t.length);this._heap=[];this._size=0;this._keyToIndex.fill(-1)};fn.prototype.add=function e(t){var r=this._keyToIndex[t];if(r===-1){r=this._size++;this._heap[r]=t}this._keyToIndex[t]=this._bubble(r)};fn.prototype.removeMin=function e(){if(this._size===0){return NaN}var t=this._heap[0];this._heap[0]=this._heap[--this._size];this._bubble(0);return t};fn.prototype.isEmpty=function e(){return this._size===0};fn.prototype.has=function e(t){return this._keyToIndex[t]!==-1};fn.prototype._bubble=function e(t){var value=this._indexToValue(t);var r=this._getParentIndex(t);var i=this._indexToValue(r);var n=t;if(t!==0&&i>value){n=this._swap(t,r)}else{var a=this._getLeftChildIndex(t);var o=this._getRightChildIndex(t);var s=this._indexToValue(a);var u=this._indexToValue(o);var l=Math.min(value,s,u);if(l===value);else if(l===s){n=this._swap(t,a)}else{n=this._swap(t,o)}}if(n===t){return t}else{return this._bubble(n)}};fn.prototype._indexToValue=function e(t){if(t>=this._size){return Infinity}else{return this._keyToValue[this._heap[t]]}};fn.prototype._getParentIndex=function e(t){return(t-1)/2|0};fn.prototype._getLeftChildIndex=function e(t){return t*2+1};fn.prototype._getRightChildIndex=function e(t){return t*2+2};fn.prototype._swap=function e(t,r){var i=this._heap[t];var n=this._heap[r];this._heap[t]=n;this._heap[r]=i;this._keyToIndex[i]=r;this._keyToIndex[n]=t;return r};function hn(e){return e.charAt(0).toUpperCase()+e.slice(1)}var vn=function e(t){if(t===void 0)t={};var r=t.xValues;if(r===void 0)r=[];var i=t.yValues;if(i===void 0)i=[];var n=t.sizeValues;if(n===void 0)n=[];this.minX=_r(r);this.minY=_r(i);this.maxX=cr(r);this.maxY=cr(i);this.minSize=_r(n);this.maxSize=cr(n);this.cx=this.minX+(this.maxX-this.minX)/2;this.cy=this.minY+(this.maxY-this.minY)/2;this.width=this.maxX-this.minX;this.height=this.maxY-this.minY};vn.prototype.reset=function e(){this.minX=Infinity;this.minY=Infinity;this.maxX=-Infinity;this.maxY=-Infinity;this.width=0;this.height=0;this.cx=0;this.cy=0;this.minSize=Infinity;this.maxSize=-Infinity;return this};vn.prototype.addPoint=function e(t,r,i){if(t<this.minX){this.minX=t}else if(t>this.maxX){this.maxX=t}if(r<this.minY){this.minY=r}else if(r>this.maxY){this.maxY=r}if(i!==undefined){if(i<this.minSize){this.minSize=i}else if(i>this.maxSize){this.maxSize=i}}this.cx=this.minX+(this.maxX-this.minX)/2;this.cy=this.minY+(this.maxY-this.minY)/2;this.width=this.maxX-this.minX;this.height=this.maxY-this.minY;return this};vn.prototype.pad=function e(value){this.minX-=value;this.minY-=value;this.maxX+=value;this.maxY+=value;this.width+=2*value;this.height+=2*value;return this};var dn=Array.isArray;var cn=function e(){};cn.prototype.on=function e(t,r){if(typeof t!=="string"){throw new TypeError("Event name must be string")}if(typeof r!=="function"){throw new TypeError("Event handler must be function")}var i=this._events=this._events||{};var n=i[t]=i[t]||[];n.push(r);return this};cn.prototype.off=function e(t,r){if(typeof t!=="string"){throw new TypeError("Event name must be string")}var i=this._event=this._events||{};var n=i[t];if(dn(n)){if(typeof r!=="function"){i[t]=null}else{var a=n.indexOf(r);if(a!==-1){n.splice(a,1)}if(n.length===0){i[t]=null}}}return this};cn.prototype.fire=function e(t){var r=this;if(typeof t!=="string"){throw new TypeError("Event name must be string")}var i=this._event=this._events||{};var n=i[t],a;if(dn(n)){var o=Array.prototype.slice.call(arguments,1);for(var s=0;s<n.length;s++){a=n[s];if(a){a.apply(r,o)}}}return this};cn.prototype.once=function e(t,r){var i=this;var n=function(){r.apply(i,Array.prototype.slice.call(arguments,0));i.off(t,n)};n.handler=r;return this.on(t,n)};cn.prototype.hasListener=function e(t,r){if(!t||!r){return false}var i=this._events=this._events||{};var n=i[t];if(dn(n)){var a;for(var o=0,s=n.length;o<s;o++){a=n[o];if(a===r||a.handler===r){return true}}}return false};cn.prototype.getListeners=function e(t){var r=this._events=this._events||{};return r[t]};cn.mixin=function(e){var t=typeof e==="function"?e.prototype:e;var r=["addEventListener","removeEventListener","addOneTimeEventListener","dispatch","on","off","once","fire","trigger"];for(var i=0,n=r.length;i<n;i++){var a=r[i];t[a]=cn.prototype[a]}return e};cn.prototype.addEventListener=cn.prototype.on;cn.prototype.removeEventListener=cn.prototype.off;cn.prototype.addOneTimeEventListener=cn.prototype.once;cn.prototype.trigger=cn.prototype.dispatch=cn.prototype.fire;var _n=["AliceBlue","#F0F8FF","AntiqueWhite","#FAEBD7","Aqua","#00FFFF","Aquamarine","#7FFFD4","Azure","#F0FFFF","Beige","#F5F5DC","Bisque","#FFE4C4","Black","#000000","BlanchedAlmond","#FFEBCD","Blue","#0000FF","BlueViolet","#8A2BE2","Brown","#A52A2A","BurlyWood","#DEB887","CadetBlue","#5F9EA0","Chartreuse","#7FFF00","Chocolate","#D2691E","Coral","#FF7F50","CornflowerBlue","#6495ED","Cornsilk","#FFF8DC","Crimson","#DC143C","Cyan","#00FFFF","DarkBlue","#00008B","DarkCyan","#008B8B","DarkGoldenRod","#B8860B","DarkGray","#A9A9A9","DarkGrey","#A9A9A9","DarkGreen","#006400","DarkKhaki","#BDB76B","DarkMagenta","#8B008B","DarkOliveGreen","#556B2F","DarkOrange","#FF8C00","DarkOrchid","#9932CC","DarkRed","#8B0000","DarkSalmon","#E9967A","DarkSeaGreen","#8FBC8F","DarkSlateBlue","#483D8B","DarkSlateGray","#2F4F4F","DarkSlateGrey","#2F4F4F","DarkTurquoise","#00CED1","DarkViolet","#9400D3","DeepPink","#FF1493","DeepSkyBlue","#00BFFF","DimGray","#696969","DimGrey","#696969","DodgerBlue","#1E90FF","FireBrick","#B22222","FloralWhite","#FFFAF0","ForestGreen","#228B22","Fuchsia","#FF00FF","Gainsboro","#DCDCDC","GhostWhite","#F8F8FF","Gold","#FFD700","GoldenRod","#DAA520","Gray","#808080","Grey","#808080","Green","#008000","GreenYellow","#ADFF2F","HoneyDew","#F0FFF0","HotPink","#FF69B4","IndianRed","#CD5C5C","Indigo","#4B0082","Ivory","#FFFFF0","Khaki","#F0E68C","Lavender","#E6E6FA","LavenderBlush","#FFF0F5","LawnGreen","#7CFC00","LemonChiffon","#FFFACD","LightBlue","#ADD8E6","LightCoral","#F08080","LightCyan","#E0FFFF","LightGoldenRodYellow","#FAFAD2","LightGray","#D3D3D3","LightGrey","#D3D3D3","LightGreen","#90EE90","LightPink","#FFB6C1","LightSalmon","#FFA07A","LightSeaGreen","#20B2AA","LightSkyBlue","#87CEFA","LightSlateGray","#778899","LightSlateGrey","#778899","LightSteelBlue","#B0C4DE","LightYellow","#FFFFE0","Lime","#00FF00","LimeGreen","#32CD32","Linen","#FAF0E6","Magenta","#FF00FF","Maroon","#800000","MediumAquaMarine","#66CDAA","MediumBlue","#0000CD","MediumOrchid","#BA55D3","MediumPurple","#9370DB","MediumSeaGreen","#3CB371","MediumSlateBlue","#7B68EE","MediumSpringGreen","#00FA9A","MediumTurquoise","#48D1CC","MediumVioletRed","#C71585","MidnightBlue","#191970","MintCream","#F5FFFA","MistyRose","#FFE4E1","Moccasin","#FFE4B5","NavajoWhite","#FFDEAD","Navy","#000080","OldLace","#FDF5E6","Olive","#808000","OliveDrab","#6B8E23","Orange","#FFA500","OrangeRed","#FF4500","Orchid","#DA70D6","PaleGoldenRod","#EEE8AA","PaleGreen","#98FB98","PaleTurquoise","#AFEEEE","PaleVioletRed","#DB7093","PapayaWhip","#FFEFD5","PeachPuff","#FFDAB9","Peru","#CD853F","Pink","#FFC0CB","Plum","#DDA0DD","PowderBlue","#B0E0E6","Purple","#800080","RebeccaPurple","#663399","Red","#FF0000","RosyBrown","#BC8F8F","RoyalBlue","#4169E1","SaddleBrown","#8B4513","Salmon","#FA8072","SandyBrown","#F4A460","SeaGreen","#2E8B57","SeaShell","#FFF5EE","Sienna","#A0522D","Silver","#C0C0C0","SkyBlue","#87CEEB","SlateBlue","#6A5ACD","SlateGray","#708090","SlateGrey","#708090","Snow","#FFFAFA","SpringGreen","#00FF7F","SteelBlue","#4682B4","Tan","#D2B48C","Teal","#008080","Thistle","#D8BFD8","Tomato","#FF6347","Turquoise","#40E0D0","Violet","#EE82EE","Wheat","#F5DEB3","White","#FFFFFF","WhiteSmoke","#F5F5F5","Yellow","#FFFF00","YellowGreen","#9ACD32"];var gn=function e(){var t=this;this._colorByName={};this._colorByName["null"]=[0,0,0,0];this._colorByName["transparent"]=[0,0,0,0];this._temp=[0,0,0,0];for(var r=0;r<_n.length;r+=2){var i=_n[r].toLowerCase();var value=_n[r+1];t._colorByName[i]=nn(value)}};gn.prototype.parseColor=function e(t){var r=this._colorByName[t];if(r===undefined){var i=t+"";r=i.charAt(0)==="#"?nn(i):en(i);this._colorByName[t]=r}return r};gn.prototype.toHexa=function e(t){var r=this.parseColor(t);return"#"+tn(r[0])+tn(r[1])+tn(r[2])};gn.prototype.rgbaToRgb=function e(t){var r=1;var i=t;if(i&&en(t,this._temp)){i="rgb("+ +this._temp[0]*255+","+ +this._temp[1]*255+","+ +this._temp[2]*255+")";r=parseFloat(this._temp[3])}return{color:i,opacity:r}};var pn=Object.freeze({BoundingBox:vn,FlexArray:fi,EventTarget:cn,ColorManager:gn,requestAnimFrame:w,cancelAnimFrame:E,transparentEvents:I,getBrowser:N,getDocument:Oe,getStyle:Ve,getXmlSerializerClass:je,getCanvasFactory:Ue,getWebglContext:Ge,DummyXHR:Xe,DummyFileReader:We,DummyCanvas:qe,createDummyDomElement:Je,createDomElement:Qe,createDomElementNS:et,createXmlDocument:tt,serializeXMLDocument:rt,createCanvas:it,getPixelRatio:nt,dataUrlToBlob:at,createBlob:st,isBlob:ut,promptDownload:lt,resizeElement:ft,setAttributes:ht,createSvgElement:vt,createTextNode:dt,bindEvt:ct,unbindEvt:_t,getImage:gt,fetch:yt,isHTMLElement:mt,applyCursorStyle:xt,getBoundingClientRect:bt,onPageUnload:At,fetchBinary:wt,fetchBinaryAsBase64:Et,eachNode:St,reduceNodeList:Ct,setCtxFont:Tt,escapeDOMAttribute:Mt,getDocumentFontRules:kt,getEmbeddedFontRules:It,resolvePath:zt,getClosestValue:Xt,isPowerOfTwo:Wt,computeSum:Yt,isInteger:Ht,computeRange:qt,findFunctionParameter:$t,getUpperPowerOf:Kt,getUpperPowerOfTwo:Jt,clamp:Qt,mix:er,createCounter:tr,convertToString:rr,toPropertyPath:ir,throttle:nr,debounce:ar,processQueue:sr,getFunctionBody:ur,convertToFloat:fr,isParsableNumber:hr,isLittleEndian:vr,removeFromArray:dr,computeMax:cr,computeMin:_r,isRawObject:Z,getValues:$,forEach:K,reduce:J,map:Q,merge:ee,extend:te,shallowCopy:re,stringify:ie,deepCopy:ne,updateObject:ae,extendList:oe,propertyAccess:se,hasProperty:ue,setPathValue:le,bindProperty:he,unbindProperty:ve,concat:de,removeDuplicates:ce,setReadOnly:_e,isNotNative:ye,destroy:me,flatten:xe,setProperty:be,getProperty:Ae,unflatten:we,getFlattenedKeys:Ee,ensureTransferrable:Se,getOptions:Ce,flattenArray:Te,isObject:Me,mergeValues:ke,Position:Nr,PositionList:Pr,rectangleFromCenterAndDimensions:Lr,lineFromBoundaries:Dr,PathMap:Wr,objToValueList:Xr,roundedRect:Zr,circleStroke:Kr,smartRequire:P,getCurrentTime:R,now:O,getDate:V,getTime:j,createDelayer:G,isNull:bi,isBool:Ai,isNumber:wi,isPositive:Ei,isStrictPositive:Si,isLayerValue:Ci,isText:Ti,isColor:Mi,isInheritableColor:ki,isSourceTargetInheritableColor:Ii,isFontName:Ni,isFontStyle:Li,isTextAlign:zi,isNodeShape:Di,isPredefinedEdgeShape:Pi,isEdgeType:Fi,isEdgeExtremity:Bi,isEdgeStyle:Ri,isTextPosition:Oi,isColorOrArrayOfColors:Vi,createCheckSizeFunction:ji,createWorker:Xi,insertSortAsc:X,insertSortDesc:W,pushMultipleValues:Y,isArray:H,toArray:q,parseColorRgba:en,toHexa:tn,componentsToRGBA:rn,parseColorHex:nn,createDummyXmlDocument:ln,PrioritySet:fn,capitalize:hn});function circleCircleIntersection(e,t,r,i,n,a){var o,s,u,l,f,h,v;var d,c;s=i-e;u=n-t;l=Math.sqrt(s*s+u*u);if(l>r+a){return null}if(l<Math.abs(r-a)){return null}o=(r*r-a*a+l*l)/(2*l);d=e+s*o/l;c=t+u*o/l;f=Math.sqrt(r*r-o*o);h=-u*(f/l);v=s*(f/l);return[[d+h,c+v],[d-h,c-v]]}function circleSortCompare(e,t,r,i,n,a){if(e-n>=0&&r-n<0){return 1}if(e-n<0&&r-n>=0){return-1}if(e-n===0&&r-n===0){return t-i>=0||i-a>=0?t-i:i-t}var o=(e-n)*(i-a)-(r-n)*(t-a);if(o<0){return 1}if(o>0){return-1}var s=(e-n)*(e-n)+(t-a)*(t-a);var u=(r-n)*(r-n)+(i-a)*(i-a);return s-u}function yn(e,t,r){var i=e[2];var n=Math.abs(e[0]-t),a=Math.abs(e[1]-r);if(n+a<=i){return true}if(n>i||a>i){return false}return Math.sqrt(n*n+a*a)<i+1e-12}function mn(e,t,r,i){var n=e[0]-t,a=e[1]-r,o=e[2]-i;return n*n+a*a<o*o+1e-6}function xn(e,t,r,i,n,a,o){var s=Math.max(i,Math.min(a,e));var u=Math.max(n,Math.min(o,t));var l=e-s;var f=t-u;return l*l+f*f<r*r}function bn(e,t,r,i,n,a,o,s){var u=s||{x:0,y:0};var l,f,h,v;if(r===e){var d=e-n;var c=o*o-d*d;if(c<0){return null}var _=Math.sqrt(c);l=e;h=e;f=a+_;v=a-_}else{var g=(i-t)/(r-e);var p=t-g*e;var y=p-a;var m=g*g+1;var x=2*(g*y-n);var b=n*n+y*y-o*o;var A=x*x-4*m*b;if(A<0){return null}var w=-x;var E=Math.sqrt(A);var S=2*m;l=(w+E)/S;h=(w-E)/S;f=g*l+p;v=g*h+p}var C=e-l;var T=t-f;var M=e-h;var k=t-v;if(C*C+T*T<M*M+k*k){u.x=l;u.y=f}else{u.x=h;u.y=v}return u}function An(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i),s=(r-e)/o,u=(i-t)/o,l=.5*n*-u,f=.5*n*s;a.x1=e-l;a.y1=t-f;a.x2=e+l;a.y2=t+f;return a}function wn(e,t,r,i,n,a,o,s,u){if(s===void 0)s=0;if(u===void 0)u=false;var l=distance(r,i,n,a),f=o/2*(u?distance(e,t,n,a)/l:1),h=(f+s)/l,v=(n-r)*h,d=(a-i)*h,c=r+d,_=i-v,g=r-d,p=i+v,y=n+d,m=a-v;var x=e-c,b=t-_,A=g-c,w=p-_,E=y-c,S=m-_;var C=x*A+b*w,T=A*A+w*w,M=x*E+b*S,k=E*E+S*S;return C>0&&C<T&&M>0&&M<k}function En(e,t,r,i,n,a){var o=n-r,s=a-i;return(s*e-o*t+n*i+n*a)/Math.sqrt(o*o+s*s)}function Sn(e,t,r,i,n,a){return Math.abs(En(e,t,r,i,n,a))}function Cn(e,t,r,i,n,a){var o=n-r,s=a-i,u=s/o,l=i-u*r,f,h;if(o===0){f=r;h=t}else{f=(o*e+s*t-l*s)/(o+u*s);h=u*f+l}return{x:f-e,y:h-t}}function Tn(e,t,r,i,n){if(n&&(Mn(e,r)||Mn(e,i)||Mn(t,r)||Mn(t,i))){return false}var a=(e.y-r.y)*(i.x-r.x)-(e.x-r.x)*(i.y-r.y),o=(t.x-e.x)*(i.y-r.y)-(t.y-e.y)*(i.x-r.x);if(o===0){return false}var s=a/o;a=(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y);var u=a/o;return!(s<=0||s>=1||u<=0||u>=1)}function Mn(e,t){return e.x===t.x&&e.y===t.y}function kn(e,t,r,i){return Math.atan2(i-t,r-e)}function In(e,t,r){var i=kn(e.x,e.y,t.x,t.y)-kn(r.x,r.y,t.x,t.y);if(i<0){i+=2*Math.PI}return i}function Nn(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i),s=(r-e)/o,u=(i-t)/o;a.x=n*-u;a.y=n*s;return a}function Ln(e,t,r,i,n,a){a=a||{};var o=distance(e,t,r,i);a.x=(r-e)/o*n;a.y=(i-t)/o*n;return a}function zn(e,t,r,i,n,a){return e>=r&&e<=n&&t>=i&&t<=a}function Dn(e,t,r,i,n,a,o,s){var u,l,f;var h=(s-a)*(r-e)-(o-n)*(i-t);if(h===0){return null}u=t-a;l=e-n;f=(o-n)*u-(s-a)*l;u=f/h;return{x:e+u*(r-e),y:t+u*(i-t)}}function Pn(e,t,r,i,n,a,o,s){var u;var l=[];u=Dn(e,t,r,i,n,a,n,s);if(u){l.push(u)}u=Dn(e,t,r,i,n,s,o,s);if(u){l.push(u)}u=Dn(e,t,r,i,o,s,o,a);if(u){l.push(u)}u=Dn(e,t,r,i,o,a,n,a);if(u){l.push(u)}return l}function Fn(e,t,r,i,n,a,o,s){var u=((o-n)*(t-a)-(s-a)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));var l=((r-e)*(t-a)-(i-t)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));if(u>=0&&u<=1&&l>=0&&l<=1){return true}return false}function Bn(e,t,r,i,n,a,o,s){if(e>=n&&t>=a&&e<=o&&t<=s){return true}if(r>=n&&i>=a&&r<=o&&i<=s){return true}if(Fn(e,t,r,i,n,a,n,s)){return true}if(Fn(e,t,r,i,o,a,o,s)){return true}if(Fn(e,t,r,i,n,a,o,a)){return true}if(Fn(e,t,r,i,n,s,o,s)){return true}return false}function Rn(e,t,r,i,n){var a=n[0];var o=n[1];var s=n[2];var u=n[3];var l=0,f=1;var h=r-e,v=i-t;var d,c,_;for(var g=0;g<4;g++){if(g===0){d=-h;c=-(a-e)}if(g===1){d=h;c=o-e}if(g===2){d=-v;c=-(s-t)}if(g===3){d=v;c=u-t}_=c/d;if(d===0&&c<0){return null}if(d<0){if(_>f){return null}else if(_>l){l=_}}else if(d>0){if(_<l){return null}else if(_<f){f=_}}}return[[e+l*h,t+l*v],[e+f*h,t+f*v]]}function On(e,t,r,i,n,a,o,s){var u,l,f,h,v,d={x:null,y:null,onLine1:false,onLine2:false};u=(s-a)*(r-e)-(o-n)*(i-t);if(u===0){return d}l=t-a;f=e-n;h=(o-n)*l-(s-a)*f;v=(r-e)*l-(i-t)*f;l=h/u;f=v/u;d.x=e+l*(r-e);d.y=t+l*(i-t);if(l>0&&l<1){d.onLine1=true}if(f>0&&f<1){d.onLine2=true}return d}function Vn(e,t,r,i,n,a){var o=n-r,s=a-i;if(o===0&&s===0){return{x:r,y:i}}if(o===0){return{x:r,y:t}}if(s===0){return{x:e,y:i}}var u=s/o,l=-(o/s),f=(r*u-e*l+t-i)/(u-l),h=u*f+i-r*u;return{x:f,y:h}}function jn(e,t){var r=t.x-e.x,i=t.y-e.y;return{x:(e.x+t.x)/2,y:(e.y+t.y)/2,length:Math.sqrt(r*r+i*i),angle:Math.atan2(-i,r)}}function Un(e,t,r,i,n,a){return 1/2*(-i*n+t*(-r+n)+e*(i-a)+r*a)}function Gn(e,t,r,i,n,a,o,s){var u=Un(r,i,n,a,o,s);var l=1/(2*u)*(i*o-r*s+(s-i)*e+(r-o)*t);var f=1/(2*u)*(r*a-i*n+(i-a)*e+(n-r)*t);return l>0&&f>0&&1-l-f>0}function Xn(e,t,r,i,n,a){var o=distance(r,i,n,a),s=distance(e,t,n,a),u=distance(e,t,r,i),l=o+s+u;if(l===0){return{x:e,y:t}}else{return{x:(o*e+s*r+u*n)/l,y:(o*t+s*i+u*a)/l}}}function Wn(e,t,r,i,n,a){return{x:(e+r+n)/3,y:(t+i+a)/3}}function Yn(e){var t=0,r=0;var i=e.length;for(var n=0;n<i;n++){var a=e[n];t+=a.x;r+=a.y}return{x:t/i,y:r/i}}function Hn(e,t,r,i,n,a){return e>=r&&e<=n&&t>=i&&t<=a}function qn(e,t,r,i){if(i===undefined){i=r.length}var n=i-1,a=false;for(var o=0;o<i;++o){if((r[o].y<t&&r[n].y>=t||r[n].y<t&&r[o].y>=t)&&(r[o].x<=e||r[n].x<=e)){a^=r[o].x+(t-r[o].y)/(r[n].y-r[o].y)*(r[n].x-r[o].x)<e}n=o}return a}function Zn(e,t){if(e<0){e+=t}else if(e>=t){e-=t}return e}function $n(e){for(var t=0;t<e.length;++t){if(Kn(e,t)){return t}}return 0}function Kn(e,t){var r=Zn(t-1,e.length),i=Zn(t+1,e.length),n=In(e[r],e[t],e[i]);if(n>Math.PI){return false}for(var a=0;a<e.length;++a){if(a===t||a===r||a===i){continue}if(Gn(e[a].x,e[a].y,e[r].x,e[r].y,e[i].x,e[i].y,e[t].x,e[t].y)){return false}}return true}function Jn(e){if(e.length===3){return[[e[0].index,e[1].index,e[2].index]]}var t=$n(e),r=[e[Zn(t-1,e.length)].index,e[t].index,e[Zn(t+1,e.length)].index];e.splice(t,1);var i=Jn(e);i.push(r);return i}function Qn(e){var t=e.length,r=(t-2)*Math.PI,i=0;for(var n=0;n<t;++n){var a=In(e[Zn(n-1,t)],e[n],e[Zn(n+1,t)]);i+=a}var o=e.slice();for(n=0;n<o.length;++n){o[n].index=n}if(i-1e-4>r){o.reverse()}return Jn(o)}function ea(e){var t=e.x*e.x+e.y*e.y;return{x:e.x/t,y:e.y/t}}function ta(e,t){var r=Infinity;var i=-Infinity;for(var n=0,a=e.length;n<a;n++){var o=e[n];var s=o.x*t.x+o.y*t.y;if(s<r){r=s}if(s>i){i=s}}return{x:r,y:i}}function ra(e,t){var r=new Array(4);var i,n,a,o;i=e[1],n=e[0];a=ea({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[0]=a;i=e[2];n=e[1];a=ea({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[1]=a;i=t[1];n=t[0];a=ea({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[2]=a;i=t[2];n=t[1];a=ea({x:i.x-n.x,y:i.y-n.y});o=a.x;a.x=-a.y;a.y=o;r[3]=a;return r}function ia(e,t){var r=ra(e,t);for(var i=0,n=r.length;i<n;i++){var a=r[i];var o=ta(e,a);var s=ta(t,a);var u=o.x<=s.y&&o.y>=s.x?Math.min(o.y,s.y)-Math.max(o.x,s.x):0;if(u===0){return false}}return true}var na=0;var aa=1;var oa=2;var sa=3;var ua=4;var la=5;var fa=6;var ha=7;var va=8;var da=9;var ca=10;var _a=0;var ga=1;var pa=2;var ya=3;var ma=0;var xa=1;var ba=2;var Aa=3;var wa=4;var Ea=5;var Sa=6;var Ca=1e-5;var Ta=Math.PI;var Ma=Math.PI*2;var ka=Ta*(5/4);var Ia=Ta*(7/4);var Na=Ta*(3/4);var La=Ta*(1/4);var za=1;var Da=.17;var Pa=1;var Fa=-Math.PI/2;var Ba=Math.PI/2;var Ra=3;var Oa=-Math.PI/4;var Va=7;var ja=41;var Ua=10;var Ga=2/3;var Xa={plain:{dash:0,gap:0},dashed:{dash:3,gap:1},dotted:{dash:1,gap:3}};var Wa={right:0,top:-Math.PI/2,left:Math.PI,bottom:Math.PI/2,center:0};var Ya={right:Math.PI,top:-Math.PI/2,left:0,bottom:Math.PI/2,center:0};var Ha=1e-6;var qa=1e-12;function Za(){var e=arguments;var t=e.length-1;var r=t;var i=[];for(var n=0;n<=t;n++){if(Math.abs(e[n])<=qa){t--}else{break}}switch(t){case 1:$a(e[r],e[r-1],i);break;case 2:Ka(e[r],e[r-1],e[r-2],i);break;case 3:Ja(e[r],e[r-1],e[r-2],e[r-3],i);break;default:break}return i}function $a(e,t,r){if(r===void 0)r=[];if(t!==0){r.push(-e/t)}return r}function Ka(e,t,r,i){if(i===void 0)i=[];var n=r;var a=t/n;var o=e/n;var s=a*a-4*o;if(s>0){var u=Math.sqrt(s);i.push(.5*(-a+u));i.push(.5*(-a-u))}else if(s===0){i.push(.5*-a)}return i}function Ja(e,t,r,i,n){if(n===void 0)n=[];var a=i;var o=r/a;var s=t/a;var u=e/a;var l=(3*s-o*o)/3;var f=(2*o*o*o-9*s*o+27*u)/27;var h=o/3;var v=f*f/4+l*l*l/27;var d=f/2;var c,_;if(Math.abs(v)<=Ha){v=0}if(v>0){var g=Math.sqrt(v);c=-d+g;if(c>=0){_=Math.pow(c,1/3)}else{_=-Math.pow(-c,1/3)}c=-d-g;if(c>=0){_+=Math.pow(c,1/3)}else{_-=Math.pow(-c,1/3)}n.push(_-h)}else if(v<0){var distance=Math.sqrt(-l/3);var p=Math.atan2(Math.sqrt(-v),-d)/3;var y=Math.cos(p);var m=Math.sin(p);var x=Math.sqrt(3);n.push(2*distance*y-h);n.push(-distance*(y+x*m)-h);n.push(-distance*(y-x*m)-h)}else{if(d>=0){c=-Math.pow(d,1/3)}else{c=Math.pow(-d,1/3)}n.push(2*c-h);n.push(-c-h)}return n}function Qa(e,t,r,i,n,a,o,s,u,l,f){var h,v,d,c;var _,g,p,y,m,x;var b;var A,w;var E=Math.min(o,u),S=Math.min(s,l),C=Math.max(o,u),T=Math.max(s,l);h=r*-2;v=i*-2;_=e+h+n;g=t+v+a;h=e*-2;v=t*-2;d=r*2;c=i*2;p=h+d;y=v+c;m=e;x=t;A=s-l;w=u-o;b=o*l-u*s;var M=Za(A*_+w*g,A*p+w*y,A*m+w*x+b);for(var k=0;k<M.length;k++){var I=M[k];if(0<=I&&I<=1){var N=e+(r-e)*I;var L=t+(i-t)*I;var z=r+(n-r)*I;var D=i+(a-i)*I;var P=N+(z-N)*I;var F=L+(D-L)*I;if(o===u){if(S<=F&&F<=T){if(f){f.push(P,F)}else{return 1}}}else if(s===l){if(E<=P&&P<=C){if(f){f.push(P,F)}else{return 1}}}else if(P>=E&&F>=S&&P<=C&&F<=T){if(f){f.push(P,F)}else{return 1}}}}return f?f.length/2:0}function eo(e,t,r,i,n,a,o,s,u,l,f){if(f){Qa(e,t,r,i,n,a,o,s,u,s,f);Qa(e,t,r,i,n,a,u,s,u,l,f);Qa(e,t,r,i,n,a,o,l,u,l,f);Qa(e,t,r,i,n,a,o,s,o,l,f);return f.length/2}else{if(o<=e&&u>=e&&s<=t&&l>=t){return 1}if(o<=n&&u>=n&&s<=a&&l>=a){return 1}if(Qa(e,t,r,i,n,a,o,s,u,s)){return 1}if(Qa(e,t,r,i,n,a,u,s,u,l)){return 1}if(Qa(e,t,r,i,n,a,o,l,u,l)){return 1}if(Qa(e,t,r,i,n,a,o,s,o,l)){return 1}return 0}}function to(e,t,r,i,n,a,o,s,u,l,f,h,v){var d,c,_,g,p,y,m,x;var b,A,w,E,S,C,T,M;var k;var I,N;var L=Math.min(u,f),z=Math.min(l,h),D=Math.max(u,f),P=Math.max(l,h);d=e*-1;c=t*-1;_=r*3;g=i*3;p=n*-3;y=a*-3;m=d+_+p+o;x=c+g+y+s;b=m;A=x;d=e*3;c=t*3;_=r*-6;g=i*-6;p=n*3;y=a*3;m=d+_+p;x=c+g+y;w=m;E=x;d=e*-3;c=t*-3;_=r*3;g=i*3;p=d+_;y=c+g;S=p;C=y;T=e;M=t;I=l-h;N=f-u;k=u*h-f*l;var F=Za(I*b+N*A,I*w+N*E,I*S+N*C,I*T+N*M+k);for(var B=0;B<F.length;B++){var R=F[B];if(0<=R&&R<=1){var O=e+(r-e)*R;var V=t+(i-t)*R;var j=r+(n-r)*R;var U=i+(a-i)*R;var G=n+(o-n)*R;var X=a+(s-a)*R;var W=O+(j-O)*R;var Y=V+(U-V)*R;var H=j+(G-j)*R;var q=U+(X-U)*R;var Z=W+(H-W)*R;var $=Y+(q-Y)*R;if(u===f){if(z<=$&&$<=P){if(v){v.push(Z,$)}else{return 1}}}else if(l===h){if(L<=Z&&Z<=D){if(v){v.push(Z,$)}else{return 1}}}else if(Z>=L&&$>=z&&Z<=D&&$<=P){if(v){v.push(Z,$)}else{return 1}}}}return v?v.length/2:0}function ro(e,t,r,i,n,a,o,s,u,l,f,h,v){if(v){to(e,t,r,i,n,a,o,s,u,l,f,l,v);to(e,t,r,i,n,a,o,s,f,l,f,h,v);to(e,t,r,i,n,a,o,s,u,h,f,h,v);to(e,t,r,i,n,a,o,s,u,l,u,h,v);return v.length/2}else{if(u<=e&&f>=e&&l<=t&&h>=t){return 1}if(u<=o&&f>=o&&l<=s&&h>=s){return 1}if(to(e,t,r,i,n,a,o,s,u,l,f,l)){return 1}if(to(e,t,r,i,n,a,o,s,f,l,f,h)){return 1}if(to(e,t,r,i,n,a,o,s,u,h,f,h)){return 1}if(to(e,t,r,i,n,a,o,s,u,l,u,h)){return 1}return 0}}function io(e,t,r,i,n,a){if(a===void 0)a={};var o=(e+r)/2;var s=(t+i)/2;var u=r-e;var l=i-t;var f=Math.sqrt(u*u+l*l)+Ca;var h=l/f;var v=-u/f;var d=n*(f/Ua)*2;a.x=o+h*d;a.y=s+v*d;return a}function no(e,t,r,i){if(i===void 0)i={};i.x1=e-r*Va;i.y1=t;i.x2=e;i.y2=t+r*Va;return i}function ao(e,t,r,i,n){if(n===void 0)n={};return no(e,t,i+r,n)}function oo(e,t,r,i,n,a,o,s){s=s||{};s.x=(1-e)*(1-e)*t+2*(1-e)*e*a+e*e*i;s.y=(1-e)*(1-e)*r+2*(1-e)*e*o+e*e*n;return s}function so(e,t,r,i,n,a,o,s,u,l,f){if(l===void 0)l=0;if(f===void 0)f=false;var h=r-2*o+n;var v=2*o-2*r;var d=r-e;var c=i-2*s+a;var _=2*s-2*i;var g=i-t;var p=-(d*c-g*h)/(v*c-_*h);if(p<0||p>1){return false}var y=u/2;if(f){y*=1-p}y+=l;var m=uo(p,r,n,o);var x=uo(p,i,a,s);return distance(m,x,e,t)<=y}function uo(e,t,r,i){var n=1-e;return n*n*t+2*n*e*i+e*e*r}function lo(e,t,r,i,n,a,o,s,u,l){l=l||{};var f=(1-e)*(1-e)*(1-e),h=3*e*(1-e)*(1-e),v=3*e*e*(1-e),d=e*e*e;l.x=f*t+h*a+v*s+d*i;l.y=f*r+h*o+v*u+d*n;return l}function fo(e,t,r,i,n,a,o,s,u,l,f,h){var v=distance(r,i,o,s);if(Math.abs(e-r)>v||Math.abs(t-i)>v){return false}var d=distance(e,t,r,i),c=distance(e,t,n,a),_=.5,g=d<c?-.01:.01,p=.001,y=100,m=lo(_,r,i,n,a,o,s,u,l),x=distance(e,t,m.x,m.y),b;var A=f/2+h;while(y-- >0&&_>=0&&_<=1&&x>A&&(g>p||g<-p)){b=x;lo(_,r,i,n,a,o,s,u,l,m);x=distance(e,t,m.x,m.y);if(x>b){g=-g/2;_+=g}else if(_+g<0||_+g>1){g=g/2;x=b}else{_+=g}}return x<A}function ho(e,t,r,i,n,a){var o=Math.sqrt,s=Math.log,u=e-2*r+n,l=t-2*i+a,f=2*r-2*e,h=2*i-2*t,v=4*(u*u+l*l),d=4*(u*f+l*h),c=f*f+h*h,_=2*o(v+d+c),g=o(v),p=2*v*g,y=2*o(c),m=d/g;return(p*_+g*d*(_-y)+(4*c*v-d*d)*s((2*g+m+_)/(m+y)))/(4*p)}var vo=100,co=1/vo,_o={};function go(e,t,r,i,n,a,o,s){var u=0,l=e,f=t;for(var h=co;h<=1;h+=co){lo(h,e,t,o,s,r,i,n,a,_o);u+=distance(l,f,_o.x,_o.y);l=_o.x;f=_o.y}return u}function po(e,t,r,i,n,a,o){var s=e+2/3*(r-e);var u=t+2/3*(i-t);var l=s+1/3*(n-e);var f=u+1/3*(a-t);return yo(e,t,s,u,l,f,n,a,o)}function yo(e,t,r,i,n,a,o,s,u){if(u===void 0)u={};var l=Math.min;var f=Math.max;var h=Math.sqrt;var v,d,c,_,g;u.minX=l(e,o);u.maxX=f(e,o);u.minY=l(t,s);u.maxY=f(t,s);for(var p=void 0,y=void 0,m=void 0,x=void 0,b=void 0,A=void 0,w=void 0,E=0;E<2;++E){if(E===0){d=e;c=r;_=n;g=o}else{d=t;c=i;_=a;g=s}y=6*d-12*c+6*_;p=-3*d+9*c-9*_+3*g;m=3*c-3*d;y=y|0;p=p|0;m=m|0;if(p===0){if(y===0){continue}x=-m/y;if(x>0&&x<1){v=mo(x,d,c,_,g);if(E===0){u.minX=l(u.minX,v);u.maxX=f(u.maxX,v)}else{u.minY=l(u.minY,v);u.maxY=f(u.maxY,v)}}continue}b=y*y-4*m*p;if(b<0){continue}A=(-y+h(b))/(2*p);if(A>0&&A<1){v=mo(A,d,c,_,g);if(E===0){u.minX=l(u.minX,v);u.maxX=f(u.maxX,v)}else{u.minY=l(u.minY,v);u.maxY=f(u.maxY,v)}}w=(-y-h(b))/(2*p);if(w>0&&w<1){v=mo(w,d,c,_,g);if(E===0){u.minX=l(u.minX,v);u.maxX=f(u.maxX,v)}else{u.minY=l(u.minY,v);u.maxY=f(u.maxY,v)}}}return u}function mo(e,t,r,i,n){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*n}function xo(e,t,r,i,n,a,o){var s=1-e;var u=s*a+e*i-(s*t+e*a);var l=s*o+e*n-(s*r+e*o);return Math.atan2(l,u)}function bo(e,t,r,i,n,a,o,s){if(n===void 0)n=0;if(a===void 0)a=Math.sin(n);if(o===void 0)o=Math.cos(n);if(s===void 0)s=[];var u=r/2,l=i/2;var f=e+u,h=t+l;if(n===0){s[0]=e;s[1]=t;s[2]=e+r;s[3]=t+i;return s}var v,d,c,_;var g,p,y,m;c=-u;_=-l;v=f+c*o-_*a,d=h+c*a+_*o;g=y=v;p=m=d;c=-u;_=l;v=f+c*o-_*a;d=h+c*a+_*o;if(v<g){g=v}else if(v>y){y=v}if(d<p){p=d}else if(d>m){m=d}c=u;_=l;v=f+c*o-_*a;d=h+c*a+_*o;if(v<g){g=v}else if(v>y){y=v}if(d<p){p=d}else if(d>m){m=d}c=u;_=-l;v=f+c*o-_*a;d=h+c*a+_*o;if(v<g){g=v}else if(v>y){y=v}if(d<p){p=d}else if(d>m){m=d}s[0]=g;s[1]=p;s[2]=y;s[3]=m;return s}function Ao(e,t,r,i,n){if(n===void 0)n=0;var a=r/2,o=i/2;var s=e+a,u=t+o;if(n===0){return[{x:e,y:t},{x:e+r,y:t},{x:e+r,y:t+i},{x:e,y:t+i}]}var l=Math.sin(n);var f=Math.cos(n);var h,v,d,c;var _=new Array(4);d=-a;c=-o;h=s+d*f-c*l,v=u+d*l+c*f;_[0]={x:h,y:v};d=-a;c=o;h=s+d*f-c*l;v=u+d*l+c*f;_[1]={x:h,y:v};d=a;c=o;h=s+d*f-c*l;v=u+d*l+c*f;_[2]={x:h,y:v};d=a;c=-o;h=s+d*f-c*l;v=u+d*l+c*f;_[3]={x:h,y:v};return _}function wo(e,t,r,i){if(t===void 0)t=0;if(r===void 0)r=1;if(i===void 0)i=[];var n=r*Math.sin(t);var a=r*Math.cos(t);i[0]=e[0]+n;i[1]=e[1]+a;i[2]=e[2]+n;i[3]=e[3]+a;return i}function Eo(e,t,r,i,n){if(n===void 0)n=[];var a=Math.sin(t),o=Math.cos(t);var s=(e[0]+e[2])/2;var u=(e[1]+e[3])/2;var l=(e[2]-e[0])/2;var f=(e[3]-e[1])/2;var h=l,v=-f;var d=l,c=f;var _=h*o-v*a;var g=h*a+v*o;var p=d*o-c*a;var y=d*a+c*o;var m=Math.max(Math.abs(_),Math.abs(p));var x=Math.max(Math.abs(g),Math.abs(y));n[0]=s-m;n[2]=s+m;n[1]=u-x;n[3]=u+x;return n}function So(e,t){e.minX-=t;e.minY-=t;e.maxX+=t;e.maxY+=t;e.width+=2*t;e.height+=2*t;return e}function Co(e,t){return e[3]>=t[1]&&e[1]<=t[3]&&(e[2]>=t[0]&&e[0]<=t[2])}var To=Object.freeze({circleCircleIntersection:circleCircleIntersection,circleSortCompare:circleSortCompare,circleContainsPoint:yn,circleContainsCircle:mn,circleIntersectsBox:xn,circleLineIntersection:bn,lineFromPoint:An,isPointInLine:wn,signedDistanceToLine:En,distanceToLine:Sn,vectorToLine:Cn,twoSegmentsIntersect:Tn,lineAngle:kn,angle:In,orthogonal:Nn,normalize:Ln,isPointInsideRectangle:zn,segmentIntersection:Dn,lineRectangleIntersection:Pn,lineLine:Fn,lineAABB:Bn,clipLine:Rn,lineIntersection:On,findClosestPointOnLine:Vn,computeLineInfo:jn,unitVector:Tr,scalarProduct:Mr,vectorLength:kr,rotate:mr,move:xr,distance:distance,squaredDistance:br,slope:Ar,degreeToRadians:wr,radiansToDegrees:Er,extendBounds:Sr,computeCentroid:Cr,isPointInTriangle:Gn,incenter:Xn,triangleCentroid:Wn,centroid:Yn,isPointInRectangle:Hn,isPointInPolygon:qn,triangulatePolygon:Qn,polygonsIntersect:ia,getCurveControlPoint:io,getSelfLoopControlPoints:no,getLoopControlPoints:ao,getPointOnQuadraticCurve:oo,isPointOnQuadraticCurve:so,quadraticEquation:uo,getPointOnBezierCurve:lo,isPointOnBezierCurve:fo,quadraticCurveLength:ho,cubicCurveLength:go,getQuadraticCurveBoundingBox:po,getBezierCurveBoundingBox:yo,getAngleOnQuadraticCurve:xo,quadBezierAABB:eo,cubicBezierAABB:ro,getAABB:bo,getOBBPoints:Ao,moveAABB:wo,rotateAABB:Eo,padBounds:So,overlaps:Co});function weightedStress(e,t,r,i,n,a){var o=0,s,u,l,f,h,v;for(l=0;l<i;l++){for(f=0;f<i;f++){var d=a[l],c=a[f];if(d!==c){u=e[d][c];u*=n;s=1/(u*u);if(s){h=t[d]-t[c];v=r[d]-r[c];o+=s*Math.pow(u-Math.sqrt(h*h+v*v),2)}}}}return o}function distanceStress(e,t,r,i,n,a,o){var s=0,u,l,f,h,v,d;if(n===-1){return 0}for(u=0;u<i;u++){for(l=0;l<i;l++){var c=o[u],_=o[l];if(c!==_&&(c===n||_===n)){f=e[c][_];f*=a;h=1/(f*f);if(h){v=t[c]-t[_];d=r[c]-r[_];s+=h*Math.pow(f-Math.sqrt(v*v+d*d),2)}}}}return s}function constrainedStress(e,t,r,i,n,a,o,s){o=o||0;var weightedStress=0;var distanceStress=0;var u,l,f,h,v,d,c;for(u=0;u<i;u++){for(l=0;l<i;l++){var _=s[u],g=s[l];if(_!==g){f=e[_][g];f*=a;h=1/(f*f);if(h){v=t[_]-t[g];d=r[_]-r[g];c=h*Math.pow(f-Math.sqrt(v*v+d*d),2);weightedStress+=c;if(_===n||g===n){distanceStress+=c}}}}}return(1-o)*weightedStress+o*distanceStress}function stressMinimizationStep(e,t,r,i,n,a,o,s,u){var l=t,f=r;var h=1e-6;o=o||0;n=typeof n==="undefined"?-1:n;if(n===-1){o=0}var v,d,c,_,g;var p=t[n],y=r[n];for(var m=0;m<i;m++){var x=s[m];var b=u(e[n][m]);var A=o/(b*b);if(b===0){continue}var w=0,E=0,S=0,C;var T=t[x],M=r[x];for(C=0;C<i;C++){var k=s[C],I,N,L,z,D;if(k!==x){I=e[x][k]*a;N=1/(I*I);L=t[k];z=r[k];if(N!==0){d=T-L;c=M-z;_=d*d+c*c;D=_<h?0:1/Math.sqrt(_);E+=(1-o)*N*(L+I*(T-L)*D);S+=(1-o)*N*(z+I*(M-z)*D)}w+=N}}v=(1-o)*w+A;if(v!==0){d=T-p;c=M-y;_=d*d+c*c;_=_<h?0:1/Math.sqrt(_);g=b===0?0:A*(b*_);l[x]=(E+g*t[x])/v;f[x]=(S+g*r[x])/v}}return{X:l,Y:f}}function stressMinimizationStepGeneral(e,t,r,i,n,a,o,s){var u=t,l=r;var f=1e-6;o=o||0;n=typeof n==="undefined"?-1:n;if(n===-1){o=0}var h;for(var v=0;v<i;v++){var d=s[v];var c=0,_=0,g=0,p,y;var m=t[d],x=r[d];var b,A,w;for(p=0;p<i;p++){var E=s[p],S,C,T,M,k;var I=0;if(E!==d){y=e[d][E]*a;S=1/(y*y);if(d===n||E===n){I=S}k=(1-o)*S+o*I;c+=k;if(S!==0){C=t[E];T=r[E];b=m-C;A=x-T;w=b*b+A*A;if(w>f){M=1/Math.sqrt(w)}_+=k*(C+y*(m-C)*M);g+=k*(T+y*(x-T)*M)}}}h=c;if(h!==0){u[d]=_/h;l[d]=g/h}}return{X:u,Y:l}}function minHeap(e,t,r,i){if(e===void 0)e=function(e,t){return e-t};if(t===void 0)t=[];if(r===void 0)r={};if(i===void 0)i=function(e){return e};var n=t.length;function a(a){while(true){var o=2*a+1;var s=o+1;var u=a;if(o<n&&e(t[o],t[u])<0){u=o}if(s<n&&e(t[s],t[u])<0){u=s}if(u===a){return a}var l=t[u];t[u]=t[a];t[a]=l;r[i(t[u])]=u;r[i(l)]=a;a=u}}var o={heapify:a,pop:function e(){if(n<=0){return undefined}if(n===1){n--;return t[0]}var r=t[0];t[0]=t[n-1];n--;a(0);return r},decreaseKey:function n(a,value){if(value!==undefined){t[a]=value;r[i(value)]=a}while(a>0){var o=a-1>>1;if(e(t[o],t[a])>0){var s=t[a];t[a]=t[o];t[o]=s;r[i(t[a])]=a;r[i(s)]=o;a=o}else{break}}return a},min:function e(){return t[0]},remove:function e(t){this.decreaseKey(t,Number.NEGATIVE_INFINITY);return this.pop()},push:function a(o){n++;var s=n-1;t[s]=o;while(s>0){var u=s-1>>1;if(e(t[u],t[s])>0){var l=t[s];t[s]=t[u];t[u]=l;r[i(t[s])]=s;r[i(l)]=u;s=u}else{break}}return s},empty:function e(){return n<=0},toArray:function e(){return t.slice(0,n)}};Object.defineProperty(o,"keys",{get:function(){return r},enumerable:true});Object.defineProperty(o,"size",{get:function(){return n},enumerable:true});return o}function bellmanFord(e){var t=e.sources;var r=e.targets;var i=e.weights;var n=e.source;var a=e.target;var o=e.undirected;if(o===void 0)o=false;var s=e.indexes;var u=e.N;u=s?s.length:u;if(!isFinite(u)||u===0){throw new Error("Invalid number of nodes "+u)}var l=new Float32Array(u);var f=new Int32Array(u);var h={};var v=Number.POSITIVE_INFINITY;var d,c,_,g,p,y,m;var x,b,A,w;if(!i){for(d=0,i=new Uint8Array(u);d<u;d++){i[d]=1}}if(!s){for(d=0,s=new Uint32Array(u);d<u;d++){s[d]=d+1}}for(d=0;d<u;d++){l[d]=v;f[d]=-1;h[s[d]]=d}l[h[n]]=0;for(d=1,c=u;d<=c;d++){w=false;for(_=0,g=i.length;_<g;_++){x=t[_];b=r[_];y=h[x];m=h[b];if(y!==undefined&&m!==undefined){A=i[_];p=l[y]+A;if(l[y]!==v&&p<l[m]){l[m]=p;f[m]=x;w=true}if(o){p=l[m]+A;if(l[m]!==v&&p<l[y]){l[y]=p;f[y]=b;w=true}}}}if(!w){break}}if(w){for(d=0,c=i.length;d<c;d++){x=t[d];b=r[d];y=h[x];m=h[b];if(y!==undefined&&m!==undefined){A=i[d];if(l[y]+A<l[m]){return null}}}}var E=null;var S=null;if(a!==undefined){var C=h[a];if(C!==undefined&&l[C]!==v){for(d=a,E=[];d!==-1;d=f[h[d]]){E.push(d)}E=E.reverse();S=l[C]}}return{distances:l,path:E,pathLength:S}}function dijkstra(e,t,r,i,n,a,o){var s=i?i.length:e.length;var u=new Float32Array(s);var l=new Int32Array(s);var f=new Uint32Array(s);var h=Number.POSITIVE_INFINITY;var v={};var d,c;if(s===0){return{distances:u,path:null,pathLength:null}}if(!i){for(d=0,i=new Uint32Array(s);d<s;d++){i[d]=d+1}}if(!n){for(d=0,n={};d<s;d++){n[i[d]]=d}}for(d=0;d<s;d++){u[d]=h;l[d]=-1;f[d]=v[d]=d}var _=minHeap(function(e,t){return u[e]-u[t]},f,v);u[n[t]]=0;_.decreaseKey(v[n[t]]);while(_.size!==0){var g=_.pop();var p=u[g];var y=e[g];if(p===h){break}for(d=0,c=y.nodes.length;d<c;d++){var m=y.nodes[d];var x=a?1:o?o(i[g],m):y.weights[d];var b=n[m];if(b===undefined){continue}var A=p+x;if(A<u[b]){u[b]=A;l[b]=g;_.decreaseKey(v[b])}}}var w=null;var E=null;if(r!==undefined){var S=n[r];if(u[S]!==h){for(d=S,w=[];d!==-1;d=l[d]){w.push(i[d])}w=w.reverse();E=u[r]}}return{distances:u,path:w,pathLength:E}}function johnson(e){var t=e.sources;var r=e.targets;var i=e.weights;var n=e.indexes;var a=e.adjacency;var o=e.undirected;var s=e.ignoreWeights;var u=Number.POSITIVE_INFINITY;var l=n?n.length:a.length;var f,h,v,d,c,_;if(!n){for(f=0,n=new Uint32Array(l);f<l;f++){n[f]=f+1}}var g=new Array(l);var p={};for(f=0;f<l;f++){g[f]=new Float32Array(l);for(v=0;v<l;v++){g[f][v]=f===v?0:u}p[n[f]]=f}var y=l;var m=i.length;t=t.slice();r=r.slice();i=i.slice();for(f=0;f<l;f++){t[m+f]=y;r[m+f]=n[f];i[m+f]=0;if(s){i[f]=1}}var x=bellmanFord({sources:t,targets:r,weights:i,undirected:o,N:l+1,source:y});if(x===null){throw new Error("Graph has negative weight loops")}d=x.distances;for(f=0,h=i.length;f<h;f++){c=p[t[f]];_=p[r[f]];if(c!==undefined&&_!==undefined){i[f]=i[f]+d[c]-d[_]}}t=t.slice(0,m);r=r.slice(0,m);i=i.slice(0,m);for(f=0;f<l;f++){var b=n[f];c=p[b];d=dijkstra(a,b,undefined,n,p,s).distances;for(v=0;v<l;v++){g[f][v]=f===v?0:d[v]}}return g}var Mo=d(function(e){(function(){function t(e){if(!(this instanceof t)){return new t(e)}this.points=e||[]}t.prototype={triangulate:function(){var e=this.points;e.sort(function(e,t){if(e[0]===t[0]){return e[1]-t[1]}return e[0]-t[0]});for(var t=e.length-1;t>=1;t--){if(e[t][0]===e[t-1][0]&&e[t][1]===e[t-1][1]){e.splice(t,1)}}if(e.length<2){return{}}var r=v(e).le;var i=[];var a=0;var o=[r];while(n(r.onext.dest,r)){r=r.onext}var s=r;do{o.push(s.sym);s.mark=true;s=s.lnext}while(s!==r);do{var u=o[a++];if(!u.mark){s=u;do{i.push(s.orig);if(!s.sym.mark){o.push(s.sym)}s.mark=true;s=s.lnext}while(s!=u)}}while(a<o.length);return i}};function r(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])>0}function i(e,t){return r(e,t.dest,t.orig)}function n(e,t){return r(e,t.orig,t.dest)}function a(e,t){return i(e.dest,t)}function o(e,t,r,i){if(e[0]===i[0]&&e[1]===i[1]||t[0]===i[0]&&t[1]===i[1]||r[0]===i[0]&&r[1]===i[1]){return false}var n=e[0]*e[0]+e[1]*e[1],a=t[0]*t[0]+t[1]*t[1],o=r[0]*r[0]+r[1]*r[1],s=i[0]*i[0]+i[1]*i[1];var u=o-s,l=r[1]-i[1],f=r[1]*s-o*i[1],h=r[0]-i[0],v=r[0]*s-o*i[0],d=r[0]*i[1]-r[1]*i[0];return e[0]*(t[1]*u-a*l+f)-e[1]*(t[0]*u-a*h+v)+n*(t[0]*l-t[1]*h+d)-t[0]*f+t[1]*v-a*d>1}function s(e,t,r){this.onext=e;this.rot=t;this.orig=r;this.mark=false}s.prototype={get sym(){return this.rot.rot},get dest(){return this.sym.orig},get rotSym(){return this.rot.sym},get oprev(){return this.rot.onext.rot},get dprev(){return this.rotSym.onext.rotSym},get lnext(){return this.rotSym.onext.rot},get lprev(){return this.onext.sym},get rprev(){return this.sym.onext}};function u(e,t){var r=new s(null,null,e),i=new s(null,null,null),n=new s(null,null,t),a=new s(null,null,null);r.onext=r;n.onext=n;i.onext=a;a.onext=i;r.rot=i;i.rot=n;n.rot=a;a.rot=r;return r}function l(e,t){var r=e.onext.rot,i=t.onext.rot;var n=e.onext,a=i.onext,o=r.onext;e.onext=t.onext;t.onext=n;r.onext=a;i.onext=o}function f(e,t){var r=u(e.dest,t.orig);l(r,e.lnext);l(r.sym,t);return r}function h(e){l(e,e.oprev);l(e.sym,e.sym.oprev)}function v(e){var t,s,d,c;if(e.length===2){t=u(e[0],e[1]);return{le:t,re:t.sym}}else if(e.length===3){t=u(e[0],e[1]);s=u(e[1],e[2]);l(t.sym,s);if(r(e[0],e[1],e[2])){d=f(s,t);return{le:t,re:s.sym}}else if(r(e[0],e[2],e[1])){d=f(s,t);return{le:d.sym,re:d}}else{return{le:t,re:s.sym}}}else{var _=Math.ceil(e.length/2);var g=v(e.slice(0,_));var p=v(e.slice(_));var y=g.le,m=g.re,x=p.le,b=p.re;do{if(n(x.orig,m)){m=m.lnext}else if(i(m.orig,x)){x=x.rprev}else{break}}while(true);var A=f(x.sym,m);if(m.orig===y.orig){y=A.sym}if(x.orig===b.orig){b=A}do{var w=A.sym.onext;if(a(w,A)){while(o(A.dest,A.orig,w.dest,w.onext.dest)){c=w.onext;h(w);w=c}}var E=A.oprev;if(a(E,A)){while(o(A.dest,A.orig,E.dest,E.oprev.dest)){c=E.oprev;h(E);E=c}}if(!a(w,A)&&!a(E,A)){break}if(!a(w,A)||a(E,A)&&o(w.dest,w.orig,E.orig,E.dest)){A=f(E,A.sym)}else{A=f(A.sym,w.sym)}}while(true);return{le:y,re:b}}}t.prototype.ccw=r;t.prototype.rightOf=i;t.prototype.leftOf=n;t.prototype.inCircle=o;if(typeof undefined==="function"&&undefined.amd){undefined("Delaunay",function(){return t})}else{e.exports=t}})()});function ko(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])}function Io(e){var t=e.length,r=[0,1],i=2;for(var n=2;n<t;n++){while(i>1&&ko(e[r[i-2]],e[r[i-1]],e[n])<=0){--i}r[i++]=n}return r.slice(0,i)}function No(e){var t=e.length,r;if(t<3){return null}var i=new Array(t);var n=new Array(t);for(r=0;r<t;r++){i[r]=[+e[r][0],+e[r][1],r]}i.sort(function(e,t){return e[0]-t[0]||e[1]-t[1]});for(r=0;r<t;r++){n[r]=[i[r][0],-i[r][1]]}var a=Io(i),o=Io(n);var s=o[0]===a[0],u=o[o.length-1]===a[a.length-1],l=[];for(r=a.length-1;r>=0;--r){l.push(e[i[a[r]][2]])}for(r=+s;r<o.length-u;r++){l.push(e[i[o[r]][2]])}return l}function Lo(e,t,r,i,convexhull){if(t===void 0)t=1;if(r===void 0)r=0;if(!i||!convexhull){e=e.map(function(e){return[e.x,e.y]});i=new Mo(e.slice()).triangulate();convexhull=No(e)}var n=r*r;var a=[],o={},s,u,l,f,h;for(l=0,f=i.length;l<f;l+=3){u=Fo(i[l],i[l+1],i[l+2]);if(zo(convexhull,u)){h=Po(i[l],i[l+1],i[l+2]);if(h>n){a.push(l);o[l]=h}}}if(a.length===0){return a}a.sort(function(e,t){return o[e]-o[t]});var v=a[0];var d=o[v];var c=[];for(l=0,f=a.length;l<f;l++){s=a[l];h=o[s];if(h>d&&h>n){v=s;d=h;c.push(v);if(c.length>t){c.shift()}}}return c.map(function(e){return Do(i[e],i[e+1],i[e+2])})}function zo(e,t){var r=e.length;var i=e[r-1];var n=t[0];var a=t[1];var o=i[0];var s=i[1];var u,l;var f=false;for(var h=0;h<r;h++){i=e[h],u=i[0],l=i[1];if(l>a!==s>a&&n<(o-u)*(a-l)/(s-l)+u){f=!f}o=u,s=l}return f}function Do(e,t,r){var i=arguments;var n=Fo(e,t,r);var a=0;for(var o=0;o<3;o++){var s=i[o];var u=s[0]-n[0];var l=s[1]-n[1];var f=Math.sqrt(u*u+l*l);if(f>a){a=f}}return n.concat(a)}function Po(e,t,r){var i=Fo(e,t,r);var n=i[0];var a=i[1];var o=e[0];var s=e[1];var u=n-o;var l=a-s;return u*u+l*l}function Fo(e,t,r){var i=[(e[0]+t[0])/2,(e[1]+t[1])/2];var n=[(t[0]+r[0])/2,(t[1]+r[1])/2];var a=-1/((t[1]-e[1])/(t[0]-e[0]));var o=-1/((r[1]-t[1])/(r[0]-t[0]));var s=i[1]-a*i[0];var u=n[1]-o*n[0];var l=(s-u)/(o-a);return[l,a*l+s]}function minDisk(e,t,r,i){if(!i){i=new Uint32Array(e.length);for(var n=0,a=e.length;n<a;n++){i[n]=n}}function o(e){for(var t=e.length-1;t>=0;t--){var r=Math.floor(Math.random()*(t+1));r=Math.max(Math.min(r,t),0);var i=e[t];e[t]=e[r];e[r]=i}return e}function s(e,t,r,i,n,a,o){var s=null;var u=t.length;var l,f,h;if(u===1){l=t[0];s=[r[l],i[l],n[l]||0]}else if(u===2){l=t[0];f=t[1];s=a(r[l],i[l],r[f],i[f],n[l],n[f])}else if(u===3){l=t[0];f=t[1];h=t[2];s=o(r[l],i[l],r[f],i[f],r[h],i[h],n[l],n[f],n[h])}return s}function u(e,t,r,i,n,a,o,l,f){var h=null;if(r===0||t.length===3){h=s(e,t,i,n,a,l,f)}else{var v=e[r-1];h=u(e,t,r-1,i,n,a,o,l,f);if(h===null||!o(h,i[v],n[v],a[v])){t.push(v);h=u(e,t,r-1,i,n,a,o,l,f);t.pop()}}return h}function l(e,t,r,i){var n=e-r,a=t-i;return[(e+r)/2,(t+i)/2,Math.sqrt(n*n+a*a)/2]}function f(e,t,r,i,n,a){var o=r-e;var s=i-t;var u=a-n;var l=Math.sqrt(o*o+s*s);return[(e+r+o/l*u)/2,(t+i+s/l*u)/2,(l+n+a)/2]}function h(e,t,r,i,n,a,o,s,u){var l=2*(e-r),f=2*(t-i),h=2*(s-o);var v=e*e+t*t-o*o-r*r-i*i+s*s;var d=2*(e-n),c=2*(t-a),_=2*(u-o);var g=e*e+t*t-o*o-n*n-a*a+u*u;var p=d*f-l*c,y=(f*g-c*v)/p-e,m=(c*h-f*_)/p,x=(d*v-l*g)/p-t,b=(l*_-d*h)/p;var A=m*m+b*b-1,w=2*(y*m+x*b+o),E=y*y+x*x-o*o,S=(-w-Math.sqrt(w*w-4*A*E))/(2*A);return[y+m*S+e,x+b*S+t,S]}function v(e,t,r,i,n,a){var o=(e*(i-a)+r*(a-t)+n*(t-i))*2;if(o===0){return null}var s=((e*e+t*t)*(i-a)+(r*r+i*i)*(a-t)+(n*n+a*a)*(t-i))/o;var u=((e*e+t*t)*(n-r)+(r*r+i*i)*(e-n)+(n*n+a*a)*(r-e))/o;var l=s-e,f=u-t;return[s,u,Math.sqrt(l*l+f*f)]}i=o(i);var d=r?f:l;var c=r?h:v;var _=r?mn:yn;r=r||[];return u(i,[],i.length,e,t,r,_,d,c)}function removeRadialOverlap(e){var t=e.X;var r=e.Y;var i=e.sizes;var n=e.indexes;var a=e.R;var o=e.center;var s=e.gap;if(s===void 0)s=0;var u=e.epsilon;if(u===void 0)u=.001;var l=e.maxLoops;if(l===void 0)l=5;var f=e.inPlace;if(f===void 0)f=true;var h=n.length;var v=h;var d=o[0],c=o[1];if(!f){t=t.slice();r=r.slice()}var _=circleCircleIntersection;var g=circleSortCompare;var p=n.slice().sort(function(e,i){return g(t[e],r[e],t[i],r[i],d,c)});var y=p[h-1];var m=t[y],x=r[y];var b,A,w,E,S,C;for(var T=0,M=false;T<v-1;T++){var k=T%h,I=(T+1)%h;if(T===-1){k=h-1;I=0}k=p[k];I=p[I];b=t[k];A=r[k];w=t[I];E=r[I];var N=i[k],L=i[I];var z=N+L+s;var D=g(b,A,w,E,d,c);if(D===-1&&M){D=1}if(z>a){continue}if(D===1||z-distance(b,A,w,E)>u){var P=_(d,c,a,b,A,z);if(P){P=P[0];M=w>d&&P[0]<d;w=t[I]=P[0];E=r[I]=P[1]}}else{M=false}if(T%h===h-2){var F=p[h-1],B=p[0];if(r[F]>c&&r[B]>c&&t[F]-i[F]<t[B]+i[F]){S=0;v=Math.min(h*l,v+h);while(r[p[F]]>c&&r[p[0]]>c&&t[p[F]]<t[p[0]]&&++S<h){p.unshift(p.pop())}}}}b=m-d;A=x-c,w=t[y]-d;E=r[y]-c;var R=b===w?0:Math.abs(Math.acos((b*w+A*E)/(Math.sqrt(b*b+A*A)*Math.sqrt(w*w+E*E))));if(R!==0){var O=Math.sin(-R);var V=Math.cos(-R);var j;for(T=0;T<h;T++){j=p[T];S=t[j]-d;C=r[j]-c;t[j]=S*V-C*O+d;r[j]=S*O+C*V+c}}return{X:t,Y:r}}function circlePack(e){var t=e.X;var r=e.Y;var i=e.R;var n=e.center;var a=e.maxSteps;if(a===void 0)a=1e3;var o=e.padding;if(o===void 0)o=5;var s=e.epsilon;if(s===void 0)s=1e-5;var u=e.damping;if(u===void 0)u=2;var l=e.pinned;var f=e.indexes;var h=e.onUpdate;var v=e.pushSmallerOut;if(v===void 0)v=true;var d=f?f.length:t.length;var c=f;var _;if(!isFinite(l)){l=-1}if(c===undefined){c=new Uint32Array(d);for(_=0;_<d;_++){c[_]=_}}else{c=f}if(l!==-1){n=[t[l],r[l]]}else if(!n){var g=0,p=0;for(_=0;_<d;_++){g+=t[c[_]];p+=r[c[_]]}n=[g/d,p/d]}var y=function(e){return--e*e*e+1};var m=function(e,t){var r=e-n[0];var i=t-n[1];return r*r+i*i};var x=-Infinity,b=Infinity;c.sort(function(e,n){var a=i[e],o=i[n];x=Math.max(x,a,o);b=Math.min(b,a,o);return o*m(t[n],r[n])-a*m(t[e],r[e])});function A(e,a){var s=0;var f,h,_,g,p,y;for(f=0;f<d-1;f++){for(h=f+1;h<d;h++){if(f===h){continue}_=c[f];g=c[h];var m=t[_],A=r[_],w=i[_];var E=t[g],S=r[g],C=i[g];var T=E-m;var M=S-A;var k=w+C+o;var I=T*T+M*M;if(I<k*k-e){var N=(k-Math.sqrt(I))*a;var L=1/I;var z=T*L*N;var D=M*L*N;y=z*z+D*D;if(g!==l){p=w/b;s+=y*p;t[g]+=z*p;r[g]+=D*p}if(_!==l){p=C/b;s+=y*p;t[_]-=z*p;r[_]-=D*p}}}}var P=e*u*(1-a);var F=n[0],B=n[1],R,O;for(f=0;f<d;f++){_=c[f];if(_!==l){R=t[_];O=r[_];k=i[_];p=k/x;var V=v?P*p:P;z=(R-F)*V;D=(O-B)*V;y=z*z+D*D;s+=y;t[_]-=z;r[_]-=D}}return s}var w=0,E=0;var S=y(1/d);for(_=0;_<a;_++){w=A(S,y((_+1)/a));if(h){setTimeout(function(){return h(t,r)})}if(Math.abs(w-E)<s){break}E=w}return{X:t,Y:r}}var Bo=3;var Ro=function e(t,r,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0];r=a[1];i=a[2];this.d=r+2*i;for(var o=0;o<this.d*this.d;o++){var s=a[Bo+o];var u=a[Bo+o+1];n.push(s===u?null:a.subarray(s,u))}var l=a[Bo+n.length];var f=a[Bo+n.length+1];this.keys=a.subarray(l,f);this.bboxes=a.subarray(f);this.insert=this._insertReadonly}else{this.d=r+2*i;for(var h=0;h<this.d*this.d;h++){n.push([])}this.keys=[];this.bboxes=[]}this.n=r;this.extent=t;this.padding=i;this.scale=r/t;this.uid=0;this.freeIndexes=[];this.freeIndexMap={};var v=i/r*t;this.min=-v;this.max=t+v};Ro.prototype.clear=function e(){var t=this.cells=[];for(var r=0;r<this.d*this.d;r++){t.push([])}this.keys=[];this.bboxes=[];this.freeIndexMap={};this.freeIndexes=[];this.uid=0};Ro.prototype.insert=function e(t,r,i,n,a){var o;if(this.freeIndexes.length===0){o=this.uid++}else{o=this.freeIndexes.pop();delete this.freeIndexMap[o]}var s=o*4;var u=this.bboxes;this._forEachCell(r,i,n,a,this._insertCell,o);this.keys[o]=t;u[s+0]=r;u[s+1]=i;u[s+2]=n;u[s+3]=a;return this};Ro.prototype.remove=function e(t){var r=this.keys.indexOf(t);if(r!==-1&&!this.freeIndexMap[r]){var i=r*4;var n=this.bboxes;var a=n[i+0];var o=n[i+1];var s=n[i+2];var u=n[i+3];this._forEachCell(a,o,s,u,this._removeCell,r);this.freeIndexes.push(r);this.freeIndexMap[r]=true}return this};Ro.prototype._removeCell=function e(t,r,i,n,a,o){var s=this.cells[a];for(var u=0,l=s.length;u<l;u++){if(s[u]===o){s.splice(u,1);u--;l--}}};Ro.prototype._insertReadonly=function e(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."};Ro.prototype._insertCell=function e(t,r,i,n,a,o){this.cells[a].push(o)};Ro.prototype.query=function e(t,r,i,n){var a=this;var o=this.min;var s=this.max;var u,l;var f={};var h=[];for(u=0,l=this.freeIndexes.length;u<l;u++){f[a.freeIndexes[u]]=true}if(t<=o&&r<=o&&s<=i&&s<=n){var v=this.keys;for(u=0,l=v.length;u<l;u++){if(!f[u]){h.push(v[u])}}return h}else{this._forEachCell(t,r,i,n,this._queryCell,h,f);return h}};Ro.prototype._queryCell=function e(t,r,i,n,a,o,s){var u=this.cells[a];if(u!==null){var l=this.keys;var f=this.bboxes;for(var h=0;h<u.length;h++){var v=u[h];if(s[v]===undefined){var d=v*4;if(t<=f[d+2]&&r<=f[d+3]&&i>=f[d+0]&&n>=f[d+1]){s[v]=true;o.push(l[v])}else{s[v]=false}}}}};Ro.prototype._forEachCell=function e(t,r,i,n,a,o,s){var u=this;var l=this.scale;var f=this.padding;var h=this.d;var v=Math.max(0,Math.min(h-1,Math.floor(t*l)+f));var d=Math.max(0,Math.min(h-1,Math.floor(r*l)+f));var c=Math.max(0,Math.min(h-1,Math.floor(i*l)+f));var _=Math.max(0,Math.min(h-1,Math.floor(n*l)+f));for(var g=v;g<=c;g++){for(var p=d;p<=_;p++){var y=h*p+g;if(a.call(u,t,r,i,n,y,o,s)){return}}}};Ro.prototype.toArrayBuffer=function e(){var t=this;if(this.arrayBuffer){return this.arrayBuffer}var r=this.cells;var i=Bo+this.cells.length+1+1;var n=0;for(var a=0;a<this.cells.length;a++){n+=t.cells[a].length}var o=new Int32Array(i+n+this.keys.length+this.bboxes.length);o[0]=this.extent;o[1]=this.n;o[2]=this.padding;var s=i;for(var u=0;u<r.length;u++){var l=r[u];o[Bo+u]=s;o.set(l,s);s+=l.length}o[Bo+r.length]=s;o.set(this.keys,s);s+=this.keys.length;o[Bo+r.length+1]=s;o.set(this.bboxes,s);s+=this.bboxes.length;return o.buffer};function Oo(e,t){return e[3]>t[1]&&e[1]<t[3]&&(e[2]>t[0]&&e[0]<t[2])}var Vo=function e(t,r,i){if(i===void 0)i=16;if(i<2||i>16||i%2!==0){throw new Error("Wrong grid resolution '"+i+"' - it must be 2, 4, 8 or 16")}this._getBBox=r;this._bbox=t;this._res=i;this._inX=Math.pow(2,i)-1;this._inY=this._inX<<i;this.clear()};Vo.prototype._updateResolution=function e(){var t=this;this._xres=(this._bbox[2]-this._bbox[0])/this._res;this._yres=(this._bbox[3]-this._bbox[1])/this._res;this._clear();var r=Object.keys(this._codes);for(var i=0,n=r.len;i<n;i++){var a=r[i];t._codes[a]=0;t.insert(a)}return this};Vo.prototype.insert=function e(t){var r=this._getBBox(t);var i=this._res;var n=this._bbox[0],a=this._bbox[1];var o=(r[0]-n)/this._xres|0;var s=(r[1]-a)/this._yres|0;var u=(r[2]-n)/this._xres|0;var l=(r[3]-a)/this._yres|0;var f=o,h=s;var v=this._x,d=this._y;var c=this._codes;while(f<=u&&f<i){v[f][t]=true;c[t]|=1<<f;f++}while(h<=l&&h<i){d[h][t]=true;c[t]|=1<<i+h;h++}return this};Vo.prototype.updateBBox=function e(t){var r=this._bbox;var i=this._res;this._bbox=t;var n=(r[0]-t[0])/this._xres|0;var a=(r[1]-t[1])/this._yres|0;if(Math.abs(n)>=i||Math.abs(a)>=i){this.clear()}else{var o=this._updateDim(this._x,0,n);var s=this._updateDim(this._y,i,a);var u=this._inX,l=this._inY;var f=Object.keys(this._codes);var h=this._x,v=this._y,d=this._codes;for(var c=0,_=f.length;c<_;c++){var g=f[c];var p=d[g];if((p&u)===0||(p&l)===0){for(var y=0;y<i;y++){if(p&1<<y){delete h[y][g]}if(p&1<<i+y){delete v[y][g]}}delete d[g]}}if(n<0){this._x=this._x.slice(-n).concat(o)}else if(n>0){this._x=o.concat(this._x.slice(0,i-n))}if(a<0){this._y=this._y.slice(-a).concat(s)}else if(a>0){this._y=s.concat(this._y.slice(0,i-a))}}return this};Vo.prototype._updateDim=function e(t,r,i){var n,a,o,s,u;var l=this._codes;var f=[];if(i<0){for(n=0;n<-i;n++){s=1<<r+n;u=Object.keys(t[n]);for(a=0,o=u.length;a<o;a++){l[u[a]]^=s}f.push({})}}else if(i>0){for(n=this._res-i;n<this._res;n++){s=1<<r+n;u=Object.keys(t[n]);for(a=0,o=u.length;a<o;a++){l[u[a]]^=s}f.push({})}}return f};Vo.prototype.resize=function e(t){var r=this;this._bbox=t;for(var i=0;i<this._res;i++){r._x[i]={};r._y[i]={}}this._updateResolution()};Vo.prototype.removeMultiple=function e(t){var r=this;var i=t.length,n,a,o;for(var s=0;s<this._res;s++){a=r._x[s],o=r._y[s];for(var u=0;u<i;u++){n=t[u];if(r._codes[n]){if(a[n]){delete a[n]}if(o[n]){delete o[n]}delete r._codes[n]}}}return this};Vo.prototype.remove=function e(t){var r=this._codes[t];var i=this._x,n=this._y,a=this._res;for(var o=0;o<a;o++){var s=1<<o,u=1<<a+o;if(r&s){delete i[o][t]}if(r&u){delete n[o][t]}}delete this._codes[t];return this};Vo.prototype.point=function e(t){return this.query([t[0],t[1],t[0],t[1]])};Vo.prototype.query=function e(t){var r=this;var i=this._bbox[0],n=this._bbox[1],a=this._res;var o=Math.max(0,(t[0]-i)/this._xres|0);var s=Math.max(0,(t[1]-n)/this._yres|0);var u=Math.min(a-1,(t[2]-i)/this._xres|0);var l=Math.min(a-1,(t[3]-n)/this._yres|0);var f=this._getBBox;var h=[];var v=o,d=s,c={},_=[],g,p,y;while(v<=u){_=_.concat(Object.keys(r._x[v++]))}while(d<=l){_=_.concat(Object.keys(r._y[d++]))}for(g=0,p=_.length;g<p;g++){y=_[g];if(!c[y]){if(Oo(f(y),t)){h.push(y)}c[y]=true}}return h};Vo.prototype.getAll=function e(){var t=this;return Object.keys(this._codes).map(function(e){return t._getBBox(e)})};Vo.prototype.getOverlaps=function e(){var t=this;var r=this._res,i={};var n=this._getBBox;var a=[];var o=this._ycode;for(var s=0;s<r;s++){var u=Object.keys(t._x[s]);for(var l=0;l<r;l++){var f=[],h=1<<l;for(var v=0,d=u.length;v<d;v++){if(o[u[v]]&h){f.push(u[v])}}var c=f.length;for(var _=0;_<c;_++){for(var g=0;g<c;g++){var p=f[_],y=f[g];if(g!==_&&!i[p+":"+y]&&!i[y+":"+p]){i[p+":"+y]=true;if(Oo(n(p),n(y))){a.push(p,y)}}}}}}return a};Vo.prototype.clear=function e(){var t=this;var r=this._bbox;var i=this._res;this._x=new Array(i);this._y=new Array(i);for(var n=0;n<i;n++){t._x[n]={};t._y[n]={}}this._xres=(r[2]-r[0])/i;this._yres=(r[3]-r[1])/i;this._codes={}};function jo(e,t,r,i,n,a){return{minX:e,minY:t,maxX:r,maxY:i,leaf:true,level:a,parent:n,objects:[],final:false}}function Uo(e){var t=e.minX;var r=e.minY;var i=e.maxX;var n=e.maxY;return[t,r,i,n]}function Go(e,t,r,i,n,a,o,s){var u=(e+r)/2;var l=(t+i)/2;return u>=n&&u<=o&&(l>=a&&l<=s)}function Xo(e,t,r,i,n,a,o,s){return e>n&&e<o&&(t>a&&t<s)||r>n&&r<o&&(i>a&&i<s)}function Wo(e,t,r,i,n,a,o,s){return i>=a&&t<=s&&(r>=n&&e<=o)}var Yo=0;var Ho=1;var qo=2;var Zo=3;function $o(e,t,r,i,n,a,o,s){var u=(n+o)/2;var l=(a+s)/2;var f=(e+r)/2;var h=(t+i)/2;if(f<=u){return h<=l?Yo:Ho}else{return h<=l?Zo:qo}}var Ko=function(e){return e};var Jo=function e(t,r,i,n){if(t===void 0)t=Ko;if(r===void 0)r=10;if(n===void 0)n=0;this._nodeCapacity=r;this._root=null;this._getBBox=t;this._upScale=4;this._objects={};this._size=0;this._rootLevel=n;this._maxLevel=n+100;this._idToCell={};if(i){this._root=jo(i[0],i[1],i[2],i[3],null,n)}};var Qo={size:{configurable:true},root:{configurable:true}};Qo.size.get=function(){return this._size};Qo.root.get=function(){return this._root};Jo.prototype.clear=function e(){this._root=null;this._objects={};this._size=0;this._idToCell={};this._rootLevel=0;return this};Jo.prototype.insert=function e(t,r,i){var n=this;if(i===void 0)i=this._root;r=r||this._getBBox(t);if(this._objects[t]){return}this._objects[t]=true;this._size++;if(!this._root){var a=Math.max(Math.abs(r[2]-r[0]),Math.abs(r[3]-r[1]));this._root=jo(r[0],r[1],r[0]+a,r[1]+a,null,this._rootLevel);this._root.objects.push(t);return t}var o=[i];var s,u=false;var l=this._nodeCapacity,f=this._idToCell;var h=this._maxLevel;while(s=o.pop()){var v=s.minX;var d=s.minY;var c=s.maxX;var _=s.maxY;if(Wo(r[0],r[1],r[2],r[3],v,d,c,_)){if(s.leaf){if(s.final||s.objects.length<l||s.level>=h){s.objects.push(t);if(f[t]){f[t].push(s)}else{f[t]=[s]}if(s.level>=h||Math.abs(c-v)<=Math.abs(r[2]-r[0])||Math.abs(_-d)<=Math.abs(r[3]-r[1])){s.final=true}u=true}else{n.splitNode(s);o.push.apply(o,s.children)}}else{o.push.apply(o,s.children)}}}if(u){return t}i=this._root;if(!Go(r[0],r[1],r[2],r[3],i.minX,i.minY,i.maxX,i.maxY)){var g=this._rootLevel;var p=(r[0]+r[2])/2;var y=(r[1]+r[3])/2;while(!Go(r[0],r[1],r[2],r[3],this._root.minX,this._root.minY,this._root.maxX,this._root.maxY)){i=n._root;var m=i.minX;var x=i.minY;var b=i.maxX;var A=i.maxY;var w=m,E=x,S=b,C=A;var T=Math.abs(b-m);var M=Math.abs(A-x);if(M===0&&T===0){break}if(p<=m){w-=T}if(y<=x){E-=M}if(p>m){S+=T}if(y>x){C+=M}var k=jo(w,E,S,C,null,--g);n.splitNode(k);k.children[$o(m,x,b,A,w,E,S,C)]=i;n._root=i.parent=k}o=[this._root];this._root.level=this._rootLevel;while(s=o.shift()){if(!s.leaf){for(var I=0;I<4;I++){var N=s.children[I];N.level=s.level+1;o.push(N)}}}}i=this._root;s=i.children[$o(r[0],r[1],r[2],r[3],i.minX,i.minY,i.maxX,i.maxY)];if(s.leaf){s.objects.push(t);if(f[t]){f[t].push(s)}else{f[t]=[s]}}return t};Jo.prototype.removeById=function e(t){if(!this._objects[t]){return t}this._size--;var r=this._idToCell[t];for(var i=0;i<r.length;i++){var n=r[i];var a=n.objects;for(var o=0,s=a.length;o<s;o++){if(a[o]===t){a.splice(o,1);break}}}delete this._objects[t];delete this._idToCell[t];return t};Jo.prototype.remove=function e(t){var r=this._getBBox(t);var i=r[0];var n=r[1];var a=r[2];var o=r[3];var s=[this._root];var u,l,f;while(u=s.pop()){if(Wo(i,n,a,o,u.minX,u.minY,u.maxX,u.maxY)){if(u.leaf){var h=u.objects;for(var v=0,d=h.length;v<d;v++){if(h[v]===t){h.splice(v,1);if(d===1){f=f||[];f.push(u)}break}}}else{s.push.apply(s,u.children)}}}delete this._idToCell[t];delete this._objects[t];this._size--;if(f){while(l=f.pop()){var c=l.parent;var _=true;while(c&&_){if(!c.leaf){for(var g=0;g<4;g++){u=c.children[g];if(!u.leaf||u.objects.length!==0){_=false;break}}if(_){c.leaf=true;c.children=null;c.objects=[]}}c=c.parent}}}return t};Jo.prototype.splitNode=function e(t){var r=t.minX;var i=t.minY;var n=t.maxX;var a=t.maxY;var o=(r+n)/2,s=(i+a)/2;var u=t.level+1;var l=this._idToCell;var f=[jo(r,i,o,s,t,u),jo(r,s,o,a,t,u),jo(o,s,n,a,t,u),jo(o,i,n,s,t,u)];if(t.objects){var h=t.objects;var v=this._getBBox;for(var d=0,c=h.length;d<c;d++){var _=h[d];var g=v(_);var p=l[_];for(var y=0;y<4;y++){var m=f[y];if(Wo(g[0],g[1],g[2],g[3],m.minX,m.minY,m.maxX,m.maxY)){m.objects.push(_);if(p){p.push(m)}else{p=[m]}}}p.splice(p.indexOf(t),1)}}t.children=f;t.objects=null;t.leaf=false};Jo.prototype.point=function e(t,r){var i=[];var n=[this._root];var a,o,s;var u=t[0];var l=t[1];var f=this._getBBox;while(a=n.pop()){if(u>=a.minX&&u<=a.maxX&&l>=a.minY&&l<=a.maxY){if(a.leaf){if(r){i=a.objects}var h=a.objects;for(var v=0,d=h.length;v<d;v++){s=h[v];o=f(s);if(u>=o[0]&&u<=o[2]&&l>=o[1]&&l<=o[3]){i.push(s)}}break}else{n.push.apply(n,a.children)}}}return i};Jo.prototype.neigbours=function e(t){var r=[],i;var n=[this._root];var a=t[0];var o=t[1];while(i=n.pop()){if(a>=i.minX&&a<=i.maxX&&o>=i.minY&&o<=i.maxY){if(i.leaf){r=i.objects;break}else{n.push.apply(n,i.children)}}}return r};Jo.prototype.query=function e(t,r,i,n){var a=[];var o=[this._root];var s,u,l;var f=this._getBBox;var h={};while(s=o.pop()){if(Wo(t,r,i,n,s.minX,s.minY,s.maxX,s.maxY)){if(s.leaf){var v=s.objects;for(var d=0,c=v.length;d<c;d++){l=v[d];if(!h[l]){u=f(l);if(Wo(t,r,i,n,u[0],u[1],u[2],u[3])){a.push(l)}h[l]=true}}}else{o.push.apply(o,s.children)}}}return a};Jo.prototype.getOverlaps=function e(){var t=[this._root];var r,i,n;var a=[];var o=this._getBBox;var s={},u=this._objects;while(r=t.pop()){if(r.leaf){var l=r.objects,f=l.length;for(var h=0;h<f;h++){for(var v=0;v<f;v++){i=l[h];n=l[v];if(h!==v&&!s[i+":"+n]&&!s[n+":"+i]){var d=u[i],c=u[n];s[i+":"+n]=true;if(Wo(o(d),o(c))){a.push(d,c)}}}}}else{t.push.apply(t,r.children)}}return a};Jo.prototype.getAll=function e(){return Object.keys(this._objects)};Jo.prototype.forEach=function e(t,r){var i=[this._root];var n;while(n=i.pop()){if(n.leaf){for(var a=0,o=n.objects.length;a<o;a++){t.call(r,n.objects[a])}}else{i.push.apply(i,n.children)}}return this};Jo.prototype.getLeafs=function e(){var t=[this._root],r=[];var i;while(i=t.pop()){if(i.leaf){r.push(i)}else{t.push.apply(t,i.children)}}return r};Jo.prototype.traverse=function e(t,r){var i=[this._root];var n;while(n=i.pop()){if(!t.call(r,n,n.objects)&&!n.leaf){i.push.apply(i,n.children)}}return this};Jo.prototype.update=function e(t){this.remove(t);this.insert(t);return this};Jo.prototype.getNodeBounds=function e(t){return Uo(t)};Object.defineProperties(Jo.prototype,Qo);Jo.flatAccessor=function(e,t){return function(r){var i=t*r;return e.slice(i,i+t)}};Jo.inside=Go;Jo.intersects=Xo;Jo.overlaps=Wo;Jo.getNodeBBox=Uo;var es=Object.freeze({minHeap:minHeap,bellmanFord:bellmanFord,dijkstra:dijkstra,johnson:johnson,largestEmptyCircle:Lo,minDisk:minDisk,removeRadialOverlap:removeRadialOverlap,convexhull:No,circlePack:circlePack,GridIndex:Ro,Grid:Vo,Quadtree:Jo,weightedStress:weightedStress,distanceStress:distanceStress,constrainedStress:constrainedStress,stressMinimizationStep:stressMinimizationStep,stressMinimizationStepGeneral:stressMinimizationStepGeneral});var ts=typeof S==="object"&&S!==null&&typeof S.it!=="undefined";function rs(e){if(!ts){console.info(j()+" "+e)}}function is(e){if(!ts){console.warn(j()+" "+e)}}function ns(e,t){return e===undefined?t:e}function as(e,t){if(!t){return{nodes:e?new e:Object.create(null),edges:e?new e:Object.create(null),fetch:function(e){return e?this.nodes:this.edges}}}else{return{nodes:e,edges:t,fetch:function(e){return e?this.nodes:this.edges}}}}function os(value,e,t){return Ce(value,e,t)}function ss(e,t,value,r){if(t in e){throw new Error(r+" "+t+" already exists")}e[t]=value}function us(e,t,r){if(Array.isArray(e)){var i=e.indexOf(t);if(i===-1){throw new Error(r+" "+t+" does not exist")}return i}else{if(!(t in e)){throw new Error(r+" "+t+" does not exist")}return e[t]}}function ls(e,t){return se(e,t)}Ogma.extend(function(e){var t=new fs;e.modules.events=t;e.events.removeListener=function(e){t.removeListener(e)}});var fs=function e(){this._events={};this._onAnyEvents=[]};fs.prototype.register=function e(t,r){var i=this;if(r===void 0)r=[];t.forEach(function(e){if(i._events[e]){throw new Error('event "'+e+'" already exists')}i._events[e]=new hs(false,e)});r.forEach(function(e){if(i._events[e]){throw new Error('event "'+e+'" already exists')}i._events[e]=new hs(true,e)})};fs.prototype.onAnyEvent=function e(t){this._onAnyEvents.push(t)};fs.prototype.on=function e(t,r,i){var n=this;if(Z(t)){K(t,function(e,t){return n.on(t,e,i)})}else{var a=t.split(" ").filter(function(e){return!!e});a.forEach(function(e){return us(n._events,e,"event").on(r,i)})}return r};fs.prototype.removeListener=function e(t){K(this._events,function(e){e.off(t)})};fs.prototype.fire=function e(t,r,i){if(i===void 0)i=false;var n=us(this._events,t,"event");this._onAnyEvents.forEach(function(e){return e(t,r)});return n.trigger(r,i)};fs.prototype.once=function e(t,r){var i=this;var n=function(){r.apply(null,arguments);i.removeListener(n)};return this.on(t,n)};var hs=function e(t,r){this._name=r;this._reverseOrder=t;this._subscribers=[];this._handlers=[]};hs.prototype.trigger=function e(t,r){var i=this._handlers;var n=this._name;var a=Promise.resolve();if(r){var o=function(e){var r=i[e];a=a.then(function(){return r(t,n)})};for(var s=0;s<i.length;++s)o(s)}else{for(var u=0;u<i.length;++u){i[u](t,n)}}return a};hs.prototype.on=function e(t){if(typeof t!=="function"){throw new Error("handler is not a function")}var r=this._reverseOrder?0:this._subscribers.length;this._handlers.splice(r,0,t);this._subscribers.splice(r,0,t)};hs.prototype.off=function e(t){var r=this;var i;while((i=this._subscribers.indexOf(t))!==-1){r._subscribers.splice(i,1);r._handlers.splice(i,1)}};Ogma.atInit(function(e,t){if(t.options){e.setOptions(t.options)}});Ogma.extend(function(e){var t=new vs(e);e.modules.settings=t;e.setOptions=function(e){return t.update(e)};e.getOptions=function(){return t.get()}});var vs=function e(){this._currentValue={};this._onChange={};this._defaultValues={};this._keys=[]};vs.prototype.register=function e(t,r,i,n){if(n===void 0)n=true;this._keys.push(t);this._currentValue[t]=r;this._defaultValues[t]=r;this._onChange[t]=i||function(){};if(i&&n){i(r)}};vs.prototype.update=function e(t){var r=this;t=xe(t);var i=this._keys,n={};for(var a=0;a<i.length;++a){var o=i[a];if(o in t){var value=t[o];if(value===undefined){value=r._defaultValues[o]}n[o]=r._currentValue[o];r._currentValue[o]=value}}var s=Object.keys(n);for(var u=0;u<s.length;++u){var l=s[u],f=r._currentValue[l],h=n[l];if(f!==h){r._onChange[l](f,h)}}return we(n)};vs.prototype.get=function e(t){if(t===undefined){return we(this._currentValue)}else{return this._currentValue[t]}};vs.prototype.set=function e(t,value){var r=this._currentValue[t];var i=this._onChange[t];this._currentValue[t]=value;if(i){i(value,r)}};var ds=["geo","graphics","legend","brand","tooltip"];var cs=300;var _s=300;Ogma.atInit(function(e,t){if(t.container){e.setContainer(t.container)}});Ogma.extend(function(e,t){var r=new gs(e,t.dimensions);e.modules.dom=r;e.setContainer=function(e){return r.setContainer(e)};e.getContainer=function(){return r.getContainer()};e.view.beforeNextFrame=function(){return r.beforeNextFrame()};e.view.afterNextFrame=function(){return r.afterNextFrame()};e.view.setFullScreen=function(value){return r.setFullScreen(value)};e.view.isFullScreen=function(){return r.isFullScreen()};e.view.forceResize=function(){return r.forceResize()};e.view.getSize=function(){return r.getDimensions()};e.view.setSize=function(e){r.setDimensions(e);return Promise.resolve()}});Ogma.onDestroy(function(e){e.modules.dom.detachFromDom();e.modules.dom.clearAllTimeouts();e.modules.dom.stopFrames()});var gs=function e(t,r){var i=this;if(r===void 0)r={};var n=r.width;if(n===void 0)n=80;var a=r.height;if(a===void 0)a=60;this._events=t.modules.events;this._settings=t.modules.settings;this._width=n;this._height=a;this._layers={};this._container=null;this._isFullScreen=false;this._beforeNextFramePromises=[];this._afterNextFramePromises=[];this._refreshUntil=0;this._currentTime=R();this._timeouts=[];this._framesStopped=false;this._settings.register("minimumWidth",cs,function(){return i._resize()},false);this._settings.register("minimumHeight",_s,function(){return i._resize()},false);this._events.register(["beforeNewFrame","newFrame","afterNewFrame","setContainer","resize"]);this._listeners=[];this._onWindowResize=function(){return i._resize()};this._onWindowFocus=function(){return i.refresh()};this.addWindowEventListener("resize",this._onWindowResize);this.addWindowEventListener("focus",this._onWindowFocus)};gs.prototype.addWindowEventListener=function e(t,r,i){if(typeof window!=="undefined"&&!Ogma.debug){this.addElementEventListener(window,t,r,i)}};gs.prototype.addDocumentEventListener=function e(t,r,i){if(typeof document!=="undefined"&&!Ogma.debug){this.addElementEventListener(document,t,r,i)}};gs.prototype.addElementEventListener=function e(t,r,i,n){this._listeners.push({elt:t,name:r,listener:i,options:n});t.addEventListener(r,i,n)};gs.prototype.detachFromDom=function e(){this._listeners.forEach(function(e){var t=e.elt;var r=e.name;var i=e.listener;var n=e.options;t.removeEventListener(r,i,n)});this._emptyContainer()};gs.prototype.setTimeout=function e(t,r){var i=this;if(r===void 0)r=0;var n=setTimeout(function(){i._timeouts.splice(i._timeouts.indexOf(n),1);t()},r);this._timeouts.push(n);return n};gs.prototype.clearTimeout=function e(t){if(t){clearTimeout(t);this._timeouts.splice(this._timeouts.indexOf(t),1)}return null};gs.prototype.clearAllTimeouts=function e(){this._timeouts.forEach(clearTimeout);this._timeouts=[]};gs.prototype.stopFrames=function e(){this._framesStopped=true;if(this._nextFrame){E(this._nextFrame);this._nextFrame=null}};gs.prototype.isDestroyed=function e(){return this._framesStopped};gs.prototype.getDimensions=function e(){return{width:this._width,height:this._height}};gs.prototype.setDimensions=function e(t){this._resize(t)};gs.prototype.setLayer=function e(t,r,i){if(i===void 0)i={};var n=i.automaticResize;if(n===void 0)n=false;if(r){r._ogmaLayer=t;if(n){r.style.position="absolute";r.style.top="0px";r.style.left="0px";ft(r,this._width,this._height,nt())}}this._layers[t]={element:r,automaticResize:n};this._updateContainerContent()};gs.prototype.setContainer=function e(t){if(typeof t==="string"){var r=t;t=document.getElementById(r);if(!t){throw new Error('unable to find DOM element with id "'+r+'"')}}if(t===this._container){return}var i=this._container;this._isFullScreen=false;this._container=t;this._resize();this._updateContainerContent();this._events.fire("setContainer",{element:t,prevElement:i})};gs.prototype.getContainer=function e(){return this._container};gs.prototype.forceResize=function e(){this._resize()};gs.prototype._beforeOrAfterNextFrame=function e(t){var r=t?this._afterNextFramePromises:this._beforeNextFramePromises;var i=new Promise(function(e){r.push(function(){e();return i})});this._refresh();return i};gs.prototype.beforeNextFrame=function e(){return this._beforeOrAfterNextFrame(false)};gs.prototype.afterNextFrame=function e(){return this._beforeOrAfterNextFrame(true)};gs.prototype.refresh=function e(t){if(t){this._refreshUntil=Math.max(this._refreshUntil,t)}this._refresh()};gs.prototype._emptyContainer=function e(){var t=this;if(this._container){var r=[];for(var i=0;i<this._container.childNodes.length;++i){var n=t._container.childNodes[i];if(n._ogmaLayer){r.push(n)}}for(var a=0;a<r.length;++a){t._container.removeChild(r[a])}}};gs.prototype._fillContainer=function e(){var t=this;if(this._container){var r=Ve(this._container,"position");if(r!=="absolute"&&r!=="relative"&&r!=="fixed"){this._container.style.position="relative"}var i=this._container.firstChild;ds.forEach(function(e){var r=t._layers[e];if(r&&r.element){t._container.insertBefore(r.element,i)}})}};gs.prototype._updateContainerContent=function e(){this._emptyContainer();this._fillContainer()};gs.prototype._resize=function e(t){if(!this._container&&!t){return}var r=this._width;var i=this._height;var n;var a;if(this._container){var o=this._settings.get("minimumWidth");var s=this._settings.get("minimumHeight");var u=this._container.clientWidth||1;var l=this._container.clientHeight||1;n=Math.max(o,u);a=Math.max(s,l)}else{n=t.width;a=t.height}if(n!==r||a!==i){this._width=n;this._height=a;K(this._layers,function(e){var t=e.element;var r=e.automaticResize;if(r){ft(t,n,a)}});this._events.fire("resize",{prevWidth:r,prevHeight:i,width:n,height:a,difWidth:n-r,difHeight:a-i})}};gs.prototype._refresh=function e(){var t=this;if(this._inFrame){this._mustRefresh=true}else if(!this._nextFrame&&!this._framesStopped){this._nextFrame=w(function(){return t._playFrame()})}};gs.prototype._playFrame=function e(){var t=this;var r=R();var i=r-this._currentTime;var n=Te([this._beforeNextFramePromises,function(){return t._events.fire("beforeNewFrame",{elapsed:i})},function(){return t._events.fire("newFrame",{elapsed:i})},function(){return t._events.fire("afterNewFrame",{elapsed:i})},this._afterNextFramePromises,function(){t._inFrame=false;if(t._mustRefresh||r<t._refreshUntil+17){t._mustRefresh=false;t._refresh()}}]);this._inFrame=true;this._nextFrame=null;this._mustRefresh=false;this._currentTime=r;this._beforeNextFramePromises=[];this._afterNextFramePromises=[];n.reduce(function(e,r){return e.then(function(){if(!t._framesStopped){return r()}})},Promise.resolve())};gs.prototype.isPlayingFrame=function e(){return this._inFrame||!!this._nextFrame};gs.prototype.setFullScreen=function e(value){if(this._container){if(value&&!this._isFullScreen){ps(this._container)}else if(!value&&this._isFullScreen){ys()}}this._isFullScreen=value};gs.prototype.isFullScreen=function e(){return this._isFullScreen};gs.prototype.debounceBeforeFrame=function e(t){var r=this;var i=false;var n=[];var a=function(){var e=n;i=false;n=[];t();e.forEach(function(e){return e()})};return function(){return new Promise(function(e){n.push(e);if(!i){i=true;r.beforeNextFrame().then(a)}})}};function ps(e){if(e.requestFullScreen){e.requestFullScreen()}else if(e.webkitRequestFullScreen){e.webkitRequestFullScreen()}else if(e.mozRequestFullScreen){e.mozRequestFullScreen()}else if(e.msRequestFullscreen){e.msRequestFullscreen()}}function ys(){if(typeof document==="undefined"){return}if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}function ms(e,t){var r=t.directed;var i=t.ids;var n=t.weight;var a=t.nodes;var o=r?"out":"both";a=a||e._getIndexes(true);var s=a.map(function(t){return e._collectAdjacentEdges([t],o)});var u=e._nodeIdList;var l=e.getAttributes(false,["source","target","width"]);var f=l[0];var h=l[1];var v=l[2];var d=new Array,c;var _=1,g=false,p=false;if(typeof n==="number"){g=true;_=n}else if(typeof n==="function"){p=true}else if(typeof n!=="string"){n=n?"width":null}for(var y=0;y<s.length;y++){var m=s[y];var x=a[y];var b=void 0,A=void 0,w=void 0,E=void 0;var S=m.length;var C=i?new Array(S):new Uint32Array(S);var T=new Array(S);for(var M=0;M<S;M++){b=m[M];A=f.get(b);w=h.get(b);E=r?w:x===A?w:A;if(i){E=e._getId(true,E)}C[M]=E;if(n){if(g){T[M]=_}else if(p){T[M]=n(u.get(A),u.get(w))}else{T[M]=v.get(b)||_}}}c=Object.create(null);c.nodes=C;c.id=i?e._getId(true,x):x;if(n){c.weights=T}d.push(c)}return d}Ogma.atInit(function(e,t){if(t.graph){var r=t.graph;var i=r.nodes;var n=r.edges;if(i){e.addNodes(i)}if(n){e.addEdges(n)}}});Ogma.extend(function(e){var t=new xs(e);var r=t.Node;var i=t.Edge;var n=t.NodeList;var a=t.EdgeList;e.modules.graph=t;e.Node=r;e.Edge=i;e.NodeList=n;e.EdgeList=a;e.events.onNodesAdded=function(t){e.modules.events.on("addNodes",t);return e.events};e.events.onBeforeNodesRemoved=function(t){e.modules.events.on("beforeRemoveNodes",t);return e};e.events.onNodesRemoved=function(t){e.modules.events.on("removeNodes",t);return e.events};e.events.onEdgesAdded=function(t){e.modules.events.on("addEdges",t);return e.events};e.events.onBeforeEdgesRemoved=function(t){e.modules.events.on("beforeRemoveEdges",t);return e};e.events.onEdgesRemoved=function(t){e.modules.events.on("removeEdges",t);return e.events};e.addNodes=function(e,r){return t.addElements(true,e,r)};e.addEdges=function(e,r){if(r===void 0)r={};return t.addElements(false,e,r)};e.addNode=function(e,r){return t.addElement(true,e,r)};e.addEdge=function(e,r){return t.addElement(false,e,r)};e.removeNodes=function(e,r){return t.removeElements(true,e,r)};e.removeEdges=function(e,r){return t.removeElements(false,e,r)};e.removeNode=function(e,r){return t.removeElements(true,[e],r)};e.removeEdge=function(e,r){return t.removeElements(false,[e],r)};e.getNodes=function(e){return t.getElements(true,e)};e.getEdges=function(e){return t.getElements(false,e)};e.getNode=function(e){return t.getElement(true,e)};e.getEdge=function(e){return t.getElement(false,e)};e.clearGraph=function(){return t.clear()};e.setGraph=function(r,i){t.clear();return e.addGraph(r,i)};e.addGraph=function(e,r){return t.addGraph(e,r)};e.createNodeList=function(){return e.getNodes([])};e.createEdgeList=function(){return e.getEdges([])};r.prototype.getAdjacentNodes=function(e){return t.getAdjacentNodes(this,e)};n.prototype.getAdjacentNodes=function(e){return t.getAdjacentNodes(this,e)};r.prototype.getAdjacentEdges=function(e){return t.getAdjacentEdges(this,e)};n.prototype.getAdjacentEdges=function(e){return t.getAdjacentEdges(this,e)};r.prototype.getDegree=function(e){return t.getDegree(this,e)[0]};n.prototype.getDegree=function(e){return t.getDegree(this,e)};n.prototype.getConnectedComponents=function(e){return t.getConnectedComponents(this,e)};i.prototype.getParallelEdges=function(e){return t.getParallelEdges(this,e)};a.prototype.getParallelEdges=function(e){return t.getParallelEdges(this,e)};e.getConnectedComponents=function(e){if(e===void 0)e={};return t.getConnectedComponents(t.getNodes(e.filter),e)};e.getConnectedComponentByNode=function(e,r){var i=t.getElement(true,e);if(i===undefined){throw new Error("getComponentByNode: cannot find node "+e)}return t.getConnectedComponentByNode(i,r)[0]};r.prototype.getConnectedComponent=function(e){return t.getConnectedComponentByNode(this,e)[0]};r.prototype.isVisible=function(){return!this.isExcluded()};n.prototype.isVisible=function(){return this.isExcluded().map(function(value){return!value})};i.prototype.isVisible=function(){return!this.isExcluded()};a.prototype.isVisible=function(){return this.isExcluded().map(function(value){return!value})};r.prototype.isExcluded=function(){return t.isExcluded(this)[0]};n.prototype.isExcluded=function(){return t.isExcluded(this)};r.prototype.setExcluded=function(value){return t.setExcluded(this,value)};n.prototype.setExcluded=function(value){return t.setExcluded(this,value)};i.prototype.isExcluded=function(){return t.isExcluded(this)[0]};a.prototype.isExcluded=function(){return t.isExcluded(this)};i.prototype.setExcluded=function(value){return t.setExcluded(this,value)};a.prototype.setExcluded=function(value){return t.setExcluded(this,value)};r.prototype.setVisible=function(value){return this.setExcluded(!value)};n.prototype.setVisible=function(value){return this.setExcluded(!value)};i.prototype.setVisible=function(value){return this.setExcluded(!value)};a.prototype.setVisible=function(value){return this.setExcluded(!value)}});var xs=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._dom=t.modules.dom;this._elts=as(new pi(true),new pi(false));this._buffer=[];this._events.register(["addNodes","addEdges","excludedStateChange"],["clear","beforeRemoveNodes","removeNodes","beforeRemoveEdges","removeEdges"]);this._promisesToResolve=[];this._freeIndexes=0;this._init_();this._sourceList=this.createEdgeAttribute({name:"source",storage:32});this._targetList=this.createEdgeAttribute({name:"target",storage:32});this._nodeDeduper=this.createNodeAttribute({storage:1});this._edgeDeduper=this.createEdgeAttribute({storage:1});this.createAttributes([{name:"excluded",storage:1,default:1},{name:"removed",storage:1,default:1},{name:"virtual",storage:1,default:0}]);this.Node=function e(t){this._index=t};Object.defineProperty(this.Node.prototype,"_ogma",{value:t});Object.defineProperty(this.Node.prototype,"isNode",{value:true});Object.defineProperty(this.Node.prototype,"size",{value:1});Object.defineProperty(this.Node.prototype,"__indexes",{value:[0]});Object.defineProperty(this.Node.prototype,"_indexes",{get:function(){this.__indexes[0]=this._index;return this.__indexes}});this.Edge=function e(t){this._index=t};Object.defineProperty(this.Edge.prototype,"_ogma",{value:t});Object.defineProperty(this.Edge.prototype,"isNode",{value:false});Object.defineProperty(this.Edge.prototype,"size",{value:1});Object.defineProperty(this.Edge.prototype,"__indexes",{value:[0]});Object.defineProperty(this.Edge.prototype,"_indexes",{get:function(){this.__indexes[0]=this._index;return this.__indexes}});this.NodeList=function e(t){this._indexes=t||[]};Object.defineProperty(this.NodeList.prototype,"_ogma",{value:t});Object.defineProperty(this.NodeList.prototype,"size",{get:function(){return this._indexes.length}});Object.defineProperty(this.NodeList.prototype,"isNode",{value:true});this.EdgeList=function e(t){this._indexes=t||[]};Object.defineProperty(this.EdgeList.prototype,"_ogma",{value:t});Object.defineProperty(this.EdgeList.prototype,"size",{get:function(){return this._indexes.length}});Object.defineProperty(this.EdgeList.prototype,"isNode",{value:false});this._nodes=this.createAttribute(true,{name:"object",storage:"any"});this._edges=this.createAttribute(false,{name:"object",storage:"any"});this._dummyList={get:function(){return 0}};this._events.on({newFrame:function(){if(r._freeIndexes===1){r._freeIndexes=2}else if(r._freeIndexes===2){r._elts.nodes.freeIndexes();r._elts.edges.freeIndexes();r._freeIndexes=0}}})};xs.prototype._resolvePromises=function e(){var t=this._promisesToResolve;this._promisesToResolve=[];t.forEach(function(e){return e()})};xs.prototype._init_=function e(){this._nodeList=[];this._edgeList=[];this._neighborTable=new mi;this._parallelTable=new mi;this._parallelEdgesIndex=[];this._resolvePromises()};xs.prototype.getNodeMaxIndex=function e(){return this._elts.nodes.getMaxIndex()};xs.prototype.getEdgeMaxIndex=function e(){return this._elts.edges.getMaxIndex()};xs.prototype.isExcluded=function e(t){var r=this._elts.fetch(t.isNode).getFlexArray("excluded");return r.getMultiple(t._indexes)};xs.prototype.setExcluded=function e(t,value){var r=+value;var i=this._elts.fetch(t.isNode);var n=t._indexes;var a=i.getFlexArray("excluded");var o=i.getFlexArray("removed");var s=[];for(var u=0;u<n.length;++u){var l=n[u];var f=a.get(l);var h=o.get(l);if(r!==f&&!h){s.push(l)}}a.setMultiple(s,r);var v=this._getElements(t.isNode,s);this._events.fire("excludedStateChange",{elements:v,value:value})};xs.prototype.addElement=function e(t,r,i){if(r===void 0)r={};if(i===void 0)i={};return this._addElements(t,[r],i).get(0)};xs.prototype.addGraph=function e(t,r){var i=this;var n=t.nodes;if(n===void 0)n=[];var a=t.edges;if(a===void 0)a=[];if(r===void 0)r={};if(!r.batchSize){return Promise.resolve({nodes:this._addElements(true,n,r),edges:this._addElements(false,a,r)})}else{var o;return this.addElements(true,n,r).then(function(e){o=e;return i.addElements(false,a,r)}).then(function(e){return{nodes:o,edges:e}})}};xs.prototype.addElements=function e(t,r,i){var n=this;if(i===void 0)i={};if(!i.batchSize){return Promise.resolve(this._addElements(t,r,i))}else{var a=[];for(var o=0;o<r.length;o+=i.batchSize){a.push(r.slice(o,o+i.batchSize))}return a.reduce(function(e,r){var a=null;return e.then(function(e){a=e;return n._dom.afterNextFrame()}).then(function(){return n._addElements(t,r,i)}).then(function(e){return a.concat(e)})},Promise.resolve(this.getEmptyList(t)))}};xs.prototype.getEmptyList=function e(t){return t?new this.NodeList:new this.EdgeList};xs.prototype._addElements=function e(t,r,i){var n=this;var a=this._elts.fetch(t);var o=[];var s=[];var u=[];var l=[];var f=new ii;var h=i.virtual;if(h===void 0)h=false;for(var v=0;v<r.length;++v){var d=r[v];if(typeof d!=="object"||d===null||Array.isArray(d)){throw new Error(d+" is not a valid "+(t?"node":"edge"))}var c=ws(d.id);if(!a.getIndex(c,false)&&!f.has(c)){s.push(c);o.push(d);f.add(c);if(!t){var _=n._getExtremityIndex(c,d.source,"source");var g=n._getExtremityIndex(c,d.target,"target");u.push(_);l.push(g)}}}var p=a.addElements(s);if(t){this._neighborTable.reserve(p.length);for(var y=0;y<p.length;++y){n._neighborTable.addEntry(p[y])}}else{this._parallelTable.reserve(p.length/2|0);for(var m=0;m<p.length;++m){var x=p[m];var b=u[m];var A=l[m];n._sourceList.set(x,b);n._targetList.set(x,A);Es(n,x)}}var w=a.getFlexArray("object");var E=a.getFlexArray("excluded");var S=a.getFlexArray("removed");var C=a.getFlexArray("virtual");var T=t?this.Node:this.Edge;var M=t?this.NodeList:this.EdgeList;var k=new M(p);w.setMultiple(p,p.map(function(e){return new T(e)}));E.setMultiple(p,0);S.setMultiple(p,0);C.setMultiple(p,h);var I={virtual:h,objects:o};I[t?"nodes":"edges"]=k;if(k.size){this._events.fire(t?"addNodes":"addEdges",I)}return k};xs.prototype._getExtremityIndex=function e(t,r,i){if(r instanceof this.Node){return r._index}else{var n=this._elts.nodes.getIndex(r);if(!n){throw new Error("addEdge(s): invalid "+i+' for edge "'+t+'"; node "'+r+'" does not exist')}return n}};xs.prototype.removeElements=function e(t,r,i){var n=this;if(i===void 0)i={};if(!Array.isArray(r)&&!(r instanceof(t?this.NodeList:this.EdgeList))){r=[r]}var a=this.getElements(t,r).dedupe();if(!a.size){return Promise.resolve()}if(t){var o=a.getAdjacentEdges({filter:"all"});this.removeElements(false,o,i)}var s=i.virtual;if(s===void 0)s=false;var u=a._indexes;var l=this._elts.fetch(t);var f=l.getFlexArray("removed");var h=l.getFlexArray("virtual");var v=Yt(h.getMultiple(u));if(v!==(s?u.length:0)){throw new Error("Attempting to remove virtual elements; you should not do that")}var d={virtual:s};d[t?"nodes":"edges"]=a;this._events.fire(t?"beforeRemoveNodes":"beforeRemoveEdges",d);this.setExcluded(a,true);f.setMultiple(u,1);if(!t){for(var c=0;c<u.length;++c){Ss(n,u[c])}}l.removeElements(u);this._freeIndexes=0;this._events.fire(t?"removeNodes":"removeEdges",d);return Promise.resolve()};xs.prototype.getElements=function e(t,r){var i=bs(r);var n=i.ids;var a=i.filter;var o=this._getIndexes(t,n);this._filter(t,o,a);return this._getElements(t,o)};xs.prototype.getElement=function e(t,r){return this._getElement(t,this._getIndex(t,r))};xs.prototype._getElements=function e(t,r){return t?new this.NodeList(r):new this.EdgeList(r)};xs.prototype.createNodeList=function e(t){return new this.NodeList(t)};xs.prototype.createEdgeList=function e(t){return new this.EdgeList(t)};xs.prototype._getElement=function e(t,r){return(t?this._nodes:this._edges).get(r)};xs.prototype.clear=function e(){this._events.fire("clear");this._elts.nodes.clear();this._elts.edges.clear();this._init_()};xs.prototype.forEachNode=function e(t,r){this._forEachElements(true,t._indexes,r)};xs.prototype.forEachEdge=function e(t,r){this._forEachElements(false,t._indexes,r)};xs.prototype._forEachElements=function e(t,r,i){var n=this;for(var a=0;a<r.length;++a){i(n._getElement(t,r[a]),a)}};xs.prototype.mapNodes=function e(t,r){return this._mapElements(true,t._indexes,r)};xs.prototype.mapEdges=function e(t,r){return this._mapElements(false,t._indexes,r)};xs.prototype._mapElements=function e(t,r,i){var n=this;var a=new Array(r.length);for(var o=0;o<r.length;++o){a[o]=i(n._getElement(t,r[o]),o)}return a};xs.prototype.filterNodes=function e(t,r){return this._filterElements(true,t._indexes,r)};xs.prototype.filterEdges=function e(t,r){return this._filterElements(false,t._indexes,r)};xs.prototype._filterElements=function e(t,r,i){var n=this;var a=[];for(var o=0;o<r.length;++o){var s=r[o];if(i(n._getElement(t,s),o)){a.push(s)}}return this._getElements(t,a)};xs.prototype.reduceNodes=function e(t,r,i){return this._reduceElements(true,t._indexes,r,i)};xs.prototype.reduceEdges=function e(t,r,i){return this._reduceElements(false,t._indexes,r,i)};xs.prototype._reduceElements=function e(t,r,i,n){var a=this;var o=n;for(var s=0;s<r.length;++s){var u=r[s],l=a._getElement(t,u);o=i(o,l,s)}return o};xs.prototype.dedupeNodes=function e(t){return this._getElements(true,this._dedupe(true,t._indexes.slice()))};xs.prototype.dedupeEdges=function e(t){return this._getElements(false,this._dedupe(false,t._indexes.slice()))};xs.prototype._dedupe=function e(t,r){if(!r.length){return r}var i=this[t?"_nodeDeduper":"_edgeDeduper"],n=0;i.reset();for(var a=0;a<r.length;++a){var o=r[a];if(i.get(o)===0){i.set(o,1);r[n]=o;n+=1}}r.length=n;return r};xs.prototype.inverse=function e(t){var r=t.isNode,i=t._indexes,n=this[r?"_nodeDeduper":"_edgeDeduper"],a=this._elts.fetch(r).getFlexArray("excluded"),o=this._allIndexes(r),s=[];n.reset();for(var u=0,l=i.length;u<l;++u){var f=i[u];n.set(f,1)}for(var h=0,v=o.length;h<v;++h){var d=o[h];if(n.get(d)===0&&a.get(d)===0){s.push(d)}}return this._getElements(r,s)};xs.prototype.partitionNodes=function e(t,r){return this._partition(true,t._indexes,r)};xs.prototype.partitionEdges=function e(t,r){return this._partition(false,t._indexes,r)};xs.prototype._partition=function e(t,r,i){var n=this;var a={};for(var o=0;o<r.length;++o){var s=r[o],u=n._getElement(t,s),l=i(u,o),f=a[l];if(!f){f=new n.NodeList;a[l]=f}f._indexes.push(s)}return a};xs.prototype.concatNodes=function e(t,r){return this._getElements(true,t._indexes.concat(r._indexes))};xs.prototype.concatEdges=function e(t,r){return this._getElements(false,t._indexes.concat(r._indexes))};xs.prototype.createAttribute=function e(t,r){return this._elts.fetch(t).createFlexArray(r)};xs.prototype.createNodeAttribute=function e(t){return this.createAttribute(true,t)};xs.prototype.createEdgeAttribute=function e(t){return this.createAttribute(false,t)};xs.prototype.createAttributes=function e(t){var r=this;t.forEach(function(e){if(e.for!=="edges"){r.createNodeAttribute(e)}if(e.for!=="nodes"){r.createEdgeAttribute(e)}})};xs.prototype._removeAttribute=function e(t,r){this._elts.fetch(t).removeFlexArray(r)};xs.prototype.getAllAttributes=function e(){return this._elts.nodes.getAllFlexArrays().concat(this._elts.nodes.getAllFlexArrays())};xs.prototype.getAttribute=function e(t,r){return this._elts.fetch(t).getFlexArray(r)};xs.prototype.getAttributes=function e(t,r){var i=this;return r.map(function(e){return i.getAttribute(t,e)})};xs.prototype.getNodeAttribute=function e(t){return this.getAttribute(true,t)};xs.prototype.getEdgeAttribute=function e(t){return this.getAttribute(false,t)};xs.prototype._getIndexes=function e(t,r,i){if(i===void 0)i=false;var n=this[t?"Node":"Edge"],a=this[t?"NodeList":"EdgeList"],o=this[t?"_nodes":"_edges"],s=this._elts.fetch(t),u;if(r===undefined){u=s.allIndexes().slice()}else if(r instanceof a||r instanceof n){u=r._indexes.filter(function(e){return o.get(e)})}else{u=[];if(H(r)){for(var l=0;l<r.length;++l){var f=r[l];if(f instanceof n){if(o.get(f._index)){u.push(f._index)}}else{var h=s.getIndex(f,i);if(h){u.push(h)}}}}else{var v=s.getIndex(r,i);if(v){u.push(v)}}}return u};xs.prototype._allIndexes=function e(t){return this._elts.fetch(t).allIndexes()};xs.prototype.allNodeIndexesConst=function e(){return this._allIndexes(true)};xs.prototype.allEdgeIndexesConst=function e(){return this._allIndexes(false)};xs.prototype._getIndex=function e(t,r,i){var n=this[t?"Node":"Edge"];if(r instanceof n){return r._index}else{return this._elts.fetch(t).getIndex(r,i)}};xs.prototype.getNodeIndex=function e(t){return this._elts.nodes.getIndex(t)};xs.prototype.getEdgeIndex=function e(t){return this._elts.edges.getIndex(t)};xs.prototype.nodeIndexList=function e(t){return this._getIndexes(true,t)};xs.prototype.edgeIndexList=function e(t){return this._getIndexes(false,t)};xs.prototype.getAttributesArrays=function e(t,r,i){if(i===void 0)i={};var n=i.destArrays;var a=i.ids;if(!r){throw new Error("You must provide array of attributes to retrieve the values")}if(!a){a=this._elts[t?"nodes":"edges"].getAllIndexes()}return this.getAttributes(t,r).map(function(e,t){return e.getMultiple(a,n?n[t]:undefined)})};xs.prototype.getNodeAttributesArrays=function e(t,r){return this.getAttributesArrays(true,t,r)};xs.prototype.getEdgeAttributesArrays=function e(t,r){return this.getAttributesArrays(false,t,r)};xs.prototype._getId=function e(t,r){return this._elts.fetch(t).getId(r)};xs.prototype._getIds=function e(t,r,i){return this._elts.fetch(t).getIdList(r,i)};xs.prototype._getSource=function e(t){return this._sourceList.get(t)};xs.prototype._getSources=function e(t,r){return this._sourceList.getMultiple(t,r)};xs.prototype._getTarget=function e(t){return this._targetList.get(t)};xs.prototype._getTargets=function e(t,r){return this._targetList.getMultiple(t,r)};xs.prototype._setExtremities=function e(t,r,i){var n=this;for(var a=0;a<t.length;++a){Ss(n,t[a])}if(r){this._sourceList.setMultiple(t,r)}if(i){this._targetList.setMultiple(t,i)}for(var o=0;o<t.length;++o){Es(n,t[o])}};xs.prototype.setSource=function e(t,r){var i=this._getIndexes(false,t),n=Array.isArray(r)?this._getIndexes(true,r):this._getIndex(true,r);this._setExtremities(i,n,undefined)};xs.prototype.setTarget=function e(t,r){var i=this._getIndexes(false,t),n=Array.isArray(r)?this._getIndexes(true,r):this._getIndex(true,r);this._setExtremities(i,undefined,n)};xs.prototype.getParallelEdges=function e(t,r){var i=this;if(r===void 0)r={};var n=r.filter;if(n===void 0)n="visible";var a=[];for(var o=0;o<t._indexes.length;++o){var s=t._indexes[o];var u=i._sourceList.get(s);var l=i._targetList.get(s);var f=Ts(u,l);var h=i._parallelEdgesIndex[f];var v=i._parallelTable.get(+h);if(v){for(var d=0;d<v.length;++d){a.push(v[d])}}}this._filter(false,a,n);return new this.EdgeList(a)};xs.prototype.getEdgesBetweenTwoNodes=function e(t,r){var i=Ts(t._index,r._index);var n=this._parallelEdgesIndex[i];var a=this._parallelTable.get(+n);return new this.EdgeList(a.slice())};xs.prototype._getAllEdgeDirections=function e(){var t=this;var r=[],i=Object.keys(this._parallelEdgesIndex);for(var n=0;n<i.length;++n){r.push(t._parallelEdgesIndex[i[n]])}return r};xs.prototype._filter=function e(t,r,i){var n=this._elts.fetch(t);var a=n.getFlexArray("removed");var o=undefined;var s=0;if(i==="raw"){o=n.getFlexArray("virtual")}else if(i==="all"){o=this._dummyList}else{o=n.getFlexArray("excluded")}for(var u=0;u<r.length;++u){var l=r[u];if(o.get(l)===0&&a.get(l)===0){r[s]=l;s+=1}}r.length=s;return r};xs.prototype._filterWithCriteria=function e(t,r,i){var n=this;var a=0;for(var o=0;o<r.length;++o){var s=r[o];if(i(n._getElement(t,s))){r[a]=s;a+=1}}r.length=a;return r};xs.prototype.getAdjacentDirections=function e(t){return this._neighborTable.get(t)};xs.prototype.getEdgeIndexesInDirection=function e(t){return this._parallelTable.get(t)};xs.prototype._collectAdjacentEdges=function e(t,r){var i=this;var n=r==="out",a=r==="in",o=!(n||a),s=[];for(var u=0;u<t.length;++u){var l=t[u],f=i._neighborTable.get(l);for(var h=0;h<f.length;++h){var v=i._parallelTable.get(f[h]);if(o){s.push.apply(s,v)}else{for(var d=0;d<v.length;++d){var c=v[d],_=i._sourceList.get(c),g=i._targetList.get(c),p=g===l;if(a===p||_===g){s.push(c)}}}}}return s};xs.prototype._collectAdjacentNodes=function e(t,r,i){var n=this;var a=r==="out";var o=r==="in";var s=!(a||o);var u=[];var l=null;if(i==="all"){l=this._dummyList}else if(i==="raw"){l=this._elts.edges.getFlexArray("virtual")}else{l=this._elts.edges.getFlexArray("excluded")}for(var f=0;f<t.length;++f){var h=t[f],v=n._neighborTable.get(h);for(var d=0;d<v.length;++d){var c=n._parallelTable.get(v[d]);for(var _=0;_<c.length;++_){var g=c[_];if(!l.get(g)){var p=n._sourceList.get(g);var y=n._targetList.get(g);if(s||o&&h===y||a&&h===p){u.push(p+y-h);break}}}}}return u};xs.prototype.getAdjacentNodes=function e(t,r){return this._getElements(true,this._getAdjacentElements(true,t._indexes,r))};xs.prototype.getAdjacentEdges=function e(t,r){return this._getElements(false,this._getAdjacentElements(false,t._indexes,r))};xs.prototype._getAdjacentElements=function e(t,r,i){if(i===void 0)i={};var n=i.direction;if(n===void 0)n="both";var a=i.filter;if(a===void 0)a="visible";var o=i.policy;if(o===void 0)o="union";var s=i.includeSources;if(s===true){o="include-sources"}else if(s===false){o="exclude-sources"}if(!t){var u=this._collectAdjacentEdges(r,n);this._filter(false,u,a);this._dedupe(false,u);return u}else{var l=this._collectAdjacentNodes(r,n,a);this._dedupe(true,l);if(o==="include-sources"){for(var f=0;f<r.length;++f){var h=r[f];if(!l.includes(h)){l.push(h)}}}else if(o==="exclude-sources"){for(var v=0;v<r.length;++v){var d=r[v];var c=l.indexOf(d);if(c!==-1){l.splice(c,1)}}}return l}};xs.prototype.getDegree=function e(t,r){var i=this;var n=this._getDegreeOptions(r);var a=n.direction;var o=n.filter;var s=new Array(t.size);var u=new Array(1);for(var l=0;l<t.size;++l){u[0]=t._indexes[l];s[l]=i._collectAdjacentNodes(u,a,o).length}return s};xs.prototype._getDegreeOptions=function e(t){var r={direction:"both",filter:"visible"};if(typeof t==="string"){r.direction=t}else if(t){if(typeof t.direction==="string"){r.direction=t.direction}if(typeof t.filter==="string"){r.filter=t.filter}}return r};xs.prototype._degrees=function e(t,r){var i=this;if(r!=="in"&&r!=="out"){return this._neighborTable.sizes(t)}else{var n=new Array(t.length);var a=r==="in";for(var o=0,s=t.length;o<s;o++){n[o]=Cs(i,t[o],a)}return n}};xs.prototype.getAdjacencyList=function e(t){if(t===void 0)t={};var r=t.directed;if(r===void 0)r=false;var i=t.internalIndexes;if(i===void 0)i=false;var n=t.weight;if(n===void 0)n=1;var a=t.nodes;var o=t.indexes;return ms(this,{directed:r,weight:n,ids:!i,nodes:o||this._getIndexes(true,a)})};xs.prototype.getConnectedComponents=function e(t,r){return Ms(this,t._indexes,r)};xs.prototype.getConnectedComponentByNode=function e(t,r){return Ms(this,[t._index],r)};xs.prototype.generateUnusedNodeId=function e(){return As()};xs.prototype.generateUnusedEdgeId=function e(){return As()};xs.prototype.getNodes=function e(t){return this._ogma.getNodes(t)};xs.prototype.getEdges=function e(t){return this._ogma.getEdges(t)};xs.prototype.getNode=function e(t){return this._ogma.getNode(t)};xs.prototype.getEdge=function e(t){return this._ogma.getEdge(t)};function bs(e){if(e===null||e===undefined){return{}}else if(typeof e==="string"){return{filter:e}}else{return{ids:e,filter:"all"}}}function As(){return Math.round(Math.random()*Number.MAX_SAFE_INTEGER)}function ws(e){if(e===undefined){return As()}else if(typeof e!=="string"&&(typeof e!=="number"||!isFinite(e))){throw new Error(e+" is not a valid id, expected string or number")}return e}function Es(e,t){var r=e._sourceList.get(t),i=e._targetList.get(t),n=Ts(r,i),a=e._parallelEdgesIndex[n];if(a===undefined){a=e._parallelTable.addEntry();e._parallelEdgesIndex[n]=a;e._neighborTable.addTo(r,a);if(r!==i){e._neighborTable.addTo(i,a)}}e._parallelTable.addTo(a,t)}function Ss(e,t){var r=e._sourceList.get(t),i=e._targetList.get(t),n=Ts(r,i),a=e._parallelEdgesIndex[n];if(e._parallelTable.removeFromAndGetSize(a,t)===0){e._neighborTable.removeFrom(r,a);if(r!==i){e._neighborTable.removeFrom(i,a)}e._parallelEdgesIndex[n]=undefined}}function Cs(e,t,r){var i=e._neighborTable.get(t),n=0;for(var a=0;a<i.length;++a){var o=e._parallelTable.get(i[a]);for(var s=0;s<o.length;++s){var u=o[s],l=e._sourceList.get(u),f=e._targetList.get(u);if(r&&f===t||!r&&l===t){n+=1;break}}}return n}function Ts(e,t){var r=e<t?e:t;var i=e+t-r;return r*67108864+i}function Ms(e,t,r){if(r===void 0)r={};var i=r.filter;if(i===void 0)i="visible";var n=r.returnIds;if(n===void 0)n=false;var a=r.internalIndexes;if(a===void 0)a=false;var o=[];var s={};var u=e._filter(true,t,i);var l={filter:i};for(var f=0;f<u.length;f++){var h=u[f];if(!s[h]){var v=[h];var d=[];while(v.length!==0){var c=v.pop();if(!s[c]){v.push.apply(v,e._getAdjacentElements(true,[c],l));s[c]=1;d.push(c)}}if(d.length>0){o.push(d)}}}if(n){for(var _=0;_<o.length;_++){o[_]=e._getIds(true,o[_])}}else if(!a){for(var g=0;g<o.length;g++){o[g]=new e.NodeList(o[g])}}return o}Ogma.extend(function(e){var t=e.modules.graph;var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;r.prototype.toList=function(){return new n([this._index])};i.prototype.toList=function(){return new a([this._index])};n.prototype.toList=function(){return this};a.prototype.toList=function(){return this};n.prototype.toArray=function(){var e=this;var r=this.size,i=new Array(r);for(var n=0;n<r;++n){i[n]=t._getElement(true,e._indexes[n])}return i};n.prototype.clone=function(){return new n(this._indexes.slice())};a.prototype.toArray=function(){var e=this;var r=this.size,i=new Array(r);for(var n=0;n<r;++n){i[n]=t._getElement(false,e._indexes[n])}return i};a.prototype.clone=function(){return new a(this._indexes.slice())};r.prototype.getId=function(){return t._getId(true,this._index)};n.prototype.getId=function(){return t._getIds(true,this._indexes)};i.prototype.getId=function(){return t._getId(false,this._index)};a.prototype.getId=function(){return t._getIds(false,this._indexes)};i.prototype.getSource=function(){return t._getElement(true,t._getSource(this._index))};a.prototype.getSource=function(){return t._getElements(true,t._getSources(this._indexes))};i.prototype.getTarget=function(){return t._getElement(true,t._getTarget(this._index))};a.prototype.getTarget=function(){return t._getElements(true,t._getTargets(this._indexes))};i.prototype.getExtremities=function(){return t._getElements(true,[t._getSource(this._index),t._getTarget(this._index)])};a.prototype.getExtremities=function(){return t._getElements(true,t._getSources(this._indexes).concat(t._getTargets(this._indexes)))};i.prototype.setSource=function(e){t.setSource(this,e)};i.prototype.setTarget=function(e){t.setTarget(this,e)};n.prototype.get=function(e){return t._getElement(true,this._indexes[e])};n.prototype.forEach=function(e){t.forEachNode(this,e)};n.prototype.map=function(e){return t.mapNodes(this,e)};n.prototype.filter=function(e){return t.filterNodes(this,e)};n.prototype.reduce=function(e,r){return t.reduceNodes(this,e,r)};n.prototype.concat=function(e){return t.concatNodes(this,e)};n.prototype.dedupe=function(){return t.dedupeNodes(this)};r.prototype.slice=function(){return this.toList()};i.prototype.slice=function(){return this.toList()};n.prototype.slice=function(e,t){return new n(this._indexes.slice(e,t))};a.prototype.get=function(e){return t._getElement(false,this._indexes[e])};a.prototype.forEach=function(e){t.forEachEdge(this,e)};a.prototype.map=function(e){return t.mapEdges(this,e)};a.prototype.filter=function(e){return t.filterEdges(this,e)};a.prototype.reduce=function(e,r){return t.reduceEdges(this,e,r)};a.prototype.concat=function(e){return t.concatEdges(this,e)};a.prototype.dedupe=function(){return t.dedupeEdges(this)};n.prototype.partition=function(e){return t.partitionNodes(this,e)};a.prototype.partition=function(e){return t.partitionEdges(this,e)};a.prototype.slice=function(e,t){return new a(this._indexes.slice(e,t))};n.prototype.indexOf=function(e){if(!(e instanceof r)){return-1}return this._indexes.indexOf(e._index)};a.prototype.indexOf=function(e){if(!(e instanceof i)){return-1}return this._indexes.indexOf(e._index)};n.prototype.includes=function(e){return this.indexOf(e)!==-1};a.prototype.includes=function(e){return this.indexOf(e)!==-1};n.prototype.sort=function(e){return new n(this._indexes.slice().sort(function(r,i){return e(t._getElement(true,r),t._getElement(true,i))}))};n.prototype.inverse=function(){return t.inverse(this)};a.prototype.inverse=function(){return t.inverse(this)};function o(e){if(typeof e!=="object"||e===null){e={}}var t=typeof e.data==="function"?e.data:function(e){return e},r=Array.isArray(e.attributes)?e.attributes:undefined;return{attributes:r,data:t}}r.prototype.toJSON=function(e){var t=o(e);var r=t.attributes;var i=t.data;return{id:this.getId(),attributes:this.getAttributes(r),data:i(ne(this.getData()))}};n.prototype.toJSON=function(e){if(e===void 0)e={};return this.map(function(t){return t.toJSON(e)})};i.prototype.toJSON=function(e){if(e===void 0)e={};var t=o(e);var r=t.attributes;var i=t.data;return{id:this.getId(),source:this.getSource().getId(),target:this.getTarget().getId(),attributes:this.getAttributes(r),data:i(ne(this.getData()))}};a.prototype.toJSON=function(e){if(e===void 0)e={};return this.map(function(t){return t.toJSON(e)})};r.prototype.get=function(e){return e===0?this:undefined};i.prototype.get=function(e){return e===0?this:undefined}});Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=e.NodeList;var n=e.EdgeList;var a=new Is(e);e.modules.data=a;e.events.onNodeDataChange=function(t){e.modules.events.on("updateNodeData",t);return e.events};e.events.onEdgeDataChange=function(t){e.modules.events.on("updateEdgeData",t);return e.events};t.prototype.setData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value);return this};t.prototype.getData=function(e){ks(arguments.length);return a.getProperty(this,e)[0]};r.prototype.setData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value);return this};r.prototype.getData=function(e){ks(arguments.length);return a.getProperty(this,e)[0]};i.prototype.setData=function(e,t){if(arguments.length<2){t=e;e=null}if(typeof t!=="function"&&!H(t)){throw new Error("invalid argument "+t+"; expected array or function")}a.setProperty(this,e,t,{dispatch:true});return this};i.prototype.fillData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value,{dispatch:false});return this};i.prototype.getData=function(e){ks(arguments.length);return a.getProperty(this,e)};n.prototype.setData=function(e,t){if(arguments.length<2){t=e;e=null}if(typeof t!=="function"&&!H(t)){throw new Error("invalid argument "+t+"; expected array or function")}a.setProperty(this,e,t,{dispatch:true});return this};n.prototype.fillData=function(e,value){if(arguments.length<2){value=e;e=null}a.setProperty(this,e,value,{dispatch:false});return this};n.prototype.getData=function(e){ks(arguments.length);return a.getProperty(this,e)}});function ks(e){if(e>1){is("getData: more than one argument were specified, you probably want to "+"use a single array argument instead of multiple arguments")}}var Is=function e(t){var r=this;this._dom=t.modules.dom;this._graph=t.modules.graph;this._events=t.modules.events;this._nodeChanges=[];this._edgeChanges=[];this._nodeDataList=this._graph.createAttribute(true,{name:"data",storage:"any"});this._edgeDataList=this._graph.createAttribute(false,{name:"data",storage:"any"});this._nodeList=this._graph.getAttribute(true,"object");this._edgeList=this._graph.getAttribute(false,"object");this._events.register(["updateNodeData","updateEdgeData"]);this._tmp=new Array(2);this._triggerEvents=false;this._events.on({"addNodes addEdges":function(e){var t=e.nodes;var i=e.edges;var n=e.objects;var a=t||i;var o=a.isNode;var s=a.size;var u=a._indexes;var l=r[o?"_nodeDataList":"_edgeDataList"];for(var f=0;f<s;++f){l.set(u[f],n[f].data)}},beforeNewFrame:function(){if(r._triggerEvents){r._triggerEvents=false;Ls(r)}}})};Is.prototype.setProperty=function e(t,r,value,i){if(i===void 0)i={};var n=i.dispatch;if(n===void 0)n=false;return Fs(this,t.isNode,t._indexes,r,value,n)};Is.prototype.getProperty=function e(t,r){return Rs(this,t.isNode,t._indexes,r)};function Ns(e){e._triggerEvents=true;e._dom.refresh()}function Ls(e){var t=zs(e,true);var r=zs(e,false);e._events.fire("updateNodeData",t);e._events.fire("updateEdgeData",r)}function zs(e,t){var r;var i=t?"_nodeChanges":"_edgeChanges",n=[],a=e[i];e[i]=[];for(var o=0;o<a.length;++o){var s=a[o];n.push.apply(n,s.indexes);s[t?"nodes":"edges"]=e._graph._getElements(t,s.indexes);delete s.indexes}return r={},r[t?"nodes":"edges"]=e._graph._getElements(t,n).dedupe(),r.isNode=t,r.changes=a,r}function Ds(e,t){for(var r=0;r<e.length;++r){var i=e[r],n=i.property;if(t===null&&n===null){return i}else if(t&&n&&n.length===t.length){var a=true;for(var o=0;o<n.length;++o){if(n[o]!==t[o]){a=false;break}}if(a){return i}}}var s={property:t&&t.slice(),indexes:[],previousValues:[],newValues:[]};e.push(s);return s}function Ps(e){if(typeof e==="string"){return e.split(".")}else if(H(e)){return e}else if(e===undefined||e===null){return null}else{return[e.toString()]}}function Fs(e,t,r,i,value,n){if(n&&typeof value==="function"){n=false}i=Ps(i);var a=typeof value==="function",o=t?e._nodeList:e._edgeList,s=t?e._nodeDataList:e._edgeDataList,u=t?e._nodeChanges:e._edgeChanges,l=Ds(u,i);for(var f=0;f<r.length;++f){var h=r[f],v=s.get(h),d=o.get(h),c=n?value[f]:value,_=void 0,g=void 0;if(i===null){_=v;g=a?c(d):c;s.set(h,g)}else{if(v===null||v===undefined){v={};s.set(h,v)}Bs(v,i,c,a,d,e._tmp);_=e._tmp[0];g=e._tmp[1]}l.indexes.push(h);l.previousValues.push(_);l.newValues.push(g)}Ns(e)}function Bs(e,t,value,r,i,n){var a=t.length-1;for(var o=0;o<a;++o){var s=t[o],u=e[s];if(u===null||u===undefined){u={};e[s]=u}e=u}var l=t[a],f=e[l],h=r?value(i):value;e[l]=h;n[0]=f;n[1]=h}function Rs(e,t,r,i,n){i=Ps(i);if(!n){n=new Array(r.length)}var a=t?e._nodeDataList:e._edgeDataList;for(var o=0;o<r.length;++o){var s=r[o],u=a.get(s);n[o]=Os(u,i)}return n}function Os(e,t){if(t===null||!t.length){return e}else if(e===undefined||e===null){return undefined}var r=t.length-1;for(var i=0;i<r;++i){var n=t[i];e=e[n];if(e===null||e===undefined){return undefined}}return e[t[r]]}var Vs={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){if((e*=2)<1){return.5*e*e}return-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){if((e*=2)<1){return.5*e*e*e}return.5*((e-=2)*e*e+2)}};var js={duration:0,easing:"linear",callback:function(){},startAfter:0};Ogma.extend(function(e){return e.modules.animations=new Us(e)});var Us=function e(t){var r=this;this._dom=t.modules.dom;this._events=t.modules.events;this._animationList=[];this._events.on("beforeNewFrame",function(){return r._updateAnimations()})};Us.prototype._updateAnimations=function e(){var t=this;if(this._animationList.length===0){return true}var r=R();var i=[];for(var n=0;n<this._animationList.length;++n){var a=t._animationList[n],o=(r-a.creationDate)/a.duration,s=a.startAfter,u=a.easing(o);if(o>=1){a.func(1);a.done=true;t._animationList.splice(n,1);n-=1;i.push(a.callback)}else if(u>=s){var l=1/(1-s);u=(u-s)*l;a.func(u)}}for(var f=0;f<i.length;++f){i[f](false)}this._dom.refresh()};Us.prototype.play=function e(t,r){var i=os(r,js);var n=i.duration;var a=i.easing;var o=i.callback;var s=i.startAfter;var u=null;if(n<=0){t(1);o()}else{u={func:t,easing:typeof a==="function"?a:Vs[a],duration:n,callback:o,startAfter:s,creationDate:R(),done:false};this._animationList.push(u);this._dom.refresh()}return u};Us.prototype.end=function e(t,r){if(r===void 0)r=true;var i=this._animationList.indexOf(t);if(i!==-1){t.func(1);this._animationList.splice(i,1);t.done=true;if(r){t.callback(true)}}};var Gs=1e-8;var Xs=1e8;var Ws={duration:0,easing:"linear",startAfter:0,ignoreZoomLimits:false};function Ys(e){return Math.abs(e)<1e-9}Ogma.extend(function(e){var t=new qs(e);var r=e.modules;var i=e.view;var n=e.Node;var a=e.Edge;r.camera=t;i.setZoom=function(e,r){return t.setZoom(e,r)};i.zoomIn=function(e,r){return t.zoomIn(e,r)};i.zoomOut=function(e,r){return t.zoomOut(e,r)};i.getZoom=function(){return t.getZoom()};i.setCenter=function(e,r){return t.setCenter(e,r)};i.move=function(e,r){return t.move(e,r)};i.getCenter=function(){return t.getCenter()};i.setAngle=function(e,r){return t.setAngle(e,r)};i.rotate=function(e,r){return t.rotate(e,r)};i.getAngle=function(){return t.getAngle()};i.set=function(e,r){return t.setView(e,r)};i.get=function(){return t.getView()};i.graphToScreenCoordinates=function(e){return t.graphToScreenCoordinates(e)};i.screenToGraphCoordinates=function(e){return t.screenToGraphCoordinates(e)};i.getSize=function(){return{width:t.width,height:t.height}};e.events.onZoomProgress=function(t){r.events.on("cameraZoom",t);return e.events};e.events.onViewChanged=function(t){r.events.on("viewChanged",t);return e.events};n.prototype.isInView=function(e){return t.isElementInView(this,e)};a.prototype.isInView=function(e){return t.isElementInView(this,e)}});var Hs=50;var qs=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._dom=t.modules.dom;this._animations=t.modules.animations;this._settings=t.modules.settings;this._zoomAnimation=null;this._moveAnimation=null;this._reset();this._minZoom=Gs;this._maxZoom=Xs;this._events.register(["cameraMove","cameraPan","cameraZoom","cameraRotate","viewChanged","startZoom"]);this._settings.register("minZoom",Gs,function(e){r._minZoom=e;if(r._zoom<e){r._zoom=e;r._events.fire("cameraMove")}});this._settings.register("maxZoom",Xs,function(e){r._maxZoom=e;if(r._zoom>e){r._zoom=e;r._events.fire("cameraMove")}});this._timeout=null;this._moveEnd=function(e){if(r._timeout){r._dom.clearTimeout(r._timeout)}r._timeout=r._dom.setTimeout(function(){r._timeout=null;r._events.fire("viewChanged",{type:e})},Hs)};this._events.on({setContainer:function(){r._reset();r._events.fire("cameraMove")},resize:function(){r.reloadDimensions();r._events.fire("cameraMove")}})};var Zs={x:{configurable:true},y:{configurable:true},zoom:{configurable:true},angle:{configurable:true},width:{configurable:true},height:{configurable:true}};Zs.x.get=function(){return this._x};Zs.y.get=function(){return this._y};Zs.zoom.get=function(){return this._zoom};Zs.angle.get=function(){return this._angle};Zs.width.get=function(){return this._dimensions.width};Zs.height.get=function(){return this._dimensions.height};qs.prototype.getCenter=function e(){return{x:this._x,y:this._y}};qs.prototype.setCenter=function e(t,r){var i=this;var n=t.x;var a=t.y;r=os(r,Ws);var o=this._x,s=this._y,u=n-this._x,l=a-this._y;if(Ys(u)&&Ys(l)){return Promise.resolve()}return new Promise(function(e){var t=function(e){i._x=o+u*e;i._y=s+l*e;i._events.fire("cameraMove");i._events.fire("cameraPan")};r.callback=$s(i,e,"pan");if(i._moveAnimation){i._animations.end(i._moveAnimation)}i._moveAnimation=i._animations.play(t,r)})};qs.prototype.move=function e(t,r){var i=t.x;var n=t.y;var a=Ks(this,{x:i,y:n});return this.setCenter({x:this._x+a.x,y:this._y+a.y},r)};qs.prototype.getZoom=function e(){return this._zoom};qs.prototype.setZoom=function e(t,r,i){var n=this;if(i===void 0)i={};var a=i.refX;var o=i.refY;r=os(r,Ws);var s=this._minZoom;var u=this._maxZoom;var l=Qt(t,s,u);if(!r.ignoreZoomLimits){l=this._applyZoomLimits(l)}if(Ys(this._zoom-l)){return Promise.resolve()}return new Promise(function(e){var t=n._dimensions.width/2;var i=n._dimensions.height/2;var s=n._zoom;var u=t/s-t/l;var f=function(e){n._zoom=t/(t/s-u*e);n._events.fire("cameraMove");n._events.fire("cameraZoom")};r.callback=$s(n,e,"zoom");if(a!==undefined&&o!==undefined){var h=(a-t)/s-(a-t)/l;var v=(o-i)/s-(o-i)/l;var d=n._cosAngle;var c=n._sinAngle;var _=d*h-c*v;var g=c*h+d*v;n.setCenter({x:n._x+_,y:n._y+g},r)}if(n._zoomAnimation){n._animations.end(n._zoomAnimation)}n._dom.setTimeout(function(){n._events.fire("startZoom",{duration:r.duration,easing:r.easing,startZoom:s,endZoom:l})});n._zoomAnimation=n._animations.play(f,r)})};qs.prototype._applyZoomLimits=function e(t){var r=this._settings.get("interactions.zoom.minValue");var i=this._settings.get("interactions.zoom.maxValue");var n=this._ogma.view.getGraphBoundingBox();var a=this._ogma.view.getZoom();var o=this._ogma.view.getSize();var s=t;if(!isNaN(n.cx)){var u={smallestNodeSize:n.minSize,graphWidth:n.width,graphHeight:n.height,viewWidth:o.width,viewHeight:o.height};var l=r&&r(u);var f=i&&i(u);if(Js(l)&&s<l){if(s<a){s=Math.min(a,l)}}else if(Js(f)&&s>f){if(s>a){s=Math.max(a,f)}}}return s};qs.prototype.zoomIn=function e(t,r,i){if(typeof t!=="number"){i=r;r=t;t=this._settings.get("interactions.zoom.modifier")}return this.setZoom(this._zoom*t,r,i)};qs.prototype.zoomOut=function e(t,r,i){if(typeof t!=="number"){i=r;r=t;t=this._settings.get("interactions.zoom.modifier")}return this.setZoom(this._zoom/t,r,i)};qs.prototype.getAngle=function e(){return this._angle};qs.prototype.setAngle=function e(t,r){var i=this;r=os(r,Ws);var n=this._angle;var a=t-n;if(Ys(a)){return Promise.resolve()}return new Promise(function(e){var t=function(e){i._angle=n+a*e;while(i._angle>Math.PI){i._angle-=2*Math.PI}while(i._angle<-Math.PI){i._angle+=2*Math.PI}i._sinAngle=Math.sin(i._angle);i._cosAngle=Math.cos(i._angle);i._events.fire("cameraMove");i._events.fire("cameraRotate")};r.callback=$s(i,e,"rotate");if(i._rotateAnimation){i._animations.end(i._rotateAnimation)}i._rotateAnimation=i._animations.play(t,r)})};qs.prototype.rotate=function e(t,r){return this.setAngle(this._angle+t,r)};qs.prototype.getScreenCenter=function e(){return{x:this._dimensions.width/2,y:this._dimensions.height/2}};qs.prototype.graphToScreenCoordinates=function e(t,r){var i=t.x;var n=t.y;if(r===void 0)r={};var a=this._dimensions.width/2;var o=this._dimensions.height/2;var s=(i-this._x)*this._zoom+a;var u=(n-this._y)*this._zoom+o;return mr(s,u,a,o,-this._angle,r)};qs.prototype.screenToGraphCoordinates=function e(t,r){var i=t.x;var n=t.y;if(r===void 0)r={};var a=this._x+(i-this._dimensions.width/2)/this._zoom;var o=this._y+(n-this._dimensions.height/2)/this._zoom;return mr(a,o,this._x,this._y,this._angle,r)};qs.prototype.projectBounds=function e(t,r){if(r===void 0)r=t;var i=t[0];var n=t[1];var a=t[2];var o=t[3];var s=this._x,u=this._y;var l=this._dimensions.width/2;var f=this._dimensions.height/2;var h=this._sinAngle,v=this._cosAngle,d=1/this._zoom;var c=Infinity;var _=Infinity;var g=-Infinity;var p=-Infinity;var y=[i,n,i,o,a,o,a,n];for(var m=0;m<y.length;m+=2){var x=y[m];var b=y[m+1];x=s+(x-l)*d;b=u+(b-f)*d;var A=x-s;var w=b-u;x=v*A-h*w+s;b=h*A+v*w+u;if(x<c){c=x}if(x>g){g=x}if(b<_){_=b}if(b>p){p=b}}r[0]=c;r[1]=_;r[2]=g;r[3]=p;return r};qs.prototype.screenToGraphVector=function e(t){var r=t.x;var i=t.y;return Ks(this,{x:r,y:i})};qs.prototype.getView=function e(){return{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle,width:this._dimensions.width,height:this._dimensions.height}};qs.prototype.setView=function e(t,r){var i=os(t,{x:this._x,y:this._y,zoom:this._zoom,angle:this._angle});var n=i.x;var a=i.y;var o=i.zoom;var s=i.angle;this.setCenter({x:n,y:a},r);this.setZoom(o,r);return this.setAngle(s,r)};qs.prototype.reloadDimensions=function e(){this._dimensions=this._dom.getDimensions()};qs.prototype.animationInProgress=function e(){var t=this._moveAnimation;var r=this._zoomAnimation;return t&&!t.done||r&&!r.done};qs.prototype.getProjectedScreenBounds=function e(t){if(t===void 0)t=0;var r=this._dimensions;var i=r.width;var n=r.height;var a=Math.max(i,n)*t;return this.projectBounds([0-a,0-a,i+a,n+a])};qs.prototype.isElementInView=function e(t,r){if(r===void 0)r={};var i=r.margin;if(i===void 0)i=0;var n={minX:-i,minY:-i,maxX:this._dimensions.width+i,maxY:this._dimensions.height+i};return t.isNode?this.isNodeInRectangle(t,n):this.isEdgeInRectangle(t,n)};qs.prototype.isNodeInRectangle=function e(t,r){var i=t.getPositionOnScreen();var n=t.getAttribute("radius")*this._zoom;var a=i.x-n;var o=i.y-n;var s=i.x+n;var u=i.y+n;return s>=r.minX&&a<=r.maxX&&u>=r.minY&&o<=r.maxY};qs.prototype.isEdgeInRectangle=function e(t,r){var i=t.getAttribute("curvature");var n=t.getSource();var a=t.getTarget();var o=n.getPositionOnScreen();var s=[];if(n===a){var u=(i+n.getAttribute("radius"))*Va*this._zoom;var l=o.x;var f=o.y;var h=l-u;var v=f;var d=l;var c=f+u;s.push(o,lo(.2,l,f,l,f,h,v,d,c),lo(.4,l,f,l,f,h,v,d,c),lo(.6,l,f,l,f,h,v,d,c),lo(.8,l,f,l,f,h,v,d,c),o)}else{var _=a.getPositionOnScreen();var g=_.x-o.x;var p=_.y-o.y;var y=Math.sqrt(g*g+p*p);var m=(o.x+_.x)/2;var x=(o.y+_.y)/2;var b=p/y;var A=-g/y;var w=i*(y/Ua)*2;var E=m+b*w;var S=x+A*w;s.push(o,oo(.25,o.x,o.y,_.x,_.y,E,S),oo(.5,o.x,o.y,_.x,_.y,E,S),oo(.75,o.x,o.y,_.x,_.y,E,S),_)}for(var C=0;C<s.length-1;++C){var T=s[C],M=s[C+1];if(Bn(T.x,T.y,M.x,M.y,r.minX,r.minY,r.maxX,r.maxY)){return true}}return false};qs.prototype._reset=function e(){this._zoom=1;this._x=0;this._y=0;this._angle=0;this._sinAngle=0;this._cosAngle=1;this._dimensions=this._dom.getDimensions()};Object.defineProperties(qs.prototype,Zs);function $s(e,t,r){return function(){e._moveEnd(r);t(r)}}function Ks(e,t){var r=t.x;var i=t.y;r/=e._zoom;i/=e._zoom;var n=e._sinAngle;var a=e._cosAngle;return{x:a*r-n*i,y:n*r+a*i}}function Js(value){return typeof value==="number"&&isFinite(value)}var Qs=0;var eu=2;var tu=10;var ru=11;var iu=12;var nu=13;var au=14;var ou=15;var su={};su[ru]="image";su[nu]="pieChart";su[iu]="text";su[au]="icon";var uu=function e(){this._version=0;this._mustUpdate=true;this._nextPatternId=1;this._patterns=[null];this._patternsByHash={};this._nullPattern={type:tu,attributes:{}}};uu.prototype._increaseNextId=function e(){var t=this;var r=this._nextPatternId++;if(r%256===255){r=this._nextPatternId++}while(this._patterns.length<=r){t._patterns.push(undefined)}return r};uu.prototype._createPattern=function e(t){var r=t.type;var i=t.attributes;var n={id:this._increaseNextId(),type:r,attributes:this._cloneAttributes(r,i)};this._patterns[n.id]=n;this._mustUpdate=true;return n};uu.prototype._cloneAttributes=function e(t,r){if(t===ru){return{image:r.image,scaled:r.scaled,duplicated:r.duplicated}}else if(t===iu||t===au){return{font:r.font,size:r.size,style:r.style,text:r.text,align:r.align||"center",pixelRatio:r.pixelRatio||1,offset:r.offset||0}}else if(t===nu){return{colors:r.colors,colorArray:r.colors.split(";").map(function(e){return e.trim()})}}};uu.prototype.getPatternList=function e(){return this._patterns.filter(function(e){return e})};uu.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false}};uu.prototype.notifyUpdate=function e(){this._mustUpdate=true};uu.prototype.getIdFromDefinition=function e(t){var r=t.type;var i=t.attributes;var n=r&&r!==tu&&r!==ou&&(r!==ru||i.image)&&(r!==iu&&r!==au||i.text&&i.font);var a=0;if(n){var o=this._getPatternHash(t);a=this._patternsByHash[o];if(!a){if(this._nextPatternId>65535){is("maximum number of pattern exceeded")}else{a=this._createPattern(t).id;this._patternsByHash[o]=a}}}return a};uu.prototype._getPatternHash=function e(t){var r=t.type;var i=t.attributes;var n=[su[r]];if(r===ru){n.push(i.scaled?"scaled":"non-scaled",i.duplicated?"duplicated":"non-duplicated",i.image.src||i.image.toDataURL())}else if(r===iu){n.push(i.text,i.font,i.style,i.size,i.align||"center",i.pixelRatio||1,i.offset||0)}else if(r===au){n.push(i.text,i.font,i.style,i.size,i.pixelRatio||1)}else{n.push(i.colors)}return n.join("+")};uu.prototype.getDefinitionFromId=function e(t){return t?this._patterns[t]:this._nullPattern};uu.prototype.getVersion=function e(){return this._version};var lu=function e(){var t=this;this._version=0;this._mustUpdate=true;this._byName={};this._byId=[null];Object.keys(yu).forEach(function(e){t.register(e,yu[e])})};lu.prototype.register=function e(t,r){var i=r.getDistanceFromStrokeVertically;var n=r.getDistanceFromStrokeHorizontally;var a=r.points;var o={id:this._byId.length,name:t,getDistanceFromStrokeVertically:i,getDistanceFromStrokeHorizontally:n,points:a.slice()};this._mustUpdate=true;this._byId.push(o);this._byName[t]=o;return o};lu.prototype.getIdFromName=function e(t){return this._byName[t].id};lu.prototype.getNameFromId=function e(t){return t?this._byId[t].name:null};lu.prototype.getDefinitionFromName=function e(t){return this._byName[t]||null};lu.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false}};lu.prototype.getVersion=function e(){return this._version};lu.prototype.getShapeList=function e(){return this._byId};function fu(e,t){return Math.sqrt(e*e+t*t)}var hu=1e-5;function vu(e,t,r){var i=Infinity;var n=0;var a=0;for(var o=0;o<r.length;++o){var s=r[o];var u=r[(o+1)%r.length];var l=s.x;var f=s.y;var h=u.x;var v=u.y;var d=h-l;var c=v-f;var _=l;var g=f;if(d===0){g=t}else if(c===0){_=e}else{var p=c/d;var y=-(d/c);_=(l*p-e*y+t-f)/(p-y);g=p*_+f-l*p}var m=fu(_-e,g-t);var x=fu(l-h,f-v);var b=fu(l-_,f-g);var A=fu(h-_,v-g);var w=b+A<=x+hu;if(!w){if(b<A){m=fu(l-e,f-t);_=l;g=f}else{m=fu(h-e,v-t);_=h;g=v}}if(m<i){i=m;n=_;a=g}}var E=fu(e,t);var S=fu(n,a);return i*(E<=S?1:-1)}function du(e,t){if(t===void 0)t=1;var r=-Math.PI/2+hu;var i=[];var n=Math.PI*2/e;var a=r;for(var o=0;o<e;++o){var s=o%2===1?t:1;i.push({x:Math.cos(a)*s,y:Math.sin(a)*s});a+=n}return i}var cu=du(4);var _u=du(5);var gu=du(10,.4);function pu(e){return{getDistanceFromStrokeVertically:function(){return 1},getDistanceFromStrokeHorizontally:function(t,r){return vu(t,r,e)},points:e}}var yu={circle:{getDistanceFromStrokeVertically:function(e,t){return 1},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.sqrt(e*e+t*t)},points:[{x:0,y:0}]},square:{getDistanceFromStrokeVertically:function(e,t){return 1-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.abs(e)},points:[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}]},line:{getDistanceFromStrokeVertically:function(e,t){return 1-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1},points:[{x:-1,y:0},{x:1,y:0}]},triangle:{getDistanceFromStrokeVertically:function(e,t){return(1-e)/2-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.abs(e)},points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}]},arrow:{getDistanceFromStrokeVertically:function(e,t){return(1-e)/2-Math.abs(t)},getDistanceFromStrokeHorizontally:function(e,t){return 1-Math.abs(e)},points:[{x:-1,y:-1},{x:-1,y:1},{x:1,y:0}]},cross:{getDistanceFromStrokeVertically:function(e,t){return 1},getDistanceFromStrokeHorizontally:function(e,t){var r=Math.abs(e);var i=Math.abs(t);var n=.31-Math.min(r,i);var a=1-Math.max(Math.abs(e),Math.abs(t));return Math.min(n,a)},points:[{x:-1,y:.31},{x:-1,y:-.31},{x:-.31,y:-.31},{x:-.31,y:-1},{x:.31,y:-1},{x:.31,y:-.31},{x:1,y:-.31},{x:1,y:.31},{x:.31,y:.31},{x:.31,y:1},{x:-.31,y:1},{x:-.31,y:.31}]},diamond:pu(cu),pentagon:pu(_u),star:pu(gu)};var mu=512;var xu=128;var bu=Math.log2(mu);var Au=Math.log2(xu);var wu=bu+Au;var Eu=127;var Su=255;var Cu=32767;var Tu=65535;var Mu=15;var ku=3;var Iu=256;var Nu=1/16;var Lu=16;var zu=1;var Du=256;var Pu=128;var Fu=128;var Bu=1.5;var Ru=1.1;var Ou=44;var Vu=16;var ju=Ou*2+Vu;var Uu=4;var Gu=function e(t){var r=t.elementSize;var i=t.sideElementSize;var n=t.nbSideElementsPerMainElement;var a=t.id;var o=t.depth;var s=t.elementType;var u=t.animated;this._id=a;this._depth=o;this._elementType=s;this._animated=u;this._version=0;this._elementSize=r;this._sideElementSize=i;this._nbSideElementsPerMainElement=n;this._totalSideElementsSize=n*i;this._capacity=mu;this._byteCapacity=this._capacity*this._elementSize;this._byteArray=new Uint8Array(this._byteCapacity);this._dataView=new DataView(this._byteArray.buffer);this._sideByteCapacity=this._capacity*this._totalSideElementsSize;this._sideByteArray=new Uint8Array(this._sideByteCapacity);this._sideDataView=new DataView(this._sideByteArray.buffer);this._nbCellsAllocated=0;this._nbCellsFreed=0;this._isFullyAllocated=false;this._isFullyFreed=false;this._mustUpdate=true};Gu.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false;if(this._isFullyAllocated&&this._nbCellsFreed===this._nbCellsAllocated){this._isFullyFreed=true}}};Gu.prototype.allocate=function e(t){var r=-1;if(!this._isFullyAllocated&&this._nbCellsAllocated+t<=this._capacity){r=this._nbCellsAllocated;this._nbCellsAllocated+=t;this._mustUpdate=true}else{this._isFullyAllocated=true}return r};Gu.prototype.free=function e(t,r){var i=this;for(var n=0;n<r;++n){var a=(t+n)*i._elementSize;if(!i._byteArray[a]){throw new Error('"free": invalid address provided')}i._byteArray[a]=0}this._mustUpdate=true;this._nbCellsFreed+=r};Gu.prototype.triggerUpdate=function e(){this._mustUpdate=true};Gu.prototype.isEmpty=function e(){return this._nbCellsFreed===this._nbCellsAllocated};Gu.prototype.isFullyFreed=function e(){return this._isFullyFreed};Gu.prototype.getId=function e(){return this._id};Gu.prototype.getDepth=function e(){return this._depth};Gu.prototype.getElementType=function e(){return this._elementType};Gu.prototype.getDataView=function e(){return this._dataView};Gu.prototype.getByteArray=function e(){return this._byteArray};Gu.prototype.getElementSize=function e(){return this._elementSize};Gu.prototype.isAnimated=function e(){return this._animated};Gu.prototype.getCapacity=function e(){return this._capacity};Gu.prototype.getSize=function e(){return this._nbCellsAllocated};Gu.prototype.getNbSideElementsPerMainElement=function e(){return this._nbSideElementsPerMainElement};Gu.prototype.hasSideData=function e(){return this._nbSideElementsPerMainElement>0};Gu.prototype.getSideDataView=function e(){return this._sideDataView};Gu.prototype.getSideByteArray=function e(){return this._sideByteArray};Gu.prototype.getTotalSideElementsSize=function e(){return this._totalSideElementsSize};Gu.prototype.getVersion=function e(){return this._version};var Xu=8;var Wu=function e(){this._buffersByDepth=new Array(100);this._buffersById=[];this._buffersByAscendingDepth=[];this._buffersByDescendingDepth=[];this._version=0;this._mustUpdate=true;this._blockInfo={buffer:null,offset:0,size:0,address:0}};Wu.prototype._fillBlockInfo=function e(t,r,i,n){this._blockInfo.buffer=t;this._blockInfo.offset=r;this._blockInfo.size=i;this._blockInfo.address=n;return this._blockInfo};Wu.prototype._createBuffer=function e(t,r,i,n){var a=r?ju:Ou;var o=this._buffersById.length;var s=new Gu({elementSize:a,sideElementSize:Uu,nbSideElementsPerMainElement:n,id:o,depth:i,elementType:t,animated:r});this._buffersById.push(s);return s};Wu.prototype.getBlockInfo=function e(t){return this._getBlockInfo(t)};Wu.prototype._getBlockInfo=function e(t){return this._fillBlockInfo(this._buffersById[t>>wu],(t>>Au)%mu,t%xu,t)};Wu.prototype.allocateBlock=function e(t,r,i,n,a,o){var s=Hu(o,Xu);this._mustUpdate=true;var u=null;var l=-1;if(t){var f=this._getBlockInfo(t),h=f.buffer,v=f.offset,d=f.size,c=f.size===a,_=h.getDepth()===n,g=h.getElementType()===r,p=h.isAnimated()===i,y=h.getNbSideElementsPerMainElement()===s;if(c&&_&&g&&p&&y){h.triggerUpdate();u=h;l=v}else{h.free(v,d)}}if(l===-1){var m=s/Xu;var x=this._buffersByDepth[n]||(this._buffersByDepth[n]=new Array(2));var b=x[+i]||(x[+i]=[]);var A=b[r]||(b[r]=new Array(16));var w=A[m]||(A[m]=[]);var E=w[w.length-1];if(E){u=E;l=E.allocate(a)}if(l===-1){u=this._createBuffer(r,i,n,s);l=u.allocate(a);w.push(u)}}var S=Yu(u.getId(),l,a);return this._fillBlockInfo(u,l,a,S)};Wu.prototype.freeBlock=function e(t){if(t){this._mustUpdate=true;var r=this._getBlockInfo(t);r.buffer.free(r.offset,r.size)}return 0};Wu.prototype._sortBuffersByDepth=function e(){var t=this;var r=[];for(var i=0;i<this._buffersByDepth.length;++i){var n=t._buffersByDepth[i];if(!n){continue}for(var a=0;a<n.length;++a){var o=n[a];if(!o){continue}for(var s=0;s<o.length;++s){var u=o[s];if(!u){continue}for(var l=0;l<u.length;++l){var f=u[l];if(!f){continue}for(var h=0;h<f.length;++h){var v=f[h];v.update();if(v.isFullyFreed()){t._buffersById[v.getId()]=undefined;f.splice(h,1);h-=1}else{r.push(v)}}}}}}this._buffersByAscendingDepth=r;this._buffersByDescendingDepth=r.slice().reverse()};Wu.prototype.update=function e(){if(this._mustUpdate){this._sortBuffersByDepth();this._version+=1;this._mustUpdate=false}};Wu.prototype.getBuffers=function e(){return this._buffersById};Wu.prototype.getBuffersByAscendingDepth=function e(){return this._buffersByAscendingDepth};Wu.prototype.getBuffersByDescendingDepth=function e(){return this._buffersByDescendingDepth};Wu.prototype.getVersion=function e(){return this._version};function Yu(e,t,r){return((e<<bu)+t<<Au)+r}function Hu(e,t){var value=0;while(value<e){value+=t}return value}function qu(){return{opacity:1,minVisibleSize:0,strokeMinVisibleSize:0,patternMinVisibleSize:0,shape:"circle",dashLength:0,gapLength:0,angleAffectedByView:false,offsetAffectedByAngle:false,adjustAngle:false,isSelfLoop:false,patternSdf:false,offsetAngle:0,patternScale:0,pattern:{type:0,attributes:{}},fillColor:null,strokeColor:null,shapeStart:0,shapeEnd:1,x:0,y:0,angle:0,lengthScaled:0,thicknessScaled:0,strokeWidthScaled:0,offsetScaled:0,lengthAbsolute:0,thicknessAbsolute:0,strokeWidthAbsolute:0,offsetAbsolute:0,dashOffset:0,patternMask:"black",symbolicSize:-1,curvature:0}}function Zu(e){e.opacity=1;e.minVisibleSize=0;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.shape="circle";e.dashLength=0;e.gapLength=0;e.angleAffectedByView=false;e.offsetAffectedByAngle=false;e.adjustAngle=false;e.isSelfLoop=false;e.patternSdf=false;e.offsetAngle=0;e.patternScale=0;e.pattern.type=0;e.fillColor=null;e.strokeColor=null;e.shapeStart=0;e.shapeEnd=1;e.x=0;e.y=0;e.angle=0;e.lengthScaled=0;e.thicknessScaled=0;e.strokeWidthScaled=0;e.offsetScaled=0;e.lengthAbsolute=0;e.thicknessAbsolute=0;e.strokeWidthAbsolute=0;e.offsetAbsolute=0;e.dashOffset=0;e.patternMask="black";e.symbolicSize=-1;e.curvature=0;return e}function $u(e){e.beginTime=-1;e.duration=0;e.easing="linear"}function Ku(){return{valid:false,id:undefined,end:qu(),start:qu(),animation:{beginTime:-1,duration:0,easing:"linear"}}}function Ju(e,t,r,i){e.width=t*i;e.height=r*i;e.style.width=t+"px";e.style.height=r+"px"}var Qu=function e(t){this._bufferList=t.bufferList;this._shapeManager=t.shapeManager;this._patternManager=t.patternManager;this._boundariesManager=t.boundariesManager;this._textManager=t.textManager;this._colorManager=t.colorManager;this._easingManager=t.easingManager;this._idRecorder=t.idRecorder;this._width=0;this._height=0;this._pixelRatio=0;this._viewX=0;this._viewY=0;this._viewZoom=0;this._viewAngle=0;this._viewAngleCos=0;this._viewAngleSin=0;this._currentTime=0;this._bytesToActualCoord=0;this._bytesToActualScaledSize=0;this._bytesToActualPixelSize=0;this._bytesToActualMinVisibleSize=0;this._bytesToActualSymbolicSize=0;this._bytesToActualDashOffset=0;this._bytesToActualDashLength=0;this._bytesToActualGapLength=0;this._shapesVersion=0;this._patternsVersion=0;this._boundariesVersion=0;this._textsVersion=0;this._backgroundColor=null;this._backgroundRgba=[0,0,0,0];this._isBufferDisplayable=null;this._hideImages=false;this._rgbaToString=new Array(65535);this._genericObject=Ku();this._littleEndian=vr()};Qu.getName=function e(){return null};Qu.prototype.getDomElement=function e(){return null};Qu.prototype.export=function e(){return Promise.resolve()};Qu.prototype._colorToString=function e(t){var r=this._rgbaToString[t];if(!r){var i=(t>>12)/15;var n=(t>>8)%16/15;var a=(t>>4)%16/15;var o=t%16/15;r="rgba("+(i*255|0)+", "+(n*255|0)+", "+(a*255|0)+", "+o+")";if(i+n+a+o===0){r=null}this._rgbaToString[t]=r}return r};Qu.prototype._getBytesToActualSize=function e(t){return t?this._bytesToActualScaledSize:this._bytesToActualPixelSize};Qu.prototype._unsignedToSignedByte=function e(value){return value-128};Qu.prototype._adjustAngleValue=function e(t){return t<Math.PI?t:t-Math.PI*2};Qu.prototype._extractGenericObject=function e(t,r,i){var n=r;var a=i;var o=this._littleEndian;var s=n.getUint8(a),u=s>>4,l=s%16>>2,f=s%4,h=n.getUint8(a+1),v=h>>4,d=h%16,c=n.getUint8(a+2),_=c>>4,g=c%16,p=n.getUint8(a+3),y=(p>>7)%2,m=(p>>6)%2,x=(p>>5)%2,b=(p>>4)%2,A=(p>>3)%2,w=p%8,E=n.getUint16(a+4,o),S=n.getUint16(a+6,o),C=n.getUint16(a+8,o),T=n.getUint16(a+10,o),M=T>>8,k=T%256,I=n.getFloat32(a+12,o),N=n.getFloat32(a+16,o),L=n.getFloat32(a+20,o),z=n.getFloat32(a+24,o),D=n.getUint16(a+28,o),P=n.getUint16(a+30,o),F=n.getUint16(a+32,o),B=n.getUint16(a+34,o),R=n.getUint16(a+36,o),O=B>>8,V=B%256,j=R>>8,U=R%256,G=n.getUint16(a+38,o),X=n.getUint16(a+40,o),W=X>>8,Y=X%256,H=n.getUint16(a+42,o),q=H>>8,Z=H%256;t.shape=this._shapeManager.getNameFromId(u);t.dashLength=l*this._bytesToActualDashLength;t.gapLength=f*this._bytesToActualGapLength;t.opacity=v/15;t.minVisibleSize=d*this._bytesToActualMinVisibleSize;t.strokeMinVisibleSize=_*this._bytesToActualMinVisibleSize;t.patternMinVisibleSize=g*this._bytesToActualMinVisibleSize;t.offsetAffectedByAngle=!!m;t.adjustAngle=!!x;t.patternSdf=!!b;t.isSelfLoop=!!A;t.offsetAngle=w*(Math.PI*2/8);t.pattern=this._patternManager.getDefinitionFromId(E);t.fillColor=this._colorToString(S);t.strokeColor=this._colorToString(C);t.shapeStart=M/255;t.shapeEnd=k/255;t.x=I;t.y=N;t.angle=this._adjustAngleValue(L);t.angleAffectedByView=!!y;t.lengthScaled=z;t.thicknessScaled=D*this._bytesToActualScaledSize;t.strokeWidthScaled=P*this._bytesToActualScaledSize;t.offsetScaled=F*this._bytesToActualScaledSize;t.lengthAbsolute=O*this._bytesToActualPixelSize;t.thicknessAbsolute=V*this._bytesToActualPixelSize;t.strokeWidthAbsolute=j*this._bytesToActualPixelSize;t.offsetAbsolute=U*this._bytesToActualPixelSize;t.patternScale=W/127;t.dashOffset=Y*this._bytesToActualDashOffset;t.patternMask=this._colorToString(G);t.symbolicSize=q*this._bytesToActualSymbolicSize;t.curvature=this._unsignedToSignedByte(Z);if(t.shapeStart===0&&t.shapeEnd===1&&t.curvature!==0){t.lengthAbsolute=t.lengthAbsolute+t.curvature*256;t.curvature=0}};Qu.prototype._extractAnimationInformation=function e(t,r,i){var n=r,a=i,o=this._littleEndian;var s=n.getFloat32(a,o),u=n.getFloat32(a+4,o),l=n.getUint16(a+8,o),f=n.getUint16(a+10,o),h=n.getUint16(a+12,o),v=n.getUint16(a+14,o),d=(l>>8)-128,c=(f>>8)-128,_=(h>>8)-128,g=(v>>8)-128,p=l%256-128,y=f%256-128,m=h%256-128,x=v%256-128;t.beginTime=s;t.duration=u;t.easing=this._easingManager.getNameFromPolygon(d,c,_,g,p,y,m,x)};Qu.prototype._extractTextCharacters=function e(t,r,i,n){t.pattern=this._textManager.extractTextFromDataView(r,i,n)};Qu.prototype.extractElement=function e(t,r){var i=t.getElementType();var n=t.isAnimated();var a=t.getDataView();var o=t.getElementSize();var s=r*o;var u=this._genericObject;u.valid=false;if(a.getUint8(s)){u.valid=true;this._extractGenericObject(u.end,a,s);if(n){this._extractGenericObject(u.start,a,s+Ou);this._extractAnimationInformation(u.animation,a,s+Ou*2)}u.id=this._idRecorder.get(t,r);if(i===eu){var l=t.getSideDataView();var f=r*t.getTotalSideElementsSize();var h=f+t.getTotalSideElementsSize();var v=u.end;this._extractTextCharacters(v,l,f,h)}}return u};Qu.prototype._compareDimensions=function e(t,r,i){if(t!==this._width||r!==this._height||i!==this._pixelRatio){this._width=t;this._height=r;this._pixelRatio=i;return true}return false};Qu.prototype._compareView=function e(t,r,i,n){if(t!==this._viewX||r!==this._viewY||i!==this._viewZoom||n!==this._viewAngle){this._viewX=t;this._viewY=r;this._viewZoom=i;this._viewAngle=n;this._viewAngleCos=Math.cos(n);this._viewAngleSin=Math.sin(n);return true}return false};Qu.prototype._compareCurrentTime=function e(t){if(t!==this._currentTime){this._currentTime=t;return true}return false};Qu.prototype._compareBackgroundColor=function e(t){if(t!==this._backgroundColor){this._backgroundColor=t;this._backgroundRgba=this._colorManager.parseColor(this._backgroundColor);return true}return false};Qu.prototype._compareShapes=function e(){if(this._shapesVersion!==this._shapeManager.getVersion()){this._shapesVersion=this._shapeManager.getVersion();return true}return false};Qu.prototype._comparePatterns=function e(){if(this._patternsVersion!==this._patternManager.getVersion()){this._patternsVersion=this._patternManager.getVersion();return true}return false};Qu.prototype._compareBoundaries=function e(){if(this._boundariesVersion!==this._boundariesManager.getVersion()){this._boundariesVersion=this._boundariesManager.getVersion();return true}return false};Qu.prototype._compareTexts=function e(){if(this._textsVersion!==this._textManager.getVersion()){this._textsVersion=this._textManager.getVersion();return true}return false};Qu.prototype._compareIsDisplayableBuffer=function e(t){if(this._isBufferDisplayable!==t){this._isBufferDisplayable=t;return true}return false};Qu.prototype._compareHideImages=function e(t){if(this._hideImages!==t){this._hideImages=t;return true}return false};Qu.prototype.renderFrame=function e(t){var r=t.x;var i=t.y;var n=t.zoom;var a=t.angle;var o=t.width;var s=t.height;var u=t.pixelRatio;var l=t.backgroundColor;var f=t.currentTime;var h=t.isBufferDisplayable;var v=t.hideImages;var d=this._compareShapes();var c=this._comparePatterns();var _=this._compareBoundaries();var g=this._compareTexts();var p=this._compareDimensions(o,s,u);var y=this._compareView(r,i,n,a);var m=this._compareCurrentTime(f);var x=this._compareBackgroundColor(l);var b=this._compareIsDisplayableBuffer(h);var A=this._compareHideImages(v);if(_){var w=this._boundariesManager;this._bytesToActualCoord=w.maxCoord/Cu;this._bytesToActualScaledSize=w.maxScaledSize/Tu;this._bytesToActualPixelSize=w.maxPixelSize/Su;this._bytesToActualMinVisibleSize=w.maxMinVisibleSize/Mu;this._bytesToActualSymbolicSize=w.maxSymbolicSize/Su;this._bytesToActualDashOffset=w.maxDashOffset/Su;this._bytesToActualDashLength=w.maxDashLength/ku;this._bytesToActualGapLength=w.maxGapLength/ku}this._render({shapesChanged:d,patternsChanged:c,boundariesChanged:_,textsChanged:g,dimensionsChanged:p,viewChanged:y,currentTimeChanged:m,backgroundColorChanged:x,isBufferDisplayableChanged:b,isHideImagesChanged:A})};Qu.prototype._render=function e(){};Qu.prototype._unsignedToSignedShort=function e(value){return value-32768};Qu.prototype.destroy=function e(){};Qu.prototype.getImageData=function e(){return null};var el="#define ANIMATED 0\n#define TEXT 0\n#define D3D9_FIX 0\nprecision highp float;\nprecision mediump int;\nattribute /*ubyte*/ vec4 _v1; \nattribute /*ushort*/ vec4 _v2; \nattribute /*float*/ vec4 _v3; \nattribute /*ushort*/ vec4 _v4; \nattribute /*ushort*/ vec4 _v5; \n#if ANIMATED\nattribute /*ubyte*/ vec4 _v6; \nattribute /*ushort*/ vec4 _v7; \nattribute /*float*/ vec4 _v8; \nattribute /*ushort*/ vec4 _v9; \nattribute /*ushort*/ vec4 _v10; \nattribute /*float*/ vec2 _v11; \nattribute /*ushort*/ vec4 _v12; \n#endif\n#if TEXT\nattribute /*ushort*/ vec2 _v13; \n#endif\nattribute vec2 a_vertexPos;\nuniform /*$viewWidth*/ float _v15;\nuniform /*$viewHeight*/ float _v16;\nuniform /*$viewX*/ float _v17;\nuniform /*$viewY*/ float _v18;\nuniform /*$viewAngle*/ float _v19;\nuniform /*$viewZoom*/ float _v20;\nuniform /*$currentTime*/ float _v21;\nuniform /*$pixelRatio*/ float _v22;\nuniform /*$patternInfoTexture*/ sampler2D _v23;\nvarying vec4 _v24;\nvarying vec4 _v25;\nvarying vec4 _v26;\nvarying vec2 _v27;\nvarying vec2 _v28;\n#if D3D9_FIX\nvarying vec4 _v29;\nvarying vec3 _v30;\nvarying vec3 _v31;\nvarying vec4 _v32;\n#else\nvarying float _v33;\nvarying vec2 _v34;\nvarying vec2 _v35;\nvarying vec2 _v36;\nvarying float _v37;\nvarying float _v38;\nvarying float _v39;\nvarying vec2 _v40;\nvarying float _v41;\nvarying float _v42;\n#endif\nconst float _v43 = 0.000001;\nconst float _v44 = 10000000.0;\nconst float _v45 = 3.14159265359;\nconst float _v46 = 4096.0;\nconst float _v47 = 256.0;\nconst float _v48 = 128.0;\nconst float _v49 = 64.0;\nconst float _v50 = 32.0;\nconst float _v51 = 16.0;\nconst float _v52 = 8.0;\nconst float _v53 = 4.0;\nconst float _v54 = 2.0;\nuniform /*$BYTES_TO_COORD*/ float _v55;\nuniform /*$BYTES_TO_SCALED_SIZE*/ float _v56;\nuniform /*$BYTES_TO_PIXEL_SIZE*/ float _v57;\nuniform /*$BYTES_TO_MIN_VISIBLE_SIZE*/ float _v58;\nuniform /*$BYTES_TO_SYMBOLIC_SIZE*/ float _v59;\nuniform /*$BYTES_TO_CURVATURE*/ float _v60;\nuniform /*$BYTES_TO_PATTERN_OFFSET*/ float _v61;\nuniform /*$BYTES_TO_DASH_LENGTH*/ float _v62;\nuniform /*$BYTES_TO_GAP_LENGTH*/ float _v63;\nuniform /*$SHAPE_TEXTURE_SIZE*/ float _v64;\nuniform /*$SHAPE_SAMPLING_SIZE*/ float _v65;\nuniform /*$SHAPE_SAMPLING_BUFFER_RATIO*/ float _v66;\nuniform /*$PATTERN_POSITION_GRANULARITY*/ float _v67;\nuniform /*$PATTERN_INFO_TEXTURE_SIZE*/ float _v68;\nuniform /*$PATTERN_NEAREST_TEXTURE_SIZE*/ float _v69;\nuniform /*$PATTERN_LINEAR_TEXTURE_SIZE*/ float _v70;\nuniform /*$PATTERN_MIPMAP_TEXTURE_SIZE*/ float _v71;\nuniform /*$SHAPE_LINE_ID*/ float _v72;\nuniform /*$SHAPE_TRIANGLE_ID*/ float _v73;\nuniform /*$NB_SHAPES_BY_SIDE*/ float _v74;\nuniform /*$SHAPE_DIMENSIONS*/ float _v75;\nuniform /*$SHAPE_ACTUAL_RATIO*/ float _v76;\nconst float _v77 = (_v45 * 2.0 / 65535.0);\nconst float _v78 = (_v45 * 2.0 / 8.0);\nconst float _v79 = 1.0 / 15.0;\nconst float _v80 = 24.0;\nconst float _v81 = 10.0;\nconst float _v82 = 1.0;\nconst float _v83 = 1.1;\nconst float _v84 = 1.5;\nconst float _v85 = 7.0;\n#if TEXT\nconst float _v86 = 25.0;\nconst float _v87 = _v86 / 511.0;\n#endif\nstruct _v88 {\nbool valid;\nfloat _v89;\nfloat _v90;\nfloat _v91;\nvec2 _v92;\nvec4 _v93;\nvec4 _v94;\nfloat _v95;\nfloat _v96;\nfloat _v97;\nfloat _v98;\nvec2 _v99;\nfloat _v100;\nvec2 _v101;\nvec2 _v102;\nvec2 _v103;\nfloat _v104;\nfloat _v105;\nvec4 _v106;\nvec2 _v107;\nvec2 _v108;\n};\nstruct _v109 {\nvec4 _v110;\nvec4 _v111;\nvec4 _v112;\nvec4 _v113;\nvec4 _v114;\n#if TEXT\nvec2 _v115;\n#endif\n};\nstruct _v116 {\nfloat _v117;\nfloat _v118;\nfloat _v119;\nfloat _v120;\nfloat _v121;\nfloat _v122;\n};\n_v116 decodeFlagsAndOffsetAngle(float _v123) {\n_v116 r;\nfloat _v117 = floor(_v123 / _v48);\nfloat _v124 = _v123 - (_v117 * _v48);\nfloat _v118 = floor(_v124 / _v49);\nfloat _v125 = _v124 - (_v118 * _v49);\nfloat _v119 = floor(_v125 / _v50);\nfloat _v126 = _v125 - (_v119 * _v50);\nfloat _v120 = floor(_v126 / _v51);\nfloat _v127 = _v126 - (_v120 * _v51);\nfloat _v121 = floor(_v126 / _v52);\nfloat _v128 = _v127 - (_v121 * _v52);\nr._v117 = _v117;\nr._v118 = _v118;\nr._v119 = _v119;\nr._v120 = _v120;\nr._v121 = _v121;\nr._v122 = _v128;\nreturn r;\n}\nvec2 _v129(in float _v123) {\nfloat _v130 = floor(_v123 / 16.0);\nfloat _v127 = _v123 - (_v130 * 16.0);\nreturn vec2(_v130, _v127);\n}\nvec3 _v131(in float _v123) {\nfloat _v130 = floor(_v123 / _v51);\nfloat _v127 = _v123 - (_v130 * _v51);\nfloat _v132 = floor(_v127 / _v53);\nfloat _v133 = _v127 - _v132 * _v53;\nreturn vec3(_v130, _v132, _v133);\n}\nvec4 _v134(in float _v123) {\nfloat _v130 = floor(_v123 / _v46);\nfloat _v135 = _v123 - (_v130 * _v46);\nfloat _v136 = floor(_v135 / _v47);\nfloat _v137 = _v135 - _v136 * _v47;\nfloat _v138 = floor(_v137 / _v51);\nfloat _v127 = _v137 - _v138 * _v51;\nreturn vec4(_v130, _v136, _v138, _v127);\n}\nvec2 _v139(in float _v123) {\nreturn vec2(floor(_v123 / 256.0), mod(_v123, 256.0));\n}\nvec2 _v140(in float _v123) {\nfloat _v141 = floor(_v123 / _v49);\nfloat _v125 = _v123 - (_v141 * _v49);\nreturn vec2(_v141, _v125);\n}\nvec3 _v142(in float _v123) {\nfloat _v130 = floor(_v123 / _v51);\nfloat _v127 = _v123 - (_v130 * _v51);\nfloat _v143 = floor(_v127 / _v54);\nfloat _v144 = _v127 - (_v143 * _v54);\nreturn vec3(_v130, _v143, _v144);\n}\nvec4 _v145(in float _v123) {\nfloat _v146 = floor(_v123 / _v50);\nfloat _v126 = _v123 - (_v146 * _v50);\nfloat _v147 = floor(_v126 / _v51);\nfloat _v127 = _v126 - (_v147 * _v51);\nfloat _v148 = floor(_v127 / _v54);\nfloat _v144 = _v127 - (_v148 * _v54);\nreturn vec4(_v146, _v147, _v148, _v144);\n}\nvec2 _v149(in float _v123) {\nfloat _v150 = floor(_v123 / _v48);\nfloat _v124 = _v123 - (_v150 * _v48);\nreturn vec2(_v150, _v124);\n}\nvec2 _v151(in vec2 _v152, in float _v153) {\nfloat _v154 = cos(_v153);\nfloat _v155 = sin(_v153);\nreturn vec2(_v154 * _v152.x + _v155 * _v152.y, -_v155 * _v152.x + _v154 * _v152.y);\n}\nvec4 _v156(in vec4 _v157) {\nreturn floor(_v157 / 256.0) - 128.0;\n}\nvec4 _v158(in vec4 _v157) {\nreturn mod(_v157, 256.0) - 128.0;\n}\nfloat _v159(float _v123) {\nreturn _v123 - 128.0;\n}\nvec2 _v159(vec2 _v123) {\nreturn _v123 - 128.0;\n}\nvec2 _v160(vec2 _v161) {\nreturn vec2(_v161.y, -_v161.x);\n}\nvec2 _v162(float t, vec2 _v164, vec2 _v165, vec2 _v166) {\nfloat _v167 = 1.0 - t;\nreturn (_v167 * _v167 * _v164) + (2.0 * _v167 * t * _v166) + (t * t * _v165);\n}\nvec2 _v168(float t, vec2 _v164, vec2 _v165, vec2 _v166) {\nfloat _v167 = (1.0 - t);\nvec2 _v152 = (_v167 * _v166 + t * _v165) - (_v167 * _v164 + t * _v166);\nreturn normalize(_v152);\n}\nvec2 _v169(float t, vec2 _v164, vec2 _v165, vec2 _v170, vec2 _v171) {\nfloat _v167 = 1.0 - t;\nfloat _v172 = _v167 * _v167;\nfloat _v173 = _v172 * _v167;\nfloat _v174 = t * t;\nfloat _v175 = _v174 * t;\nreturn (_v173 * _v164) + (3.0 * _v172 * t * _v170) + (3.0 * _v167 * _v174 * _v171) + (_v175 * _v165);\n}\nvec2 _v176(float t, vec2 _v164, vec2 _v165, vec2 _v170, vec2 _v171) {\nfloat _v167 = 1.0 - t;\nfloat _v172 = _v167 * _v167;\nfloat _v174 = t * t;\nvec2 _v152 = _v172 * (_v170 - _v164) + 2.0 * _v167 * t * (_v171 - _v170) + _v174 * (_v165 - _v171);\nreturn normalize(_v152);\n}\nfloat _v177(float _v123) {\nreturn _v123 - 32.0;\n}\nfloat _v178(float _v123) {\nreturn _v123 - 512.0;\n}\nfloat _v179(float _v123) {\nreturn _v123 - 32768.0;\n}\nvoid _v180() {\ngl_Position = vec4(-10.0, -10.0, 1.0, 1.0);\n}\nvec4 _v181(vec2 _v107) {\nreturn vec4(((vec2(_v107.x, _v16 - _v107.y) / vec2(_v15, _v16)) * 2.0 - 1.0), 0.5, 1.0);\n}\nfloat _v182(float _v183, float _v184) {\nreturn step(_v183 - _v43, _v184) * step(_v184, _v183 + _v43);\n}\n/**\nCompute a _v88 from the provided _v109.\nIn case of an animated element, this function will be run twice: once for the starting state of the element,\nonce for its final state. The two results will be interpolated based on the time in the animation.\n*/\n_v88 computeVertexPosition(in _v109 attributes) {\n_v88 result;\nresult.valid = true;\nvec3 _v185 = _v131(attributes._v110.x);\nfloat _v186 = _v185.x;\nfloat _v187 = _v185.y;\nfloat _v188 = _v185.z;\nvec2 _v189 = _v129(attributes._v110.y);\nfloat _v190 = _v189.x;\nfloat _v191 = _v189.y;\nvec2 _v192 = _v129(attributes._v110.z);\nfloat _v193 = _v192.x;\nfloat _v194 = _v192.y;\n_v116 _flagsAndOffsetAngle = decodeFlagsAndOffsetAngle(attributes._v110.w);\nfloat _v195 = _flagsAndOffsetAngle._v117;\nfloat _v196 = _flagsAndOffsetAngle._v118;\nfloat _v197 = _flagsAndOffsetAngle._v119;\nfloat _v198 = _flagsAndOffsetAngle._v120;\nfloat _v199 = _flagsAndOffsetAngle._v121;\nfloat _v200 = _flagsAndOffsetAngle._v122;\nfloat _v201 = attributes._v111.x;\nvec4 _v202 = _v134(attributes._v111.y);\nvec4 _v203 = _v134(attributes._v111.z);\nvec2 _v204 = _v139(attributes._v111.w);\nfloat _v205 = _v204.x;\nfloat _v206 = _v204.y;\nfloat _v207 = attributes._v112.x;\nfloat _v208 = attributes._v112.y;\nfloat _v209 = attributes._v112.z;\nfloat _v210 = attributes._v112.w;\nfloat _v211 = attributes._v113.x;\nfloat _v212 = attributes._v113.y;\nfloat _v213 = attributes._v113.z;\nvec2 _v214 = _v139(attributes._v113.w);\nfloat _v215 = _v214.x;\nfloat _v216 = _v214.y;\nvec2 _v217 = _v139(attributes._v114.x);\nfloat _v218 = _v217.x;\nfloat _v219 = _v217.y;\nvec4 _v220 = _v134(attributes._v114.y);\nvec2 _v221 = _v139(attributes._v114.z);\nfloat _v222 = _v221.x;\nfloat _v223 = _v221.y;\nvec2 _v224 = _v139(attributes._v114.w);\nfloat _v225 = _v224.x;\nfloat _v226 = _v159(_v224.y);\n#if TEXT\nfloat _v227 = attributes._v115.x;\nvec2 _v228 = _v140(attributes._v115.y);\nfloat _v229 = _v178(_v228.x);\nfloat _v230 = _v177(_v228.y);\n#endif\nfloat _v231 = _v186;\nfloat _v98 = _v187 * _v62;\nfloat _v232 = _v188 * _v63;\nfloat _v95 = _v190 * _v79;\nfloat _v233 = _v191 * _v58 - _v43;\nfloat _v234 = _v193 * _v58 - _v43;\nfloat _v235 = _v194 * _v58 - _v43;\nfloat _v118 = _v196;\nfloat _v119 = _v197;\nfloat _v120 = _v198;\nfloat _v121 = _v199;\nfloat _v122 = _v200 * _v78;\nfloat _v236 = _v201;\nvec4 _v93 = _v202 * _v79;\nvec4 _v94 = _v203 * _v79;\nfloat _v237 = _v205 / 255.0;\nfloat _v238 = _v206 / 255.0;\nfloat x = _v207;\nfloat y = _v208;\nfloat _v153 = _v209 + (_v195 * _v19);\nfloat _v91 = (_v210 * _v20) + (_v215 * _v57);\nfloat _v90 = (_v211 * _v56 * _v20) + (_v216 * _v57);\nfloat _v89 = (_v212 * _v56 * _v20) + (_v218 * _v57);\nfloat _v241 = (_v213 * _v56 * _v20) + (_v219 * _v57);\nfloat _v242 = _v222 / 127.0;\nfloat _v243 = _v223 * _v61;\nvec4 _v106 = _v220 * _v79;\nfloat _v244 = _v225 * _v59 * _v20 + step(_v225, _v43) * _v44;\nfloat _v245 = _v226;\nif (_v237 < _v43 && _v238 > (1.0 - _v43) && _v245 > 0.0) {\n_v91 += _v245 * 256.0;\n_v245 = 0.0;\n}\nvec2 _v246 = vec2(0.0, 0.0);\n#if TEXT\nfloat _v247 = _v227;\nif (_v247 < 0.5) {\nresult.valid = false;\nreturn result;\n}\nfloat _v248 = _v90;\nfloat _v249 = _v248 / 2.0;\n_v236 = _v247;\n_v246.y = _v230 * _v249;\nif (_v120 > _v43) {\n_v246.x = _v229 * _v87 * _v248;\n} else {\n_v246.x = floor(_v229);\n}\n_v90 = _v248 * _v84;\n_v91 = _v248 * _v83;\n#endif\nif (_v231 < _v43 || _v244 < _v233) {\nresult.valid = false;\nreturn result;\n}\nif (_v119 > _v43 && _v212 > _v43) {\nfloat _v250 = _v212 * _v56;\nif (_v250 > _v20) {\n_v153 = 0.0;\n_v241 = 0.0;\n}\n_v89 = 0.0;\n}\n_v89 *= step(_v234, _v244);\n_v98 *= _v90;\n_v232 *= _v90;\n_v243 *= _v90;\n_v122 -= _v118 * _v153;\n_v153 = mod(_v153 + _v45 * 2.0, _v45 * 2.0);\nif (_v119 > _v43 && (_v153 > _v45 / 2.0 && _v153 < 3.0 * _v45 / 2.0)) {\n_v153 += _v45;\n_v122 += _v45;\n}\nfloat _v97 = _v98 + _v232;\nvec2 _v251 = (vec2(mod(_v231, _v74), floor(_v231 / _v74)) + vec2(_v237, 0.0) * _v76 + vec2(_v66 / 2.0)) / _v74;\nvec2 _v252 = vec2(_v238 - _v237, 1.0) * _v76 / _v74;\nvec2 _v92 = _v251 + (a_vertexPos / 2.0 + 0.5) * _v252;\nfloat _v253 = _v182(_v231, _v72);\nfloat _v254 = _v182(_v231, _v73);\nfloat _v255 = 1.0 - _v253;\nvec2 _v256 = vec2(_v15, _v16) / 2.0;\nvec2 _v257 = _v151((vec2(x, y) - vec2(_v17, _v18)) * _v20, _v19) + _v256;\nvec2 _v258 = _v151(vec2(_v241, 0.0), -_v122);\n#if TEXT\n_v257 = ceil(_v257);\n#else\n_v90 += 1.0;\n_v91 += 1.0;\n#endif\nvec2 _v107 = _v257 + _v258;\nvec2 _v108;\nfloat _v259;\nif (abs(_v245) > _v43) {\nfloat _v260 = _v237;\nfloat _v174 = _v238;\nfloat _v261 = (_v174 - _v260);\nfloat _v262 = (a_vertexPos.x / 2.0 + 0.5);\nfloat t = _v260 + _v261 * _v262;\nvec2 _v263, pc2;\nif (_v121 > _v43) {\nfloat _v264 = _v245 * _v85 * _v20;\nvec2 _v265 = _v107;\nvec2 _v266 = _v107 + _v151(vec2(0.0, _v91), _v19);\nvec2 _v267 = _v107 + _v151(vec2(-_v264, 0.0), _v19);\nvec2 _v268 = _v107 + _v151(vec2(0.0, _v264), _v19);\n_v263 = _v169(_v260, _v265, _v266, _v267, _v268);\npc2 = _v169(_v174, _v265, _v266, _v267, _v268);\n_v108 = _v160(_v176(t, _v265, _v266, _v267, _v268));\n} else {\nvec2 _v269 = vec2(cos(_v153), -sin(_v153));\nvec2 _v152 = _v269 * _v91 / 2.0;\nvec2 _v265 = _v107 - _v152;\nvec2 _v266 = _v107 + _v152;\nvec2 _v270 = _v160(_v269);\nvec2 _v271 = _v107 + _v270 * _v245 * (_v91 / _v81 * 2.0);\n_v263 = _v162(_v260, _v265, _v266, _v271);\npc2 = _v162(_v174, _v265, _v266, _v271);\n_v108 = _v160(_v168(t, _v265, _v266, _v271));\n}\nfloat _v272 = distance(_v263, pc2);\n_v107 = _v263 * (1.0 - _v262) + pc2 * _v262;\n_v259 = _v272;\n} else {\n_v246 = _v151(_v246, _v153);\n_v107 += _v246;\nvec2 _v273 = vec2((_v91 / 2.0 + _v89 * _v255 + _v253), 0.0);\n_v273 = _v151(_v273, _v153);\n_v108 = -normalize(_v160(_v273));\n_v107 += _v273 * a_vertexPos.x;\n_v259 = _v91;\n}\nvec2 _v101 = vec2(0.0, 0.0);\nvec2 _v102 = vec2(_v43, _v43);\nvec2 _v103 = vec2(-_v43, -_v43);\nfloat _v104 = 0.0;\nfloat _v105 = 0.0;\nif (_v236 > 0.1 && _v244 > _v235) {\nfloat _v274 = floor(_v236 / _v68);\nfloat _v275 = _v236 - (_v274 * _v68);\nvec4 _v276 = texture2D(_v23, vec2(_v275, _v274) / 255.0) * 255.0;\nvec2 _v277 = _v149(_v276.z);\nvec2 _v278 = _v149(_v276.w);\nfloat _v279 = _v277.x * 2.0 + _v278.x;\nfloat _v280;\nif (_v279 < 0.5) {\n_v280 = _v69;\n} else if (_v279 < 1.5) {\n_v280 = _v70;\n} else {\n_v280 = _v71;\n}\nfloat _v281 = 1.0 / _v280;\nvec2 _v282 = (vec2(_v277.y, _v278.y) * _v67) * _v281 / 2.0;\nvec2 _v283 = (_v276.xy * _v67 * _v281) + _v282;\n_v283 += _v82 * _v281;\n_v282 -= _v82 * _v281 * 2.0;\nvec2 _v284 = vec2(_v91, _v90) / 2.0 * _v281;\nvec2 _v285 = vec2(_v89, _v89) * _v281;\nfloat _v286 = 1.0 * _v22;\nif (_v242 > _v43) {\n#if TEXT\nif (_v120 > _v43) {\n_v105 = 2.0 / _v248;\n_v286 = (_v80 / _v248);\n} else {\n_v286 = (_v282.y / _v284.y) / _v242;\n}\n#else\n_v286 = (_v282.y / _v284.y) / _v242;\n#endif\n}\nvec2 _v287 = (_v284 + _v285) * _v286;\n_v282 += _v82 * _v281;\n_v101 = _v283 + _v287 * a_vertexPos;\n_v102 = _v283 - _v282;\n_v103 = _v283 + _v282;\n_v104 = 1.0 + _v279;\n}\nfloat _v288 = _v238 - _v237;\nfloat _v289 = step(0.0, a_vertexPos.x);\nresult._v89 = _v89;\nresult._v90 = _v90;\nresult._v91 = _v91;\nresult._v92 = _v92;\nresult._v93 = _v93;\nresult._v94 = _v94;\nresult._v95 = _v95;\nresult._v96 = (_v243 + _v259 * _v289) / _v97;\nresult._v97 = _v97;\nresult._v98 = _v98;\nresult._v99 = (vec2(_v91, _v90) / 2.0 + vec2(_v89)) / vec2(_v288, 1.0);\nresult._v100 = _v254 * 0.5 * (_v237 + _v289 * _v288);\nresult._v101 = _v101;\nresult._v102 = _v102;\nresult._v103 = _v103;\nresult._v104 = _v104;\nresult._v105 = _v105;\nresult._v106 = _v106;\nresult._v107 = _v107;\nresult._v108 = _v108;\nreturn result;\n}\nvoid main() {\n_v88 result;\n_v109 final_input;\nfinal_input._v110 = _v1;\nfinal_input._v111 = _v2;\nfinal_input._v112 = _v3;\nfinal_input._v113 = _v4;\nfinal_input._v114 = _v5;\n#if TEXT\nfinal_input._v115 = _v13;\n#endif\n_v88 final_result = computeVertexPosition(final_input);\n#if ANIMATED\n_v109 prev_input;\nprev_input._v110 = _v6;\nprev_input._v111 = _v7;\nprev_input._v112 = _v8;\nprev_input._v113 = _v9;\nprev_input._v114 = _v10;\n#if TEXT\nprev_input._v115 = _v13;\n#endif\n_v88 prev_result = computeVertexPosition(prev_input);\nfloat _v291 = _v11.x;\nfloat _v292 = _v11.y;\nfloat _v293 = clamp(((_v21 - _v291) / _v292), 0.0, 1.0);\nfloat r = _v293;\nfloat _v295 = r * r;\nfloat _v296 = _v295 * r;\nvec4 _v297 = _v293 < 0.5 ? _v156(_v12) : _v158(_v12);\nfloat _v298 = _v297.x;\nfloat _v299 = _v297.y;\nfloat _v300 = _v297.z;\nfloat _v301 = _v297.w;\nfloat _v302 = _v298 + _v299 * r + _v300 * _v295 + _v301 * _v296;\nresult.valid = final_result.valid && prev_result.valid;\nresult._v89 = mix(prev_result._v89, final_result._v89, _v302);\nresult._v90 = mix(prev_result._v90, final_result._v90, _v302);\nresult._v93 = mix(prev_result._v93, final_result._v93, _v302);\nresult._v94 = mix(prev_result._v94, final_result._v94, _v302);\nresult._v95 = mix(prev_result._v95, final_result._v95, _v302);\nresult._v96 = mix(prev_result._v96, final_result._v96, _v302);\nresult._v97 = mix(prev_result._v97, final_result._v97, _v302);\nresult._v98 = mix(prev_result._v98, final_result._v98, _v302);\nresult._v99 = mix(prev_result._v99, final_result._v99, _v302);\nresult._v100 = mix(prev_result._v100, final_result._v100, _v302);\nresult._v106 = mix(prev_result._v106, final_result._v106, _v302);\nresult._v92 = final_result._v92;\nresult._v101 = final_result._v101;\nresult._v102 = final_result._v102;\nresult._v103 = final_result._v103;\nresult._v104 = final_result._v104;\nresult._v105 = final_result._v105;\nresult._v107 = mix(prev_result._v107, final_result._v107, _v302);\nfloat _v303 = (final_result._v91 + _v43) / (prev_result._v91 + final_result._v91 + 2.0 * _v43) * 2.0;\nvec2 _v304 = prev_result._v108 * (2.0 - _v303);\nvec2 _v305 = final_result._v108 * _v303;\nresult._v108 = normalize(mix(_v304, _v305, _v302));\n#else\nresult = final_result;\n#endif\nif (!result.valid) {\n_v180();\nreturn;\n}\nfloat _v306 = result._v89;\nvec2 _v307 = result._v92;\nvec4 _v202 = result._v93;\nvec4 _v203 = result._v94;\nfloat _v190 = result._v95;\nfloat _v308 = result._v96;\nfloat _v309 = result._v97;\nfloat _v187 = result._v98;\nvec2 _v310 = result._v99;\nfloat _v311 = result._v100;\nvec2 _v312 = result._v101;\nvec2 _v313 = result._v102;\nvec2 _v314 = result._v103;\nfloat _v315 = result._v104;\nfloat _v316 = result._v105;\nvec4 _v220 = result._v106;\n_v24 = _v202;\n_v25 = _v203;\n_v26 = _v220;\n_v27 = _v307;\n_v28 = _v312;\n#if D3D9_FIX\n_v29 = vec4(_v313, _v314);\n_v30 = vec3(_v306, _v190, _v311);\n_v31 = vec3(_v308, _v309, _v187);\n_v32 = vec4(_v310, _v316, _v315);\n#else\n_v33 = _v306;\n_v34 = _v313;\n_v35 = _v314;\n_v36 = vec2(_v190, _v311);\n_v37 = _v308;\n_v38 = _v309;\n_v39 = _v187;\n_v40 = _v310;\n_v41 = _v316;\n_v42 = _v315;\n#endif\nvec2 _v107 = result._v107 + result._v108 * (result._v90 / 2.0 + result._v89) * a_vertexPos.y;\ngl_Position = _v181(_v107);\n}\n";var tl="#define TEXT 0\n#define ANIMATED 0\n#define D3D9_FIX 0\nprecision highp float;\nprecision mediump int;\nuniform /*$backgroundColor*/ vec3 _v317;\nuniform /*$patternNearestTexture*/ sampler2D _v318;\nuniform /*$patternLinearTexture*/ sampler2D _v319;\nuniform /*$patternMipmapTexture*/ sampler2D _v320;\nuniform /*$shapeTexture*/ sampler2D _v321;\nvarying vec4 _v24;\nvarying vec4 _v25;\nvarying vec4 _v26;\nvarying vec2 _v27;\nvarying vec2 _v28;\n#if D3D9_FIX\nvarying vec4 _v29;\nvarying vec3 _v30;\nvarying vec3 _v31;\nvarying vec4 _v32;\n#else\nvarying float _v33;\nvarying vec2 _v34;\nvarying vec2 _v35;\nvarying vec2 _v36;\nvarying float _v37;\nvarying float _v38;\nvarying float _v39;\nvarying vec2 _v40;\nvarying float _v41;\nvarying float _v42;\n#endif\nconst float _v43 = 0.000000001;\nconst float _v322 = (256.0 - 64.0) / 256.0; \nvec4 _v323(in vec4 _v324, in vec4 _v325) {\nfloat _v326 = _v325.a;\nfloat _v327 = _v324.a + _v43;\nfloat _v328 = min(_v326 + _v327, 1.0);\nfloat r = _v326 / _v328;\nreturn vec4(mix(_v324.rgb, _v325.rgb, r), _v328);\n}\nfloat _v329(in float _v330, in float _v331) {\nfloat _v332 = (_v330 * 256.0 + _v331) * 256.0;\nfloat _v333 = _v332 / 60000.0;\nreturn _v333 * 2.0 - 1.0;\n}\nvoid main() {\n#if D3D9_FIX\nfloat _v33 = _v30.x;\nfloat _v334 = _v30.y;\nfloat _v335 = _v30.z;\nvec2 _v34 = _v29.xy;\nvec2 _v35 = _v29.zw;\nfloat _v37 = _v31.x;\nfloat _v38 = _v31.y;\nfloat _v39 = _v31.z;\nvec2 _v40 = _v32.xy;\nfloat _v41 = _v32.z;\nfloat _v42 = _v32.w;\n#else\nfloat _v334 = _v36.x;\nfloat _v335 = _v36.y;\n#endif\nvec4 _v336 = texture2D(_v321, _v27);\nfloat _v337 = _v329(_v336.b, _v336.a) * _v40.x;\nfloat _v338 = _v329(_v336.r, _v336.g) * _v40.y;\n_v338 += _v335;\nfloat _v339 = min(_v337, _v338);\nvec4 _v93 = _v24;\nvec4 _v94 = _v25;\nif (_v42 > 0.5) {\nvec2 _v101 = _v28;\nfloat _v340 =\nstep(_v34.x, _v101.x) *\nstep(_v101.x, _v35.x) *\nstep(_v34.y, _v101.y) *\nstep(_v101.y, _v35.y);\nfloat _v341 = _v340;\nvec4 _v342;\nif (_v42 < 1.5) { \n_v342 = texture2D(_v318, _v101);\n} else if (_v42 < 2.5) { \n_v342 = texture2D(_v319, _v101);\nif (_v41 > _v43) {\n_v342.a = smoothstep(_v322 - _v41, _v322 + _v41, _v342.a);\n}\n} else {\n_v342 = texture2D(_v320, _v101);\n}\n_v342.rgb += _v26.rgb;\n_v342.a *= _v341;\n_v93 = _v323(_v93, _v342);\n}\nfloat _v343 = clamp(_v339, 0.0, 1.0);\nfloat _v344 = clamp(_v339 - _v33, 0.0, 1.0);\nfloat _v345 = _v343 - _v344;\n_v345 = 1.0 - clamp(_v339 - _v33, 0.0, 1.0);\n_v93.a *= _v344;\n_v94.a *= _v345;\nvec4 _v346 = _v323(_v93, _v94);\nfloat _v347 = _v343;\n_v346.rgb = mix(_v317, _v346.rgb, _v334);\nif (_v38 > _v43) {\nfloat _v348 = fract(_v37) * _v38;\nfloat _v349 = clamp(min(_v348, _v39 - _v348), 0.0, 1.0);\n_v347 *= _v349;\n}\n_v346.a *= _v347;\ngl_FragColor = _v346;\n}\n";var rl=Iu*(1-Nu)/2;var il=(Iu-1)/2;var nl=function e(t,r){this._gl=t;this._glTextureUnit=r;this._textureSize=-1};nl.prototype.refresh=function e(t){var r=this;var i=this._gl;var n=t.getShapeList();var a=Jt(Math.sqrt(n.length));var o=a*Iu;var s=new Uint8Array(o*o*4);var u=i.createTexture();for(var l=0;l<n.length;++l){var f=n[l];if(f){var h=f.getDistanceFromStrokeVertically;var v=f.getDistanceFromStrokeHorizontally;var d=l%a*Iu;var c=Math.floor(l/a)*Iu;for(var _=0;_<Iu;++_){for(var g=0;g<Iu;++g){var p=_+d;var y=g+c;var m=(y*o+p)*4;var x=(_-il)/rl;var b=(g-il)/rl;var A=h(x,b);var w=v(x,b);var E=r._formatShapeDistance(A);var S=r._formatShapeDistance(w);r._writeDistanceToPixel(s,m,E,S)}}}}i.activeTexture(i.TEXTURE0+this._glTextureUnit);i.bindTexture(i.TEXTURE_2D,u);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o,o,0,i.RGBA,i.UNSIGNED_BYTE,s);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR);this._textureSize=o};nl.prototype._writeDistanceToPixel=function e(t,r,i,n){t[r]=i>>8;t[r+1]=i%256;t[r+2]=n>>8;t[r+3]=n%256};nl.prototype._formatShapeDistance=function e(value){var t=(value+1)/2;return t*6e4};nl.prototype.getTextureSize=function e(){return this._textureSize};nl.prototype.getSamplingSize=function e(){return Iu};nl.prototype.getBufferRatio=function e(){return Nu};nl.prototype.getTextureUnit=function e(){return this._glTextureUnit};var al=1e20;var ol=24;var sl=6;var ul=8;var ll=.25;var fl=(ol+2*sl)/ol;var hl=function e(){this._fontSize=ol;this._buffer=sl;this._radius=ul;this._cutoff=ll;this._height=Math.ceil(this._fontSize+this._buffer*2*Bu);this._maxDimension=1;this._gridSize=1;this._canvas=it();this._canvas.height=this._height;this._canvas.width=1;this._ctx=this._canvas.getContext("2d");this._ctx.textBaseline="middle";this._ctx.textAlign="center";this._ctx.fillStyle="black";this._gridOuter=null;this._gridInner=null;this._f=null;this._d=null;this._z=null;this._v=null};var vl={SDF_DIV:{configurable:true}};vl.SDF_DIV.get=function(){return fl};hl.prototype.getFontToImageSizeRatio=function e(){return 1+this._buffer*2/this._fontSize};hl.prototype.draw=function e(t,r,i){var n=this;Tt(this._ctx,r,this._fontSize,i);var a=this._ctx.measureText(t).width+this._buffer*2,o=_l(a)-zu*2,s=o,u=this._height,l=s*u,f=Math.max(s,u);if(this._canvas.width<s){this._canvas.width=s;Tt(this._ctx,r,this._fontSize,i);this._ctx.textAlign="center";this._ctx.textBaseline="middle";this._ctx.fillStyle="black"}if(l>this._gridSize){this._gridOuter=new Float64Array(l);this._gridInner=new Float64Array(l);this._gridSize=l}if(f>this._maxDimension){this._f=new Float64Array(f);this._d=new Float64Array(f);this._z=new Float64Array(f+1);this._v=new Int16Array(f);this._maxDimension=f}this._ctx.clearRect(0,0,s,u);this._ctx.fillText(t,s/2,u/2);var h=this._ctx.getImageData(0,0,s,u),v=new Uint8ClampedArray(l);for(var d=0;d<l;d++){var c=h.data[d*4+3]/255;n._gridOuter[d]=c===1?0:c===0?al:Math.pow(Math.max(0,.5-c),2);n._gridInner[d]=c===1?al:c===0?0:Math.pow(Math.max(0,c-.5),2)}dl(this._gridOuter,s,u,this._f,this._d,this._v,this._z);dl(this._gridInner,s,u,this._f,this._d,this._v,this._z);for(var _=0;_<l;_++){var g=n._gridOuter[_]-n._gridInner[_];v[_]=Math.max(0,Math.min(255,Math.round(255-255*(g/n._radius+n._cutoff))))}return{height:u,width:s,distance:v}};Object.defineProperties(hl,vl);function dl(e,t,r,i,n,a,o){for(var s=0;s<t;s++){for(var u=0;u<r;u++){i[u]=e[u*t+s]}cl(i,n,a,o,r);for(var l=0;l<r;l++){e[l*t+s]=n[l]}}for(var f=0;f<r;f++){for(var h=0;h<t;h++){i[h]=e[f*t+h]}cl(i,n,a,o,t);for(var v=0;v<t;v++){e[f*t+v]=Math.sqrt(n[v])}}}function cl(e,t,r,i,n){r[0]=0;i[0]=-al;i[1]=+al;for(var a=1,o=0;a<n;a++){var s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);while(s<=i[o]){o--;s=(e[a]+a*a-(e[r[o]]+r[o]*r[o]))/(2*a-2*r[o])}o++;r[o]=a;i[o]=s;i[o+1]=+al}for(var u=0,l=0;u<n;u++){while(i[l+1]<u){l++}t[u]=(u-r[l])*(u-r[l])+e[r[l]]}}function _l(value){return Math.ceil((value+zu*2)/Lu)*Lu}var gl=256;var pl=0;var yl=1;var ml=2;var xl=3;var bl=0;var Al=1;var wl={};wl[pl]={min:"NEAREST",mag:"NEAREST",mipmap:false};wl[yl]={min:"LINEAR",mag:"LINEAR",mipmap:false};wl[ml]={min:"LINEAR_MIPMAP_LINEAR",mag:"LINEAR",mipmap:true};var El={};El[bl]="ALPHA";El[Al]="RGBA";var Sl=Fu-zu*2;var Cl=Pu-zu*2;var Tl=function e(t,r){this._gl=t;this._glUnit=r;this._colorManager=new gn;this._patternIdToInfoTexture=new Uint8Array(gl*gl*4);this._glTextureInfo=null;this._glTextures=[];this._textureSizes=[];this._imageCanvas=it();this._imageCanvas.width=Du;this._imageCanvas.height=Du;this._imageCanvasContext=this._imageCanvas.getContext("2d");this._canvasForDuplicatedImage=null;this._sdfGenerator=new hl};Tl.prototype.refresh=function e(t){var r=this;var i=this._gl;var n=this._getPatternsByFilter(t.getPatternList());for(var a=0;a<n.length;++a){var o=a;var s=n[a];var u=r._getApproximateRequestedTextureSize(s);var l=r._fillAtlas(s,u);var f=l.texture;var h=l.size;var v=r._glTextures[o]||(r._glTextures[o]=i.createTexture());var d=o===pl?bl:Al;r._setupTexture(v,r._glUnit+1+o,f,h,o,d);r._textureSizes[o]=h}var c=this._glTextureInfo||(this._glTextureInfo=i.createTexture());var _=this._patternIdToInfoTexture;this._setupTexture(c,this._glUnit,_,gl,pl,Al)};Tl.prototype._setupTexture=function e(t,r,i,n,a,o){var s=this._gl;var u=wl[a];var l=u.min;var f=u.mag;var h=u.mipmap;var v=s[El[o]];if(o===bl){var d=new Uint8Array(n*n);for(var c=0;c<d.length;++c){d[c]=i[c*4+3]}i=d}s.activeTexture(s.TEXTURE0+r);s.bindTexture(s.TEXTURE_2D,t);s.texImage2D(s.TEXTURE_2D,0,v,n,n,0,v,s.UNSIGNED_BYTE,i);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s[f]);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s[l]);if(h){s.generateMipmap(s.TEXTURE_2D)}};Tl.prototype.getGranularity=function e(){return Lu};Tl.prototype.getInfoTextureUnit=function e(){return this._glUnit};Tl.prototype.getNearestTextureUnit=function e(){return this._glUnit+1+pl};Tl.prototype.getLinearTextureUnit=function e(){return this._glUnit+1+yl};Tl.prototype.getMipmapTextureUnit=function e(){return this._glUnit+1+ml};Tl.prototype.getInfoTextureSize=function e(){return gl};Tl.prototype.getNearestTextureSize=function e(){return this._textureSizes[pl]};Tl.prototype.getLinearTextureSize=function e(){return this._textureSizes[yl]};Tl.prototype.getMipmapTextureSize=function e(){return this._textureSizes[ml]};Tl.prototype._getPatternsByFilter=function e(t){var r=this;var i=new Array(xl);for(var n=0;n<xl;++n){i[n]=[]}for(var a=0;a<t.length;++a){var o=r._getPatternPixels(t[a]);i[o.filter].push(o)}return i};Tl.prototype._getApproximateRequestedTextureSize=function e(t){var r=0;var i=4;for(var n=0;n<t.length;++n){var a=t[n];var o=a.width;var s=a.height;var u=Ml(o);var l=Ml(s);r+=u+l;i=Math.max(i,Math.max(u,l))}return Jt(Math.max(i,Math.sqrt(r)))};Tl.prototype._adjustDimension=function e(t,r){return Math.floor((r-t)/2)};Tl.prototype._fillAtlas=function e(t,r){var i=this;var n=new Uint8Array(r*r*4);var a=Math.ceil(r/Lu);var o=new Uint8Array(a*a);var s=[{x:0,y:0}];for(var u=0;u<t.length;++u){var l=t[u];var f=l.id;var h=l.filter;var v=Ml(l.width)/Lu;var d=Ml(l.height)/Lu;var c=i._setPositionOnCanvas(s,o,a,v,d);if(c){var _=l.width;var g=l.height;var p=l.pixels;var y=v*Lu;var m=d*Lu;var x=c.x*Lu+i._adjustDimension(_,y);var b=c.y*Lu+i._adjustDimension(g,m);i._copyPixelsOnTexture(n,r,p,x,b,_,g);i._writePatternMetaData(f,h,x,b,y,m)}else if(r<4096){return i._fillAtlas(t,r*2)}else{is("exceeded max WebGL texture size of 4096; won't be able to store some images/texts in memory");i._writePatternMetaData(f,h,0,0,0,0)}}return{texture:n,size:r}};Tl.prototype._copyPixelsOnTexture=function e(t,r,i,n,a,o,s){for(var u=0;u<o;++u){for(var l=0;l<s;++l){var f=(n+u+(a+l)*r)*4;var h=(u+l*o)*4;t[f]=i[h];t[f+1]=i[h+1];t[f+2]=i[h+2];t[f+3]=i[h+3]}}};Tl.prototype._writePatternMetaData=function e(t,r,i,n,a,o){var s=t*4;var u=r>>1<<7;var l=r%2<<7;this._patternIdToInfoTexture[s]=i/Lu;this._patternIdToInfoTexture[s+1]=n/Lu;this._patternIdToInfoTexture[s+2]=u+a/Lu;this._patternIdToInfoTexture[s+3]=l+o/Lu};Tl.prototype._setPositionOnCanvas=function e(t,r,i,n,a){for(var o=0,s=t.length;o<s;++o){var u=t[o];var l=u.x;var f=u.y;var h=u.x+n;var v=u.y+a;var d=h<i&&v<i;if(d){for(var c=l;c<h;++c){if(r[c+f*i]===1){d=false;break}}}if(d){for(var _=f;_<v;++_){if(r[l+_*i]===1){d=false;break}}}if(d){for(var g=l;g<h;++g){for(var p=f;p<v;++p){r[g+p*i]=1}}t.splice(o,1);t.push({x:l,y:v},{x:h,y:f});return u}}return null};Tl.prototype._getPatternPixels=function e(t){var r=t.id;var i=t.type;var n=t.attributes;var a=null;if(i===ru){if(n.duplicated){a=this._getDuplicatedImagePixels(n.image)}else if(n.scaled){a=this._getScaledImagePixels(n.image)}else{a=this._getNonScaledImagePixels(n.image)}}else if(i===iu){var o=n.text;var s=n.font;var u=n.style;var l=n.size;var f=n.pixelRatio;var h=n.offset;if(n.size==="sdf"){a=this._getSdfTextPixels(o,s,u,f)}else{a=this._getRegularTextPixels(o,s,u,l,f,h)}}else if(i===au){a=this._getIconPixels(n.text,n.font,n.style,n.pixelRatio)}else if(i===nu){a=this._getPieChartPixels(n.colorArray)}else{throw new Error('pattern type "'+i+'" does not exist')}a.id=r;return a};Tl.prototype._getScaledImagePixels=function e(t){var r=t.width;var i=t.height;if(r>Du||i>Du){var n=Du/Math.max(t.width,t.height);r*=n;i*=n}if(r&&i){r=Ml(r);i=Ml(i)}r-=zu*2;i-=zu*2;return this._getImagePixels(t,r,i)};Tl.prototype._getNonScaledImagePixels=function e(t){return this._getImagePixels(t,t.width,t.height)};Tl.prototype._getDuplicatedImagePixels=function e(t){if(t.width===0||t.height===0){return this._getImagePixels(t,0,0)}if(!this._canvasForDuplicatedImage){this._canvasForDuplicatedImage=it();this._canvasForDuplicatedImage.width=Du;this._canvasForDuplicatedImage.height=Du}var r=this._canvasForDuplicatedImage;var i=r.getContext("2d");var n=t.width;var a=t.height;var o=(Du-n)/2;var s=(Du-a)/2;while(o>0){o-=n}while(s>0){s-=a}for(var u=o;u<Du;u+=n){for(var l=s;l<Du;l+=a){i.drawImage(t,u,l)}}return this._getImagePixels(r,Du,Du)};Tl.prototype._getImagePixels=function e(t,r,i){var n;if(r===0||i===0){n=new Uint8Array(0)}else{if(this._imageCanvas.width<r||this._imageCanvas.height<i){this._imageCanvas.width=r;this._imageCanvas.height=i}var a=this._imageCanvasContext;kl(a,0,0,r,i);try{a.drawImage(t,0,0,r,i)}catch(e){}n=a.getImageData(0,0,r,i).data}return{width:r,height:i,pixels:n,filter:ml}};Tl.prototype._getPieChartPixels=function e(t){var r=Cl;var i=this._imageCanvasContext;var n=r/2;var a=r/2;var o=0;var s=Math.PI*2/t.length;kl(i,0,0,r,r);i.save();i.rect(0,0,r,r);i.clip();for(var u=0;u<t.length;++u){var l=o+s;i.beginPath();i.moveTo(n,a);i.arc(n,a,r,o,l);i.fillStyle=t[u];i.fill();o=l}i.restore();return{width:r,height:r,pixels:i.getImageData(0,0,r,r).data,filter:yl}};Tl.prototype._getTextPixels=function e(t,r,i,n,a,o,s){var u=this._imageCanvasContext;var l=a*o;Tt(u,i,l,n);var f=u.measureText(r).width;if(f===0){f=l}var h=0;var v=0;var d=t===ml;if(!d){h=Math.ceil(l*Bu/2)*2;v=Math.ceil(f*Ru/2)*2}var c=Math.ceil(f+v);var _=Math.ceil(l+h);if(this._imageCanvas.width<c){this._imageCanvas.width=c;Tt(u,i,l,n)}u.clearRect(0,0,c,_);u.fillStyle="black";u.textBaseline="middle";u.textAlign="left";u.fillText(r,s+v/2,_/2);return{width:c,height:_,pixels:u.getImageData(0,0,c,_).data,filter:t}};Tl.prototype._getRegularTextPixels=function e(t,r,i,n,a,o){return this._getTextPixels(pl,t,r,i,n,a,o)};Tl.prototype._getIconPixels=function e(t,r,i,n){return this._getTextPixels(ml,t,r,i,Sl,n,0)};Tl.prototype._getSdfTextPixels=function e(t,r,i,n){var a=this._sdfGenerator.draw(t,r,i,n);var o=a.width;var s=a.height;var distance=a.distance;var u=new Uint8Array(o*s*4);for(var l=0;l<distance.length;++l){u[l*4+3]=distance[l]}return{width:o,height:s,pixels:u,filter:yl}};function Ml(value){return Math.ceil((value+zu*2)/Lu)*Lu}function kl(e,t,r,i,n){e.clearRect(t,r,i,n)}var Il=false;var Nl={byte:1,ubyte:1,short:2,ushort:2,float:4};var Ll={byte:"BYTE",ubyte:"UNSIGNED_BYTE",short:"SHORT",ushort:"UNSIGNED_SHORT",float:"FLOAT"};var zl=function e(t,r,i){var n=this;var a=i.metaData;var o=i.vertexSource;var s=i.fragmentSource;var u=i.macros;this._gl=t;this._ext=r;this._vertexSource=o;this._fragmentSource=s;this._metaData=a;this._macros=u;this._animated=!!u.ANIMATED;this._isText=!!u.TEXT;this._compiled=false;this._totalAttributesSize=this._metaData.attributes.reduce(function(e,t){var r=t.size;var i=t.type;var a=t.tags;var o=a.includes("TEXT");var s=a.includes("ANIMATED");return e+(!o&&(!s||n._animated)?r*Nl[i]:0)},0);this._vertexPosBuffer=null;this._vertexPosAttribLocation=-1;this._uniformLocations={};this._program=null;this._enableAttributes=null;this._disableAttributes=null;this._setupAttributes=null;this._setupSideAttributes=null;this._setupUniforms=null;this._initVertexPosBuffer()};zl.prototype._initVertexPosBuffer=function e(){var t=this._gl;var r=new Int8Array(mu*12);for(var i=0;i<mu;++i){var n=i*12;r[n]=-1;r[n+1]=-1;r[n+2]=1;r[n+3]=-1;r[n+4]=1;r[n+5]=1;r[n+6]=-1;r[n+7]=-1;r[n+8]=-1;r[n+9]=1;r[n+10]=1;r[n+11]=1}this._vertexPosBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,this._vertexPosBuffer);t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW)};zl.prototype._compile=function e(t){var r=this;if(t===void 0)t={};var i=Object.keys(t);var n=this._gl;var a=["var gl = this._gl;"];var o=["var gl = this._gl;"];var s=["var gl = this._gl; var ext = this._ext;"];var u=["var gl = this._gl; var ext = this._ext;"];var l=["var gl = this._gl;"];var f=this._vertexSource;var h=this._fragmentSource;Object.keys(this._macros).forEach(function(e){f=f.replace("#define "+e+" 0","#define "+e+" "+r._macros[e]);h=h.replace("#define "+e+" 0","#define "+e+" "+r._macros[e])});for(var v=0;v<i.length;++v){var d=i[v],value=t[d];f=Dl(f,d,value);h=Dl(h,d,value)}this._program=Pl(n,f,h);n.useProgram(this._program);this._vertexPosAttribLocation=n.getAttribLocation(this._program,this._metaData.vertexPosAttribute);a.push("gl.enableVertexAttribArray("+this._vertexPosAttribLocation+");");o.push("gl.disableVertexAttribArray("+this._vertexPosAttribLocation+");");var c=this._totalAttributesSize,_=0;for(var g=0;g<this._metaData.attributes.length;++g){var p=r._metaData.attributes[g];var y=p.name;var m=p.size;var x=p.type;var b=p.tags;var A=b.includes("ANIMATED");var w=n.getAttribLocation(r._program,y);var E=m*Nl[x];var S=Ll[x];if(w!==-1){a.push("gl.enableVertexAttribArray("+w+");");o.push("gl.disableVertexAttribArray("+w+");");s.push("gl.vertexAttribPointer("+w+", "+m+", gl."+S+", false, "+c+", "+_+");","ext.vertexAttribDivisorANGLE("+w+", divisor);")}else{if(!b.includes("TEXT")&&(r._animated||!A)){is('unused attribute "'+y+'"')}}_+=E}if(this._macros.TEXT){var C=this._metaData.attributes.filter(function(e){var t=e.tags;return t.includes("TEXT")})[0];var T=C.name;var M=C.size;var k=C.type;var I=n.getAttribLocation(this._program,T),N=M*Nl[k];if(I!==-1){a.push("gl.enableVertexAttribArray("+I+");");o.push("gl.disableVertexAttribArray("+I+");");u.push("gl.vertexAttribPointer("+I+", "+M+", gl."+Ll[k]+", false, "+N+", 0);","ext.vertexAttribDivisorANGLE("+I+", 1);")}else{is('unused attribute "'+T+'"')}}for(var L=0;L<this._metaData.uniforms.length;++L){var z=r._metaData.uniforms[L];var D=z.id;var P=z.name;var F=z.type;var B=n.getUniformLocation(r._program,P);var R="";r._uniformLocations[D]=B;if(F==="int"||F==="sampler2D"){R="gl.uniform1i(this._uniformLocations."+D+", variables."+D+");"}else if(F==="float"){R="gl.uniform1f(this._uniformLocations."+D+", variables."+D+");"}else if(F==="vec2"){R="gl.uniform2f(this._uniformLocations."+D+", variables."+D+"[0], variables."+D+"[1]);"}else if(F==="vec3"){R="gl.uniform3f(this._uniformLocations."+D+", variables."+D+"[0], variables."+D+"[1], variables."+D+"[2]);"}else if(F==="vec4"){R="gl.uniform4f(this._uniformLocations."+D+", variables."+D+"[0], variables."+D+"[1], variables."+D+"[2], variables."+D+"[3]);"}l.push(R)}this._enableAttributes=new Function(a.join("\n"));this._disableAttributes=new Function(o.join("\n"));this._setupAttributes=new Function("divisor",s.join("\n"));this._setupSideAttributes=new Function(u.join("\n"));this._setupUniforms=new Function("variables",l.join("\n"))};zl.prototype.attach=function e(t){if(!this._compiled){this._compile();this._compiled=true}var r=this._gl;r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE);r.useProgram(this._program);r.bindBuffer(r.ARRAY_BUFFER,this._vertexPosBuffer);r.vertexAttribPointer(this._vertexPosAttribLocation,2,r.BYTE,false,2,0);this._ext.vertexAttribDivisorANGLE(this._vertexPosAttribLocation,0);this._enableAttributes();this._setupUniforms(t)};zl.prototype.detach=function e(){this._disableAttributes()};zl.prototype.setupAttributes=function e(t){this._setupAttributes(t)};zl.prototype.setupSideAttributes=function e(){this._setupSideAttributes()};function Dl(e,t,value){var r=value.toString();if(r.indexOf(".")===-1){r+=".0"}return e.replace("const float "+t+" = 0.0;","const float "+t+" = "+r+";")}function Pl(e,t,r){if(Il){t=t.replace("#define D3D9_FIX 0","#define D3D9_FIX 1");r=r.replace("#define D3D9_FIX 0","#define D3D9_FIX 1")}var i=e.createProgram();var n=e.createShader(e.VERTEX_SHADER);var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t);e.shaderSource(a,r);e.compileShader(n);e.compileShader(a);if(!e.getShaderParameter(n,e.COMPILE_STATUS)){throw new Error("Vertex shader compilation error:\n"+e.getShaderInfoLog(n))}if(!e.getShaderParameter(a,e.COMPILE_STATUS)){throw new Error("Fragment shader compilation error:\n"+e.getShaderInfoLog(a))}e.attachShader(i,n);e.attachShader(i,a);e.linkProgram(i);if(!e.getProgramParameter(i,e.LINK_STATUS)){var o=e.getProgramInfoLog(i);if(!Il&&o.indexOf("D3D9")!==-1){rs("Direct3D 9 detected, will use workaround to compile shaders.");Il=true;return Pl(e,t,r)}else{throw new Error("Unable to initialize WebGL program:\n"+o)}}return i}var Fl=function e(t,r,i,n){this._gl=t;this._ext=r;this._program=i;this._dataBuffer=n;this._version=0;this._glBuffer=this._gl.createBuffer();this._sideGlBuffer=n.hasSideData()?this._gl.createBuffer():null;this._used=false};Fl.prototype.markAsUnused=function e(){this._used=false;return this};Fl.prototype.markAsUsed=function e(){this._used=true;return this};Fl.prototype.isUsed=function e(){return this._used};Fl.prototype.getProgram=function e(){return this._program};Fl.prototype.draw=function e(){var t=this._gl;var r=this._dataBuffer.getNbSideElementsPerMainElement()||1;var i=r>1;var n=this._dataBuffer.getVersion();var a=this._version!==n;t.bindBuffer(t.ARRAY_BUFFER,this._glBuffer);if(a){this._version=n;t.bufferData(t.ARRAY_BUFFER,this._dataBuffer.getByteArray(),t.STATIC_DRAW)}this._program.setupAttributes(r);if(i){t.bindBuffer(t.ARRAY_BUFFER,this._sideGlBuffer);if(a){t.bufferData(t.ARRAY_BUFFER,this._dataBuffer.getSideByteArray(),t.STATIC_DRAW)}this._program.setupSideAttributes()}this._ext.drawArraysInstancedANGLE(t.TRIANGLES,0,6,this._dataBuffer.getSize()*r)};Fl.prototype.destroy=function e(){this._gl.deleteBuffer(this._glBuffer);if(this._sideGlBuffer){this._gl.deleteBuffer(this._sideGlBuffer)}};var Bl={stencil:false,antialias:false,alpha:true,premultipliedAlpha:true};var Rl=0;var Ol=1;var Vl=Xl(Qs,false);var jl=Xl(Qs,true);var Ul=Xl(eu,false);var Gl=Xl(eu,true);function Xl(e,t){return(e<<1)+t}var Wl={NO_WEBGL:'Unable to create a WebGL context: `canvas.getContext("webgl")` and `canvas.getContext("experimental-webgl")` returned `null`',NO_ANGLE_INSTANCED_ARRAYS:'WebGL extension "ANGLE_instanced_arrays" unavailable: `gl.getExtension("ANGLE_instanced_arrays")` returned `null`'};function Yl(value,e){if(!value){var t=new Error(Wl[e]);t.code=e;throw t}}var Hl=function(e){function t(t){e.call(this,t);this._glCanvas=it();this._gl=Ge(this._glCanvas,Bl);Yl(this._gl,"NO_WEBGL");this._ext=this._gl.getExtension("ANGLE_instanced_arrays");Yl(this._ext,"NO_ANGLE_INSTANCED_ARRAYS");this._shapeTexture=new nl(this._gl,Rl);this._patternTexture=new Tl(this._gl,Ol);this._2dcanvas=it();this._ctx=this._2dcanvas.getContext("2d");this._glCanvas.style.imageRendering="pixelated";this._glBuffers=[];this._currentProgram=null;this._programs=null;this._animationFrame=null;this._initPrograms();this._initGl()}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.getName=function e(){return"WebGL"};t.prototype.getDomElement=function e(){return this._glCanvas};t.prototype._initGl=function e(){var t=this._gl;var r=this._colorManager.parseColor(null);t.clearColor(r[0],r[1],r[2],r[3]);t.enable(t.BLEND)};t.prototype._initPrograms=function e(){var t=ql(el,tl);this._programs=new Array(4);this._programs[Vl]=this._createProgram({metaData:t,vertexSource:el,fragmentSource:tl,macros:{ANIMATED:0,TEXT:0}});this._programs[jl]=this._createProgram({metaData:t,vertexSource:el,fragmentSource:tl,macros:{ANIMATED:1,TEXT:0}});this._programs[Ul]=this._createProgram({metaData:t,vertexSource:el,fragmentSource:tl,macros:{ANIMATED:0,TEXT:1}});this._programs[Gl]=this._createProgram({metaData:t,vertexSource:el,fragmentSource:tl,macros:{ANIMATED:1,TEXT:1}})};t.prototype._createProgram=function e(t){return new zl(this._gl,this._ext,t)};t.prototype._computeUniforms=function e(){return{viewWidth:this._width,viewHeight:this._height,viewX:this._viewX,viewY:this._viewY,viewZoom:this._viewZoom,viewAngle:this._viewAngle,currentTime:this._currentTime,pixelRatio:this._pixelRatio,backgroundColor:this._backgroundRgba,patternInfoTexture:this._patternTexture.getInfoTextureUnit(),patternNearestTexture:this._patternTexture.getNearestTextureUnit(),patternLinearTexture:this._patternTexture.getLinearTextureUnit(),patternMipmapTexture:this._patternTexture.getMipmapTextureUnit(),shapeTexture:this._shapeTexture.getTextureUnit(),BYTES_TO_COORD:this._bytesToActualCoord,BYTES_TO_SCALED_SIZE:this._bytesToActualScaledSize,BYTES_TO_PIXEL_SIZE:this._bytesToActualPixelSize,BYTES_TO_MIN_VISIBLE_SIZE:this._bytesToActualMinVisibleSize,BYTES_TO_SYMBOLIC_SIZE:this._bytesToActualSymbolicSize,BYTES_TO_PATTERN_OFFSET:this._bytesToActualDashOffset,BYTES_TO_DASH_LENGTH:this._bytesToActualDashLength,BYTES_TO_GAP_LENGTH:this._bytesToActualGapLength,PATTERN_INFO_TEXTURE_SIZE:this._patternTexture.getInfoTextureSize(),PATTERN_NEAREST_TEXTURE_SIZE:this._patternTexture.getNearestTextureSize(),PATTERN_LINEAR_TEXTURE_SIZE:this._patternTexture.getLinearTextureSize(),PATTERN_MIPMAP_TEXTURE_SIZE:this._patternTexture.getMipmapTextureSize(),PATTERN_POSITION_GRANULARITY:this._patternTexture.getGranularity(),SHAPE_TEXTURE_SIZE:this._shapeTexture.getTextureSize(),SHAPE_SAMPLING_SIZE:this._shapeTexture.getSamplingSize(),SHAPE_SAMPLING_BUFFER_RATIO:this._shapeTexture.getBufferRatio(),SHAPE_LINE_ID:this._shapeManager.getIdFromName("line"),SHAPE_TRIANGLE_ID:this._shapeManager.getIdFromName("triangle"),NB_SHAPES_BY_SIDE:this._shapeTexture.getTextureSize()/this._shapeTexture.getSamplingSize(),SHAPE_DIMENSIONS:this._shapeTexture.getSamplingSize()/this._shapeTexture.getTextureSize(),SHAPE_ACTUAL_RATIO:1-this._shapeTexture.getBufferRatio()}};t.prototype._render=function e(t){var r=this;var i=t.shapesChanged;var n=t.patternsChanged;var a=t.dimensionsChanged;var o=t.backgroundColorChanged;if(n){this._patternTexture.refresh(this._patternManager)}if(i){this._shapeTexture.refresh(this._shapeManager)}if(a){ft(this._glCanvas,this._width,this._height,this._pixelRatio);this._gl.viewport(0,0,this._width*this._pixelRatio,this._height*this._pixelRatio)}if(o){var s=this._backgroundRgba;var u=s[0];var l=s[1];var f=s[2];var h=s[3];if(h===0){u=0;l=0;f=0}this._gl.clearColor(u,l,f,h)}var v=this._computeUniforms();var d=this._startFrame();this._gl.clear(this._gl.COLOR_BUFFER_BIT);for(var c=0;c<d.length;++c){r._displayBuffer(d[c],v)}this._endFrame()};t.prototype._displayBuffer=function e(t,r){var i=t.getProgram();if(this._currentProgram!==i){if(this._currentProgram){this._currentProgram.detach()}this._currentProgram=i;this._currentProgram.attach(r)}t.markAsUsed();return t.draw()};t.prototype._startFrame=function e(){var t=this;var r=this._bufferList.getBuffersByAscendingDepth();var i=[];for(var n=0;n<this._glBuffers.length;++n){var a=t._glBuffers[n];if(a){a.markAsUnused()}}for(var o=0;o<r.length;++o){var s=r[o];var u=t._getAssociatedGlBuffer(s);u.markAsUsed();if(!s.isEmpty()&&t._isBufferDisplayable(s)){i.push(u)}}for(var l=0;l<this._glBuffers.length;++l){var f=t._glBuffers[l];if(f&&!f.isUsed()){f.destroy();t._glBuffers[l]=undefined}}return i};t.prototype._endFrame=function e(){if(this._currentProgram){this._currentProgram.detach();this._currentProgram=null}};t.prototype._getAssociatedGlBuffer=function e(t){var r=this;var i=t.getId();var n=this._glBuffers[i];if(!n){while(this._glBuffers.length<=i){r._glBuffers.push(undefined)}var a=Xl(t.getElementType(),t.isAnimated());var o=this._programs[a];n=new Fl(this._gl,this._ext,o,t);this._glBuffers[i]=n}return n};t.prototype.destroy=function e(){var t=this._gl.getExtension("WEBGL_lose_context");if(t){t.loseContext()}};t.prototype.getImageData=function e(){var t=this._glCanvas.width;var r=this._glCanvas.height;if(this._2dcanvas.width<t||this._2dcanvas.height<r){this._2dcanvas.width=t;this._2dcanvas.height=r}this._ctx.drawImage(this._glCanvas,0,0);return this._ctx.getImageData(0,0,t,r)};t.prototype._getImageDataFlippedYAxis=function e(){var t=this._gl;var r=this._glCanvas.width;var i=this._glCanvas.height;var n=this._ctx.createImageData(r,i);var a=new Uint8Array(n.data.buffer);t.readPixels(0,0,r,i,t.RGBA,t.UNSIGNED_BYTE,a);return n};return t}(Qu);function ql(e,t){var r={vertexPosAttribute:"a_vertexPos",attributes:[],uniforms:[]};$l(r,e);$l(r,t);return r}var Zl={float:1,vec2:2,vec3:3,vec4:4};function $l(e,t){var r=/(?:attribute\s+\/\*\s*(byte|ubyte|short|ushort|float)\s*\*\/\s*(float|vec2|vec3|vec4)\s+(\w+)\s*;)|(?:#if\s*(\w+))|(?:#endif)/g;var i=/uniform\s+\/\*\s*\$(\w+)\s*\*\/\s*(float|vec2|vec3|vec4|sampler2D|int)\s+(\w+)\s*;/g;var n=[];var a=r.exec(t);while(a){var o=a[0];if(o==="#endif"){n.pop()}else if(o.startsWith("#if")){n.push(a[4])}else{e.attributes.push({name:a[3],size:Zl[a[2]],type:a[1],tags:n.slice()})}a=r.exec(t)}a=i.exec(t);while(a){if(!e.uniforms.some(function(e){var t=e.id;return t===a[1]})){e.uniforms.push({id:a[1],name:a[3],type:a[2]})}a=i.exec(t)}}var Kl=Math.PI;var Jl=Math.PI*2;var Ql=function(e){function t(t){e.call(this,t);this._tmp={x:0,y:0,length:0,angle:0};this._dummyDimensions={width:1,height:1};this._selfLoopCosCp1=0;this._selfLoopSinCp1=0;this._selfLoopCosCp2=0;this._selfLoopSinCp2=0;this._renderInfo={bounds:[]};this._patternAttributes={};this._clipViewport=true}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.setViewportClipping=function e(t){this._clipViewport=t};t.prototype._graphToScreen=function e(t,r){var i=this._width/2;var n=this._height/2;var a=(t-this._viewX)*this._viewZoom;var o=(r-this._viewY)*this._viewZoom;var s=this._viewAngleCos;var u=this._viewAngleSin;this._tmp.x=s*a+u*o+i;this._tmp.y=-u*a+s*o+n;return this._tmp};t.prototype._graphToScreenSize=function e(t,r){return t*this._viewZoom+r};t.prototype._getShapePoints=function e(t){return this._shapeManager.getDefinitionFromName(t).points};t.prototype._computeAngle=function e(t,r,i){var n=t+(r?this._viewAngle:0);if(i){n=(n+Math.PI*2)%(Math.PI*2);if(n>Math.PI/2&&n<3*Math.PI/2){n+=Math.PI}}return n};t.prototype._computeOffsetAngle=function e(t,r,i){return t-(i?r:i)};t.prototype._computeSymbolicSize=function e(t){return t===0?Infinity:t*this._viewZoom};t.prototype._computeAnimationRatio=function e(t,r,i){var n=(this._currentTime-t)/r;var a=n*n;var o=a*n;var s=this._easingManager.getPolygonFromName(i);var u,l,f,h;if(n<.5){u=s[0];l=s[1];f=s[2];h=s[3]}else{u=s[4];l=s[5];f=s[6];h=s[7]}return Qt(u+l*n+f*a+h*o,0,1)};t.prototype._mix=function e(t,r,i){return t*i+r*(1-i)};t.prototype._mixColor=function e(t,r,i,n){if(t===r){return t}var a=this._colorManager.parseColor(t);var o=this._colorManager.parseColor(r);var s=Math.round(this._mix(a[0],o[0],i)*255);var u=Math.round(this._mix(a[1],o[1],i)*255);var l=Math.round(this._mix(a[2],o[2],i)*255);var f=this._mix(a[3],o[3],n);return"rgba("+s+","+u+","+l+","+f+")"};t.prototype._distanceBetweenAngles=function e(t,r){var i=Math.abs(t-r);if(i>Kl){i=Math.abs(i-Jl)}return i};t.prototype._mixPosLengthAngle=function e(t,r,i,n,a,o,s,u,l){var f=Math.cos(n);var h=Math.sin(n);var v=Math.cos(u);var d=Math.sin(u);var c=i/2;var _=s/2;var g=t-f*c;var p=r-h*c;var y=t+f*c;var m=r+h*c;var x=a-v*_;var b=o-d*_;var A=a+v*_;var w=o+d*_;var E=this._mix(g,x,l);var S=this._mix(p,b,l);var C=this._mix(y,A,l);var T=this._mix(m,w,l);var M=C-E;var k=T-S;var I=(E+C)/2;var N=(S+T)/2;var L=Math.sqrt(M*M+k*k);var z=Math.atan2(k,M);this._tmp.x=I;this._tmp.y=N;this._tmp.length=L;this._tmp.angle=z;return this._tmp};t.prototype._displayBuffer=function e(t){var r=this;var i=t.getSize();var n=t.isAnimated();for(var a=0;a<i;++a){var o=r.extractElement(t,a);if(!o.valid){continue}r._displayElement(o,n);if(o.end.curvature!==0){a+=ja-1}}};t.prototype._computeSelfLoopAngles=function e(){var t=wr(180)-this._viewAngle;var r=wr(90)-this._viewAngle;this._selfLoopCosCp1=Math.cos(t);this._selfLoopSinCp1=Math.sin(t);this._selfLoopCosCp2=Math.cos(r);this._selfLoopSinCp2=Math.sin(r)};t.prototype._formatEdgeTextData=function e(t){if(t.adjustAngle&&t.strokeWidthScaled){var r=t.strokeWidthScaled;if(r>this._viewZoom){t.angle=0;t.offsetScaled=0;t.offsetAbsolute=0}t.strokeWidthScaled=0}};t.prototype._parseRenderInfo=function e(t,r,i,n){var a=this._renderInfo;var o=t.pattern.type;var s=o===ou;var u=this._computeSymbolicSize(t.symbolicSize);var l=t.minVisibleSize;a.skip=u<l;if(a.skip){return a}this._formatEdgeTextData(t);this._formatEdgeTextData(n);var f=t.strokeMinVisibleSize;var h=t.patternMinVisibleSize;var v=t.opacity;var d=t.fillColor;var c=t.strokeColor;var _=t.patternMask;var g=this._graphToScreenSize(t.thicknessScaled,t.thicknessAbsolute);var p=this._graphToScreenSize(t.strokeWidthScaled,t.strokeWidthAbsolute);var y=this._graphToScreenSize(t.offsetScaled,t.offsetAbsolute);var m=this._graphToScreen(t.x,t.y);var x=m.x;var b=m.y;var A,w;var E=this._computeAngle(t.angle,t.angleAffectedByView,t.adjustAngle);var S=this._computeOffsetAngle(t.offsetAngle,E,t.offsetAffectedByAngle);var C=this._graphToScreenSize(t.lengthScaled,t.lengthAbsolute);A=x+Math.cos(S)*y;w=b+Math.sin(S)*y;if(r){var T=this._computeAnimationRatio(i.beginTime,i.duration,i.easing);v=this._mix(v,n.opacity,T);d=this._mixColor(d,n.fillColor,T,T);c=this._mixColor(c,n.strokeColor,T,T);_=this._mixColor(_,n.patternMask,T,T);var M=this._graphToScreen(n.x,n.y);var k=M.x;var I=M.y;var N=this._graphToScreenSize(n.lengthScaled,n.lengthAbsolute);var L=this._graphToScreenSize(n.thicknessScaled,n.thicknessAbsolute);var z=this._graphToScreenSize(n.strokeWidthScaled,n.strokeWidthAbsolute);var D=this._graphToScreenSize(n.offsetScaled,n.offsetAbsolute);var P=this._computeAngle(n.angle,n.angleAffectedByView,n.adjustAngle);var F=this._computeOffsetAngle(n.offsetAngle,P,n.offsetAffectedByAngle);var B=k+Math.cos(F)*D;var R=I+Math.sin(F)*D;if(A===B&&w===R&&E===P){C=this._mix(C,N,T)}else{var O=this._mixPosLengthAngle(A,w,C,E,B,R,N,P,T);A=O.x;w=O.y;C=O.length;E=O.angle}g=this._mix(g,L,T);p=this._mix(p,z,T)}a.thickness=g;a.length=C;a.angle=E;a.strokeWidth=p;a.strokeColor=c;a.fillColor=d;a.opacity=v;a.centerX=A;a.centerY=w;a.pattern=t.pattern;a.patternType=o;a.patternScale=t.patternScale;a.patternSdf=t.patternSdf;a.textColor=_;a.patternAttributes=t.pattern.attributes;a.isPatternTextOpt=s;a.patternDisplayed=o!==0&&o!==tu&&u>=h;a.strokeDisplayed=!s&&c&&p>0&&u>=f;a.fillDisplayed=!s;a.sinAngle=Math.sin(E);a.cosAngle=Math.cos(E);this._applyBackgroundBlending(a);this._calculateBounds(a,t);if(this._clipViewport){var V=a.bounds;var j=0,U=0,G=this._width,X=this._height;if(V[0]>G||V[2]<j||V[1]>X||V[3]<U){a.skip=true}}return a};t.prototype._applyBackgroundBlending=function e(t){var r=this;var i=t.opacity;if(i!==1){t.fillColor=this._blendColor(t.fillColor,i);t.strokeColor=this._blendColor(t.strokeColor,i);t.textColor=this._blendColor(t.textColor,i);if(t.patternType===nu){var n=t.patternAttributes.colorArray;this._patternAttributes.colorArray=n.map(function(e){return r._blendColor(e,i)});t.patternAttributes=this._patternAttributes}else if(t.patternType===ru){this._patternAttributes.image=t.patternAttributes.image;this._patternAttributes.scaled=t.patternAttributes.scaled;this._patternAttributes.duplicated=t.patternAttributes.duplicated;this._patternAttributes.backgroundBlending=true;t.patternAttributes=this._patternAttributes}}};t.prototype._blendColor=function e(t,r){return t?this._mixColor(t,this._backgroundColor,r,1):null};t.prototype._calculateBounds=function e(t,r){var i=t.length;var n=t.thickness;var a=t.angle;var o=t.centerX;var s=t.centerY;var u=t.patternType;var l=t.bounds;if(t.strokeDisplayed||t.fillDisplayed){if(r.shape==="line"){if(r.curvature===0){if(a===0){l[0]=o-i/2-n;l[1]=s-n;l[2]=l[0]+i+n*2;l[3]=l[1]+n*2}else{bo(o-i/2-n,s-n,i+n*2,n*2,a,t.sinAngle,t.cosAngle,l)}}else{if(Math.abs(r.curvature)===1){l[0]=o-i/2-n;l[1]=s-i/2-n;l[2]=l[0]+i+n*2;l[3]=l[1]+i+n*2}else{var f=n*r.curvature*4;l[0]=o-f;l[1]=s-f;l[2]=l[0]+f*2;l[3]=l[1]+f*2}}}else{var h=1.25;l[0]=o-i*h/2;l[1]=s-i*h/2;l[2]=l[0]+i*h;l[3]=l[1]+i*h}}if(t.patternDisplayed){switch(u){case iu:case ou:case au:var v=t.pattern.attributes.text;var d=u===au||t.pattern.attributes.size==="sdf";var c=d?n*t.patternScale:t.pattern.attributes.size;t.isFontSizeScaled=d;t.fontSize=c;l[0]=o-v.length*c/2;l[1]=s-v.length*c/2;l[2]=l[0]+v.length*c;l[3]=l[1]+v.length*c;break;case ru:var _=i*t.patternScale;var g=n*t.patternScale;l[0]=o-_/2;l[1]=s-g/2;l[2]=l[0]+_;l[3]=l[1]+g;break;case nu:l[0]=o-i;l[1]=s-i;l[2]=o+i;l[3]=s+i;break;default:break}}};return t}(Qu);var ef=!it().__dummy;var tf=function(e){function t(t){e.call(this,t);this._canvas=it();this._ctx=this._canvas.getContext("2d");this._helper={dashActive:false,isLine:false,lineWidth:0,isCurved:false,isSelfLoop:false,x1:0,y1:0,x2:0,y2:0,cx1:0,cy1:0,cx2:0,cy2:0};this._curvePoints=new Array((ja+1)*2).fill(null).map(function(){return{x:0,y:0}});this._imgCanvas=it("2d");this._imgCtx=this._imgCanvas.getContext("2d")}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.getName=function e(){return"Canvas"};t.isAvailable=function e(){return ef};t.prototype.getDomElement=function e(){return this._canvas};t.prototype._render=function e(t){var r=this;var i=t.dimensionsChanged;var n=t.viewChanged;if(i){Ju(this._canvas,this._width,this._height,this._pixelRatio)}if(n){this._computeSelfLoopAngles()}var a=this._ctx;var o=this._width*this._pixelRatio;var s=this._height*this._pixelRatio;a.clearRect(0,0,o,s);if(this._backgroundColor){a.fillStyle=this._backgroundColor;a.fillRect(0,0,o,s)}var u=this._bufferList.getBuffersByAscendingDepth();for(var l=0;l<u.length;++l){var f=u[l];if(r._isBufferDisplayable(f)){r._displayBuffer(f)}}};t.prototype._displayElement=function e(t,r){var i=t.end;var n=t.start;var a=this._parseRenderInfo(i,r,t.animation,n);if(a.skip){return}var o=a.thickness;var s=a.length;var u=a.angle;var l=a.cosAngle;var f=a.sinAngle;var h=a.strokeWidth;var v=a.centerX;var d=a.centerY;var c=a.patternType;var _=a.patternAttributes;var g=a.patternScale;var p=a.textColor;var y=a.isPatternTextOpt;var m=a.patternDisplayed;var x=a.strokeDisplayed;var b=a.fillColor;var A=a.strokeColor;var w=a.opacity;var E=a.fontSize;var S=this._getShapePoints(i.shape);var C=i.pattern.dimensions||this._dummyDimensions;var T=S.length===2;var M=i.curvature;var k=i.isSelfLoop;var I=i.dashLength*o;var N=i.gapLength*o;this._setupDash(S,I,N);if(x){var L=s+(T?0:h);var z=o+h;this._drawShape(S,v,d,L,z,l,f,M,k);this._stroke(A,h)}if(!y){this._drawShape(S,v,d,s,o,l,f,M,k);if(b){this._fill(b)}}if(m){this._startPatternDrawing(!y);if(c===nu){this._displayPieChart(v,d,s,_.colorArray)}else if(c===ru){var D=s*g;var P=o*g;this._displayImage(v,d,D,P,w,_)}else if(c===iu||c===ou||c===au){var F=_.text,B=_.font,R=_.style,O=_.align,V=C.width*E;this._displayText(v,d,u,F,p,B,E,R,O,V)}this._endPatternDrawing()}};t.prototype._displayImage=function e(t,r,i,n,a,o){var s=o.image;var u=o.scaled;var l=o.duplicated;var f=o.backgroundBlending;if(this._hideImages||!s.width||!s.height){return}if(f){s=this._blendImageOnBackground(s,a)}var h=this._ctx;var v=t*this._pixelRatio;var d=r*this._pixelRatio;var c=i*this._pixelRatio;var _=n*this._pixelRatio;var g=s.width*this._pixelRatio;var p=s.height*this._pixelRatio;if(u){h.drawImage(s,v-c/2,d-_/2,c,_)}else if(l){var y=v-c/2;var m=d-_/2;var x=v+c/2;var b=d+_/2;var A=v-g/2;var w=d-p/2;while(A>y){A-=g}while(w>m){w-=p}while(A<x){while(w<b){h.drawImage(s,A,w,g,p);w+=p}A+=g}}else{h.drawImage(s,v-g/2,d-p/2,g,p)}};t.prototype._blendImageOnBackground=function e(t,r){if(!t.width||!t.height){return t}var i=this._backgroundRgba;var n=Math.round(i[0]*255);var a=Math.round(i[1]*255);var o=Math.round(i[2]*255);var s="rgb("+n+","+a+","+o+")";this._imgCanvas.width=t.width;this._imgCanvas.height=t.height;this._imgCtx.clearRect(0,0,t.width,t.height);this._imgCtx.globalAlpha=1;this._imgCtx.fillStyle=s;this._imgCtx.fillRect(0,0,t.width,t.height);this._imgCtx.globalAlpha=r;this._imgCtx.drawImage(t,0,0);return this._imgCanvas};t.prototype._displayPieChart=function e(t,r,i,n){var a=this._ctx;var o=t*this._pixelRatio;var s=r*this._pixelRatio;var u=i*this._pixelRatio*2;var l=u*2;if(n.length===1){a.fillStyle=n[0];a.fillRect(o-u,s-u,l,l)}else if(n.length===2){a.fillStyle=n[0];a.fillRect(o-u,s,l,u);a.fillStyle=n[1];a.fillRect(o-u,s-u,l,u)}else{var f=Math.PI*2/n.length;var h=0;for(var v=0;v<n.length;++v){var d=n[v];var c=h+f;a.beginPath();a.moveTo(o,s);a.arc(o,s,u,h,c);a.fillStyle=d;a.fill();h=c}}};t.prototype._displayText=function e(t,r,i,n,a,o,s,u,l,f){var h=this._ctx;var v=t*this._pixelRatio;var d=r*this._pixelRatio;var c=s*this._pixelRatio;var _=l==="center"?0:-f/2;h.translate(v,d);h.rotate(-i);h.textAlign=l;h.textBaseline="middle";Tt(h,o,c,u);h.fillStyle=a;if(n.indexOf("\n")!==-1){var g=n.split("\n");var p=g.length;var y=(1-p)/2*c;for(var m=0;m<p;++m){h.fillText(g[m],_,y);y+=c}}else{h.fillText(n,_,-1)}};t.prototype._setupOpacity=function e(t){this._ctx.globalAlpha=t};t.prototype._drawShape=function e(t,r,i,n,a,o,s,u,l){var f=this;var h=t.length;var v=r*this._pixelRatio;var d=i*this._pixelRatio;var c=n*this._pixelRatio;var _=a*this._pixelRatio;var g=c/2;var p=_/2;this._helper.isLine=false;this._ctx.beginPath();if(h===1){this._ctx.arc(v,d,g,0,Math.PI*2)}else if(h===2||h===3&&u!==0){var y=h===2;var m=o;var x=-s;var b=s;var A=o;var w=v-m*g;var E=d-x*g;var S=v+m*g;var C=d+x*g;var T,M,k,I;if(u!==0){if(l){var N=u*Va*this._viewZoom*this._pixelRatio;w=v;E=d;S=v+this._selfLoopCosCp2*c;C=d+this._selfLoopSinCp2*c;T=v+this._selfLoopCosCp1*N;M=d+this._selfLoopSinCp1*N;k=v+this._selfLoopCosCp2*N;I=d+this._selfLoopSinCp2*N}else{var L=c/Ua*2*-u;T=(w+S)/2+b*L;M=(E+C)/2+A*L}}if(y){this._helper.isLine=true;this._helper.lineWidth=p*2;this._helper.x1=w;this._helper.y1=E;this._helper.x2=S;this._helper.y2=C;this._helper.vx=m;this._helper.vy=x;this._helper.orthoX=b;this._helper.orthoY=A;this._helper.isCurved=u!==0;this._helper.isSelfLoop=l;this._helper.cx1=T;this._helper.cy1=M;this._helper.cx2=k;this._helper.cy2=I}else if(l){var z=this._selfLoopCosCp1;var D=this._selfLoopSinCp1;var P=this._selfLoopCosCp2;var F=this._selfLoopSinCp2;b=-D;A=z;var B=w+b*p;var R=E+A*p;var O=T+z*p;var V=M+D*p;var j=k+P*p;var U=I+F*p;var G=k-P*p;var X=I-F*p;var W=T-z*p;var Y=M-D*p;var H=w-b*p;var q=E-A*p;this._ctx.moveTo(B,R);this._ctx.bezierCurveTo(O,V,j,U,S,C);this._ctx.bezierCurveTo(G,X,W,Y,H,q);this._ctx.closePath()}else{var Z=this._curvePoints;var $=.2;for(var K=0;K<=ja;++K){var J=K/ja;var Q=K;var ee=ja*2+1-K;var te=((1-J)*(p-$)+$)/2;var re=xo(J,w,E,S,C,T,M)+Math.PI/2;var ie=Math.cos(re)*te;var ne=Math.sin(re)*te;var ae=uo(J,w,S,T);var oe=uo(J,E,C,M);var se=Z[Q];var ue=Z[ee];se.x=ae+ie;se.y=oe+ne;ue.x=ae-ie;ue.y=oe-ne}var le=(ja+1)*2;var fe=Z[0];this._ctx.moveTo(fe.x,fe.y);for(var he=1;he<le;++he){var ve=Z[he];f._ctx.lineTo(ve.x,ve.y)}this._ctx.closePath()}}else{for(var de=0;de<h;++de){var ce=t[de];var _e=ce.x*g;var ge=ce.y*p;var pe=v+o*_e+s*ge;var ye=d+-s*_e+o*ge;if(de===0){f._ctx.moveTo(pe,ye)}else{f._ctx.lineTo(pe,ye)}}this._ctx.closePath()}};t.prototype._drawLine=function e(t){var r=this._helper.orthoX*t;var i=this._helper.orthoY*t;var n=this._helper.x1+r;var a=this._helper.y1+i;var o=this._helper.x2+r;var s=this._helper.y2+i;var u=this._helper.cx1+r;var l=this._helper.cy1+i;var f=this._helper.cx2+r;var h=this._helper.cy2+i;this._ctx.beginPath();this._ctx.moveTo(n,a);if(this._helper.isSelfLoop){this._ctx.bezierCurveTo(u,l,f,h,o,s)}else if(this._helper.isCurved){this._ctx.quadraticCurveTo(u,l,o,s)}else{this._ctx.lineTo(o,s)}};t.prototype._fill=function e(t){if(this._helper.isLine){this._drawLine(0);this._ctx.strokeStyle=t;this._ctx.lineWidth=this._helper.lineWidth;this._ctx.stroke()}else{this._ctx.fillStyle=t;this._ctx.fill()}};t.prototype._stroke=function e(t,r){var i=r*this._pixelRatio;this._ctx.strokeStyle=t;this._ctx.lineWidth=i;if(this._helper.isLine){var n=this._helper.lineWidth/2;this._drawLine(n);this._ctx.stroke();this._drawLine(-n);this._ctx.stroke()}else{this._ctx.stroke()}};t.prototype._startPatternDrawing=function e(t){this._ctx.save();if(t){this._ctx.clip()}};t.prototype._endPatternDrawing=function e(){this._ctx.restore()};t.prototype._setupDash=function e(t,r,i){var n=r&&i&&t.length===2;if(n){this._ctx.setLineDash([r*this._pixelRatio,i*this._pixelRatio])}else if(this._helper.dashActive){this._ctx.setLineDash([])}this._helper.dashActive=n};t.prototype.getImageData=function e(){return this._ctx.getImageData(0,0,this._canvas.width,this._canvas.height)};return t}(Ql);var rf=false;Ogma.beforeFirstInstanceCreated(function(){try{rf=!!vt("svg")}catch(e){}});var nf="none";var af="data-element-id";function of(e,t,r,i,n,a){var o=vt("image");o.setAttribute("width",uf(i));o.setAttribute("height",uf(n));o.setAttribute("x",uf(t));o.setAttribute("y",uf(r));o.setAttribute("href",e);if(a){a.appendChild(o)}return o}function sf(e,t,r,i,n,a,o){if(a===void 0)a=1;var s=vt("rect");s.setAttribute("x",e);s.setAttribute("y",t);s.setAttribute("width",r);s.setAttribute("height",i);s.setAttribute("fill",n);s.setAttribute("fill-opacity",a);if(o){o.appendChild(s)}return s}function uf(e){return Math.round(e*1e3)/1e3}var lf=function(e){function t(t){e.call(this,t);this._svg=vt("svg");this._defs=vt("defs");this._background=vt("rect",{width:"100%",height:"100%",fill:"none",class:"ogma-svg-background"});this._styles=vt("g",{class:"styles"});this._defs.appendChild(this._styles);this._svg.setAttribute("pointer-events","none");this._svg.style.userSelect="none";this._svg.appendChild(this._defs);this._svg.appendChild(this._background);this._clear();this._idCounter=0}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.getName=function e(){return"SVG"};t.isAvailable=function e(){return rf};t.prototype.getDomElement=function e(){return this._svg};t.prototype._render=function e(t){var r=this;var i=t.dimensionsChanged;var n=t.viewChanged;var a=1;if(i){ht(this._svg,{width:this._width*a,height:this._height*a})}if(n){this._computeSelfLoopAngles()}if(this._backgroundColor){var o=this._colorManager.rgbaToRgb(this._backgroundColor);this._background.setAttribute("fill",o.color);this._background.setAttribute("fill-opacity",o.opacity)}var s=this._bufferList.getBuffersByAscendingDepth();this._idCounter=0;this._clear();this._svg.removeChild(this._container);for(var u=0;u<s.length;++u){var l=s[u];if(r._isBufferDisplayable(l)){r._displayBuffer(l)}}this._svg.appendChild(this._container)};t.prototype._clear=function e(){if(this._container){this._svg.removeChild(this._container)}this._container=vt("g");this._svg.appendChild(this._container);if(this._clipPaths){this._defs.removeChild(this._clipPaths)}this._clipPaths=vt("g");this._defs.appendChild(this._clipPaths);if(this._filters){this._defs.removeChild(this._filters)}this._filters=vt("g");this._defs.appendChild(this._filters)};t.prototype._displayElement=function e(t,r){var i=t.start;var n=t.end;var a=t.animation;var o=t.id;var s=this._parseRenderInfo(n,r,a,i);if(s.skip){return}var u=s.thickness;var l=s.length;var f=s.angle;var h=s.cosAngle;var v=s.sinAngle;var d=s.strokeWidth;var c=s.opacity;var _=s.centerX;var g=s.centerY;var p=s.patternType;var y=s.patternAttributes;var m=s.patternScale;var x=s.patternDisplayed;var b=s.strokeDisplayed;var A=s.fillDisplayed;var w=s.fontSize;c=1;var E,S;var C=this._colorManager.rgbaToRgb(s.fillColor);var T=C.opacity;var M=C.color;C=this._colorManager.rgbaToRgb(s.strokeColor);var k=C.opacity;var I=C.color;var N=s.textColor;if(b||A){var L=this._getShapePoints(n.shape);var z=L.length;var D=n.curvature;var P=n.isSelfLoop;var F=D!==0&&z===3;var B=z===2;E=vt("path");E.setAttribute(af,o);this._setPath(E,L,_,g,l,u,B,F,P,D,v,h);this._setOpacity(E,c*T,B);if(B){this._strokePattern(E,n.dashLength*u,n.gapLength*u)}if(b){S=vt("path");S.setAttribute(af,o);S.setAttribute("fill","none");this._setPath(S,L,_,g,l,u+d,B,F,P,D,v,h);this._outline(S,d,I,c*k,B,u)}if(A){if(B){this._stroke(E,u,M,T*c)}this._fill(E,B?nf:M||nf);if(M!==null){this._container.appendChild(E)}}if(S){this._container.appendChild(S)}}if(x){var R="clip-path-"+this._idCounter++;switch(p){case iu:case ou:case au:this._text(y.text,_,g,f,w,N,y.font,y.style,o);break;case ru:this._addClippingMask(E,R);this._image(R,y,_,g,l,u,m,s.opacity,o);break;case nu:this._addClippingMask(E,R);this._pieChart(R,_,g,l,y.colorArray,o);break;case tu:default:break}}};t.prototype._setOpacity=function e(t,r,i){if(i){t.setAttribute("stroke-opacity",r)}else{t.setAttribute("fill-opacity",r)}};t.prototype._addClippingMask=function e(t,r){var i=vt("clipPath");var n=t.cloneNode(false);i.appendChild(n);this._clipPaths.appendChild(i);i.setAttribute("id",r)};t.prototype._image=function e(t,r,i,n,a,o,s,u,l){var f=1;i=i*f;n=n*f;var h=a*s;var v=o*s;var d=r.image;var c=r.scaled;var _=r.duplicated;if(this._hideImages||!d.isDummy&&(!d.width||!d.height)){return}var g=h*f;var p=v*f;var y=d.width*f;var m=d.height*f;var x;if(c){y=g;m=p}if(_){var b=i-g/2;var A=n-p/2;var w=i+g/2;var E=n+p/2;var S=i-y/2;var C=n-m/2;var T=vt("g");T.setAttribute(af,l);while(S>b){S-=y}while(C>A){C-=m}while(S<w){while(C<E){of(d.src,S,C,y,m,T);C+=m}S+=y}}else{x=of(d.src,i-g/2,n-p/2,y,m);x.setAttribute(af,l)}x.setAttribute("clip-path","url(#"+t+")");if(r.backgroundBlending){var M=this._addBackgroundBlendingFilter(u);x.setAttribute("filter","url(#"+M+")")}this._container.appendChild(x)};t.prototype._addBackgroundBlendingFilter=function e(t){var r=this._colorManager.parseColor(this._backgroundColor);var i=t;var n=1-t;var a=r[0]*n;var o=r[1]*n;var s=r[2]*n;var u=[i,0,0,0,a,0,i,0,0,o,0,0,i,0,s,0,0,0,1,0].join(" ");var l="filter-"+this._idCounter++;var f=vt("filter",{id:l});var h=vt("feColorMatrix",{in:"SourceGraphic",type:"matrix",values:u});f.appendChild(h);this._filters.appendChild(f);return l};t.prototype._pieChart=function e(t,r,i,n,a,o){var s=n*2;var u=s*2;var l;var f=vt("g");f.setAttribute(af,o);if(a.length===1){l=sf(r-s,i-s,u,u,a[0],1,f)}else if(a.length===2){l=sf(r-s,i,u,s,a[0],1,f);l=sf(r-s,i-s,u,s,a[1],1,f)}else{var h=Math.PI*2/a.length;var v=0;for(var d=0;d<a.length;++d){var c=v+h;var _=r+n*Math.cos(c);var g=i+n*Math.sin(c);var p=r+n*Math.cos(v);var y=i+n*Math.sin(v);var m=c-v<=Math.PI?0:1;var x="M "+_+","+g+" A "+n+","+n+" 0 "+m+" 0 "+p+","+y+" L "+r+","+i+" L "+_+","+g;l=vt("path");l.setAttribute("d",x);l.setAttribute("fill",a[d]);l.setAttribute("stroke-width",0);v=c;f.appendChild(l)}}f.setAttribute("clip-path","url(#"+t+")");this._container.appendChild(f)};t.prototype._text=function e(t,r,i,n,a,o,s,u,l){var f=vt("text");f.setAttribute(af,l);var h=1;var v=this._colorManager.rgbaToRgb(o);var d=v.opacity;var c=v.color;r=r*h;i=i*h;u=u||"normal";var _=uf(r);f.setAttribute("x",_);f.setAttribute("font-family",s);f.setAttribute("font-size",a*h);if(u==="bold"){f.setAttribute("font-weight",u)}else{f.setAttribute("font-style",u)}f.setAttribute("fill",c);f.setAttribute("fill-opacity",d);if(n){f.setAttribute("transform","rotate("+Er(-n)+" "+r+", "+i+")")}f.setAttribute("text-anchor","middle");var g=t.split("\n");var p=g.length;var y=(p+1)/2-1/3;f.setAttribute("y",uf(i-y*a));for(var m=0;m<p;m++){var x=vt("tspan");x.appendChild(dt(g[m]));x.setAttribute("x",_);x.setAttribute("dy",a);f.appendChild(x)}this._container.appendChild(f)};t.prototype._setPath=function e(t,r,i,n,a,o,s,u,l,f,h,v){var d=1;var c=i*d;var _=n*d;var g=a*d;var p=o*d;var y=g/2;var m=p/2;var x="";if(r.length===1){var b=m;x="M "+(c-b)+", "+_+" a "+b+","+b+" 0 1,0 "+2*b+",0 a "+b+","+b+" 0 1,0 -"+2*b+",0"}else if(s||u){var A=v;var w=-h;var E=c-A*y;var S=_-w*y;var C=c+A*y;var T=_+w*y;var M=h,k=v;var I,N,L,z,D;if(f===0){x="M "+E+","+S+" L"+C+","+T}else if(l){D=f*Va*this._viewZoom*d;I=E+this._selfLoopCosCp1*D;N=S+this._selfLoopSinCp1*D;L=C+this._selfLoopCosCp2*D;z=T+this._selfLoopSinCp2*D;E=i;S=n;C=i+this._selfLoopCosCp2*g;T=n+this._selfLoopSinCp2*g;x="M "+E+","+S+" C"+I+","+N+" "+L+","+z+" "+C+","+T}else{D=g/Ua*2*-f;I=(E+C)/2+M*D;N=(S+T)/2+k*D;x="M "+E+","+S+" Q"+I+","+N+" "+C+","+T}if(u){if(l){var P=this._selfLoopCosCp1;var F=this._selfLoopSinCp1;var B=this._selfLoopCosCp2;var R=this._selfLoopSinCp2;M=-F;k=P;var O=E+M*m;var V=S+k*m;var j=I+P*m;var U=N+F*m;var G=L+B*m;var X=z+R*m;var W=L-B*m;var Y=z-R*m;var H=I-P*m;var q=N-F*m;var Z=E-M*m;var $=S-k*m;x="M"+O+","+V+" C"+j+","+U+" "+G+","+X+", "+C+","+T+" "+"C"+W+","+Y+" "+H+","+q+" "+Z+","+$}else{var K=E+M*m;var J=S+k*m;var Q=E-M*m;var ee=S-k*m;var te=I+M*m;var re=N+k*m;var ie=I-M*m;var ne=N-k*m;x="M "+K+","+J+" Q"+te+","+re+" "+C+","+T+" Q"+ie+","+ne+" "+Q+","+ee+" Z"}}}else{for(var ae=0;ae<r.length;ae++){var oe=r[ae];var se=oe.x*y;var ue=oe.y*m;var le=c+v*se+h*ue;var fe=_-h*se+v*ue;x+=""+(ae===0?"M":"L")+le+","+fe+" "}x+="Z"}t.setAttribute("d",x)};t.prototype._outline=function e(t,r,i,n,a,o){if(a){var s=t.cloneNode(true);s.setAttribute("stroke-opacity",n);s.setAttribute("stroke-width",uf(r+o));s.setAttribute("stroke",i);s.setAttribute("fill",nf);this._container.appendChild(s)}else{this._stroke(t,r,i,n)}};t.prototype._stroke=function e(t,r,i,n){if(n===void 0)n=1;var a=1;t.setAttribute("stroke",i);t.setAttribute("stroke-width",uf(r*a));t.setAttribute("stroke-opacity",n)};t.prototype._strokePattern=function e(t,r,i){if(r&&i){t.setAttribute("stroke-dasharray",uf(r)+","+uf(i))}};t.prototype._fill=function e(t,r){t.setAttribute("fill",r)};return t}(Ql);var ff=function e(){this._version=0;this._mustUpdate=true;this.maxCoord=0;this.maxScaledSize=0;this.maxPixelSize=0;this.maxMinVisibleSize=0;this.maxSymbolicSize=0;this.maxDashOffset=0;this.maxDashLength=0;this.maxGapLength=0};ff.prototype._mustUpdateBoundary=function e(t,r){return r>t||t/r>16};ff.prototype.set=function e(t){var r=t.maxCoord;var i=t.maxScaledSize;var n=t.maxPixelSize;var a=t.maxMinVisibleSize;var o=t.maxSymbolicSize;var s=t.maxDashOffset;var u=t.maxDashLength;var l=t.maxGapLength;var f=this._mustUpdateBoundary(this.maxCoord,r)||this._mustUpdateBoundary(this.maxScaledSize,i)||this._mustUpdateBoundary(this.maxPixelSize,n)||this._mustUpdateBoundary(this.maxMinVisibleSize,a)||this._mustUpdateBoundary(this.maxSymbolicSize,o)||this._mustUpdateBoundary(this.maxDashOffset,s)||this._mustUpdateBoundary(this.maxDashLength,u)||this._mustUpdateBoundary(this.maxGapLength,l);if(f){this.maxCoord=r;this.maxScaledSize=i;this.maxPixelSize=n;this.maxMinVisibleSize=a;this.maxSymbolicSize=o;this.maxDashOffset=s;this.maxDashLength=u;this.maxGapLength=l;this._mustUpdate=true}return f};ff.prototype.update=function e(){if(this._mustUpdate){this._version+=1;this._mustUpdate=false}};ff.prototype.getVersion=function e(){return this._version};var hf=vr();var vf="\n".charCodeAt(0);var df=12;var cf=25;var _f=511/cf;var gf=3;var pf=function e(t){this._patternManager=t;this._canvas=it();this._ctx=this._canvas.getContext("2d");this._mustClear=false;this._byFont={};this._widthAtlases={normal:{},bold:{},italic:{}};this._textPattern={type:ou,attributes:{text:"",font:"",size:0,style:"",align:""},dimensions:{width:0,height:0}};this._textDimensions={width:0,height:0};this._lineWidthList=new Array(64)};pf.prototype.clear=function e(){this._mustClear=true};pf.prototype._measureChar=function e(t,r,i){Tt(this._ctx,r,df,i);return this._ctx.measureText(t).width/df};pf.prototype._getAtlas=function e(t,r,i){var n=i==="sdf"?0:i;var a=this._byFont[t]||(this._byFont[t]={});var o=a[r]||(a[r]=new Array(50));var s=o[n]||(o[n]=new Array(256));return s};pf.prototype._getMeasurementAtlas=function e(t,r){var i=this._widthAtlases[r];var n=i[t]||(i[t]=new Array(256));return n};pf.prototype.measureText=function e(t,r,i,n){var a=this;if(n===void 0)n=1;var o=this._getMeasurementAtlas(r,i);var s=0,u=0;var l=1;for(var f=0;f<t.length;++f){var h=t.charCodeAt(f);if(h===vf){if(u>s){s=u}u=0;l+=1}else{var v=o[h];if(v===undefined){v=a._measureChar(t[f],r,i);o[h]=v}u+=v}}if(u>s){s=u}this._textDimensions.width=s*n;this._textDimensions.height=l*n;return this._textDimensions};pf.prototype._getCharInfo=function e(t,r,i,n,a,o,s){var u=this;var l=t[r];if(!l){var f=String.fromCharCode(r);var h=a==="sdf"?1:gf;l={ratio:this._measureChar(f,i,n),patternId:new Array(h)};for(var v=0;v<h;++v){var d=v/h;l.patternId[v]=u._patternManager.getIdFromDefinition({type:iu,attributes:{text:f,font:i,style:n,size:a,pixelRatio:s,align:o,offset:d}})}t[r]=l}return l};pf.prototype.storeTextInDataView=function e(t,r,i,n){var a=this;var o=r;if(n&&n.type===ou){var s=n.attributes;var u=s.text;var l=s.font;var f=s.style;var h=s.size;var v=s.pixelRatio;var d=s.align;var c=d==="center";var _=this._getAtlas(l,f,h);var g=0;var p=1;var y=0;var m=0;var x=this._lineWidthList;for(var b=0;b<u.length;++b){var A=u.charCodeAt(b);if(A===vf){if(y>g){g=y}x[m]=y;m+=1;y=0;p+=1}else{var w=a._getCharInfo(_,A,l,f,h,d,v);y+=w.ratio}}x[m]=y;if(y>g){g=y}if(h==="sdf"){var E=0;var S=-(c?x[E]:g)/2;var C=(-p+1)/2;var T=0;for(var M=0;M<u.length;++M){var k=u.charCodeAt(M);var I=_[k];if(k===vf){E+=1;S=-(c?x[E]:g)/2;C+=1;T=0}else{var N=I.ratio;var L=I.patternId[0];S+=(N+T)/2;T=N;var z=mf(S*_f);var D=yf(C*2);t.setUint16(o,L,hf);t.setUint16(o+2,(z<<6)+D,hf);o+=4}}}else{var P=0;var F=Math.ceil(-(c?x[P]:g)*h/2);var B=(-p+1)/2;for(var R=0;R<u.length;++R){var O=u.charCodeAt(R);var V=_[O];if(O===vf){P+=1;F=Math.ceil(-(c?x[P]:g)*h/2);B+=1}else{var j=V.ratio*h;var U=Math.floor(F);var G=F-U;var X=Math.round(G*gf);if(X===gf){X=0;U+=1}U+=Math.ceil(j/2);F+=j;var W=V.patternId[X];var Y=mf(U);var H=yf(B*2);t.setUint16(o,W,hf);t.setUint16(o+2,(Y<<6)+H,hf);o+=4}}}}this._fillWithZeros(t,o,i)};pf.prototype.extractTextFromDataView=function e(t,r,i){var n=this;var a=t;var o=hf;var s=a.getUint16(r,o);var u=this._textPattern;var l=this._patternManager.getDefinitionFromId(s);var f=l.attributes;var h=f.font;var v=f.style;var d=f.size;var c=f.align;var _=f.pixelRatio;var g=this._getAtlas(h,v,d);var p=[];var y=0;var m=0;var x=0;var b=null;for(var A=r;A<i;A+=4){var w=a.getUint16(A,o);if(!w){break}var E=xf(a.getUint16(A+2,o)%64);var S=n._patternManager.getDefinitionFromId(w);if(!S){break}var C=S.attributes.text.charCodeAt(0);var T=g[C];if(b===null){b=E}else if(E>b){if(y>m){m=y}y=0;x+=1;p.push(vf);b=E}p.push(C);if(T){y+=T.ratio}}if(y>m){m=y}u.attributes.style=v;u.attributes.font=h;u.attributes.size=d;u.attributes.align=c;u.attributes.pixelRatio=_;u.attributes.text=String.fromCharCode.apply(null,p);u.dimensions.width=m;u.dimensions.height=x;return u};pf.prototype._fillWithZeros=function e(t,r,i){for(var n=r;n<i;n+=4){t.setUint16(n,0)}};pf.prototype._clear=function e(){this._byFont={};this._widthAtlases={normal:{},bold:{},italic:{}}};pf.prototype.update=function e(){if(this._mustClear){this._clear();this._mustClear=false}};pf.prototype.getVersion=function e(){};function yf(value){return Qt(value+32,0,63)}function mf(value){return Qt(value+512,0,1023)}function xf(value){return value-32}var bf={linear:[0,1,0,0],quadraticIn:[0,0,1,0],quadraticOut:[0,2,-1,0],quadraticInOut:[0,0,2,0,-1,4,-2,0],cubicIn:[0,0,0,1],cubicOut:[0,3,-3,1],cubicInOut:[0,0,0,4,-3,12,-12,4]};var Af=function e(){this._linearEasing=[0,1,0,0,0,1,0,0];this._nameToPolygon={};this._polygonToName={};this.add(bf)};Af.prototype.add=function e(t){var r=this;Object.keys(t).forEach(function(e){var i=t[e].slice();if(i.length<8){i[4]=i[0];i[5]=i[1];i[6]=i[2];i[7]=i[3]}var n=wf(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]);r._nameToPolygon[e]=i;r._polygonToName[n]=e})};Af.prototype.getPolygonFromName=function e(t){return this._nameToPolygon[t]||this._linearEasing};Af.prototype.getNameFromPolygon=function e(t,r,i,n,a,o,s,u){var l=wf(t,r,i,n,a,o,s,u);return this._polygonToName[l]||"linear"};function wf(e,t,r,i,n,a,o,s){return e+n+(t+a)*256+(r+o)*65536+(i+s)*16777216}var Ef=function e(){var t=this;this._elementType=Qs;this._animated=false;this._size=0;this._capacity=xu;this._depth=0;this._id=0;this._baseElt=Ku();this._list=new Array(this._capacity);for(var r=0;r<this._capacity;++r){t._list[r]=Ku()}};Ef.prototype.setDepth=function e(t){this._depth=t;return this};Ef.prototype.reset=function e(t,r,i,n){this._elementType=t;this._animated=r;this._depth=i;this._id=n;this._size=0;return this};Ef.prototype.next=function e(){if(this._size>=this._capacity){throw new Error("internal error: block.next() was called on a full block")}return this._list[this._size++]};Ef.prototype.nextAndReset=function e(){var t=this.next();Zu(t.end);Zu(t.start);$u(t.animation);return t};Ef.prototype.forEach=function e(t){this._list.forEach(t)};Ef.prototype.getElement=function e(t){return this._list[t]};Ef.prototype.getCurrentElement=function e(){return this._list[this._size-1]};Ef.prototype.getSize=function e(){return this._size};Ef.prototype.getDepth=function e(){return this._depth};Ef.prototype.getElements=function e(){return this._list};Ef.prototype.getType=function e(){return this._elementType};Ef.prototype.getId=function e(){return this._id};Ef.prototype.isAnimated=function e(){return this._animated};Ef.prototype.setGlobalAnimation=function e(t,r,i){var n=this;for(var a=0;a<this._size;++a){var o=n._list[a].animation;o.beginTime=t;o.duration=r;o.easing=i}};var Sf=function e(){this._maps=[]};Sf.prototype.set=function e(t,r,i){var n=this;var a=t.getId();while(this._maps.length<=a){n._maps.push(new Array(mu))}this._maps[a][r]=i};Sf.prototype.get=function e(t,r){return this._maps[t.getId()][r]};var Cf={x:0,y:0,zoom:1,angle:0,width:80,height:60,pixelRatio:1,backgroundColor:null,currentTime:0,hideImages:false,isBufferDisplayable:function(){return true}};var Tf={webgl:Hl,canvas:tf,svg:lf,null:Qu};var Mf=Math.PI*2;var kf=[0,0,0,0];var If=function e(){this._colorManager=new gn;this._easingManager=new Af;this._patternManager=new uu;this._shapeManager=new lu;this._boundariesManager=new ff;this._textManager=new pf(this._patternManager);this._bufferList=new Wu;this._idRecorder=new Sf;this._maxCoord=0;this._maxScaledSize=0;this._maxPixelSize=0;this._maxMinVisibleSize=0;this._maxSymbolicSize=0;this._maxDashOffset=0;this._maxDashLength=0;this._maxGapLength=0;this._actualCoordToBytes=Cu;this._actualScaledSizeToBytes=Eu;this._actualPixelSizeToBytes=Eu;this._actualMinVisibleSizeToBytes=Mu;this._actualSymbolicSizeToBytes=Su;this._actualDashOffsetToBytes=Su;this._actualDashLengthToBytes=ku;this._actualGapLengthToBytes=ku;this._blockIdToAddress=new Uint32Array(0);this._currentDataView=null;this._currentElementSize=0;this._currentBlockOffset=0;this._currentByteOffset=0;this._view=ne(Cf);this._domElement=typeof document!=="undefined"?document.createElement("div"):Je();this._rendererMustBeReset=true;this._renderType=null;this._renderer=null;this._littleEndian=vr();this._additionalCanvases=[];this._refreshTexts=false;this._debugIdCounter=0};If.prototype.addCanvas=function e(t){this._resizeCanvas(t);this._additionalCanvases.push(t);this._updateDomElement()};If.prototype.removeCanvas=function e(t){dr(this._additionalCanvases,t);this._updateDomElement()};If.prototype.createBlock=function e(){return new Ef};If.prototype.parseColor=function e(t){return this._colorManager.parseColor(t)};If.prototype.clear=function e(){this._blockIdToAddress=new Uint32Array(0);this._patternManager=new uu;this._boundariesManager=new ff;this._textManager=new pf(this._patternManager);this._bufferList=new Wu;this._rendererMustBeReset=true};If.prototype.notifyFontsReloaded=function e(){this._patternManager.notifyUpdate();this._textManager.clear();this._refreshTexts=true};If.prototype.notifyPatternUpdate=function e(){this._patternManager.notifyUpdate()};If.prototype.getShapePoints=function e(t){return this._shapeManager.getDefinitionFromName(t).points};If.prototype.checkShapeHit=function e(t,r,i){var n=this._shapeManager.getDefinitionFromName(t);var a=n.getDistanceFromStrokeVertically;var o=n.getDistanceFromStrokeHorizontally;return Math.min(a(r,i),o(r,i))>=0};If.prototype.setGlobalBoundaries=function e(t){var r=t.maxBlockId;if(r===void 0)r=0;var i=t.maxCoord;var n=t.maxScaledSize;var a=t.maxPixelSize;var o=t.maxMinVisibleSize;var s=t.maxSymbolicSize;var u=t.maxDashOffset;var l=t.maxDashLength;var f=t.maxGapLength;if(r>this._blockIdToAddress.length){this._resizeBlockArray(r)}if(this._boundariesManager.set(t)){this._maxCoord=i;this._maxScaledSize=n;this._maxPixelSize=a;this._maxMinVisibleSize=o;this._maxSymbolicSize=s;this._maxDashOffset=u;this._maxDashLength=l;this._maxGapLength=f;this._actualCoordToBytes=Cu/i;this._actualScaledSizeToBytes=Tu/n;this._actualPixelSizeToBytes=Su/a;this._actualMinVisibleSizeToBytes=Mu/o;this._actualSymbolicSizeToBytes=Su/s;this._actualDashOffsetToBytes=Su/u;this._actualDashLengthToBytes=ku/l;this._actualGapLengthToBytes=ku/f;return true}return false};If.prototype._resizeBlockArray=function e(t){var r=new Uint32Array(t);r.set(this._blockIdToAddress);this._blockIdToAddress=r};If.prototype._clamp=function e(t,r,i){return Math.min(Math.max(t,r),i)};If.prototype._signedToUnsignedShort=function e(value){return this._clamp(value+32768,0,65535)};If.prototype._parseColor=function e(t){return this._colorManager.parseColor(t)||kf};If.prototype._formatColor=function e(t){var r=this._parseColor(t);var i=Math.round(r[0]*15);var n=Math.round(r[1]*15);var a=Math.round(r[2]*15);var o=Math.round(r[3]*15);return(i<<12)+(n<<8)+(a<<4)+o};If.prototype._formatCoord=function e(t){return t};If.prototype._formatAngle=function e(t){return this._clampAngle(t)*(Tu/Mf)};If.prototype._clampAngle=function e(t){return(t%Mf+Mf)%Mf};If.prototype._formatScaledSize=function e(value){return Math.ceil(Math.min(value,this._maxScaledSize)*this._actualScaledSizeToBytes)};If.prototype._formatPixelSize=function e(value){return Math.ceil(Math.min(value,this._maxPixelSize)*this._actualPixelSizeToBytes)};If.prototype._formatMinVisibleSize=function e(t){return Math.round(Math.min(t,this._maxMinVisibleSize)*this._actualMinVisibleSizeToBytes)};If.prototype._formatSymbolicSize=function e(t){return Math.round(Math.min(t,this._maxSymbolicSize)*this._actualSymbolicSizeToBytes)};If.prototype._formatDashOffset=function e(t){return Math.round(t%this._maxDashOffset*this._actualDashOffsetToBytes)};If.prototype._formatDashLength=function e(t){return Math.round(Math.min(t,this._maxDashLength)*this._actualDashLengthToBytes)};If.prototype._formatGapLength=function e(t){return Math.round(Math.min(t,this._maxGapLength)*this._actualGapLengthToBytes)};If.prototype._signedToUnsignedByte=function e(value){return this._clamp(value,-128,127)+128};If.prototype.registerShape=function e(t,r){this._shapeManager.register(t,r)};If.prototype._bindBlock=function e(t,r,i,n,a,o){this._checkBlockId(t);var s=this._blockIdToAddress[t],u=this._bufferList.allocateBlock(s,r,i,n,a,o);this._blockIdToAddress[t]=u.address;this._currentDataView=u.buffer.getDataView();this._currentElementSize=u.buffer.getElementSize();this._currentBlockOffset=u.offset;this._currentByteOffset=this._currentBlockOffset*this._currentElementSize;this._currentSideDataView=u.buffer.getSideDataView();this._currentSideElementSize=u.buffer.getTotalSideElementsSize();this._currentSideByteOffset=this._currentBlockOffset*this._currentSideElementSize;return u};If.prototype._setItemIndex=function e(t){var r=this._currentBlockOffset+t;this._currentByteOffset=r*this._currentElementSize;this._currentSideByteOffset=r*this._currentSideElementSize};If.prototype._freeBlock=function e(t){this._checkBlockId(t);var r=this._blockIdToAddress[t],i=this._bufferList.freeBlock(r);this._blockIdToAddress[t]=i;return i};If.prototype._checkBlockId=function e(t){if(t>=this._blockIdToAddress.length){this._resizeBlockArray(Jt(t+1))}};If.prototype._setUint16=function e(t,value){this._currentDataView.setUint16(this._currentByteOffset+t,value,this._littleEndian)};If.prototype._setInt16=function e(t,value){this._currentDataView.setInt16(this._currentByteOffset+t,value,this._littleEndian)};If.prototype._setUint8=function e(t,value){this._currentDataView.setUint8(this._currentByteOffset+t,value)};If.prototype._setInt8=function e(t,value){this._currentDataView.setInt8(this._currentByteOffset+t,value)};If.prototype._setFloat32=function e(t,value){this._currentDataView.setFloat32(this._currentByteOffset+t,value,this._littleEndian)};If.prototype._setShapeAndDashLengthAndGapLength=function e(t,r,i,n){var a=this._shapeManager.getIdFromName(r),o=this._formatDashLength(i),s=this._formatGapLength(n);this._setUint8(t,(a<<4)+(o<<2)+s)};If.prototype._setOpacityAndMinVisibleSize=function e(t,r,i){var n=Math.round(r*15);var a=this._formatMinVisibleSize(i);this._setUint8(t+1,(n<<4)+a)};If.prototype._setStrokeMinVisibleSizeAndPatternMinVisibleSize=function e(t,r,i){var n=this._formatMinVisibleSize(r),a=this._formatMinVisibleSize(i);this._setUint8(t+2,(n<<4)+a)};If.prototype._setFlagsAndAngleOffset=function e(t,r,i,n,a,o,s){var u=+r,l=+i,f=+n,h=+o,v=+a,d=Math.round((s+Mf)%Mf*(8/Mf));var value=(u<<7)+(l<<6)+(f<<5)+(h<<4)+(v<<3)+d;this._setUint8(t+3,value)};If.prototype._setPattern=function e(t,r){var i=this._patternManager.getIdFromDefinition(r);this._setUint16(t+4,i)};If.prototype._setFillColor=function e(t,r){var i=this._formatColor(r);this._setUint16(t+6,i)};If.prototype._setStrokeColor=function e(t,r){var i=this._formatColor(r);this._setUint16(t+8,i)};If.prototype._setShapeBoundaries=function e(t,r,i){var n=r*255,a=i*255;this._setUint16(t+10,(n<<8)+a)};If.prototype._setX=function e(t,r){this._setFloat32(t+12,r)};If.prototype._setY=function e(t,r){this._setFloat32(t+16,r)};If.prototype._setAngle=function e(t,r){this._setFloat32(t+20,this._clampAngle(r))};If.prototype._setLengthScaled=function e(t,r){this._setFloat32(t+24,r)};If.prototype._setThicknessScaled=function e(t,r){var i=this._formatScaledSize(r);this._setUint16(t+28,i)};If.prototype._setStrokeWidthScaled=function e(t,r){var i=this._formatScaledSize(r);this._setUint16(t+30,i)};If.prototype._setOffsetScaled=function e(t,r){var i=this._formatScaledSize(r);this._setUint16(t+32,i)};If.prototype._setLengthAbsoluteAndThicknessAbsolute=function e(t,r,i){var n=this._formatPixelSize(r),a=this._formatPixelSize(i);this._setUint16(t+34,(n<<8)+a)};If.prototype._setStrokeWidthAbsoluteAndOffsetAbsolute=function e(t,r,i){var n=this._formatPixelSize(r),a=this._formatPixelSize(i);this._setUint16(t+36,(n<<8)+a)};If.prototype._setPatternMask=function e(t,r){var i=this._formatColor(r);this._setUint16(t+38,i)};If.prototype._setPatternScaleAndDashOffset=function e(t,r,i){var n=r*127;var a=this._formatDashOffset(i);this._setUint16(t+40,(n<<8)+a)};If.prototype._setSymbolicSizeAndCurvature=function e(t,r,i){var n=this._formatSymbolicSize(r);var a=this._signedToUnsignedByte(i);this._setUint16(t+42,(n<<8)+a)};If.prototype._setAnimationBeginTime=function e(t,r){this._setFloat32(t,r)};If.prototype._setAnimationDuration=function e(t,r){this._setFloat32(t+4,r)};If.prototype._setAnimationEasing=function e(t,r){var i=this._easingManager.getPolygonFromName(r);this._setUint16(t+8,(i[0]+128<<8)+(i[4]+128));this._setUint16(t+10,(i[1]+128<<8)+(i[5]+128));this._setUint16(t+12,(i[2]+128<<8)+(i[6]+128));this._setUint16(t+14,(i[3]+128<<8)+(i[7]+128))};If.prototype._setTextCharacters=function e(t){this._textManager.storeTextInDataView(this._currentSideDataView,this._currentSideByteOffset,this._currentSideByteOffset+this._currentSideElementSize,t)};If.prototype._storeGenericObject=function e(t,r){if(r.lengthAbsolute>255){r.curvature=r.lengthAbsolute/256|0;r.lengthAbsolute=r.lengthAbsolute%256}this._setShapeAndDashLengthAndGapLength(t,r.shape,r.dashLength,r.gapLength);this._setOpacityAndMinVisibleSize(t,r.opacity,r.minVisibleSize);this._setStrokeMinVisibleSizeAndPatternMinVisibleSize(t,r.strokeMinVisibleSize,r.patternMinVisibleSize);this._setFlagsAndAngleOffset(t,r.angleAffectedByView,r.offsetAffectedByAngle,r.adjustAngle,r.isSelfLoop,r.patternSdf,r.offsetAngle);this._setPattern(t,r.pattern);this._setFillColor(t,r.fillColor);this._setStrokeColor(t,r.strokeColor);this._setShapeBoundaries(t,r.shapeStart,r.shapeEnd);this._setX(t,r.x);this._setY(t,r.y);this._setAngle(t,r.angle);this._setLengthScaled(t,r.lengthScaled);this._setThicknessScaled(t,r.thicknessScaled);this._setStrokeWidthScaled(t,r.strokeWidthScaled);this._setOffsetScaled(t,r.offsetScaled);this._setLengthAbsoluteAndThicknessAbsolute(t,r.lengthAbsolute,r.thicknessAbsolute);this._setStrokeWidthAbsoluteAndOffsetAbsolute(t,r.strokeWidthAbsolute,r.offsetAbsolute);this._setPatternMask(t,r.patternMask);this._setPatternScaleAndDashOffset(t,r.patternScale,r.dashOffset);this._setSymbolicSizeAndCurvature(t,r.symbolicSize,r.curvature)};If.prototype._storeAnimationInformation=function e(t,r){this._setAnimationBeginTime(t,r.beginTime);this._setAnimationDuration(t,r.duration);this._setAnimationEasing(t,r.easing)};If.prototype._storeElement=function e(t,r){this._storeGenericObject(0,t.end);if(r){this._storeGenericObject(Ou,t.start);this._storeAnimationInformation(Ou*2,t.animation)}};If.prototype.storeBlock=function e(t,r){var i=this;if(!r||!r.getSize()){return this._freeBlock(t)}var n=r.getType();var a=r.getDepth();var o=r.getSize();var s=r.getElements();var u=r.isAnimated();var l=r.getId();var f=0;if(n===eu){for(var h=0;h<o;++h){var v=s[h];if(v.end.pattern&&v.end.pattern.type===ou){f=Math.max(f,v.end.pattern.attributes.text.length)}}}var d=this._bindBlock(t,n,u,a,o,f);for(var c=0;c<o;++c){i._setItemIndex(c);i._storeElement(s[c],u);i._idRecorder.set(d.buffer,d.offset+c,l)}if(n===eu){for(var _=0;_<o;++_){var g=s[_];i._setItemIndex(_);i._setTextCharacters(g.end.pattern)}}return d.address};If.prototype.freeBlock=function e(t){return this._freeBlock(t)};If.prototype._refreshTextElements=function e(){var t=this;var r=this._bufferList.getBuffers();for(var i=0;i<r.length;++i){var n=r[i];if(n&&n.getElementType()===eu){var a=n.getSideDataView();var o=n.getTotalSideElementsSize();var s=n.getSize();var u=0;var l=o;for(var f=0;f<s;++f){var h=t._textManager.extractTextFromDataView(a,u,l);t._textManager.storeTextInDataView(a,u,l,h);u=l;l+=o}n.triggerUpdate()}}};If.prototype._extractElement=function e(t,r){if(!t){return null}var i=this._bufferList.getBlockInfo(t);return this._renderer.extractElement(i.buffer,i.offset+r)};If.prototype.extractElement=function e(t,r){if(r===void 0)r=0;return this._extractElement(t,r)};If.prototype.getDomElement=function e(){return this._domElement};If.prototype.measureText=function e(t,r,i,n){return this._textManager.measureText(t,r,i,n)};If.prototype.setRenderType=function e(t){if(this._renderType!==t){this._renderType=t;this._rendererMustBeReset=true}};If.prototype._recreateMainRenderer=function e(){if(this._renderer){this._renderer.destroy()}this._renderer=this._instanciateRenderer(this._renderType);this._updateDomElement()};If.prototype._updateDomElement=function e(){var t=this;var r=this._renderer&&this._renderer.getDomElement();while(this._domElement.firstChild){t._domElement.removeChild(t._domElement.firstChild)}if(r){this._appendDomChild(r)}for(var i=0;i<this._additionalCanvases.length;++i){t._appendDomChild(t._additionalCanvases[i])}};If.prototype._appendDomChild=function e(t){t.style.position="absolute";t.style.left="0";t.style.top="0";this._domElement.appendChild(t)};If.prototype._instanciateRenderer=function e(t){var r=Tf[t]||Qu;return new r({bufferList:this._bufferList,shapeManager:this._shapeManager,patternManager:this._patternManager,boundariesManager:this._boundariesManager,textManager:this._textManager,colorManager:this._colorManager,easingManager:this._easingManager,idRecorder:this._idRecorder})};If.prototype.setView=function e(t){Object.assign(this._view,t)};If.prototype._updateManagers=function e(){this._shapeManager.update();this._patternManager.update();this._textManager.update();this._boundariesManager.update();this._bufferList.update();if(this._refreshTexts){this._refreshTexts=false;this._refreshTextElements()}};If.prototype._resizeCanvas=function e(t){Ju(t,this._view.width,this._view.height,this._view.pixelRatio)};If.prototype.render=function e(){var t=this;if(this._rendererMustBeReset){this._recreateMainRenderer();this._rendererMustBeReset=false}if(this._domElement.offsetWidth!==this._view.width||this._domElement.offsetHeight!==this._view.height){this._domElement.style.width=this._view.width+"px";this._domElement.style.height=this._view.height+"px";for(var r=0;r<this._additionalCanvases.length;++r){t._resizeCanvas(t._additionalCanvases[r])}}this._updateManagers();this._renderer.renderFrame(this._view)};If.prototype.export=function e(t,r,i){var n=this._instanciateRenderer(t);var a=Object.assign({},this._view,r);n.setViewportClipping(false);this._updateManagers();n.renderFrame(a);return n.export(i).then(function(){return n.getDomElement()})};If.prototype.getCurrentTime=function e(){return R()};If.prototype.getImageData=function e(){return this._renderer&&this._renderer.getImageData()};If.prototype.destroy=function e(){if(this._renderer){this._renderer.destroy()}};If.prototype.transparentify=function e(t){var r=this._parseColor(t);var i=Math.round(r[0]*255);var n=Math.round(r[1]*255);var a=Math.round(r[2]*255);return"rgba("+i+","+n+","+a+",0)"};If.prototype.initDebugRenderingLoop=function e(t){var r=this;if(t===void 0)t={};var i=t.triggerKey;if(i===void 0)i="r";var n=t.start;if(n===void 0)n=true;var a=n;document.addEventListener("keydown",function(e){var t=e.key;if(t===i){a=!a}});var o=function(e){if(a||e){r.setView({currentTime:R()});r.render()}window.requestAnimationFrame(function(){o()})};window.requestAnimationFrame(function(){document.body.appendChild(r.getDomElement());o(true)})};If.prototype.E={ELT_GENERIC:Qs,ELT_TEXT:eu,PATTERN_NONE:tu,PATTERN_IMAGE:ru,PATTERN_TEXT:iu,PATTERN_PIE_CHART:nu,PATTERN_TEXT_OPT:ou};var Nf=function(e){function t(){e.call(this);this.isDummy=true}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={src:{configurable:true}};r.src.set=function(e){var t=this;if(e){this._src=e;setTimeout(function(){if(t.onload){t.onload.call(t)}t.fire("load")},16)}};r.src.get=function(){return this._src};t.prototype.addEventListener=function e(t,r){this.on(t,r)};Object.defineProperties(t.prototype,r);return t}(cn);var Lf=typeof Image!=="undefined"?Image:Nf;var zf=function e(){this._images={};this._crossOrigin="anonymous";this._whenReady=[];this._onFetch=[];this._nbLoaded=0;this._nbToLoad=0};zf.prototype.setImgCrossOrigin=function e(t){this._crossOrigin=t};zf.prototype.clear=function e(){this._images={};this._nbLoaded=0;this._nbToLoad=0};zf.prototype.getImage=function e(t){var r=this;var i=this._images[t];if(i===undefined){this._nbToLoad+=1;i=new Lf;i.crossOrigin=this._crossOrigin;i.onload=function(){r._onImgLoad(t)};i.onerror=function(){r._onImgLoad(t);r._images[t]=null};i.src=t;this._images[t]=i}return i};zf.prototype._onImgLoad=function e(t){this._nbLoaded+=1;this._onFetch.forEach(function(e){return e(t)});if(this._nbLoaded===this._nbToLoad){this._whenReady.forEach(function(e){return e()});this._whenReady=[]}};zf.prototype.onFetch=function e(t){this._onFetch.push(t)};zf.prototype.whenReady=function e(){var t=this;if(this._nbLoaded===this._nbToLoad){return Promise.resolve()}else{return new Promise(function(e){return t._whenReady.push(e)})}};zf.prototype.destroy=function e(){this._whenReady=[];this._onFetch=[]};function Df(e,t){if(t<2){return e}var r=e.split("\n");var i=[];for(var n=0;n<r.length;++n){var a=r[n];if(a.length<t){i.push(a)}else{var o=Pf(r[n],t);for(var s=0;s<o.length;++s){i.push(o[s])}}}return i.join("\n")}function Pf(e,t){var r=e.split(" "),i=[],n=0,a=-1,o=[],s=true;for(var u=0;u<r.length;++u){if(s){if(r[u].length>t){var l=Ff(r[u],t);for(var f=0;f<l.length;++f){i.push([l[f]]);++a}n=l[l.length-1].length}else{i.push([r[u]]);++a;n=r[u].length+1}s=false}else if(n+r[u].length<=t){i[a].push(r[u]);n+=r[u].length+1}else{s=true;--u}}for(u=0;u<i.length;++u){o.push(i[u].join(" "))}return o}function Ff(e,t){var r=[];for(var i=0;i<e.length;i+=t-1){r.push(e.substr(i,t-1)+"-")}var n=r[r.length-1].length;r[r.length-1]=r[r.length-1].substr(0,n-1)+" ";return r}function Bf(e,t){if(e===null){return null}e=e.toString();var r=e.split("\n"),i=[],n=0;for(var a=0;a<r.length;a++){var o=r[a];if(!t||t<=1||o.length<t){i.push(o);n=Math.max(n,o.length)}else{var s=Pf(r[a],t);for(var u=0;u<s.length;u++){o=s[u];i.push(o);n=Math.max(n,o.length)}}}return{data:i,maxLength:n,lines:i.length}}function Rf(e){return e||e===0}function Of(e,t,r,i,n,a,o,s,u){var l=o;var f,h;var v=r.angle;var d=Math.atan2(t-a,e-n)-v;if(d<-Ta){d+=Ma}else if(d>Ta){d-=Ma}if(d<-Ta/2){f=ka;h=u.topLeft}else if(d<0){f=Ia;h=u.topRight}else if(d<Ta/2){f=La;h=u.bottomRight}else{f=Na;h=u.bottomLeft}f+=v;var c=h.textContent;var _=h.image;var g=h.positionScale;var p=h.scale;var y=c.get(i);var m=_.get(i);if(Rf(y)||m){var x=g.get(i);var b=p.get(i);var A=x*o;var w=b*o;var E=Math.cos(f);var S=Math.sin(f);var C=n+E*A;var T=a+S*A;var M=bn(e,t,n,a,C,T,w);if(M){var k=M.x-n;var I=M.y-a;var N=Math.sqrt(k*k+I*I);l=Math.max(l,N)}}if(s==="square"){var L=Math.abs(Math.cos(d));var z=Math.abs(Math.sin(d));var D=1/Math.max(L,z)*o;l=Math.max(l,D)}return l}function Vf(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function jf(e){var t=e.ogma;var r=e.graph;var i=e.engine;var n=e.imageManager;var a=e.view;var o=e.attributes;var s=e.boundaries;var u=o.nodes.current;var l=o.nodes.previous;var f=o.edges.current;var h=o.edges.previous;var v=r.nodes;var d=r.edges;if(!v.size&&!d.size){return}var c=s.maxSize;var _=s.maxMinVisibleSize;var g=Math.max(t.modules.graph.getNodeMaxIndex(),t.modules.graph.getEdgeMaxIndex());var p=(g+1)*ca;var y=i.setGlobalBoundaries({maxBlockId:Vf(p),maxScaledSize:Vf(c*32),maxPixelSize:255,maxMinVisibleSize:Vf(_),maxSymbolicSize:Vf(c),maxDashOffset:4,maxDashLength:3,maxGapLength:1});var m=y?t.modules.graph.allNodeIndexesConst():v._indexes;var x=y?t.modules.graph.allEdgeIndexesConst():d._indexes;var b=u.excluded;var A=u.layer;var w=u.animationDuration;var E=u.animationStart;var S=u.animationEasing;var C=u.x;var T=u.y;var M=u.opacity;var k=u.radius;var I=u.color;var N=u.shape;var L=u.innerStroke.width;var z=u.innerStroke.color;var D=u.innerStroke.minVisibleSize;var P=u.outerStroke.width;var F=u.outerStroke.color;var B=u.outerStroke.minVisibleSize;var R=u.badges.bottomRight.color;var O=u.badges.bottomRight.scale;var V=u.badges.bottomRight.positionScale;var j=u.badges.bottomRight.image.url;var U=u.badges.bottomRight.image.scale;var G=u.badges.bottomRight.minVisibleSize;var X=u.badges.bottomRight.stroke.color;var W=u.badges.bottomRight.stroke.width;var Y=u.badges.bottomRight.text.content;var H=u.badges.bottomRight.text.color;var q=u.badges.bottomRight.text.font;var Z=u.badges.bottomRight.text.style;var $=u.badges.bottomRight.text.scale;var K=u.badges.bottomLeft.color;var J=u.badges.bottomLeft.scale;var Q=u.badges.bottomLeft.positionScale;var ee=u.badges.bottomLeft.image.url;var te=u.badges.bottomLeft.image.scale;var re=u.badges.bottomLeft.minVisibleSize;var ie=u.badges.bottomLeft.stroke.color;var ne=u.badges.bottomLeft.stroke.width;var ae=u.badges.bottomLeft.text.content;var oe=u.badges.bottomLeft.text.color;var se=u.badges.bottomLeft.text.font;var ue=u.badges.bottomLeft.text.style;var le=u.badges.bottomLeft.text.scale;var fe=u.badges.topRight.color;var he=u.badges.topRight.scale;var ve=u.badges.topRight.positionScale;var de=u.badges.topRight.image.url;var ce=u.badges.topRight.image.scale;var _e=u.badges.topRight.minVisibleSize;var ge=u.badges.topRight.stroke.color;var pe=u.badges.topRight.stroke.width;var ye=u.badges.topRight.text.content;var me=u.badges.topRight.text.color;var xe=u.badges.topRight.text.font;var be=u.badges.topRight.text.style;var Ae=u.badges.topRight.text.scale;var we=u.badges.topLeft.color;var Ee=u.badges.topLeft.scale;var Se=u.badges.topLeft.positionScale;var Ce=u.badges.topLeft.image.url;var Te=u.badges.topLeft.image.scale;var Me=u.badges.topLeft.minVisibleSize;var ke=u.badges.topLeft.stroke.color;var Ie=u.badges.topLeft.stroke.width;var Ne=u.badges.topLeft.text.content;var Le=u.badges.topLeft.text.color;var ze=u.badges.topLeft.text.font;var De=u.badges.topLeft.text.style;var Pe=u.badges.topLeft.text.scale;var Fe=u.halo.color;var Be=u.halo.width;var Re=u.halo.strokeColor;var Oe=u.halo.strokeWidth;var Ve=u.icon.content;var je=u.icon.font;var Ue=u.icon.color;var Ge=u.icon.scale;var Xe=u.icon.style;var We=u.icon.minVisibleSize;var Ye=u.image.url;var He=u.image.scale;var qe=u.image.fit;var Ze=u.image.tile;var $e=u.image.minVisibleSize;var Ke=u.outline.enabled;var Je=u.outline.color;var Qe=u.outline.minVisibleSize;var et=u.textHidden;var tt=u.text.content;var rt=u.text.font;var it=u.text.color;var at=u.text.size;var ot=u.text.scale;var st=u.text.style;var ut=u.text.align;var lt=u.text.margin;var ft=u.text.padding;var ht=u.text.backgroundColor;var vt=u.text.tip;var dt=u.text.minVisibleSize;var ct=u.text.secondary.content;var _t=u.text.secondary.font;var gt=u.text.secondary.color;var pt=u.text.secondary.size;var yt=u.text.secondary.scale;var mt=u.text.secondary.style;var xt=u.text.secondary.align;var bt=u.text.secondary.margin;var At=u.text.secondary.padding;var wt=u.text.secondary.backgroundColor;var Et=u.text.secondary.minVisibleSize;var St=u.text.scaling;var Ct=u.text.position;var Tt=u.text.maxLineLength;var Mt=l.x;var kt=l.y;var It=l.opacity;var Nt=l.radius;var Lt=l.color;var zt=l.shape;var Dt=l.innerStroke.width;var Pt=l.innerStroke.color;var Ft=l.innerStroke.minVisibleSize;var Bt=l.outerStroke.width;var Rt=l.outerStroke.color;var Ot=l.outerStroke.minVisibleSize;var Vt=l.badges.bottomRight.color;var jt=l.badges.bottomRight.scale;var Ut=l.badges.bottomRight.positionScale;var Gt=l.badges.bottomRight.image.url;var Xt=l.badges.bottomRight.image.scale;var Wt=l.badges.bottomRight.minVisibleSize;var Yt=l.badges.bottomRight.stroke.color;var Ht=l.badges.bottomRight.stroke.width;var qt=l.badges.bottomRight.text.content;var Zt=l.badges.bottomRight.text.color;var $t=l.badges.bottomRight.text.font;var Kt=l.badges.bottomRight.text.style;var Jt=l.badges.bottomRight.text.scale;var Qt=l.badges.bottomLeft.color;var er=l.badges.bottomLeft.scale;var tr=l.badges.bottomLeft.positionScale;var rr=l.badges.bottomLeft.image.url;var ir=l.badges.bottomLeft.image.scale;var nr=l.badges.bottomLeft.minVisibleSize;var ar=l.badges.bottomLeft.stroke.color;var or=l.badges.bottomLeft.stroke.width;var sr=l.badges.bottomLeft.text.content;var ur=l.badges.bottomLeft.text.color;var lr=l.badges.bottomLeft.text.font;var fr=l.badges.bottomLeft.text.style;var hr=l.badges.bottomLeft.text.scale;var vr=l.badges.topRight.color;var dr=l.badges.topRight.scale;var cr=l.badges.topRight.positionScale;var _r=l.badges.topRight.image.url;var gr=l.badges.topRight.image.scale;var pr=l.badges.topRight.minVisibleSize;var yr=l.badges.topRight.stroke.color;var mr=l.badges.topRight.stroke.width;var xr=l.badges.topRight.text.content;var br=l.badges.topRight.text.color;var Ar=l.badges.topRight.text.font;var wr=l.badges.topRight.text.style;var Er=l.badges.topRight.text.scale;var Sr=l.badges.topLeft.color;var Cr=l.badges.topLeft.scale;var Tr=l.badges.topLeft.positionScale;var Mr=l.badges.topLeft.image.url;var kr=l.badges.topLeft.image.scale;var Ir=l.badges.topLeft.minVisibleSize;var Nr=l.badges.topLeft.stroke.color;var Lr=l.badges.topLeft.stroke.width;var zr=l.badges.topLeft.text.content;var Dr=l.badges.topLeft.text.color;var Pr=l.badges.topLeft.text.font;var Fr=l.badges.topLeft.text.style;var Br=l.badges.topLeft.text.scale;var Rr=l.halo.color;var Or=l.halo.width;var Vr=l.halo.strokeColor;var jr=l.halo.strokeWidth;var Ur=l.icon.content;var Gr=l.icon.font;var Xr=l.icon.color;var Wr=l.icon.scale;var Yr=l.icon.style;var Hr=l.icon.minVisibleSize;var qr=l.image.url;var Zr=l.image.scale;var $r=l.image.fit;var Kr=l.image.tile;var Jr=l.image.minVisibleSize;var Qr=l.outline.enabled;var ei=l.outline.color;var ti=l.outline.minVisibleSize;var ri=l.text.content;var ii=l.text.font;var ni=l.text.color;var ai=l.text.size;var oi=l.text.scale;var si=l.text.style;var ui=l.text.align;var li=l.text.margin;var fi=l.text.padding;var hi=l.text.backgroundColor;var vi=l.text.tip;var di=l.text.minVisibleSize;var ci=l.text.secondary.content;var _i=l.text.secondary.font;var gi=l.text.secondary.color;var pi=l.text.secondary.size;var yi=l.text.secondary.scale;var mi=l.text.secondary.style;var xi=l.text.secondary.align;var bi=l.text.secondary.margin;var Ai=l.text.secondary.padding;var wi=l.text.secondary.backgroundColor;var Ei=l.text.secondary.minVisibleSize;var Si=l.text.scaling;var Ci=l.text.position;var Ti=l.text.maxLineLength;var Mi=f.source;var ki=f.target;var Ii=f.curvature;var Ni=f.excluded;var Li=f.layer;var zi=f.animationDuration;var Di=f.animationStart;var Pi=f.animationEasing;var Fi=f.width;var Bi=f.color;var Ri=f.shape.type;var Oi=f.shape.head;var Vi=f.shape.tail;var ji=f.shape.style;var Ui=f.opacity;var Gi=f.stroke.color;var Xi=f.stroke.width;var Wi=f.stroke.minVisibleSize;var Yi=f.minVisibleSize;var Hi=f.adjustAnchors;var qi=f.halo.color;var Zi=f.halo.width;var $i=f.outline.enabled;var Ki=f.outline.color;var Ji=f.outline.minVisibleSize;var Qi=f.textHidden;var en=f.text.content;var tn=f.text.font;var rn=f.text.color;var nn=f.text.scaling;var an=f.text.size;var on=f.text.scale;var sn=f.text.style;var un=f.text.align;var ln=f.text.margin;var fn=f.text.padding;var hn=f.text.backgroundColor;var vn=f.text.minVisibleSize;var dn=f.text.adjustAngle;var cn=f.text.secondary.content;var _n=f.text.secondary.font;var gn=f.text.secondary.color;var pn=f.text.scaling;var yn=f.text.secondary.size;var mn=f.text.secondary.scale;var xn=f.text.secondary.style;var bn=f.text.secondary.align;var An=f.text.secondary.margin;var wn=f.text.secondary.padding;var En=f.text.secondary.backgroundColor;var Sn=f.text.secondary.minVisibleSize;var Cn=f.text.maxLineLength;var Tn={get:function(){return false}};var Mn=h.width;var kn=h.color;var In=h.shape.type;var Nn=h.shape.head;var Ln=h.shape.tail;var zn=h.shape.style;var Dn=h.opacity;var Pn=h.stroke.color;var Fn=h.stroke.width;var Bn=h.stroke.minVisibleSize;var Rn=h.minVisibleSize;var On=h.adjustAnchors;var Vn=h.halo.color;var jn=h.halo.width;var Un=h.outline.enabled;var Gn=h.outline.color;var Xn=h.outline.minVisibleSize;var Wn=h.text.content;var Yn=h.text.font;var Hn=h.text.color;var qn=h.text.scaling;var Zn=h.text.size;var $n=h.text.scale;var Kn=h.text.style;var Jn=h.text.align;var Qn=h.text.margin;var ea=h.text.padding;var ta=h.text.backgroundColor;var ra=h.text.minVisibleSize;var ia=h.text.adjustAngle;var da=h.text.secondary.content;var _a=h.text.secondary.font;var ga=h.text.secondary.color;var pa=h.text.scaling;var ya=h.text.secondary.size;var ma=h.text.secondary.scale;var xa=h.text.secondary.style;var ba=h.text.secondary.align;var Aa=h.text.secondary.margin;var wa=h.text.secondary.padding;var Ea=h.text.secondary.backgroundColor;var Sa=h.text.secondary.minVisibleSize;var Ca=h.text.maxLineLength;var Ta={get:function(){return false}};var Ma={topLeft:{textContent:Ne,image:Ce,positionScale:Se,scale:Ee},topRight:{textContent:ye,image:de,positionScale:ve,scale:he},bottomLeft:{textContent:ae,image:ee,positionScale:Q,scale:J},bottomRight:{textContent:Y,image:j,positionScale:V,scale:O}};var Ra={topLeft:{textContent:zr,image:Mr,positionScale:Tr,scale:Cr},topRight:{textContent:xr,image:_r,positionScale:cr,scale:dr},bottomLeft:{textContent:sr,image:rr,positionScale:tr,scale:er},bottomRight:{textContent:qt,image:Gt,positionScale:Ut,scale:jt}};var Oa=i.createBlock();var Va=i.createBlock();var ja=i.createBlock();var Ua=i.createBlock();var Ga=i.createBlock();var Xa={bodyPatternAssigned:false,pixelRatio:nt(),input:{},output:{},inputPrev:{},outputPrev:{},depthInfo:{}};for(var Wa=0,Ya=m.length;Wa<Ya;++Wa){var Ha=void 0;var qa=void 0;var Za=void 0;var $a=void 0;var Ka=void 0;var Ja=void 0;var Qa=void 0;var eo=void 0;var to=void 0;var ro=void 0;var io=void 0;var no=void 0;var ao=void 0;var oo=void 0;var so=void 0;var uo=void 0;var lo=void 0;var fo=void 0;var ho=void 0;var vo=void 0;var co=void 0;var _o=void 0;var go=void 0;var po=void 0;var yo=void 0;var mo=void 0;var xo=void 0;var bo=void 0;var Ao=void 0;var wo=void 0;var Eo=void 0;var So=void 0;var Co=void 0;var To=void 0;var Mo=void 0;var ko=void 0;var Io=void 0;var No=void 0;var Lo=void 0;var zo=void 0;var Do=void 0;var Po=void 0;var Fo=void 0;var Bo=void 0;var Ro=void 0;var Oo=void 0;var Vo=void 0;var jo=void 0;var Uo=void 0;var Go=void 0;var Xo=void 0;var Wo=void 0;var Yo=void 0;var Ho=void 0;var qo=void 0;var Zo=void 0;var $o=void 0;var Ko=void 0;var Jo=void 0;var Qo=void 0;var es=void 0;var ts=void 0;var rs=void 0;var is=void 0;var ns=void 0;var as=void 0;var os=void 0;var ss=void 0;var us=void 0;var ls=void 0;var fs=void 0;var hs=void 0;var vs=void 0;var ds=void 0;var cs=void 0;var _s=void 0;var gs=void 0;var ps=void 0;var ys=void 0;var ms=void 0;var xs=void 0;var bs=void 0;var As=void 0;var ws=void 0;var Es=void 0;var Ss=void 0;var Cs=void 0;var Ts=void 0;var Ms=void 0;var ks=void 0;var Is=void 0;var Ns=void 0;var Ls=void 0;var zs=void 0;var Ds=void 0;var Ps=void 0;var Fs=void 0;var Bs=void 0;var Rs=void 0;var Os=void 0;var Vs=void 0;var js=void 0;var Us=void 0;var Gs=void 0;var Xs=void 0;var Ws=void 0;var Ys=void 0;var Hs=void 0;var qs=void 0;var Zs=void 0;var $s=void 0;var Ks=void 0;var Js=void 0;var tu=void 0;var ru=void 0;var iu=void 0;var nu=void 0;var au=void 0;var ou=void 0;var su=void 0;var uu=void 0;var lu=void 0;var fu=void 0;var hu=void 0;var vu=void 0;var du=void 0;var cu=void 0;var _u=void 0;var gu=void 0;var pu=void 0;var yu=void 0;var mu=void 0;var xu=void 0;var bu=void 0;var Au=void 0;var wu=m[Wa];var Eu=wu*ca;var Su=Eu+na;var Cu=Eu+aa;var Tu=Eu+oa;var Mu=Eu+sa;var ku=Eu+ua;qa=b.get(wu);if(qa){i.freeBlock(Su);i.freeBlock(Cu);i.freeBlock(Tu);i.freeBlock(Mu);i.freeBlock(ku)}else{Ha="n"+wu;Ka=A.get(wu);Ja=w.get(wu);Za=Ja>0;$a=ph(Ka,Xa.depthInfo);Xa.bodyPatternAssigned=false;Oa.reset(Qs,Za,$a.nodeBody,Ha);Va.reset(eu,Za,$a.nodeText,Ha);ja.reset(Qs,Za,$a.nodeTextBackground,Ha);Ua.reset(Qs,Za,$a.nodeHalo,Ha);Ga.reset(Qs,Za,$a.nodeHaloStroke,Ha);to=C.get(wu);ro=T.get(wu);oo=N.get(wu);ao=I.get(wu);io=M.get(wu);no=k.get(wu);uo=z.get(wu);so=L.get(wu);lo=D.get(wu);ho=F.get(wu);fo=P.get(wu);yo=Ve.get(wu);So=Ye.get(wu);zo=et.get(wu);Do=tt.get(wu);co=Fe.get(wu);go=Re.get(wu);Io=Ke.get(wu);if(Array.isArray(ao)&&ao.length===1){ao=ao[0]}if(Za){vs=Mt.get(wu);ds=kt.get(wu);ps=zt.get(wu);gs=Lt.get(wu);cs=It.get(wu);_s=Nt.get(wu);ms=Pt.get(wu);ys=Dt.get(wu);xs=Ft.get(wu);As=Rt.get(wu);bs=Bt.get(wu);Ms=Ur.get(wu);Ps=qr.get(wu);Gs=ri.get(wu);Es=Rr.get(wu);Cs=Vr.get(wu);Vs=Qr.get(wu);if(Array.isArray(gs)&&gs.length===1){gs=gs[0]}}var Iu=void 0;if(Io||Za&&Vs){Iu=Oa.next();No=Je.get(wu);Lo=Qe.get(wu);sh(Iu.end,to,ro,no,oo,io,ho,fo,No,Lo);if(Za){js=ei.get(wu);Us=ti.get(wu);sh(Iu.start,vs,ds,_s,ps,cs,As,bs,js,Us)}}if(ho||Za&&As){Iu=Oa.next();ho=Xf(ho,ao);vo=B.get(wu);eh(Iu.end,to,ro,oo,no,ho,fo,so,vo,io);if(Za){As=Xf(As,gs);ws=Ot.get(wu);eh(Iu.start,vs,ds,ps,_s,As,bs,ys,ws,cs)}}{Iu=Oa.next();uo=Xf(uo,ao);th(Iu.end,to,ro,no,oo,ao,io,uo,so,lo);if(Za){ms=Xf(ms,ao);th(Iu.start,vs,ds,_s,ps,gs,cs,ms,ys,xs)}}if(Yf(ao)||Za&&Yf(gs)){Iu=Jf(Xa,Oa,Za,to,ro,no,oo,io,vs,ds,_s,ps,cs);Hf(Iu.end,ao);if(Za){Hf(Iu.start,gs)}}if(So||Za&&Ps){Iu=Jf(Xa,Oa,Za,to,ro,no,oo,io,vs,ds,_s,ps,cs);Eo=n.getImage(So);Co=He.get(wu);To=qe.get(wu);Mo=Ze.get(wu);ko=$e.get(wu);Zf(Iu.end,Eo,To,Mo,Co,ko);if(Za){Ds=n.getImage(Ps);Fs=Zr.get(wu);Bs=$r.get(wu);Rs=Kr.get(wu);Os=Jr.get(wu);Zf(Iu.start,Ds,Bs,Rs,Fs,Os)}}if(Rf(yo)||Za&&Rf(Ms)){Iu=Jf(Xa,Oa,Za,to,ro,no,oo,io,vs,ds,_s,ps,cs);mo=je.get(wu);xo=Ue.get(wu);bo=Ge.get(wu);Ao=Xe.get(wu);wo=We.get(wu);qf(Iu.end,yo,mo,xo,bo,Ao,wo);if(Za){ks=Gr.get(wu);Is=Xr.get(wu);Ls=Wr.get(wu);Ns=Yr.get(wu);zs=Hr.get(wu);qf(Iu.start,Ms,ks,Is,Ls,Ns,zs)}}$f(n,Oa,wu,Za,ka,to,ro,no,ao,io,vs,ds,_s,gs,cs,we,Ee,Se,Me,ke,Ie,Ce,Te,Ne,Le,ze,De,Pe,Sr,Cr,Tr,Ir,Nr,Lr,Mr,kr,zr,Dr,Pr,Fr,Br);$f(n,Oa,wu,Za,Ia,to,ro,no,ao,io,vs,ds,_s,gs,cs,fe,he,ve,_e,ge,pe,de,ce,ye,me,xe,be,Ae,vr,dr,cr,pr,yr,mr,_r,gr,xr,br,Ar,wr,Er);$f(n,Oa,wu,Za,Na,to,ro,no,ao,io,vs,ds,_s,gs,cs,K,J,Q,re,ie,ne,ee,te,ae,oe,se,ue,le,Qt,er,tr,nr,ar,or,rr,ir,sr,ur,lr,fr,hr);$f(n,Oa,wu,Za,La,to,ro,no,ao,io,vs,ds,_s,gs,cs,R,O,V,G,X,W,j,U,Y,H,q,Z,$,Vt,jt,Ut,Wt,Yt,Ht,Gt,Xt,qt,Zt,$t,Kt,Jt);if(!zo&&(Rf(Do)||Za&&Rf(Gs))){var Nu=Va.next();Po=rt.get(wu);Fo=it.get(wu);Bo=at.get(wu);Ro=ot.get(wu);es=St.get(wu);ts=st.get(wu);rs=ut.get(wu);is=Ct.get(wu);ns=dt.get(wu);Oo=lt.get(wu);Vo=ft.get(wu);jo=ht.get(wu);Uo=vt.get(wu)&&is!=="center";as=Tt.get(wu);Go=ct.get(wu);Do=gh(Do);Do=Df(Do,as);Fo=Xf(Fo,ao);jo=Xf(jo,ao);os=i.measureText(Do,Po,ts);ss=os.width;us=os.height;uh(Xa,Nu.end,to,ro,no,io,so,fo,Do,Po,Fo,Bo,Ro,es,ts,rs,is,ns,Oo,0,Vo,ss,us);if(Za){Xs=ii.get(wu);Ws=ni.get(wu);Ys=ai.get(wu);Hs=oi.get(wu);cu=Si.get(wu);qs=si.get(wu);Zs=ui.get(wu);_u=Ci.get(wu);ru=di.get(wu);$s=li.get(wu);Ks=fi.get(wu);Js=hi.get(wu);tu=vi.get(wu)&&_u!=="center";gu=Ti.get(wu);iu=ci.get(wu);Gs=gh(Gs);Gs=Df(Gs,gu);Ws=Xf(Ws,gs);Js=Xf(Js,gs);pu=i.measureText(Gs,Xs,qs);yu=pu.width;mu=pu.height;uh(Xa,Nu.start,vs,ds,_s,cs,ys,bs,Gs,Xs,Ws,Ys,Hs,cu,qs,Zs,_u,ru,$s,0,Ks,yu,mu)}if(jo||Za&&Js){Iu=ja.next();lh(Xa,Iu.end,to,ro,no,io,so,fo,Bo,Ro,es,is,ns,Oo,Vo,jo,ss,us);if(Za){lh(Xa,Iu.start,vs,ds,_s,cs,ys,bs,Ys,Hs,cu,_u,ru,$s,Ks,Js,yu,mu)}if(Uo||Za&&tu){Iu=ja.next();fh(Xa,Iu.end,to,ro,no,io,so,fo,Bo,Ro,es,is,ns,Oo,Vo,jo);if(Za){fh(Xa,Iu.start,vs,ds,_s,cs,ys,bs,Ys,Hs,cu,_u,ru,$s,Ks,Js)}}}if(Rf(Go)||Za&&Rf(iu)){var Lu=Va.next();Xo=_t.get(wu);Wo=gt.get(wu);Yo=pt.get(wu);Ho=yt.get(wu);qo=mt.get(wu);Zo=xt.get(wu);Qo=Et.get(wu);$o=bt.get(wu);Ko=At.get(wu);Jo=wt.get(wu);Go=gh(Go);Go=Df(Go,as);Wo=Xf(Wo,ao);Jo=Xf(Jo,ao);ls=i.measureText(Go,Xo,qo);fs=ls.width;hs=ls.height;var zu=0;if(is==="bottom"){$o+=Oo+Vo*2;if(es){zu+=us*Ro*no*2}else{$o+=us*Bo}}uh(Xa,Lu.end,to,ro,no,io,so,fo,Go,Xo,Wo,Yo,Ho,es,qo,Zo,"bottom",Qo,$o,zu,Ko,fs,hs);if(Za){nu=_i.get(wu);au=gi.get(wu);ou=pi.get(wu);su=yi.get(wu);uu=mi.get(wu);lu=xi.get(wu);fu=Ei.get(wu);hu=bi.get(wu);vu=Ai.get(wu);du=wi.get(wu);iu=gh(iu);iu=Df(iu,gu);au=Xf(au,gs);du=Xf(du,gs);xu=i.measureText(iu,nu,uu);bu=xu.width;Au=xu.height;var Du=0;if(is==="bottom"){hu+=$s+Ks*2;if(cu){Du+=mu*Hs*_s*2}else{hu+=mu*Ys}}uh(Xa,Lu.start,vs,ds,_s,cs,ys,bs,iu,nu,au,ou,su,cu,uu,lu,"bottom",fu,hu,Du,vu,bu,Au)}if(Jo||Za&&du){Iu=ja.next();lh(Xa,Iu.end,to,ro,no,io,so,fo,Yo,Ho,es,"bottom",Qo,$o,Ko,Jo,fs,hs);if(Za){lh(Xa,Iu.start,vs,ds,_s,cs,ys,bs,ou,su,cu,"bottom",fu,hu,vu,du,bu,Au)}}}}if(co||Za&&Es){var Pu=Ua.next();_o=Be.get(wu);go=Re.get(wu);th(Pu.end,to,ro,no,"circle",null,io,co,_o,0);if(Za){Ss=Or.get(wu);Cs=Vr.get(wu);th(Pu.start,vs,ds,_s,"circle",null,cs,Es,Ss,0)}if(go||Za&&Cs){var Fu=Ga.next();po=Oe.get(wu);th(Fu.end,to,ro,no,"circle",null,io,go,_o+po,0);if(Za){Ts=jr.get(wu);th(Fu.end,vs,ds,_s,"circle",null,cs,Cs,Ss+Ts,0)}}}if(Za){Qa=E.get(wu);eo=S.get(wu);Oa.setGlobalAnimation(Qa,Ja,eo);Va.setGlobalAnimation(Qa,Ja,eo);ja.setGlobalAnimation(Qa,Ja,eo);Ua.setGlobalAnimation(Qa,Ja,eo);Ga.setGlobalAnimation(Qa,Ja,eo)}i.storeBlock(Su,Oa);i.storeBlock(Cu,Va);i.storeBlock(Tu,ja);i.storeBlock(Mu,Ua);i.storeBlock(ku,Ga)}}for(var Bu=0,Ru=x.length;Bu<Ru;++Bu){var Ou=void 0;var Vu=void 0;var ju=void 0;var Uu=void 0;var Gu=void 0;var Xu=void 0;var Wu=void 0;var Yu=void 0;var Hu=void 0;var qu=void 0;var Zu=void 0;var $u=void 0;var Ku=void 0;var Ju=void 0;var Qu=void 0;var el=void 0;var tl=void 0;var rl=void 0;var il=void 0;var nl=void 0;var al=void 0;var ol=void 0;var sl=void 0;var ul=void 0;var ll=void 0;var fl=void 0;var hl=void 0;var vl=void 0;var dl=void 0;var cl=void 0;var _l=void 0;var gl=void 0;var pl=void 0;var yl=void 0;var ml=void 0;var xl=void 0;var bl=void 0;var Al=void 0;var wl=void 0;var El=void 0;var Sl=void 0;var Cl=void 0;var Tl=void 0;var Ml=void 0;var kl=void 0;var Il=void 0;var Nl=void 0;var Ll=void 0;var zl=void 0;var Dl=void 0;var Pl=void 0;var Fl=void 0;var Bl=void 0;var Rl=void 0;var Ol=void 0;var Vl=void 0;var jl=void 0;var Ul=void 0;var Gl=void 0;var Xl=void 0;var Wl=void 0;var Yl=void 0;var Hl=void 0;var ql=void 0;var Zl=void 0;var $l=void 0;var Kl=void 0;var Jl=void 0;var Ql=void 0;var ef=void 0,tf=void 0,rf=void 0,nf=void 0,af=void 0,of=void 0,sf=void 0,uf=void 0,lf=void 0,ff=void 0,hf=void 0,vf=void 0,df=void 0,cf=void 0,_f=void 0,gf=void 0,pf=void 0,yf=void 0,mf=void 0,xf=void 0,bf=void 0,Af=void 0,wf=void 0,Ef=void 0;var Sf=void 0,Cf=void 0,Tf=void 0,Mf=void 0,kf=void 0,If=void 0,Nf=void 0,Lf=void 0,zf=void 0,Pf=void 0,Ff=void 0,Bf=void 0,Of=void 0,jf=void 0,Wf=void 0,Kf=void 0,Qf=void 0,ih=void 0,nh=void 0,ah=void 0,oh=void 0,hh=void 0,vh=void 0,dh=void 0;var ch=x[Bu];var _h=ch*ca;var yh=_h+la;var mh=_h+fa;var xh=_h+ha;var bh=_h+va;Gu=Ni.get(ch);if(Gu){i.freeBlock(yh);i.freeBlock(mh);i.freeBlock(xh);i.freeBlock(bh)}else{Yu=Li.get(ch);Vu=Mi.get(ch);ju=ki.get(ch);$u=w.get(Vu);Ku=w.get(ju);Ju=$u>0;Qu=Ku>0;if(Qu){Hu=Ku;qu=E.get(ju);Zu=S.get(ju)}else if(Ju){Hu=$u;qu=E.get(Vu);Zu=S.get(Vu)}else{Hu=zi.get(ch);qu=Di.get(ch);Zu=Pi.get(ch)}Ou="e"+ch;Xu=Hu>0;Wu=ph(Yu,Xa.depthInfo);Oa.reset(Qs,Xu,Wu.edgeBody,Ou);Va.reset(eu,Xu,Wu.edgeText,Ou);ja.reset(Qs,Xu,Wu.edgeTextBackground,Ou);Ua.reset(Qs,Xu,Wu.edgeHalo,Ou);Uu=Ii.get(ch);tl=Bi.get(ch);rl=Ui.get(ch);el=Fi.get(ch);il=Ri.get(ch);nl=Oi.get(ch);ol=Vi.get(ch);al=ji.get(ch);ul=Gi.get(ch);sl=Xi.get(ch);ll=Wi.get(ch);fl=Yi.get(ch);hl=Hi.get(ch);vl=qi.get(ch);cl=$i.get(ch);pl=Qi.get(ch);yl=en.get(ch);ml=cn.get(ch);xl=C.get(Vu);bl=T.get(Vu);Al=k.get(Vu);wl=N.get(Vu);El=C.get(ju);Sl=T.get(ju);Tl=k.get(ju);Cl=N.get(ju);if(tl==="source"){tl=I.get(Vu)}else if(tl==="target"){tl=I.get(ju)}ul=Xf(ul,tl);if(Xu){Il=kn.get(ch);Nl=Dn.get(ch);kl=Mn.get(ch);Ll=In.get(ch);zl=Nn.get(ch);Pl=Ln.get(ch);Dl=zn.get(ch);Bl=Pn.get(ch);Fl=Fn.get(ch);Rl=Bn.get(ch);Ol=Rn.get(ch);Vl=On.get(ch);jl=Vn.get(ch);Gl=Un.get(ch);if(Ju){Yl=Mt.get(Vu);Hl=kt.get(Vu);ql=Nt.get(Vu);Zl=zt.get(Vu)}else{Yl=xl;Hl=bl;ql=Al;Zl=wl}if(Qu){$l=Mt.get(ju);Kl=kt.get(ju);Jl=Nt.get(ju);Ql=zt.get(ju)}else{$l=El;Kl=Sl;Jl=Tl;Ql=Cl}if(Il==="source"){Il=Ju?Lt.get(Vu):I.get(Vu)}else if(Il==="target"){Il=Qu?Lt.get(ju):I.get(ju)}Bl=Xf(Bl,Il)}var Ah=Vu===ju;var wh=Xa.input;var Eh=Xa.output;var Sh=Xa.inputPrev;var Ch=Xa.outputPrev;{wh.width=el;wh.shapeType=il;wh.shapeStyle=al;wh.shapeTail=ol;wh.shapeHead=nl;wh.sourceRadius=Al;wh.targetRadius=Tl;wh.source=Vu;wh.sourceX=xl;wh.sourceY=bl;wh.sourceShape=wl;wh.target=ju;wh.targetX=El;wh.targetY=Sl;wh.targetShape=Cl;wh.curvature=Uu;wh.isSelfLoop=Ah;wh.badgesAttributes=Ma;wh.view=a;wh.adjustAnchors=hl;Gf(wh,Eh);ef=Eh.bodyType;tf=Eh.bodyX;rf=Eh.bodyY;nf=Eh.bodyLength;af=Eh.bodyWidth;of=Eh.bodyAngle;sf=Eh.tailType;uf=Eh.tailX;lf=Eh.tailY;ff=Eh.tailLength;hf=Eh.tailWidth;vf=Eh.tailAngle;df=Eh.headType;cf=Eh.headX;_f=Eh.headY;gf=Eh.headLength;pf=Eh.headWidth;yf=Eh.headAngle;mf=Eh.textX;xf=Eh.textY;bf=Eh.textAngle;Af=Eh.availableSpace;wf=Eh.dash;Ef=Eh.gap;Uu=Eh.curvature}if(Xu){Sh.width=kl;Sh.shapeType=Ll;Sh.shapeStyle=Dl;Sh.shapeTail=Pl;Sh.shapeHead=zl;Sh.sourceRadius=ql;Sh.targetRadius=Jl;Sh.source=Vu;Sh.sourceX=Yl;Sh.sourceY=Hl;Sh.sourceRadius=ql;Sh.target=ju;Sh.targetX=$l;Sh.targetY=Kl;Sh.targetRadius=Jl;Sh.curvature=Uu;Sh.isSelfLoop=Ah;Sh.badgesAttributes=Ra;Sh.view=a;Sh.adjustAnchors=Vl;Gf(Sh,Ch);Sf=Ch.bodyType;Cf=Ch.bodyX;Tf=Ch.bodyY;Mf=Ch.bodyLength;kf=Ch.bodyWidth;If=Ch.bodyAngle;Nf=Ch.tailType;Lf=Ch.tailX;zf=Ch.tailY;Pf=Ch.tailLength;Ff=Ch.tailWidth;Bf=Ch.tailAngle;Of=Ch.headType;jf=Ch.headX;Wf=Ch.headY;Kf=Ch.headLength;Qf=Ch.headWidth;ih=Ch.headAngle;nh=Ch.textX;ah=Ch.textY;oh=Ch.textAngle;hh=Eh.availableSpace;vh=Ch.dash;dh=Ch.gap;Ml=Ch.curvature;if(nf<.001){bf=oh}else if(Mf<.001){oh=bf}}if(cl||Xu&&Gl){var Th=void 0,Mh=void 0,kh=void 0,Ih=void 0,Nh=void 0,Lh=void 0,zh=void 0,Dh=void 0,Ph=void 0,Fh=void 0,Bh=void 0;var Rh=void 0,Oh=void 0,Vh=void 0,jh=void 0,Uh=void 0,Gh=void 0,Xh=void 0,Wh=void 0,Yh=void 0,Hh=void 0,qh=void 0;_l=Ki.get(ch);gl=Ji.get(ch);Th=el*Da;Mh=Pa;kh=af*za;Ih=hf*za;Nh=pf*za;Lh=_l;zh=null;Dh=0;Ph=Math.max(gl,fl);Fh=Eh.dash;Bh=Eh.gap;if(Xu){Xl=Gn.get(ch);Wl=Xn.get(ch);Rh=kl*Da;Oh=Pa;Vh=kf*za;jh=Ff*za;Uh=Qf*za;Gh=Xl;Xh=null;Wh=0;Yh=Math.max(Wl,Ol);Hh=Ch.dash;qh=Ch.gap}rh(Xu,Oa,Uu,Ah,ef,tf,rf,nf,kh,of,sf,uf,lf,ff,Ih,vf,df,cf,_f,gf,Nh,yf,Lh,rl,zh,Dh,ll,Ph,Fh,Bh,Mh,Th,Sf,Cf,Tf,Mf,Vh,If,Nf,Lf,zf,Pf,jh,Bf,Of,jf,Wf,Kf,Uh,ih,Gh,Nl,Xh,Wh,Rl,Yh,Hh,qh,Oh,Rh)}{rh(Xu,Oa,Uu,Ah,ef,tf,rf,nf,af,of,sf,uf,lf,ff,hf,vf,df,cf,_f,gf,pf,yf,tl,rl,ul,sl,ll,fl,wf,Ef,0,0,Sf,Cf,Tf,Mf,kf,If,Nf,Lf,zf,Pf,Ff,Bf,Of,jf,Wf,Kf,Qf,ih,Il,Nl,Bl,Fl,Rl,Ol,vh,dh,0,0)}if(vl||Xu&&jl){wh.width=el;wh.shapeType="line";wh.shapeStyle="plain";wh.shapeTail=null;wh.shapeHead=null;wh.sourceRadius=Al;wh.targetRadius=Tl;wh.source=Vu;wh.sourceX=xl;wh.sourceY=bl;wh.sourceShape=wl;wh.target=ju;wh.targetX=El;wh.targetY=Sl;wh.targetShape=Cl;wh.curvature=Uu;wh.isSelfLoop=Ah;wh.badgesAttributes=Ma;wh.view=a;wh.adjustAnchors=hl;Gf(wh,Eh);dl=Zi.get(ch);if(Xu){Sh.width=el;Sh.shapeType="line";Sh.shapeStyle="plain";Sh.shapeTail=null;Sh.shapeHead=null;Sh.sourceRadius=ql;Sh.targetRadius=Jl;Sh.source=Vu;Sh.sourceX=Yl;Sh.sourceY=Hl;Sh.sourceShape=wl;Sh.target=ju;Sh.targetX=$l;Sh.targetY=Kl;Sh.targetShape=Ql;Sh.curvature=Uu;Sh.isSelfLoop=Ah;Sh.badgesAttributes=Ra;Sh.view=a;Sh.adjustAnchors=Vl;Gf(Sh,Ch);Ul=jn.get(ch)}var Zh=Eh;var $h=Ch;rh(Xu,Ua,Uu,Ah,Zh.bodyType,Zh.bodyX,Zh.bodyY,Zh.bodyLength,Zh.bodyWidth,Zh.bodyAngle,Zh.tailType,Zh.tailX,Zh.tailY,Zh.tailLength,Zh.tailWidth,Zh.tailAngle,Zh.headType,Zh.headX,Zh.headY,Zh.headLength,Zh.headWidth,Zh.headAngle,vl,rl,vl,dl,ll,fl,Zh.dash,Zh.gap,0,0,$h.bodyType,$h.bodyX,$h.bodyY,$h.bodyLength,$h.bodyWidth,$h.bodyAngle,$h.tailType,$h.tailX,$h.tailY,$h.tailLength,$h.tailWidth,$h.tailAngle,$h.headType,$h.headX,$h.headY,$h.headLength,$h.headWidth,$h.headAngle,jl,Nl,jl,Ul,Rl,Ol,$h.dash,$h.gap,0,0)}if(!pl){Uf(Fa,Xa,i,Xu,Va,ja,ch,mf,xf,bf,Af,rl,el,tl,nh,ah,oh,hh,Nl,kl,Il,en,tn,rn,an,on,nn,sn,un,vn,ln,fn,hn,dn,Cn,Wn,Yn,Hn,Zn,$n,qn,Kn,Jn,ra,Qn,ea,ta,ia,Ca);Uf(Ba,Xa,i,Xu,Va,ja,ch,mf,xf,bf,Af,rl,el,tl,nh,ah,oh,hh,Nl,kl,Il,cn,_n,gn,yn,mn,pn,xn,bn,Sn,An,wn,En,Tn,Cn,da,_a,ga,ya,ma,pa,xa,ba,Sa,Aa,wa,Ea,Ta,Ca)}if(Xu){Oa.setGlobalAnimation(qu,Hu,Zu);Va.setGlobalAnimation(qu,Hu,Zu);ja.setGlobalAnimation(qu,Hu,Zu);Ua.setGlobalAnimation(qu,Hu,Zu)}i.storeBlock(yh,Oa);i.storeBlock(mh,Va);i.storeBlock(xh,ja);i.storeBlock(bh,Ua)}}}function Uf(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p,y,m,x,b,A,w,E,S,C,T,M,k,I,N,L,z,D,P,F,B,R,O,V,j,U,G,X,W,Y,H,q){var Z,$,K,J,Q,ee,te,re,ie,ne,ae,oe,se,ue,le,fe,he;var ve,de,ce,_e,ge,pe,ye,me,xe,be,Ae,we,Ee,Se,Ce,Te,Me;Z=b.get(o);if(i){ve=P.get(o)}if(Rf(Z)||i&&Rf(ve)){var ke=n.next();$=A.get(o);K=w.get(o);J=E.get(o);Q=S.get(o);ee=C.get(o);te=T.get(o);re=M.get(o);ie=k.get(o);ne=I.get(o);ae=N.get(o);oe=L.get(o);se=z.get(o);ue=D.get(o);Z=gh(Z);Z=Df(Z,ue);K=Xf(K,d);oe=Xf(oe,d);le=r.measureText(Z,$,te);fe=le.width;he=le.height;hh(t,ke.end,e,s,u,l,h,v,Z,$,K,J,Q,ee,te,re,ie,ne,ae,oe,se,fe,he,f);if(i){de=F.get(o);ce=B.get(o);_e=R.get(o);ge=O.get(o);pe=V.get(o);ye=j.get(o);me=U.get(o);xe=G.get(o);be=X.get(o);Ae=W.get(o);we=Y.get(o);Ee=H.get(o);Se=q.get(o);ve=gh(ve);ve=Df(ve,Se);ce=Xf(ce,x);we=Xf(we,x);Ce=r.measureText(ve,de,ye);Te=Ce.width;Me=Ce.height;hh(t,ke.start,e,c,_,g,y,m,ve,de,ce,_e,ge,pe,ye,me,xe,be,Ae,we,Ee,Te,Me,p)}if(oe||i&&we){var Ie=a.next();vh(t,Ie.end,e,s,u,l,h,v,Z,$,K,J,Q,ee,te,ie,ne,ae,oe,se,fe,he,f);if(i){vh(t,Ie.start,e,c,_,g,y,m,ve,de,ce,_e,ge,pe,ye,xe,be,Ae,we,Ee,Te,Me,p)}}}}function Gf(e,t){var r=e.width;var i=e.shapeStyle;var n=e.shapeTail;var a=e.shapeHead;var o=e.sourceRadius;var s=e.targetRadius;var u=e.isSelfLoop;var l=e.shapeType;var f=e.source;var h=e.sourceX;var v=e.sourceY;var d=e.sourceShape;var c=e.target;var _=e.targetX;var g=e.targetY;var p=e.targetShape;var y=e.curvature;var m=e.badgesAttributes;var x=e.view;var b=e.adjustAnchors;var A,w,E,S;var C,T,M,k;var I,N,L,z,D,P;var F,B,R,O,V,j;var U,G,X,W,Y,H;var q,Z,$,K,J,Q;var ee,te,re,ie,ne;var ae=Xa[i];var oe=_h(r,Ra);var se=_-h;var ue=g-v;var distance=Math.sqrt(se*se+ue*ue)+Ca;var le=0;var fe=0;var he=0;var ve=o;var de=s;K=0;W=0;if(n){K=oe;fe+=K;le+=1}if(a){W=oe;he+=W;le+=1}if(u){y+=Math.round(o/2);var ce=y*Va;A=h-ce;w=v;E=h;S=v+ce;ne=ce;if(l==="triangle"||a){if(b){de=Of(E,S,x,c,_,g,s,p,m)}he+=de}}else{var _e=(h+_)/2;var ge=(v+g)/2;var pe=distance/2;var ye=ue/distance;var me=-se/distance;var xe=y*(distance/Ua)*2;A=_e+ye*xe;w=ge+me*xe;E=A;S=w;ne=Math.sqrt(xe*xe+pe*pe)+Ca;if(n||a||l==="triangle"){if(b){ve=Of(A,w,x,f,h,v,o,d,m);de=Of(E,S,x,c,_,g,s,p,m)}var be=distance-ve-de;var Ae=Math.min(be/le,oe);if(n){fe+=Math.max(ve+Ae-K,0)}if(a){he+=Math.max(de+Ae-W,0)}else if(l==="triangle"&&be>0){he+=de}}}C=(A-h)/ne;T=(w-v)/ne;M=(E-_)/ne;k=(S-g)/ne;I=h+C*fe;N=v+T*fe;L=_+M*he;z=g+k*he;var we=L-I;var Ee=z-N;F=l;V=r;if(u){B=h;R=v;O=he*.95;j=Oa}else{B=(I+L)/2;R=(N+z)/2;O=Math.sqrt(we*we+Ee*Ee)+Ca;j=Math.atan2(-Ee,we);var Se=y*(O/Ua)*2;A=B+Ee/O*Se;w=R-we/O*Se;E=A;S=w}D=ae.dash;P=ae.gap;q=n;J=oe;Z=I-C*K/2;$=N-T*K/2;Q=Math.atan2(T,-C);U=a;Y=oe;G=L-M*W/2;X=z-k*W/2;H=Math.atan2(k,-M);re=j;if(u){ee=ch(.5,I,L,A,E);te=ch(.5,N,z,w,S);ie=0}else{if(y!==0){ee=dh(.5,I,L,A);te=dh(.5,N,z,w);ie=0}else{var Ce=fe?fe:o;var Te=he?he:s;var Me=_-h;var ke=g-v;var Ie=Math.sqrt(Me*Me+ke*ke)+Ca;var Ne=Ce/Ie;var Le=Te/Ie;var ze=h+Me*Ne;var De=v+ke*Ne;var Pe=_-Me*Le;var Fe=g-ke*Le;ee=(ze+Pe)/2;te=(De+Fe)/2;ie=Ie-Ce-Te}}t.curveControl1X=A;t.curveControl1Y=w;t.curveControl2X=E;t.curveControl2Y=S;t.sourceToControl1X=C;t.sourceToControl1Y=T;t.targetToControl2X=M;t.targetToControl2Y=k;t.curveStartX=I;t.curveStartY=N;t.curveEndX=L;t.curveEndY=z;t.dash=D;t.gap=P;t.bodyType=F;t.bodyX=B;t.bodyY=R;t.bodyLength=O;t.bodyWidth=V;t.bodyAngle=j;t.headType=U;t.headX=G;t.headY=X;t.headLength=W;t.headWidth=Y;t.headAngle=H;t.tailType=q;t.tailX=Z;t.tailY=$;t.tailLength=K;t.tailWidth=J;t.tailAngle=Q;t.textX=ee;t.textY=te;t.textAngle=re;t.availableSpace=ie;t.distanceToControl=ne;t.curvature=y;return t}function Xf(e,t){if(e==="inherit"){return Array.isArray(t)?t[0]:t}else{return e}}function Wf(e,t){if(!Array.isArray(e)){return e}else{var r=t/(2*Math.PI)*e.length|0;return e[r]}}function Yf(e){return Array.isArray(e)}function Hf(e,t){if(Yf(t)){e.fillColor=null;e.pattern.type=nu;e.pattern.attributes.colors=t.join(";");e.patternScale=1;e.patternMask=null}else{e.fillColor=t;e.pattern.type=tu}}function qf(e,t,r,i,n,a,o){e.pattern.type=au;e.pattern.attributes.text=gh(t);e.pattern.attributes.font=r;e.pattern.attributes.style=a;e.pattern.attributes.size="sdf";e.patternMinVisibleSize=o;e.patternMask=i;e.patternScale=n;e.patternSdf=false}function Zf(e,t,r,i,n,a){var o=r&&!i;e.pattern.type=ru;e.pattern.attributes.image=t;e.pattern.attributes.scaled=o;e.pattern.attributes.duplicated=i;e.patternScale=o?n:0;e.patternMinVisibleSize=a;e.patternMask=null;e.patternSdf=false}function $f(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p,y,m,x,b,A,w,E,S,C,T,M,k,I,N,L,z,D,P,F,B,R,O,V){var j;var U;var G;var X;var W;var Y;var H;var q;var Z;var $;var K;var J;var Q;var ee;var te;var re;u=Wf(u,n);j=b.get(r);U=w.get(r);if(i){u=Wf(d,n);Z=D.get(r);$=F.get(r)}var ie=j;var ne=Rf(U);if(ie||ne){var ae=t.next();Kf(ae.end,r,n,a,o,s,u,l,_,g,p,y,m,x);if(i){Kf(ae.start,r,n,f,h,v,d,c,M,k,I,N,L,z)}if(j){G=e.getImage(j);X=A.get(r);Zf(ae.end,G,true,false,X,0);if(i){K=e.getImage(Z);J=P.get(r);Zf(ae.start,K,true,false,J,0)}}if(ne){if(ie){ae=t.next();Kf(ae.end,r,n,a,o,s,u,l,_,g,p,y,m,x);ae.end.fillColor=null;ae.end.strokeColor=null;if(i){Kf(ae.start,r,n,f,h,v,d,c,M,k,I,N,L,z);ae.start.fillColor=null;ae.start.strokeColor=null}}W=S.get(r);Y=E.get(r);H=T.get(r);q=C.get(r);Y=Xf(Y,u);qf(ae.end,U,W,Y,H,q,0);if(i){Q=R.get(r);ee=B.get(r);te=V.get(r);re=O.get(r);ee=Xf(ee,d);qf(ae.start,$,Q,ee,te,re,0)}}}}function Kf(e,t,r,i,n,a,o,s,u,l,f,h,v,d){var c=u.get(t);var _=l.get(t);var g=f.get(t);var p=h.get(t);var y=v.get(t);var m=d.get(t);c=Xf(c,o);y=Xf(y,o);var x=a*_*2;e.x=i;e.y=n;e.opacity=s;e.minVisibleSize=p;e.offsetAngle=r;e.fillColor=c;e.strokeColor=y;e.strokeWidthAbsolute=m;e.offsetScaled=a*g;e.thicknessScaled=x;e.lengthScaled=x;e.symbolicSize=a*2;e.offsetAffectedByAngle=false;e.strokeMinVisibleSize=0;e.patternMinVisibleSize=0;e.shape="circle";e.dashLength=0;e.gapLength=0;e.patternSdf=false;e.shapeStart=0;e.shapeEnd=1;e.angle=0;e.angleAffectedByView=false;e.lengthAbsolute=0;e.thicknessAbsolute=0;e.strokeWidthScaled=0;e.offsetAbsolute=0;e.dashOffset=0;e.adjustAngle=false;e.isSelfLoop=false;e.curvature=0}function Jf(e,t,r,i,n,a,o,s,u,l,f,h,v){if(!e.bodyPatternAssigned){e.bodyPatternAssigned=true;return t.getCurrentElement()}else{var d=t.next();Qf(d.end,i,n,a,o,s);if(r){Qf(d.start,u,l,f,h,v)}return d}}function Qf(e,t,r,i,n,a){e.x=t;e.y=r;e.shape=n;e.opacity=a;e.lengthScaled=i*2;e.thicknessScaled=i*2;e.symbolicSize=i*2;e.strokeWidthScaled=0;e.offsetScaled=0;e.lengthAbsolute=0;e.thicknessAbsolute=0;e.strokeWidthAbsolute=0;e.offsetAbsolute=0;e.strokeColor=null;e.strokeWidthAbsolute=0;e.strokeMinVisibleSize=0;e.offsetAffectedByAngle=false;e.offsetAngle=0;e.angle=0;e.angleAffectedByView=false;e.shapeStart=0;e.shapeEnd=1;e.dashLength=0;e.gapLength=0;e.dashOffset=0;e.patternMask=null;e.fillColor=null;e.minVisibleSize=0;e.strokeWidthScaled=false;e.patternSdf=false;e.adjustAngle=false;e.isSelfLoop=false;e.curvature=0}function eh(e,t,r,i,n,a,o,s,u,l){e.x=t;e.y=r;e.shape=i;e.lengthScaled=n*2;e.thicknessScaled=n*2;e.lengthAbsolute=0;e.thicknessAbsolute=0;e.strokeColor=a;e.strokeWidthAbsolute=o+s;e.strokeMinVisibleSize=u;e.opacity=l;e.symbolicSize=n*2;e.offsetScaled=0;e.offsetAbsolute=0;e.strokeWidthScaled=0;e.offsetAffectedByAngle=false;e.offsetAngle=0;e.angle=0;e.angleAffectedByView=false;e.shapeStart=0;e.shapeEnd=1;e.dashLength=0;e.gapLength=0;e.dashOffset=0;e.fillColor="transparent";e.minVisibleSize=0;e.patternScale=0;e.pattern.type=tu;e.patternMinVisibleSize=0;e.patternSdf=false;e.adjustAngle=false;e.isSelfLoop=false;e.curvature=0}function th(e,t,r,i,n,a,o,s,u,l){e.x=t;e.y=r;e.lengthScaled=i*2;e.thicknessScaled=i*2;e.shape=n;e.fillColor=a;e.opacity=o;e.strokeColor=s;e.strokeWidthAbsolute=u;e.strokeMinVisibleSize=l;e.symbolicSize=i*2;e.offsetScaled=0;e.offsetAbsolute=0;e.strokeWidthScaled=0;e.lengthAbsolute=0;e.thicknessAbsolute=0;e.offsetAffectedByAngle=false;e.offsetAngle=0;e.angle=0;e.angleAffectedByView=false;e.shapeStart=0;e.shapeEnd=1;e.dashLength=0;e.gapLength=0;e.dashOffset=0;e.minVisibleSize=0;e.patternScale=0;e.pattern.type=tu;e.patternMinVisibleSize=0;e.patternSdf=false;e.adjustAngle=false;e.isSelfLoop=false;e.curvature=0}function rh(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p,y,m,x,b,A,w,E,S,C,T,M,k,I,N,L,z,D,P,F,B,R,O,V,j,U,G,X,W,Y,H,q,Z,$,K,J,Q,ee,te,re,ie,ne,ae){var oe=r===0?1:ja;var se;if(f||e&&R){se=t.next();f="arrow";R="arrow";{oh(se.end,0,false,f,h,v,d,_,c,A,w,E,S,C,T,0,1,0,0,0,I,N)}if(e){oh(se.start,0,false,R,O,V,j,G,U,$,K,J,Q,ee,te,0,1,0,0,0,ne,ae)}}if(g||e&&X){se=t.next();g="arrow";X="arrow";{oh(se.end,0,false,g,p,y,m,b,x,A,w,E,S,C,T,0,1,0,0,0,I,N)}if(e){oh(se.start,0,false,X,W,Y,H,Z,q,$,K,J,Q,ee,te,0,1,0,0,0,ne,ae)}}var ue=1/oe;var le=0;var fe=0;var he;var ve=0;for(var de=0;de<oe;++de){se=t.next();he=ve;ve+=ue;{oh(se.end,r,i,n,a,o,s,l,u,A,w,E,S,C,T,he,ve,M,k,le,I,N);if(M&&oe>1){le+=ih(i,he,ve,r,s,u)}}if(e){oh(se.start,r,i,L,z,D,P,B,F,$,K,J,Q,ee,te,he,ve,re,ie,fe,ne,ae);if(re&&oe>1){fe+=ih(i,he,ve,r,P,F)}}}}function ih(e,t,r,i,n,a){if(e){return ah(t,r,i,n)/a}else{return nh(t,r,i,n)/a}}function nh(e,t,r,i){var n=0;var a=0;var o=i;var s=0;var u=i/2;var l=i/Ua*2*r;var f=dh(e,n,o,u);var h=dh(e,a,s,l);var v=dh(t,n,o,u);var d=dh(t,a,s,l);var c=v-f;var _=d-h;return Math.sqrt(c*c+_*_)}function ah(e,t,r,i){var n=r*Va;var a=0;var o=0;var s=0;var u=i;var l=a-n;var f=o;var h=s;var v=u+n;var d=ch(e,a,s,l,h);var c=ch(e,o,u,f,v);var _=ch(t,a,s,l,h);var g=ch(t,o,u,f,v);var p=_-d;var y=g-c;return Math.sqrt(p*p+y*y)}function oh(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p,y,m,x,b){e.curvature=t;e.isSelfLoop=r;e.x=n;e.y=a;e.angle=s;e.thicknessScaled=u;e.lengthScaled=o;e.shape=i;e.fillColor=l;e.strokeColor=h;e.strokeWidthAbsolute=v;e.opacity=f;e.symbolicSize=u;e.minVisibleSize=c;e.strokeMinVisibleSize=d;e.offsetScaled=b;e.offsetAbsolute=x;e.strokeWidthScaled=0;e.lengthAbsolute=0;e.thicknessAbsolute=0;e.angleAffectedByView=true;e.offsetAffectedByAngle=false;e.offsetAngle=1.5707963267948966;e.patternScale=0;e.pattern.type=tu;e.patternMinVisibleSize=0;e.patternSdf=false;e.shapeStart=_;e.shapeEnd=g;e.dashLength=p;e.gapLength=y;e.dashOffset=m;e.adjustAngle=false}function sh(e,t,r,i,n,a,o,s,u,l){var f=i*2*1.1;e.x=t;e.y=r;e.lengthScaled=f;e.thicknessScaled=f;e.shape=n;e.fillColor=u;e.opacity=a;e.symbolicSize=i*2;e.minVisibleSize=l;e.offsetAbsolute=o?s/2:0;e.offsetScaled=i*.15;e.strokeWidthAbsolute=0;e.strokeWidthScaled=0;e.lengthAbsolute=0;e.thicknessAbsolute=0;e.offsetAffectedByAngle=false;e.offsetAngle=1.5707963267948966;e.strokeColor=null;e.strokeMinVisibleSize=0;e.angle=0;e.angleAffectedByView=false;e.shapeStart=0;e.shapeEnd=1;e.dashLength=0;e.gapLength=0;e.dashOffset=0;e.patternScale=0;e.pattern.type=tu;e.patternMinVisibleSize=0;e.patternSdf=false;e.adjustAngle=false;e.isSelfLoop=false;e.curvature=0}function uh(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p,y,m,x,b,A){var w=0;var E=false;var S=false;var C=false;if(g==="bottom"||g==="top"){S=true}else if(g==="right"||g==="left"){E=true}else{C=true}if(!C){w=o+s+y+x}t.x=r;t.y=i;t.opacity=a;t.minVisibleSize=p;t.symbolicSize=n*2;t.offsetScaled=C?0:n+m;t.offsetAbsolute=C?0:w;t.offsetAffectedByAngle=false;t.offsetAngle=Wa[g];t.pattern.type=ou;t.pattern.attributes.text=u;t.pattern.attributes.font=l;t.pattern.attributes.style=c;t.pattern.attributes.align=_;t.pattern.attributes.pixelRatio=e.pixelRatio;t.patternMinVisibleSize=0;t.patternMask=f;if(d){var T=n*v*2,M=A/2*T,k=b/2*T;t.thicknessScaled=T;t.thicknessAbsolute=0;t.pattern.attributes.size="sdf";t.patternScale=1;t.patternSdf=true;if(S){t.offsetScaled+=M}else if(E){t.offsetScaled+=k}}else{var I=h,N=A/2*I,L=b/2*I;t.thicknessScaled=0;t.thicknessAbsolute=I;t.pattern.attributes.size=h;t.patternScale=0;t.patternSdf=false;if(S){t.offsetAbsolute+=N}else if(E){t.offsetAbsolute+=L}}t.lengthScaled=0;t.lengthAbsolute=0;t.shape="square";t.fillColor=null;t.strokeColor=null;t.strokeWidthAbsolute=0;t.strokeWidthScaled=0;t.strokeMinVisibleSize=0;t.angle=0;t.angleAffectedByView=false;t.shapeStart=0;t.shapeEnd=1;t.dashLength=0;t.gapLength=0;t.dashOffset=0;t.adjustAngle=false;t.isSelfLoop=false;t.curvature=0}function lh(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p){var y=0,m=f?n*l*2:u,x=g*m,b=p*m,A=false,w=false,E=false;if(h==="bottom"||h==="top"){w=true}else if(h==="right"||h==="left"){A=true}else{E=true}if(!E){y=o+s+d+c}t.x=r;t.y=i;t.opacity=a;t.minVisibleSize=v;t.symbolicSize=n;t.offsetScaled=E?0:n;t.offsetAbsolute=E?0:y;t.offsetAffectedByAngle=false;t.offsetAngle=Wa[h];if(f){t.lengthScaled=x;t.thicknessScaled=b;t.lengthAbsolute=0;t.thicknessAbsolute=0;if(w){t.offsetScaled+=b/2}else if(A){t.offsetScaled+=x/2}}else{t.lengthScaled=0;t.thicknessScaled=0;t.lengthAbsolute=x;t.thicknessAbsolute=b;if(w){t.offsetAbsolute+=b/2}else if(A){t.offsetAbsolute+=x/2}}t.thicknessAbsolute+=c*2;t.lengthAbsolute+=c*2;t.fillColor=_;t.strokeColor=_;t.strokeWidthAbsolute=0;t.strokeWidthScaled=0;t.pattern.type=tu;t.shape="square";t.strokeMinVisibleSize=0;t.angle=0;t.angleAffectedByView=false;t.shapeStart=0;t.shapeEnd=1;t.dashLength=0;t.gapLength=0;t.dashOffset=0;t.adjustAngle=false;t.isSelfLoop=false;t.curvature=0}function fh(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_){var g=o+s+Math.ceil(d/2)+1;t.x=r;t.y=i;t.opacity=a;t.minVisibleSize=v;t.symbolicSize=n;t.x=r;t.y=i;t.opacity=a;t.minVisibleSize=v;t.symbolicSize=n;t.offsetScaled=n;t.offsetAbsolute=g;t.offsetAffectedByAngle=false;t.offsetAngle=Wa[h];t.angle=Ya[h];t.lengthScaled=0;t.lengthAbsolute=d;t.thicknessScaled=0;t.thicknessAbsolute=d*Ga;t.fillColor=_;t.strokeColor=null;t.strokeWidthAbsolute=0;t.strokeWidthScaled=0;t.pattern.type=tu;t.shape="triangle";t.strokeMinVisibleSize=0;t.angleAffectedByView=false;t.shapeStart=0;t.shapeEnd=1;t.dashLength=0;t.gapLength=0;t.dashOffset=0;t.adjustAngle=false;t.isSelfLoop=false;t.curvature=0}function hh(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p,y,m,x,b,A,w){var E=p+y,S=d?s*v:h,C=A*S/2;t.x=i;t.y=n;t.opacity=o;t.minVisibleSize=g;t.symbolicSize=s;t.angle=a;t.angleAffectedByView=true;t.thicknessScaled=0;t.thicknessAbsolute=0;t.offsetScaled=s/2;t.offsetAbsolute=E;t.offsetAffectedByAngle=true;t.offsetAngle=r;if(d){t.thicknessScaled+=S;t.offsetScaled+=C}else{t.thicknessAbsolute+=S;t.offsetAbsolute+=C}t.pattern.type=ou;t.pattern.attributes.text=u;t.pattern.attributes.font=l;t.pattern.attributes.size="sdf";t.pattern.attributes.style=c;t.pattern.attributes.align=_;t.pattern.attributes.pixelRatio=e.pixelRatio;t.patternMinVisibleSize=0;t.patternScale=1;t.patternSdf=true;t.patternMask=f;t.lengthScaled=0;t.lengthAbsolute=0;t.shape="square";t.fillColor=null;t.strokeColor=null;t.strokeWidthAbsolute=0;t.strokeWidthScaled=0;t.strokeMinVisibleSize=0;t.shapeStart=0;t.shapeEnd=1;t.dashLength=0;t.gapLength=0;t.dashOffset=0;t.adjustAngle=true;t.isSelfLoop=false;t.curvature=0;if(x&&!d&&w>0){t.strokeWidthScaled=b*h/w}}function vh(e,t,r,i,n,a,o,s,u,l,f,h,v,d,c,_,g,p,y,m,x,b,A){var w=g+p,E=d?s*v:h,S=x*E,C=b*E;t.x=i;t.y=n;t.opacity=o;t.minVisibleSize=_;t.symbolicSize=s;t.angle=a;t.angleAffectedByView=true;t.fillColor=y;t.strokeColor=null;t.strokeWidthAbsolute=0;t.lengthScaled=0;t.thicknessScaled=0;t.lengthAbsolute=p*2;t.thicknessAbsolute=p*2;t.offsetScaled=s/2;t.offsetAbsolute=w;t.offsetAffectedByAngle=true;t.offsetAngle=r;if(d){t.lengthScaled+=S;t.thicknessScaled+=C;t.offsetScaled+=C/2}else{t.lengthAbsolute+=S;t.thicknessAbsolute+=C;t.offsetAbsolute+=C/2}t.pattern.type=tu;t.shape="square";t.strokeMinVisibleSize=0;t.strokeWidthScaled=0;t.shapeStart=0;t.shapeEnd=1;t.dashLength=0;t.gapLength=0;t.dashOffset=0;t.adjustAngle=true;t.isSelfLoop=false;t.curvature=0;if(m&&!d&&A>0){t.strokeWidthScaled=x*h/A}}function dh(e,t,r,i){var n=1-e;return n*n*t+2*n*e*i+e*e*r}function ch(e,t,r,i,n){var a=1-e,o=a*a,s=o*a,u=e*e,l=u*e;return s*t+3*o*e*i+3*a*u*n+l*r}function _h(e,t){return e+Math.log(e+1)*t}function gh(value){return value===null?"":value.toString()}function ph(e,t){if(t===void 0)t={};var r=(e+1)*Sa+ya;t.edgeHalo=_a;t.nodeHaloStroke=ga;t.nodeHalo=pa;t.edgeBody=r+ma;t.edgeTextBackground=r+xa;t.edgeText=r+ba;t.nodeBody=r+Aa;t.nodeTextBackground=r+wa;t.nodeText=r+Ea;return t}function yh(e){var t=e.getDepth();if(t===pa||t===ga){return true}return(t-ya)%Sa>=Aa}function mh(e){var t=(e.getDepth()-ya)%Sa;return t>=0&&t!==ma&&t!==Aa}function xh(e){return{_check:Ti,_set:new Function("flexArrays","index","value",["flexArrays.badges."+e+".text.content.set(index, value);","if (value === null) flexArrays.badges."+e+".image.url.set(index, value);"].join("\n")),_get:new Function("flexArrays","index","return flexArrays.badges."+e+".text.content.get(index);"),color:{_flexArray:"white",_check:ki},scale:{_flexArray:.45,_check:ji(.45)},positionScale:{_flexArray:1,_check:Ei},minVisibleSize:{_flexArray:12,_check:ji(12)},image:{_alias:"badges."+e+".image.url",url:{_flexArray:null,_check:Ti},scale:{_flexArray:1,_check:ji(1)}},stroke:{color:{_flexArray:"black",_check:ki},width:{_flexArray:2,_check:ji(2)}},text:{_alias:"badges."+e+".text.content",content:{_flexArray:null,_check:Ti},color:{_flexArray:"black",_check:ki},font:{_flexArray:"Arial",_check:Ni},style:{_flexArray:"normal",_check:Li},scale:{_flexArray:.5,_check:ji(.5)}},threshold:"badges."+e+".minVisibleSize"}}var bh={_check:Ai,_get:function e(t,r){return t.opacity.get(r)===0},_set:function e(t,r,value){t.opacity.set(r,+!value)}};var Ah={x:{_flexArray:0,_check:wi,_storage:"float"},y:{_flexArray:0,_check:wi,_storage:"float"},radius:{_flexArray:5,_check:ji(5),_storage:"float"},color:{_flexArray:"grey",_check:Vi},opacity:{_flexArray:1,_check:Ei},hidden:bh,shape:{_flexArray:"circle",_check:Di},layer:{_flexArray:0,_check:Ci},detectable:{_flexArray:true,_check:Ai},draggable:{_flexArray:true,_check:Ai},layoutable:{_flexArray:true,_check:Ai},innerStroke:{_alias:"outerStroke.color",width:{_flexArray:2,_check:ji(2)},color:{_flexArray:"white",_check:ki},minVisibleSize:{_flexArray:12,_check:ji(12)},threshold:"innerStroke.minVisibleSize"},outerStroke:{_alias:"outerStroke.color",width:{_flexArray:5,_check:ji(5)},color:{_flexArray:null,_check:ki},minVisibleSize:{_flexArray:0,_check:ji(0)},threshold:"outerStroke.minVisibleSize"},badges:{_check:bi,_set:function e(t,r){t.badges.topLeft.text.content.set(r,null);t.badges.topLeft.image.url.set(r,null);t.badges.topRight.text.content.set(r,null);t.badges.topRight.image.url.set(r,null);t.badges.bottomLeft.text.content.set(r,null);t.badges.bottomLeft.image.url.set(r,null);t.badges.bottomRight.text.content.set(r,null);t.badges.bottomRight.image.url.set(r,null)},topLeft:xh("topLeft"),topRight:xh("topRight"),bottomLeft:xh("bottomLeft"),bottomRight:xh("bottomRight")},halo:{_alias:"halo.color",color:{_flexArray:null,_check:Mi},width:{_flexArray:50,_check:ji(50)},strokeColor:{_flexArray:null,_check:Mi},strokeWidth:{_flexArray:1,_check:ji(1)},clustering:{_flexArray:false,_check:Ai},size:"halo.width"},icon:{_alias:"icon.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:"Arial",_check:Ni},color:{_flexArray:"black",_check:Mi},scale:{_flexArray:.7,_check:ji(.7)},style:{_flexArray:"normal",_check:Li},minVisibleSize:{_flexArray:12,_check:ji(12)},threshold:"icon.minVisibleSize"},image:{_alias:"image.url",url:{_flexArray:null,_check:Ti},scale:{_flexArray:1,_check:ji(1)},fit:{_flexArray:true,_check:Ai},tile:{_flexArray:false,_check:Ai},minVisibleSize:{_flexArray:12,_check:ji(12)},rescale:"image.fit",duplicate:"image.tile",threshold:"image.minVisibleSize"},outline:{_alias:"outline.enabled",enabled:{_flexArray:false,_check:Ai},color:{_flexArray:"rgba(0, 0, 0, 0.36)",_check:Mi},minVisibleSize:{_flexArray:12,_check:ji(12)}},text:{_alias:"text.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:"Arial",_check:Ni},color:{_flexArray:"black",_check:ki},size:{_flexArray:12,_check:ji(12)},scale:{_flexArray:.1,_check:Ei},style:{_flexArray:"normal",_check:Li},align:{_flexArray:"center",_check:zi},margin:{_flexArray:10,_check:ji(10)},padding:{_flexArray:2,_check:ji(2)},backgroundColor:{_flexArray:null,_check:ki},tip:{_flexArray:true,_check:Ai},minVisibleSize:{_flexArray:24,_check:ji(24)},scaling:{_flexArray:false,_check:Ai},position:{_flexArray:"bottom",_check:Oi},maxLineLength:{_flexArray:0,_check:Ei},truncateLength:{_flexArray:0,_check:Ei},backgroundArrowBaseSize:"text.margin",backgroundMargin:"text.padding",threshold:"text.minVisibleSize",secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:"Arial",_check:Ni},color:{_flexArray:"black",_check:ki},size:{_flexArray:10,_check:ji(10)},scale:{_flexArray:.08,_check:Ei},style:{_flexArray:"normal",_check:Li},align:{_flexArray:"center",_check:zi},margin:{_flexArray:5,_check:ji(5)},padding:{_flexArray:2,_check:ji(2)},backgroundColor:{_flexArray:null,_check:ki},minVisibleSize:{_flexArray:24,_check:ji(24)},backgroundArrowBaseSize:"text.secondary.margin",backgroundMargin:"text.secondary.padding",threshold:"text.secondary.minVisibleSize"}}};var wh={line:{type:"line",head:null,tail:null,style:"plain"},arrow:{type:"line",head:"arrow",tail:null,style:"plain"},tapered:{type:"triangle",head:null,tail:null,style:"plain"},dashed:{type:"line",head:null,tail:null,style:"dashed"},dotted:{type:"line",head:null,tail:null,style:"dotted"}};var Eh={width:{_flexArray:1,_check:ji(1)},color:{_flexArray:"grey",_check:Ii},opacity:{_flexArray:1,_check:Ei},hidden:bh,minVisibleSize:{_flexArray:0,_check:Ei},threshold:"minVisibleSize",layer:{_flexArray:0,_check:Ci},detectable:{_flexArray:true,_check:Ai},curvature:{_flexArray:0,_check:wi},adjustAnchors:{_flexArray:true,_check:Ai},shape:{_check:Pi,_set:function e(t,r,value){var i=wh[value];var n=i.type;var a=i.style;var o=i.head;var s=i.tail;t.shape.type.set(r,n);t.shape.style.set(r,a);t.shape.head.set(r,o);t.shape.tail.set(r,s)},type:{_flexArray:"line",_check:Fi},head:{_flexArray:null,_check:Bi},tail:{_flexArray:null,_check:Bi},style:{_flexArray:"plain",_check:Ri}},stroke:{color:{_flexArray:"inherit",_check:ki},width:{_flexArray:0,_check:ji(0)},minVisibleSize:{_flexArray:0,_check:Ei}},strokeWidth:"stroke.width",halo:{_alias:"halo.color",color:{_flexArray:null,_check:Mi},width:{_flexArray:10,_check:ji(10)},size:"halo.width"},outline:{_alias:"outline.enabled",enabled:{_flexArray:false,_check:Ai},color:{_flexArray:"rgba(0, 0, 0, 0.36)",_check:Mi},minVisibleSize:{_flexArray:0,_check:Ei}},text:{_alias:"text.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:"Arial",_check:Ni},color:{_flexArray:"black",_check:Mi},size:{_flexArray:12,_check:ji(12)},scale:{_flexArray:1,_check:Ei},style:{_flexArray:"normal",_check:Li},align:{_flexArray:"center",_check:zi},margin:{_flexArray:2,_check:ji(2)},padding:{_flexArray:2,_check:ji(2)},backgroundColor:{_flexArray:null,_check:ki},minVisibleSize:{_flexArray:4,_check:Ei},threshold:"text.minVisibleSize",adjustAngle:{_flexArray:true,_check:Ai},scaling:{_flexArray:false,_check:Ai},maxLineLength:{_flexArray:0,_check:Ei},secondary:{_alias:"text.secondary.content",content:{_flexArray:null,_check:Ti},font:{_flexArray:"Arial",_check:Ni},color:{_flexArray:"black",_check:Mi},size:{_flexArray:12,_check:ji(12)},scale:{_flexArray:.8,_check:Ei},style:{_flexArray:"normal",_check:Li},align:{_flexArray:"center",_check:zi},margin:{_flexArray:2,_check:ji(2)},padding:{_flexArray:2,_check:ji(2)},backgroundColor:{_flexArray:null,_check:ki},minVisibleSize:{_flexArray:4,_check:Ei},threshold:"text.secondary.minVisibleSize"}}};var Sh=function e(t,r){this._attributesManager=t;this._id=r};Sh.prototype.getDefinition=function e(){return this._attributesManager.getAttributeLayerDefinition(this._id)};Sh.prototype.update=function e(t){this._attributesManager.updateAttributeLayer(this._id,t)};Sh.prototype.destroy=function e(){this._attributesManager.destroyAttributeLayer(this._id)};var Ch=function e(t,r){this._graph=t.modules.graph;this._NodeList=t.NodeList;this._EdgeList=t.EdgeList;this._flexArrays={nodes:this._graph.createNodeAttribute({storage:1,name:r}),edges:this._graph.createEdgeAttribute({storage:1,name:r})};this._nodeIndexes=[];this._edgeIndexes=[];this._invalidCache=true};Ch.prototype._getFlexArray=function e(t){return t?this._flexArrays.nodes:this._flexArrays.edges};Ch.prototype._makeElementList=function e(t,r){var i=t?this._NodeList:this._EdgeList;return new i(r)};Ch.prototype._setBit=function e(t,value){var r=this._getFlexArray(t.isNode);var i=t._indexes;var n=[];var a=t.isNode?this._nodeIndexes:this._edgeIndexes;for(var o=0;o<i.length;++o){var s=i[o];if(r.get(s)!==value){r.set(s,value);n.push(s);if(value){a.push(s)}else{a.splice(a.indexOf(s),1)}}}return this._makeElementList(t.isNode,n)};Ch.prototype.addOrRemoveElements=function e(t,r){return this._setBit(t,+r)};Ch.prototype.addElements=function e(t){return this._setBit(t,1)};Ch.prototype.removeElements=function e(t){return this._setBit(t,0)};Ch.prototype.hasElement=function e(t){var r=this._getFlexArray(t.isNode);return!!r.get(t._index)};Ch.prototype.clear=function e(){this._nodeIndexes=[];this._edgeIndexes=[];this._flexArrays.nodes.reset();this._flexArrays.edges.reset()};Ch.prototype.isEmpty=function e(){return this._nodeIndexes.length===0&&this._edgeIndexes.length===0};Ch.prototype.getElements=function e(){return{nodes:new this._NodeList(this._nodeIndexes.slice()),edges:new this._EdgeList(this._edgeIndexes.slice())}};var Th={name:"animationStart",storage:32,default:0};var Mh={name:"animationDuration",storage:16,default:0};var kh={name:"animationEasing",storage:"resource",default:"linear"};var Ih=function e(t,r,i){this._ogma=t;this._colorManager=r;this._graph=t.modules.graph;this._isNode=i;this._eltName=i?"node":"edge";this._attributesDefinition=i?Ah:Eh;this._accessors=Wh(this._attributesDefinition);this._createFlexArrays=Fh(this._isNode,this._attributesDefinition);this._defaultValues=Xh(this._attributesDefinition);this._finalAttributes=this._createFlexArrays({named:true,useDefaultValues:true});this._prevAttributes=this._createFlexArrays({named:false,useDefaultValues:true});this._elementsToUpdate=this._createEmptyElementList();this._elementsToRedraw=null;this._mustDedupeElementsToRedraw=false;this._updateAll=false;this._computedValues=null;this._elementsToAssign=null;this._usedAttributes=[];this._removedList=this._graph.getAttribute(this._isNode,"removed");this._finalAttributesWrapped=Object.assign({},this._finalAttributes,{excluded:this._graph.getAttribute(i,"excluded"),textHidden:this._graph.getAttribute(i,"textHidden"),animationStart:this._graph.createAttribute(i,Th),animationDuration:this._graph.createAttribute(i,Mh),animationEasing:this._graph.createAttribute(i,kh),id:{_storage:this._graph._elts.fetch(i),get:function e(t){return this._storage.getId(t)}}});if(!i){Object.assign(this._finalAttributesWrapped,{source:this._graph.getEdgeAttribute("source"),target:this._graph.getEdgeAttribute("target")})}};Ih.prototype.clear=function e(){this._elementsToUpdate=this._createEmptyElementList();this._mustDedupeElementsToRedraw=false;this._elementsToRedraw=null};Ih.prototype.getAttributeFlexArrays=function e(){return this._finalAttributesWrapped};Ih.prototype.getPrevAttributeFlexArrays=function e(){return this._prevAttributes};Ih.prototype.getAnimationInformation=function e(t){var r=this;var i=t._indexes;var n=new Array(i.length);for(var a=0;a<i.length;++a){var o=i[a];n[a]={duration:r._finalAttributesWrapped.animationDuration.get(o),start:r._finalAttributesWrapped.animationStart.get(o),easing:r._finalAttributesWrapped.animationEasing.get(o)}}return n};Ih.prototype.markAllForUpdate=function e(){this._updateAll=true};Ih.prototype.isAllMarkedForUpdate=function e(){return this._updateAll};Ih.prototype.markForUpdate=function e(t){var r=this;if(!this._updateAll){for(var i=0;i<t.size;++i){r._elementsToUpdate._indexes.push(t._indexes[i])}}};Ih.prototype.markForRedraw=function e(t){this._addElementsToRedraw(t)};Ih.prototype._createElementList=function e(t){if(t===void 0)t=[];return new(this._isNode?this._ogma.NodeList:this._ogma.EdgeList)(t)};Ih.prototype._getAllElements=function e(){var t=(this._isNode?this._graph.getNodeMaxIndex():this._graph.getEdgeMaxIndex())-1;var r=new Array(t);for(var i=1;i<=t;++i){r[i-1]=i}return this._createElementList(r)};Ih.prototype._createEmptyElementList=function e(){return this._createElementList()};Ih.prototype.startUpdate=function e(){var t=this;this._elementsToUpdate=this._updateAll?this._getAllElements():this._elementsToUpdate.dedupe();var r=this._elementsToUpdate._indexes;this._addElementsToRedraw(this._elementsToUpdate);for(var i=0;i<r.length;++i){var n=r[i];var a=t._removedList.get(n);if(a){var o=r.length-1;r[i]=r[o];r.length=o;i-=1}}for(var s=0;s<this._usedAttributes.length;++s){var u=t._usedAttributes[s];var l=t._defaultValues[u];var f=ls(t._finalAttributes,u);var h=ls(t._prevAttributes,u);for(var v=0;v<r.length;++v){var d=r[v];h.set(d,f.get(d));f.set(d,l)}}};Ih.prototype.computeValues=function e(t,r,i){if(t){if(r){this._elementsToAssign=this._elementsToUpdate.filter(function(e){return r(e,i)})}else{this._elementsToAssign=this._elementsToUpdate}this._computedValues=zh(this._elementsToAssign,t,i)}};Ih.prototype.assignComputedValues=function e(){if(this._computedValues){this._assignValuesContainerToFlexArrays(this._finalAttributes,this._elementsToAssign,this._computedValues);this._computedValues=null;this._elementsToAssign=null}};Ih.prototype._assignValuesContainerToFlexArrays=function e(t,r,i,n){var a=this;if(n===void 0)n=false;var o=n?[]:undefined;var s=Object.keys(i);var u=r._indexes;for(var l=0;l<s.length;++l){var f=s[l];var h=i[f];var v=a._getAccessor(f);if(Array.isArray(h)){for(var d=0;d<h.length;++d){var c=v.check(h[d],a._colorManager);if(c!==o){v.set(t,u[d],c)}}}else{var _=v.check(h.value,a._colorManager);if(_!==o){for(var g=0;g<u.length;++g){v.set(t,u[g],_)}}}}};Ih.prototype._addElementsToRedraw=function e(t){if(t.size){if(this._elementsToRedraw){Y(this._elementsToRedraw._indexes,t._indexes);this._mustDedupeElementsToRedraw=true}else{this._elementsToRedraw=t.slice()}}};Ih.prototype.endUpdate=function e(){this._elementsToUpdate=this._createEmptyElementList();this._updateAll=false;this._usedAttributes=Lh(this._finalAttributes)};Ih.prototype.getAndResetElementsToRedraw=function e(){if(this._mustDedupeElementsToRedraw){this._elementsToRedraw=this._elementsToRedraw.dedupe()}var t=this._elementsToRedraw||this._createEmptyElementList();this._elementsToRedraw=null;this._mustDedupeElementsToRedraw=false;return t};Ih.prototype.createFlexArrays=function e(){return this._createFlexArrays({named:false,useDefaultValues:false})};Ih.prototype.getAttributeValues=function e(t,r,i,n){var a=n?this._prevAttributes:this._finalAttributes;if(i){return this._getMultipleAttributeValues(t,r,a)}else{return this._getAttributeValues(t,r,a)}};Ih.prototype._getAccessor=function e(t){if(t===void 0)t="";var r=Array.isArray(t)?t.join("."):t;var i=this._accessors[r];if(!i){throw new Error(this._eltName+' attribute "'+r+'" does not exist')}return i};Ih.prototype._getAttributeValues=function e(t,r,i){var n=this._getAccessor(r||"");var a=t._indexes;var o=new Array(a.length);for(var s=0;s<a.length;++s){o[s]=n.get(i,a[s])}return o};Ih.prototype._getMultipleAttributeValues=function e(t,r,i){var n=this;if(!r||r==="all"){return this._getAttributeValues(t,"",i)}var a=new Array(t.size);for(var o=0;o<a.length;++o){a[o]={}}for(var s=0;s<r.length;++s){var u=r[s];var l=n._getAttributeValues(t,u,i);for(var f=0;f<a.length;++f){var h=a[f];var value=l[f];be(h,u,value)}}return a};Ih.prototype.setAnimationAttributes=function e(t,r){var i=r.duration;var n=r.startTime;var a=r.easing;var o=t._indexes;var s=this._finalAttributesWrapped.animationDuration;var u=this._finalAttributesWrapped.animationStart;var l=this._finalAttributesWrapped.animationEasing;if(this._isNode&&i){var f=R();var h=this._finalAttributes.x;var v=this._finalAttributes.y;var d=this._prevAttributes.x;var c=this._prevAttributes.y;for(var _=0;_<o.length;++_){var g=o[_];var p=s.get(g);if(p){var y=u.get(g);var m=l.get(g);var x=Vs[m]||Vs.linear;var b=Math.min((f-y)/p,1);var A=x(b);h.set(g,er(d.get(g),h.get(g),A));v.set(g,er(c.get(g),v.get(g),A))}}}s.fill(o,i);u.fill(o,n);l.fill(o,a)};Ih.prototype.resetAnimationAttributes=function e(t){this._finalAttributesWrapped.animationDuration.fill(t._indexes,0)};Ih.prototype.assignFlexArrays=function e(t,r,i,n){var a=zh(r,i);this._assignValuesContainerToFlexArrays(t,r,a,n)};Ih.prototype.getUsedAttributes=function e(){return this._usedAttributes};var Nh=function e(t){this._ogma=t;this._colorManager=new gn;this._textHiddenSet=new Ch(t,"textHidden");this._nodes=new Ih(t,this._colorManager,true);this._edges=new Ih(t,this._colorManager,false);this._layerIdCounter=0;this._layers=[];this._layersSorted=true;this._updateOngoing=false;this._needUpdate=false;this._updateDone=false};Nh.prototype._getLayerById=function e(t){var r=this;for(var i=0;i<this._layers.length;++i){var n=r._layers[i];if(n.id===t){n.index=i;return n}}throw new Error("usage of a destroyed style rule or class")};Nh.prototype._fetch=function e(t){return t.isNode?this._nodes:this._edges};Nh.prototype.getFlexArrays=function e(){return{nodes:{current:this._nodes.getAttributeFlexArrays(),previous:this._nodes.getPrevAttributeFlexArrays()},edges:{current:this._edges.getAttributeFlexArrays(),previous:this._edges.getPrevAttributeFlexArrays()}}};Nh.prototype.createFlexArrays=function e(){return{nodes:this._nodes.createFlexArrays(),edges:this._edges.createFlexArrays()}};Nh.prototype.clear=function e(){this._updateOngoing=false;this._needUpdate=false;this._nodes.clear();this._edges.clear()};Nh.prototype.markAllForUpdate=function e(){this._needUpdate=true;this._nodes.markAllForUpdate();this._edges.markAllForUpdate()};Nh.prototype.isAllMarkedForUpdate=function e(){return this._nodes.isAllMarkedForUpdate()&&this._edges.isAllMarkedForUpdate()};Nh.prototype.markForUpdate=function e(t){this._needUpdate=true;this._fetch(t).markForUpdate(t)};Nh.prototype.markForRedraw=function e(t){this._fetch(t).markForRedraw(t)};Nh.prototype.getAnimationInformation=function e(t){return this._fetch(t).getAnimationInformation(t)};Nh.prototype.update=function e(){var t=this;if(!this._needUpdate||this._updateOngoing||!this._ogma._token){return false}if(!this._layersSorted){this._layers.sort(function(e,t){return e.priority-t.priority});this._layersSorted=true}this._updateOngoing=true;this._nodes.startUpdate();this._edges.startUpdate();for(var r=0;r<this._layers.length;++r){var i=t._layers[r];var n=i.nodeAttributes;var a=i.nodeSelector;var o=i.nodeContext;var s=i.edgeAttributes;var u=i.edgeSelector;var l=i.edgeContext;t._nodes.computeValues(n,a,o);t._edges.computeValues(s,u,l);t._nodes.assignComputedValues();t._edges.assignComputedValues()}this._nodes.endUpdate();this._edges.endUpdate();this._updateOngoing=false;this._needUpdate=false;this._updateDone=true;return true};Nh.prototype.getAndResetElementsToRedraw=function e(){var t={nodes:this._nodes.getAndResetElementsToRedraw(),edges:this._edges.getAndResetElementsToRedraw(),attributesUpdated:this._updateDone};this._updateDone=false;return t};Nh.prototype.addAttributeLayer=function e(t){if(t===void 0)t={};var r=++this._layerIdCounter;var i={id:r};this._layers.push(i);this._updateLayer(i,t);return new Sh(this,this._layerIdCounter)};Nh.prototype._updateLayer=function e(t,r){if(r===void 0)r={};var i=r.priority;var n=r.fullOverwrite;var a=r.nodeAttributes;var o=r.nodeSelector;var s=r.nodeContext;var u=r.edgeAttributes;var l=r.edgeSelector;var f=r.edgeContext;if(a!==undefined){t.nodeAttributes=n?a:ke(t.nodeAttributes,a)}if(o!==undefined){t.nodeSelector=o}if(s!==undefined){t.nodeContext=s}if(u!==undefined){t.edgeAttributes=n?u:ke(t.edgeAttributes,u)}if(l!==undefined){t.edgeSelector=l}if(f!==undefined){t.edgeContext=f}if(i!==undefined){t.priority=i}this._layersSorted=false;this.markAllForUpdate()};Nh.prototype.destroyAttributeLayer=function e(t){var r=this._getLayerById(t);this._layers.splice(r.index,1);this.markAllForUpdate()};Nh.prototype.updateAttributeLayer=function e(t,r){this._updateLayer(this._getLayerById(t),r)};Nh.prototype.getAttributeLayerDefinition=function e(t){var r=this._getLayerById(t);var i=r.nodeAttributes;var n=r.nodeSelector;var a=r.nodeContext;var o=r.edgeAttributes;var s=r.edgeSelector;var u=r.edgeContext;var l=r.priority;return{nodeAttributes:i,nodeSelector:n,nodeContext:a,edgeAttributes:o,edgeSelector:s,edgeContext:u,priority:l}};Nh.prototype.getAttributeValues=function e(t,r,i,n){this.update();return this._fetch(t).getAttributeValues(t,r,i,n)};Nh.prototype.setAnimationAttributes=function e(t,r){this._fetch(t).setAnimationAttributes(t,r)};Nh.prototype.resetAnimationAttributes=function e(t){this._fetch(t).resetAnimationAttributes(t)};Nh.prototype.assignFlexArrays=function e(t,r,i,n){var a=r.isNode?t.nodes:t.edges;this._fetch(r).assignFlexArrays(a,r,i,n)};Nh.prototype.setTextHidden=function e(t,value){var r=this._textHiddenSet.addOrRemoveElements(t,value);this.markForRedraw(r)};Nh.prototype.getUsedNodeAttributes=function e(){return this._nodes.getUsedAttributes()};Nh.prototype.getUsedEdgeAttributes=function e(){return this._edges.getUsedAttributes()};function Lh(e,t,r){if(t===void 0)t=[];if(r===void 0)r="";if(e.constructor===fi){if(e.isInitialized()){t.push(r)}}else if(e.constructor===Object){Object.keys(e).forEach(function(i){Lh(e[i],t,Gh(r,i))})}return t}function zh(e,value,t,r,i){if(r===void 0)r={};if(i===void 0)i="";if(typeof value==="function"){var n=value;for(var a=0;a<e.size;++a){var o=e.get(a);var s=n(o,t,i);Ph(r,s,e.size,a,i)}}else if(Me(value)){var u=Object.keys(value);for(var l=0;l<u.length;++l){var f=u[l];var h=Gh(i,f);zh(e,value[f],t,r,h)}}else if(value instanceof fi){if(value.isInitialized()){r[i]=value.getMultiple(e._indexes)}}else if((Array.isArray(value)||ArrayBuffer.isView(value))&&i!=="color"){if(!i){for(var v=0;v<e.size;++v){Ph(r,value[v],e.size,v,i)}}else{var d=new Array(e.size);for(var c=0;c<e.size;++c){d[c]=value[c]}r[i]=d}}else{r[i]=new Dh(value)}return r}var Dh=function e(value){this.value=value};function Ph(e,value,t,r,i){if(value&&value.constructor===Object){var n=Object.keys(value);for(var a=0;a<n.length;++a){var o=n[a];var s=value[o];var u=i?i+"."+o:o;Ph(e,s,t,r,u)}}else{var l=e[i];if(!l){l=new Array(t);e[i]=l}l[r]=value}}function Fh(e,t){var r=["var graph = this._graph;","var isNode = this._isNode;","var named = options.named;","var useDefaultValues = options.useDefaultValues;","","return "+Rh(e,t)+";"].join("\n");return new Function("options",r)}function Bh(value){if(typeof value==="string"){return'"'+value+'"'}else{return""+value}}function Rh(e,t,r){if(r===void 0)r="";var i=t._flexArray;if(i!==undefined){var n=t._storage||"resource";var a=n==="float"?Infinity:undefined;var o=['storage: "'+n+'"',"default: (useDefaultValues ? "+Bh(i)+" : "+Bh(a)+")",'name: (named ? "'+r+'" : undefined)'];return"graph.createAttribute("+e+", {"+o.join(", ")+"})"}else{var s=Object.keys(t).filter(function(e){if(e.startsWith("_")){return false}var r=t[e];return!Oh(r)&&(r._flexArray!==undefined||Object.keys(r).some(function(e){return!e.startsWith("_")}))});var u=s.map(function(i){var n=Gh(r,i);var value=Rh(e,t[i],n);return i+": "+value});return"{\n"+u.join(",\n").split("\n").map(function(e){return"  "+e}).join("\n")+"\n}"}}function Oh(e){return typeof e==="string"}function Vh(e,t,r){if(r===void 0)r="";var i={};if(t._flexArray!==undefined){return}if(Oh(t)||t._alias){var n=Oh(t)?t:t._alias;var a=e[n];i.check=a.check;i.set=a.set;i.get=a.get}else{if(t._set){i.set=t._set;i.check=t._check}else{i.set=new Function;i.check=new Function("return undefined;")}if(t._get){i.get=t._get}else{var o="return "+jh(t,e,r)+";";i.get=new Function("flexArrays","index",o)}}e[r?r.substring(1):""]=i;if(!Oh(t)){Object.keys(t).filter(function(e){return!e.startsWith("_")}).forEach(function(i){Vh(e,t[i],r+"."+i)})}return e}function jh(e,t,r){if(e._flexArray!==undefined){return"flexArrays"+r+".get(index)"}else{var i=[];Object.keys(e).filter(function(t){return!t.startsWith("_")&&!Oh(e[t])}).forEach(function(n){var a=jh(e[n],t,r+"."+n);if(a){i.push(n+": "+a)}});if(i.length){return"{\n"+i.join(",\n").split("\n").map(function(e){return"  "+e}).join("\n")+"\n}"}else{return""}}}function Uh(e,t,r){if(r===void 0)r="";if(typeof t==="object"){if(t._flexArray!==undefined){e[r.substring(1)]={check:t._check,set:new Function("flexArrays","index","value","flexArrays"+r+".set(index, value);"),get:new Function("flexArrays","index","return flexArrays"+r+".get(index);")}}else{Object.keys(t).filter(function(e){return!e.startsWith("_")}).forEach(function(i){Uh(e,t[i],r+"."+i)})}}return e}function Gh(e,t){return e?e+"."+t:t}function Xh(e,t,r){if(t===void 0)t={};if(r===void 0)r="";if(e.constructor===Object){if(e._flexArray!==undefined){t[r]=e._flexArray}else{Object.keys(e).filter(function(e){return!e.startsWith("_")}).forEach(function(i){Xh(e[i],t,Gh(r,i))})}}return t}function Wh(e){var t={};Uh(t,e);Vh(t,e);return t}var Yh=1;var Hh=2;var qh=3;var Zh=4;var $h=5;var Kh=6;var Jh="_hovered";var Qh="_hoverExtremityHighlighted";var ev="_selected";var tv="_selectionExtremityHighlighted";var rv="_dragged";var iv="_rewirable";var nv="_export";var av="_transparent";var ov=[ev,rv,tv,Jh,Qh,iv,nv,av];var sv=2;var uv=3;var lv=3;var fv=3;Ogma.extend(function(e){var t=new mv(e);var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;e.modules.graphics=t;e.reloadFonts=function(){t.reloadFonts()};e.view.getImageData=function(){return t.getImageData()};e.events.onRendererStateChange=function(t){e.modules.events.on("rendererStateChange",t);return e.events};e.styles.setNodesVisibility=function(value){return t.setNodesVisibility(value)};e.styles.setEdgesVisibility=function(value){return t.setEdgesVisibility(value)};e.styles.setNodeTextsVisibility=function(value){return t.setNodeTextsVisibility(value)};e.styles.setEdgeTextsVisibility=function(value){return t.setEdgeTextsVisibility(value)};r.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)[0]};n.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)};i.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)[0]};a.prototype.getAnimationInformation=function(){return t.getAnimationInformation(this)};hv([r,i,n,a],"setStyle","setAttributes");hv([r,i,n,a],"resetStyle","resetAttributes");hv([r,i,n,a],"getStyle","getAttribute");hv([r,n],"setPosition","setAttributes")});function hv(e,t,r){for(var i=0;i<e.length;++i){var n=e[i];n.prototype[t]=function(e,i){is('Deprecated method "'+t+'"; please use "'+r+'" instead.');return this[r](e,i)}}}var vv="anonymous";var dv="white";var cv="default";var _v={maxBlockId:1024,maxScaledSize:16,maxPixelSize:255,maxMinVisibleSize:16,maxDashOffset:4,maxDashLength:3,maxGapLength:1};Ogma.atInit(function(e,t){if(t.renderer!==undefined){e.setOptions({renderer:t.renderer})}if(t.imgCrossOrigin!==undefined){e.setOptions({imgCrossOrigin:t.imgCrossOrigin})}At(function(){gv(e)})});Ogma.onDestroy(function(e){gv(e);pv(e)});function gv(e){if(e.modules){e.modules.graphics.getGraphicsEngine().destroy()}}function pv(e){if(e.modules){e.modules.graphics.getImageManager().destroy()}}var yv=typeof window==="undefined"||window.__OGMA_HEADLESS?null:"webgl";var mv=function e(t){var r=this;this._ogma=t;this._debug=t._debug;this._events=t.modules.events;this._dom=t.modules.dom;this._graph=t.modules.graph;this._camera=t.modules.camera;this._events=t.modules.events;this._settings=t.modules.settings;this._attributesManager=new Nh(t);this._imageManager=new zf;this._engine=new If;this._domElement=this._engine.getDomElement();this._animations=[];this._cursorStyle=[];this._initDone=false;this._rendererState={type:"",code:"",state:"",message:""};this._nextAnimationId=1;this._nodeAnimationList=this._graph.createNodeAttribute({storage:32,default:0});this._edgeAnimationList=this._graph.createEdgeAttribute({storage:32,default:0});this._events.register(["reloadFonts","rendererStateChange","updateAttributes","animate"]);this._settings.register("renderer",yv,function(e){r._updateRendererState({type:e,state:"requested",code:null,message:null});r._dom.refresh()});this._settings.register("backgroundColor",dv,function(e){if(!r._engine.parseColor(e)){is('Invalid background color "'+e+'" specified; will default to black.');r._settings.set("backgroundColor","black")}else{r._dom.refresh()}});this._settings.register("imgCrossOrigin",vv,function(){return r._updateImageCrossOrigin()});this._settings.register("cursor.default",cv,function(){return r._applyCursorStyle()});this._dom.setLayer("graphics",this._domElement);this._engine.setGlobalBoundaries(_v);this._dom.beforeNextFrame().then(function(){r._initDone=true;r._fireRendererStateChangeEvent()});this._boundaries={maxSize:10,maxMinVisibleSize:24};this._visibility={nodes:0,edges:0,nodeTexts:0,edgeTexts:0};this._isBufferDisplayable=function(e){var t=yh(e);var i=mh(e);var n=t?r._visibility.nodes:r._visibility.edges;var a=t?r._visibility.nodeTexts:r._visibility.edgeTexts;var o=n===0;var s=!i||a===0;return o&&s};this._imageManager.onFetch(function(){r._engine.notifyPatternUpdate();r._dom.refresh()});this._nextGeIndex=1;this._availableGeIndexes=[];this._events.on({cameraMove:function(){return r._dom.refresh()},newFrame:function(){r._processAnimations();r._loadGraphInGraphicsEngine();r._render()},clear:function(){r._nextGeIndex=1;r._availableGeIndexes=[];r._engine.clear();r._attributesManager.markAllForUpdate();r._dom.refresh()},viewChanged:function(e){var t=e.type;if(t==="rotate"){var i=r._ogma.getEdges().filter(function(e){return e.getAttribute("adjustAnchors")});r._attributesManager.markForUpdate(i)}},"addNodes addEdges beforeRemoveNodes beforeRemoveEdges updateNodeData updateEdgeData excludedStateChange":function(e){if(r._attributesManager.isAllMarkedForUpdate()){return}var t=e.elements||e.nodes||e.edges;var i=null;var n=null;if(t.isNode){i=t.getAdjacentNodes({policy:"include-sources"});n=t.getAdjacentEdges()}else{i=t.getExtremities();n=t.getParallelEdges()}r._attributesManager.markForUpdate(i);r._attributesManager.markForUpdate(n);r._dom.refresh()}})};mv.prototype.getTransparentBackgroundColor=function e(){return this._engine.transparentify(this._settings.get("backgroundColor"))};mv.prototype._render=function e(){var t=this._settings.get("renderer");var r=this._dom.getDimensions();var i=this._camera.getView();var n=nt();var a=R();var o=this._settings.get("backgroundColor");var s=this._isBufferDisplayable;this._engine.setView({x:i.x,y:i.y,zoom:i.zoom,angle:i.angle,width:r.width,height:r.height,pixelRatio:n,currentTime:a,backgroundColor:o,isBufferDisplayable:s});this._engine.setRenderType(t);try{this._engine.render();if(this._rendererState.state==="requested"){this._updateRendererState({state:"ok"})}}catch(e){if(this._debug){throw e}var u=e.message;var l=e.code;if(l===void 0)l="OTHER";var f=this._formatRendererName(t);var h=this._rendererState.state==="requested";var v="Error while initializing the "+f+" renderer";var d="The "+f+" renderer encountered an unexpected runtime error";var c=h?v:d;var _=null;if(t==="webgl"){c+="; fallbacking on canvas renderer";_="canvas"}is(u);is(c);this._updateRendererState({state:"error",code:l,message:u});this._settings.set("renderer",_)}};mv.prototype._formatRendererName=function e(t){if(t==="webgl"){return"WebGL"}else if(t==="svg"){return"SVG"}else{return t}};mv.prototype._fireRendererStateChangeEvent=function e(){var t={type:this._rendererState.type,state:this._rendererState.state,code:this._rendererState.code,message:this._rendererState.message};this._events.fire("rendererStateChange",t)};mv.prototype._updateRendererState=function e(t){var r=t.type;var i=t.state;var n=t.code;var a=t.message;var o=false;if(r!==undefined&&this._rendererState.type!==r){this._rendererState.type=r;o=true}if(i!==undefined&&this._rendererState.state!==i){this._rendererState.state=i;o=true}if(n!==undefined&&this._rendererState.code!==n){this._rendererState.code=n;o=true}if(a!==undefined&&this._rendererState.message!==a){this._rendererState.message=a;o=true}if(o&&this._initDone){this._fireRendererStateChangeEvent()}};mv.prototype.getImageData=function e(){var t=this;return this._dom.afterNextFrame().then(function(){return t._engine.getImageData()})};mv.prototype.addCanvas=function e(t){this._engine.addCanvas(t)};mv.prototype.removeCanvas=function e(t){this._engine.removeCanvas(t)};mv.prototype.getNodeAttributes=function e(){return this._attributesManager.getFlexArrays().nodes.current};mv.prototype.getEdgeAttributes=function e(){return this._attributesManager.getFlexArrays().edges.current};mv.prototype.getGraphicsEngine=function e(){return this._engine};mv.prototype.getImageManager=function e(){return this._imageManager};mv.prototype.allocateGraphicsEngineBlockId=function e(){if(this._availableGeIndexes.length){return this._availableGeIndexes.pop()}else{return this._nextGeIndex++*ca+da}};mv.prototype.releaseGraphicsEngineBlockId=function e(t){this._engine.freeBlock(t);this._availableGeIndexes.push(t);this._dom.refresh()};mv.prototype.addCursorStyle=function e(t){if(!t){return}this._cursorStyle.push(t);this._applyCursorStyle()};mv.prototype.removeCursorStyle=function e(t){if(!t){return}var r=this._cursorStyle.lastIndexOf(t);if(r!==-1){this._cursorStyle.splice(r,1);this._applyCursorStyle()}};mv.prototype._applyCursorStyle=function e(){var t=this._cursorStyle[this._cursorStyle.length-1]||this._settings.get("cursor.default");xt(this._domElement,t)};mv.prototype.reloadFonts=function e(){this._events.fire("reloadFonts");this._engine.notifyFontsReloaded();this._dom.refresh()};mv.prototype._updateImageCrossOrigin=function e(){this._imageManager.setImgCrossOrigin(this._settings.get("imgCrossOrigin"))};mv.prototype.getDomElement=function e(){return this._domElement};mv.prototype.setTextHidden=function e(t,r){this._attributesManager.setTextHidden(t,r);this._dom.refresh()};mv.prototype.getAttributesManager=function e(){return this._attributesManager};mv.prototype._loadGraphInGraphicsEngine=function e(){this._attributesManager.update();var t=this._attributesManager.getAndResetElementsToRedraw();var r=t.attributesUpdated;if(r){this._computeBoundaries()}jf({ogma:this._ogma,graph:t,engine:this._engine,imageManager:this._imageManager,view:this._camera.getView(),attributes:this._attributesManager.getFlexArrays(),boundaries:this._boundaries});if(r){this._events.fire("updateAttributes",{nodes:t.nodes,edges:t.edges})}};mv.prototype._computeBoundaries=function e(){var t=this._graph.getNodeAttribute("excluded");var r=this._graph.getEdgeAttribute("excluded");var i=this._graph.getNodeAttribute("radius");var n=this._graph.getEdgeAttribute("width");var a=this._graph.allNodeIndexesConst();var o=this._graph.allEdgeIndexesConst();var s=0;var u=0;for(var l=0;l<a.length;++l){var f=a[l];var h=t.get(f);var v=i.get(f);if(!h&&v>s){s=v}}for(var d=0;d<o.length;++d){var c=o[d];var _=r.get(c);var g=n.get(c);if(!_&&g>u){u=g}}var p=this._graph.getAllAttributes().filter(function(e){var t=e.getName();return t&&t.indexOf("minVisibleSize")!==-1});var y=Math.max(s*2,u);var m=cr(p.map(function(e){return cr(e.getValues())}));this._boundaries.maxSize=y;this._boundaries.maxMinVisibleSize=m};mv.prototype._forceCompleteGraphRefresh=function e(){this.refreshAll();this._loadGraphInGraphicsEngine()};mv.prototype.export=function e(t,r,i,n){var a=this;var o;return Promise.all([this._graph.getNodes().addClass(nv),this._graph.getEdges().addClass(nv)]).then(function(){return a._imageManager.whenReady()}).then(function(){if(i==="all"){o=Cv(a._ogma);a._forceCompleteGraphRefresh()}else{a._loadGraphInGraphicsEngine()}return a._engine.export(t,r,n)}).then(function(e){return Promise.all([a._graph.getNodes().removeClass(nv),a._graph.getEdges().removeClass(nv)]).then(function(){return e})}).then(function(e){if(i==="all"){Tv(o);a._forceCompleteGraphRefresh()}return e})};mv.prototype.refreshAll=function e(){this._attributesManager.markAllForUpdate();this._dom.refresh()};mv.prototype.refresh=function e(t){this._attributesManager.markForUpdate(t)};mv.prototype.addAttributeLayer=function e(t){return this._attributesManager.addAttributeLayer(t)};mv.prototype.createFlexArrays=function e(){return this._attributesManager.createFlexArrays()};mv.prototype.assignFlexArrays=function e(t,r,i,n){this._attributesManager.assignFlexArrays(t,r,i,n)};mv.prototype.getAttributeValues=function e(t,r,i,n){return this._attributesManager.getAttributeValues(t,r,i,n)};mv.prototype.forceAttributesComputation=function e(){this._attributesManager.update()};mv.prototype.resolveAtNextFrame=function e(t){return this._dom.afterNextFrame().then(function(){return t})};mv.prototype.animate=function e(t,r,i){var n=this;var a=Av(i);var o=function(){return n._animate(t,r,a)};if(a.duration&&this._rendererState.state==="requested"){return this._dom.afterNextFrame().then(o)}else{return o()}};mv.prototype.isAnimating=function e(){return this._animations.length>0};mv.prototype.getAnimationInformation=function e(t){return this._attributesManager.getAnimationInformation(t)};mv.prototype._animate=function e(t,r,i){var n=this;if(!t.size){return Promise.resolve(t)}var a=i.duration;var o=i.easing;this._events.fire("animate",{elements:t.toList(),duration:a,easing:o});var s={id:this._nextAnimationId++,startTime:-1,finished:false,func:r,duration:a,easing:o,elements:t,resolve:undefined};var u=new Promise(function(e){return s.resolve=e});var l=t._indexes;var f=t.isNode?this._nodeAnimationList:this._edgeAnimationList;for(var h=0;h<l.length;++h){var v=l[h];f.set(v,s.id)}for(var d=0;d<this._animations.length;++d){var c=n._animations[d];if(c.elements.isNode!==t.isNode){continue}var _=c.elements._indexes;var g=false;for(var p=0;p<_.length;++p){var y=_[p];if(f.get(y)===c.id){g=true}}if(!g){n._endAnimation(c)}}this._removeFinishedAnimations();this._animations.push(s);this._dom.refresh();if(!a){this._processAnimations();this._attributesManager.update()}return u};mv.prototype._isElementAnimated=function e(t){var r=(t.isNode?this._nodeAnimationList:this._edgeAnimationList).get(t._index)!==0;if(!t.isNode){r|=this._nodeAnimationList.get(t.getSource()._index)!==0;r|=this._nodeAnimationList.get(t.getTarget()._index)!==0}return r};mv.prototype._endAnimation=function e(t){t.resolve(t.elements);t.finished=true};mv.prototype._removeFinishedAnimations=function e(){this._animations=this._animations.filter(function(e){return!e.finished})};mv.prototype._getAnimationElements=function e(t){var r=t.elements;var i=r.isNode?this._nodeAnimationList:this._edgeAnimationList;var n=[];for(var a=0;a<r._indexes.length;++a){var o=r._indexes[a];if(i.get(o)===t.id){n.push(o)}}return new(r.isNode?this._graph.NodeList:this._graph.EdgeList)(n)};mv.prototype._resetAnimationAttributes=function e(t){var r=t.isNode?this._nodeAnimationList:this._edgeAnimationList;this._attributesManager.resetAnimationAttributes(t);r.fill(t._indexes,0)};mv.prototype._processAnimations=function e(){var t=this;var r=R();for(var i=0;i<this._animations.length;++i){var n=t._animations[i];var a=n.func;var o=n.elements;var s=n.duration;if(n.startTime===-1){a(o);n.startTime=r;n.dependencies=[];if(s!==0){t._attributesManager.setAnimationAttributes(t._getAnimationElements(n),n)}}if(r>=n.startTime+s){t._resetAnimationAttributes(t._getAnimationElements(n));t._endAnimation(n)}}this._removeFinishedAnimations();if(this._animations.length){this._dom.refresh()}};mv.prototype.hideTexts=function e(){this.setNodeTextsVisibility(false);this.setEdgeTextsVisibility(false)};mv.prototype.showTexts=function e(){this.setNodeTextsVisibility(true);this.setEdgeTextsVisibility(true)};mv.prototype.setNodesVisibility=function e(value){return this._updateVisibilityCounter("nodes",value)};mv.prototype.setNodeTextsVisibility=function e(value){return this._updateVisibilityCounter("nodeTexts",value)};mv.prototype.setEdgesVisibility=function e(value){return this._updateVisibilityCounter("edges",value)};mv.prototype.setEdgeTextsVisibility=function e(value){return this._updateVisibilityCounter("edgeTexts",value)};mv.prototype._updateVisibilityCounter=function e(t,value){this._visibility[t]+=value?-1:1;this._dom.refresh()};mv.prototype.detectNode=function e(t){var r=this;var i=t.position;var n=t.margin;var a=t.texts;var o=t.indexes;if(o===void 0)o=this._graph.allNodeIndexesConst();var s=this._engine,u=this._graph._nodes,l=this._attributesManager.getFlexArrays().nodes.current,f=l.excluded,h=l.animationDuration,v=l.x,d=l.y,c=l.radius,_=l.shape,g=l.detectable,p=l.innerStroke.width,y=l.innerStroke.width,m=l.textHidden,x=l.text.content,b=l.text.margin,A=l.text.padding,w=l.text.position,E=l.text.size,S=l.text.scale,C=l.text.scaling,T=l.text.font,M=l.text.style,k=l.text.minVisibleSize,I=l.text.maxLineLength,N=0;var L=this._camera.getZoom(),z=i.x,D=i.y;var P={left:{x:-1,y:0},right:{x:1,y:0},top:{x:0,y:-1},bottom:{x:0,y:1},center:{x:0,y:0}};this._attributesManager.update();for(var F=0;F<o.length;++F){var B=o[F];if(!f.get(B)&&g.get(B)&&h.get(B)===0){var R=v.get(B),O=d.get(B),V=r._camera.graphToScreenCoordinates({x:R,y:O}),j=V.x,U=V.y,G=_.get(B),X=c.get(B)*L,W=X+n,Y=(z-j)/W,H=(D-U)/W;if(s.checkShapeHit(G,Y,H)){N=B}else if(a){var q=bv(x.get(B)),Z=m.get(B),$=k.get(B),K=X*2;if(!Z&&q&&K>=$){q=Df(q,I.get(B));var J=p.get(B),Q=y.get(B),ee=b.get(B),te=A.get(B),re=E.get(B),ie=S.get(B),ne=C.get(B),ae=T.get(B),oe=M.get(B),se=w.get(B),ue=s.measureText(q,ae,oe),le=ne?ie*X:re,fe=ue.width*le/2+te+n,he=ue.height*le/2+te+n,ve=P[se];var de=J+Q+ee+X,ce=(de+fe)*ve.x,_e=(de+he)*ve.y,ge=j+ce,pe=U+_e,ye=ge-fe,me=ge+fe,xe=pe-he,be=pe+he;if(z>ye&&z<me&&D>xe&&D<be){N=B}}}}}return u.get(N)||null};mv.prototype.detectEdge=function e(t){var r=t.position;var i=t.margin;var n=t.texts;var a=t.indexes;if(a===void 0)a=this._graph.allEdgeIndexesConst();var o=this._engine,s=this._graph._edges,u=this._attributesManager.getFlexArrays(),l=u.edges.current,f=u.nodes.current,h=l.excluded,v=l.animationDuration,d=f.animationDuration,c=f.x,_=f.y,g=f.radius,p=f.shape,y=l.source,m=l.target,x=l.curvature,b=l.width,A=l.detectable,w=l.shape.type,E=l.shape.head,S=l.shape.tail,C=l.text.content,T=l.text.margin,M=l.text.padding,k=l.text.position,I=l.text.size,N=l.text.font,L=l.text.style,z=l.text.minVisibleSize,D=0,P={},F={},B=this._camera.getZoom(),R=i/B,O=this._camera.screenToGraphCoordinates(r),V=O.x,j=O.y;this._attributesManager.update();for(var U=0;U<a.length;++U){var G=a[U];var X=y.get(G);var W=m.get(G);var Y=h.get(G);var H=A.get(G);var q=!!v.get(G);var Z=!!d.get(X);var $=!!d.get(W);if(!Y&&H&&!q&&!Z&&!$){var K=X===W;var J=x.get(G);var Q=w.get(G);var ee=E.get(G);var te=S.get(G);var re=b.get(G);var ie=c.get(X);var ne=_.get(X);var ae=g.get(X);var oe=c.get(W);var se=_.get(W);var ue=g.get(W);P.width=re;P.shapeStyle="plain";P.shapeTail=te;P.shapeHead=ee;P.isSelfLoop=K;P.shapeType=Q;P.sourceX=ie;P.sourceY=ne;P.targetX=oe;P.targetY=se;P.sourceRadius=ae;P.targetRadius=ue;P.curvature=J;var le=Gf(P,F);var fe=le.bodyType;var he=le.bodyX;var ve=le.bodyY;var de=le.bodyLength;var ce=le.bodyWidth;var _e=le.bodyAngle;var ge=le.tailType;var pe=le.tailX;var ye=le.tailY;var me=le.tailLength;var xe=le.tailWidth;var be=le.tailAngle;var Ae=le.headType;var we=le.headX;var Ee=le.headY;var Se=le.headLength;var Ce=le.headWidth;var Te=le.headAngle;var Me=le.textX;var ke=le.textY;var Ie=le.textAngle;var Ne=le.dash;var Le=le.gap;var ze=le.curveControl1X;var De=le.curveControl1Y;var Pe=le.curveControl2X;var Fe=le.curveControl2Y;var Be=le.distanceToControl;var Re=le.sourceToControl1X;var Oe=le.sourceToControl1Y;var Ve=le.targetToControl2X;var je=le.targetToControl2Y;var Ue=le.curveStartX;var Ge=le.curveStartY;var Xe=le.curveEndX;var We=le.curveEndY;var Ye=fe==="triangle";if(K){if(fo(V,j,Ue,Ge,Xe,We,ze,De,Pe,Fe,re,R)){D=G}}else if(J!==0){if(so(V,j,Ue,Ge,Xe,We,ze,De,re,R,Ye)){D=G}}else{if(wn(V,j,Ue,Ge,Xe,We,re,R,Ye)){D=G}}if(Ae==="arrow"&&xv(V,j,Xe,We,Ve,je,Ce,Se,R)){D=G}if(ge==="arrow"&&xv(V,j,Ue,Ge,Re,Oe,xe,me,R)){D=G}}}return s.get(D)||null};mv.prototype._getAttributeArray=function e(t,r){var i=this._attributesManager.getFlexArrays();var n=t?i.nodes:i.edges;return ls(n.current,r)};function xv(e,t,r,i,n,a,o,s,u){var l=-n;var f=-a;var h=f;var v=-l;var d=r-l*u;var c=i-f*u;var _=o/2+u;var g=s+2*u;var p=d+h*_;var y=c+v*_;var m=d-h*_;var x=c-v*_;var b=d+l*g;var A=c+f*g;return Gn(e,t,p,y,m,x,b,A)}function bv(e){return e===null?"":e.toString()}function Av(e){if(typeof e==="number"){e={duration:e}}else if(typeof e!=="object"||e===null){e={}}return{duration:wv(e.duration),easing:e.easing||"linear",chain:!!e.chain}}function wv(e){if(typeof e!=="number"||!isFinite(e)||e<0){return 0}else{return e}}function Ev(e,t){var r=e.modules.graph.getAttribute(t,"excluded"),i=(t?e.getNodes("all"):e.getEdges("all"))._indexes,n=r.getMultiple(i);r.fill(i,0);return{excludedList:r,indexes:i,values:n}}function Sv(e){var t=e.excludedList;var r=e.indexes;var i=e.values;t.setMultiple(r,i)}function Cv(e){return{nodes:Ev(e,true),edges:Ev(e,false)}}function Tv(e){var t=e.nodes;var r=e.edges;Sv(t);Sv(r)}var Mv=2e3;var kv=function e(t){var r=this;this._dom=t.modules.dom;this._settings=t.modules.settings;this._graphics=t.modules.graphics;this._events=t.modules.events;this._hideTexts=false;this._hideTextsAttributeLayer=null;this._timeout=null;this._fontsLoaded=false;this._settings.register("texts.hideUntilFontsLoaded",true,function(e){if(!e){r._stopHidingText()}});if(typeof document!=="undefined"&&document.fonts&&document.fonts.ready instanceof Promise){this._startHidingText();this._whenFontsLoaded().finally(function(){r._fontsLoaded=true;r._graphics.reloadFonts();r._stopHidingText()})}this._dom.setTimeout(function(){if(!r._fontsLoaded){r._graphics.reloadFonts()}},Mv)};kv.prototype._startHidingText=function e(){this._hideTexts=true;this._hideTextsAttributeLayer=this._graphics.addAttributeLayer({priority:Kh,nodeAttributes:{icon:{font:null},text:{font:null,secondary:{font:null}},badges:{topLeft:{text:{font:null}},topRight:{text:{font:null}},bottomLeft:{text:{font:null}},bottomRight:{text:{font:null}}}},edgeAttributes:{text:{font:null,secondary:{font:null}}}})};kv.prototype._stopHidingText=function e(){if(this._hideTexts){this._hideTexts=false;this._hideTextsAttributeLayer.destroy();this._dom.refresh()}};kv.prototype._whenFontsLoaded=function e(){var t=this;return new Promise(function(e){return t._dom.setTimeout(e)}).then(function(){return document.fonts.ready}).then(function(e){var t=Array.from(e.values());return Promise.all(t.map(function(t){return e.load("12px "+Iv(t))}))})};function Iv(e){return e.family.includes(" ")?'"'+e.family+'"':e.family}Ogma.extend(function(e){return e.modules.fontLoading=new kv(e)});Ogma.extend(function(e){return e.modules.curvatureManager=new Nv(e)});var Nv=function e(t){var r=this;this._settings=t.modules.settings;this._graphics=t.modules.graphics;this._context={edgesAlwaysCurvy:false,directedEdges:false};this._settings.register("edgesAlwaysCurvy",false,function(value){r._context.edgesAlwaysCurvy=value;r._graphics.refreshAll()});this._settings.register("directedEdges",false,function(value){r._context.directedEdges=value;r._graphics.refreshAll()});this._graphics.addAttributeLayer({priority:Yh,edgeContext:this._context,edgeAttributes:{curvature:function(e,t){var r=t.edgesAlwaysCurvy;var i=t.directedEdges;var n=e.getSource()===e.getTarget();var a=e.getParallelEdges();var o=a.indexOf(e);if(o===-1){return 0}var s;if(n){var u=a.getAttribute("width");s=0;for(var l=0;l<=o;++l){s=Math.round(s+u[l])}}else{var f=e.getSource();var h=a.size;if(h===1&&!r){return 0}if(i){var v=0;for(var d=0;d<o;++d){if(a.get(d).getSource()===f){v+=1}}s=v+1}else{var c=f!==a.get(0).getSource();if(h%2===1&&!r){if(o===0){s=0}else{s=((o+1)/2|0)*(o%2===0?1:-1)*(c?-1:1)}}else{s=((o/2|0)+1)*(o%2===0?1:-1)*(c?-1:1)}}}return s}}})};var Lv=function e(t){var r=this;this._events=t.modules.events;this._graphics=t.modules.graphics;this._originalStyles=this._graphics.createFlexArrays();this._individualStyles=this._graphics.createFlexArrays();this._events.on({"addNodes addEdges":function(e){var t=e.nodes;var i=e.edges;var n=e.objects;var a=t||i;var o=n.map(function(e){return e.attributes});r._graphics.assignFlexArrays(r._originalStyles,a,o)}});this._graphics.addAttributeLayer({priority:Hh,nodeAttributes:this._originalStyles.nodes,edgeAttributes:this._originalStyles.edges});this._graphics.addAttributeLayer({priority:Zh,nodeAttributes:this._individualStyles.nodes,edgeAttributes:this._individualStyles.edges})};Lv.prototype._getUsedAttributes=function e(t){return Lh(t?this._individualStyles.nodes:this._individualStyles.edges)};Lv.prototype._getUsedOriginalAttributes=function e(t){return Lh(t?this._originalStyles.nodes:this._originalStyles.edges)};Lv.prototype.setMultipleAttributes=function e(t,r,i){var n=this;return this._graphics.animate(t,function(){n._graphics.assignFlexArrays(n._individualStyles,t,r);n._graphics.refresh(t);if(t.isNode){n._graphics.refresh(t.getAdjacentEdges())}},i)};Lv.prototype.setSingleAttribute=function e(t,r,i,n){var a;return this.setMultipleAttributes(t,(a={},a[r]=i,a),n)};Lv.prototype.resetMultipleAttributes=function e(t,r,i){var n=this;var a=r?r:this._getUsedAttributes(t.isNode);var o={};for(var s=0;s<a.length;++s){be(o,a[s],undefined)}return this._graphics.animate(t,function(){n._graphics.assignFlexArrays(n._individualStyles,t,o,true);n._graphics.refresh(t)},i)};Lv.prototype.getMultipleAttributes=function e(t,r){return this._graphics.getAttributeValues(t,r,true,false)};Lv.prototype.getSingleAttribute=function e(t,r){return this._graphics.getAttributeValues(t,r,false,false)};Lv.prototype.getOriginalStyles=function e(t){return this._originalStyles[t?"nodes":"edges"]};Lv.prototype.replaceOriginalAttributes=function e(t,r,i){if(i===void 0)i=[];var n={};var a=this._getUsedOriginalAttributes(t.isNode).filter(function(e){return!i.includes(e)});for(var o=0;o<a.length;++o){be(n,a[o],undefined)}this._graphics.assignFlexArrays(this._originalStyles,t,n,true);this._graphics.assignFlexArrays(this._originalStyles,t,r,false);this._graphics.refresh(t)};Lv.prototype.getSinglePreviousAttribute=function e(t,r){return this._graphics.getAttributeValues(t,r,false,true)};Lv.prototype.getMultiplePreviousAttributes=function e(t,r){return this._graphics.getAttributeValues(t,r,true,true)};Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=e.NodeList;var n=e.EdgeList;var a=new Lv(e);var o=e.modules.camera;e.modules.individualAttributes=a;t.prototype.setAttributes=function(e,t){return a.setMultipleAttributes(this,e,t)};t.prototype.setAttribute=function(e,value,t){return a.setSingleAttribute(this,e,value,t)};t.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};t.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)[0]};t.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)[0]};i.prototype.setAttributes=function(e,t){return a.setMultipleAttributes(this,e,t)};i.prototype.setAttribute=function(e,t,r){return a.setSingleAttribute(this,e,t,r)};i.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)};i.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)};i.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};r.prototype.setAttributes=function(e,t){return a.setMultipleAttributes(this,e,t)};r.prototype.setAttribute=function(e,value,t){return a.setSingleAttribute(this,e,value,t)};r.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)[0]};r.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)[0]};r.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};n.prototype.setAttributes=function(e,t){return a.setMultipleAttributes(this,e,t)};n.prototype.setAttribute=function(e,value,t){return a.setSingleAttribute(this,e,value,t)};n.prototype.getAttributes=function(e){return a.getMultipleAttributes(this,e)};n.prototype.getAttribute=function(e){return a.getSingleAttribute(this,e)};n.prototype.resetAttributes=function(e,t){return a.resetMultipleAttributes(this,e,t)};t.prototype.getPosition=function(){return this.getAttributes(["x","y"])};i.prototype.getPosition=function(){return this.getAttributes(["x","y"])};t.prototype.getPositionOnScreen=function(){return o.graphToScreenCoordinates(this.getPosition())};t.prototype.isInScreen=function(){var e=this.getPositionOnScreen();return e.x>=0&&e.x<=o.width&&e.y>=0&&e.y<=o.height};t.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};i.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};r.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};n.prototype.replaceOriginalAttributes=function(e,t){return a.replaceOriginalAttributes(this,e,t)};t.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)[0]};i.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)};r.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)[0]};n.prototype.getPreviousAttributes=function(e){return a.getMultiplePreviousAttributes(this,e)};i.prototype.getPreviousAttribute=function(e){return a.getSinglePreviousAttribute(this,e)};n.prototype.getPreviousAttribute=function(e){return a.getSinglePreviousAttribute(this,e)}});var zv=1e3;var Dv=1/zv;var Pv=function e(t){this._ogma=t;this._graphics=t.modules.graphics;this._idCounter=1;this._rules=[]};Pv.prototype._get=function e(t){var r=this;for(var i=0;i<this._rules.length;++i){var n=r._rules[i];if(n.id===t){n.index=i;return n}}throw new Error("calling a method on a destroyed style rule")};Pv.prototype._updatePriorities=function e(){var t=this;for(var r=0;r<this._rules.length;++r){var i=t._rules[r];var n=qh+r*Dv;i.attributeLayer.update({priority:n})}};Pv.prototype._afterNextFrame=function e(){return this._ogma.view.afterNextFrame()};Pv.prototype.addRule=function e(t){var r=this._idCounter++;var i=this._graphics.addAttributeLayer(t);var n=this._afterNextFrame();var a=new Fv(this,r,n);var o={id:r,attributeLayer:i,wrapper:a};this._rules.push(o);this._updatePriorities();return a};Pv.prototype.getRuleIndex=function e(t){return this._get(t).index};Pv.prototype.setRuleIndex=function e(t,r){var i=this._get(t);var n=Qt(r,0,this._rules.length-1);this._rules.splice(i.index,1);this._rules.splice(n,0,i);this._updatePriorities();return this._afterNextFrame()};Pv.prototype.updateRule=function e(t,r){var i=this._get(t);i.attributeLayer.update(r);return this._afterNextFrame()};Pv.prototype.getRuleDefinition=function e(t){var r=this._get(t);var i=r.attributeLayer.getDefinition();return{nodeAttributes:i.nodeAttributes,edgeAttributes:i.edgeAttributes,nodeSelector:i.nodeSelector,edgeSelector:i.edgeSelector}};Pv.prototype.destroyRule=function e(t){var r=this._get(t);r.attributeLayer.destroy();this._rules.splice(r.index,1);return this._afterNextFrame()};Pv.prototype.refreshAllRules=function e(){this._graphics.refreshAll();return this._afterNextFrame()};Pv.prototype.getRuleList=function e(){return this._rules.map(function(e){return e.wrapper})};var Fv=function e(t,r,i){var n=this;this._module=t;this._id=r;this._whenApplied=i.then(function(){return n})};Fv.prototype.getId=function e(){return this._id};Fv.prototype.whenApplied=function e(){return this._whenApplied};Fv.prototype.refresh=function e(){return this._module.refreshAllRules()};Fv.prototype.getIndex=function e(){return this._module.getRuleIndex(this._id)};Fv.prototype.setIndex=function e(t){return this._module.setRuleIndex(this._id,t)};Fv.prototype.update=function e(t){return this._module.updateRule(this._id,t)};Fv.prototype.getDefinition=function e(){return this._module.getRuleDefinition(this._id)};Fv.prototype.destroy=function e(){return this._module.destroyRule(this._id)};Fv.prototype.delete=function e(){return this.destroy()};Ogma.extend(function(e){var t=new Pv(e);e.modules.styleRules=t;e.styles.addRule=function(e){return t.addRule(e)};e.styles.getRuleList=function(){return t.getRuleList()};e.styles.addNodeRule=function(t,r){if(arguments.length===1){r=t;t=undefined}return e.styles.addRule({nodeAttributes:r,nodeSelector:t})};e.styles.addEdgeRule=function(t,r){if(arguments.length===1){r=t;t=undefined}return e.styles.addRule({edgeAttributes:r,edgeSelector:t})};e.styles.getNodeRules=function(){return e.styles.getRuleList().filter(function(e){return e.getDefinition().edgeAttributes===undefined})};e.styles.getEdgeRules=function(){return e.styles.getRuleList().filter(function(e){return e.getDefinition().nodeAttributes===undefined})}});var Bv=1e3;var Rv=.5/Bv;var Ov=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._graphics=t.modules.graphics;this._idCounter=1;this._builtinClasses=[];this._userClasses=[];this._classesByName={};this._events.on({excludedStateChange:function(e){var t=e.elements;var value=e.value;if(value){var i=Object.keys(r._classesByName);r._addOrRemoveClassesToElements(i,t,false)}},clear:function(){r._builtinClasses.concat(r._userClasses).forEach(function(e){return e.elementSet.clear()})}})};Ov.prototype._getClassList=function e(t){return t?this._builtinClasses:this._userClasses};Ov.prototype.createClass=function e(t){if(t===void 0)t={};var r=t.name;var i=t.nodeAttributes;var n=t.edgeAttributes;var a=t.isBuiltin;var o=t.after;if(typeof r!=="string"){throw new Error('the "name" argument should be a string')}var s=this._getClassList(a);var u=o?jv(s,o)+1:s.length;if(u===-1){throw new Error('createClass: class specified as `after` parameter "'+o+'" does not exist')}if(a&&!r.startsWith("_")){throw new Error('invalid builtin class name "'+r+"\": builtin classes should start with '_'")}var l=new Ch(this._ogma);var f=new Uv(this,r);var h=this._graphics.addAttributeLayer({nodeAttributes:i,edgeAttributes:n,nodeSelector:function(e,t){return t.hasElement(e)},edgeSelector:function(e,t){return t.hasElement(e)},nodeContext:l,edgeContext:l});var v={name:r,elementSet:l,attributeLayer:h,isBuiltin:a,wrapper:f};s.splice(u,0,v);if(a){s.sort(function(e,t){return ov.indexOf(e.name)-ov.indexOf(t.name)})}this._updatePriorities(a);this._classesByName[r]=v;this._events.register([Vv(r,true,true),Vv(r,true,false),Vv(r,false,true),Vv(r,false,false)]);return f};Ov.prototype._updatePriorities=function e(t){var r=this._getClassList(t);var i=$h+(t?.5:0);for(var n=0;n<r.length;++n){var a=r[n];var o=i+Rv*n;a.attributeLayer.update({priority:o})}};Ov.prototype._get=function e(t){var r=this._classesByName[t];if(!r){throw new Error('class "'+t+'" does not exist')}return r};Ov.prototype.getIndex=function e(t){var r=this._get(t);var i=this._getClassList(r.isBuiltin);return i.indexOf(r)};Ov.prototype.setIndex=function e(t,r){var i=this._get(t);var n=this._getClassList(i.isBuiltin);var a=n.indexOf(i);var o=Qt(r,0,n.length-1);n.splice(a,1);n.splice(o,0,i);this._updatePriorities(i.isBuiltin)};Ov.prototype.update=function e(t,r){if(r===void 0)r={};var i=this._get(t);i.attributeLayer.update({nodeAttributes:r.nodeAttributes,edgeAttributes:r.edgeAttributes,fullOverwrite:r.fullOverwrite})};Ov.prototype.getDefinition=function e(t){var r=this._get(t);var i=r.attributeLayer.getDefinition();var n=i.nodeAttributes;var a=i.edgeAttributes;return{nodeAttributes:n,edgeAttributes:a}};Ov.prototype._addOrRemoveClassesToElements=function e(t,r,i){var n=this;var a=r.isNode;for(var o=0;o<t.length;++o){var s=t[o];var u=n._get(s);var l=u.elementSet;var f=l.addOrRemoveElements(r,i);var h=Vv(s,a,i);if(f.size){n._refreshElements(f);n._events.fire(h,a?{nodes:f}:{edges:f})}}};Ov.prototype.addClassesToElements=function e(t,r,i){var n=this;return this._graphics.animate(r,function(){n._addOrRemoveClassesToElements(t,r,true)},i)};Ov.prototype.removeClassesFromElements=function e(t,r,i){var n=this;return this._graphics.animate(r,function(){n._addOrRemoveClassesToElements(t,r,false)},i)};Ov.prototype.hasSingleElementClass=function e(t,r){return this._get(t).elementSet.hasElement(r)};Ov.prototype.getElementsClassList=function e(t,r){if(r===void 0)r={};var i=r.includeBuiltinClasses;if(i===void 0)i=false;var n=new Array(t.size);for(var a=0;a<n.length;++a){n[a]=[]}this._addClassNamesToList(n,t,this._userClasses);if(i){this._addClassNamesToList(n,t,this._builtinClasses)}return n};Ov.prototype._addClassNamesToList=function e(t,r,i){var n=this;var a=r.toList();for(var o=0;o<i.length;++o){var s=n._userClasses[o];var u=s.name;var l=s.elementSet;for(var f=0;f<a.size;++f){var h=a.get(f);if(l.hasElement(h)){t[f].push(u)}}}};Ov.prototype._refreshElements=function e(t){this._graphics.refresh(t)};Ov.prototype.getClassByName=function e(t,r){if(r===void 0)r=false;var i=this._classesByName[t]||null;if(r&&!i){throw new Error('class "'+t+'" does not exist')}return i&&i.wrapper};Ov.prototype.getClassList=function e(){return this._userClasses.map(function(e){return e.wrapper})};Ov.prototype.getElementsByClass=function e(t){var r=this._get(t);var i=r.elementSet;return i.getElements()};Ov.prototype._onClassEvent=function e(t,r,i,n){var a=Vv(t,i,n);this._events.on(a,r)};Ov.prototype.onNodeClassAdded=function e(t,r){this._onClassEvent(t,r,true,true)};Ov.prototype.onNodeClassRemoved=function e(t,r){this._onClassEvent(t,r,true,false)};Ov.prototype.onEdgeClassAdded=function e(t,r){this._onClassEvent(t,r,false,true)};Ov.prototype.onEdgeClassRemoved=function e(t,r){this._onClassEvent(t,r,false,false)};function Vv(e,t,r){return(t?"node":"edge")+"Class"+(r?"Added":"Removed")+"_"+e}function jv(e,t){for(var r=0;r<e.length;++r){if(e[r].name===t){return r}}return-1}var Uv=function e(t,r){this._classes=t;this._name=r};Uv.prototype.getName=function e(){return this._name};Uv.prototype.getIndex=function e(){return this._classes.getIndex(this._name)};Uv.prototype.setIndex=function e(t){return this._classes.setIndex(this._name,t)};Uv.prototype.update=function e(t){return this._classes.update(this._name,t)};Uv.prototype.getDefinition=function e(){return this._classes.getDefinition(this._name)};Uv.prototype.getNodes=function e(){return this._classes.getElementsByClass(this._name).nodes};Uv.prototype.getEdges=function e(){return this._classes.getElementsByClass(this._name).edges};Uv.prototype.clearNodes=function e(){this.getNodes().removeClass(this._name)};Uv.prototype.clearEdges=function e(){this.getEdges().removeClass(this._name)};Uv.prototype.add=function e(t){t.addClass(this._name)};Uv.prototype.remove=function e(t){t.removeClass(this._name)};Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=e.NodeList;var n=e.EdgeList;var a=new Ov(e);e.modules.classes=a;e.createClass=function(t,r){return e.styles.createClass(Object.assign({},r,{name:t}))};e.updateClass=function(e,t){return a.getClassByName(e,true).update(t)};e.getNodesByClassName=function(e){return a.getClassByName(e,true).getNodes()};e.getEdgesByClassName=function(e){return a.getClassByName(e,true).getEdges()};e.styles.createClass=function(e){return a.createClass(e)};e.styles.getClass=function(e){return a.getClassByName(e)};e.styles.getClassList=function(){return a.getClassList()};e.events.onNodesClassAdded=function(t,r){a.onNodeClassAdded(t,r);return e.events};e.events.onNodesClassRemoved=function(t,r){a.onNodeClassRemoved(t,r);return e.events};e.events.onEdgesClassAdded=function(t,r){a.onEdgeClassAdded(t,r);return e.events};e.events.onEdgesClassRemoved=function(t,r){a.onEdgeClassRemoved(t,r);return e.events};t.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};i.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};t.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};i.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};t.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};i.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};t.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};i.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};t.prototype.hasClass=function(e){return a.hasSingleElementClass(e,this)};i.prototype.hasClass=function(e){return this.map(function(t){return a.hasSingleElementClass(e,t)})};t.prototype.getClassList=function(){return a.getElementsClassList(this)[0]};i.prototype.getClassList=function(){return a.getElementsClassList(this)};r.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};n.prototype.addClass=function(e,t){return a.addClassesToElements([e],this,t)};r.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};n.prototype.addClasses=function(e,t){return a.addClassesToElements(e,this,t)};r.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};n.prototype.removeClass=function(e,t){return a.removeClassesFromElements([e],this,t)};r.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};n.prototype.removeClasses=function(e,t){return a.removeClassesFromElements(e,this,t)};r.prototype.hasClass=function(e){return a.hasSingleElementClass(e,this)};n.prototype.hasClass=function(e){return this.map(function(t){return a.hasSingleElementClass(e,t)})};r.prototype.getClassList=function(){return a.getElementsClassList(this)[0]};n.prototype.getClassList=function(){return a.getElementsClassList(this)}});var Gv=function e(t,r){this.key=t;this.data=r;this.left=null;this.right=null};function Xv(e,t){return e>t?1:e<t?-1:0}function Wv(e,t,r){if(t===null){return t}var i,n,a;var o=new Gv;i=n=o;while(true){var s=r(e,t.key);if(s<0){if(t.left===null){break}if(r(e,t.left.key)<0){a=t.left;t.left=a.right;a.right=t;t=a;if(t.left===null){break}}n.left=t;n=t;t=t.left}else if(s>0){if(t.right===null){break}if(r(e,t.right.key)>0){a=t.right;t.right=a.left;a.left=t;t=a;if(t.right===null){break}}i.right=t;i=t;t=t.right}else{break}}i.right=t.left;n.left=t.right;t.left=o.right;t.right=o.left;return t}function Yv(e,t,r,i,n){var a=new Gv(e,t);n._size++;if(r===null){a.left=a.right=null;return a}r=Wv(e,r,i);var o=i(e,r.key);if(o<0){a.left=r.left;a.right=r;r.left=null}else if(o>=0){a.right=r.right;a.left=r;r.right=null}return a}function Hv(e,t,r,i,n){var a=new Gv(e,t);if(r===null){a.left=a.right=null;n._size++;return a}r=Wv(e,r,i);var o=i(e,r.key);if(o===0){return r}else{if(o<0){a.left=r.left;a.right=r;r.left=null}else if(o>0){a.right=r.right;a.left=r;r.right=null}n._size++;return a}}function qv(e,t,r,i){var n;if(t===null){return null}t=Wv(e,t,r);if(e===t.key){if(t.left===null){n=t.right}else{n=Wv(e,t.left,r);n.right=t.right}i._size--;return n}return t}function Zv(e,t,r){var i,n;if(t===null){i=n=null}else{t=Wv(e,t,r);var a=r(t.key,e);if(a===0){i=t.left;n=t.right}else if(a<0){n=t.right;t.right=null;i=t}else{i=t.left;t.left=null;n=t}}return{left:i,right:n}}function $v(e,t,r){if(t===null){return e}if(e===null){return t}t=Wv(e.key,t,r);t.left=e;return t}function Kv(e,t,r,i,n){if(e){i(""+t+(r?" ":" ")+n(e)+"\n");var a=t+(r?"    ":"   ");if(e.left){Kv(e.left,a,false,i,n)}if(e.right){Kv(e.right,a,true,i,n)}}}var Jv=function e(t){if(t===void 0)t=Xv;this._comparator=t;this._root=null;this._size=0};var Qv={size:{configurable:true}};Jv.prototype.insert=function e(t,r){return this._root=Yv(t,r,this._root,this._comparator,this)};Jv.prototype.add=function e(t,r){return this._root=Hv(t,r,this._root,this._comparator,this)};Jv.prototype.remove=function e(t){this._root=qv(t,this._root,this._comparator,this)};Jv.prototype.pop=function e(){var t=this._root;if(t){while(t.left){t=t.left}this._root=Wv(t.key,this._root,this._comparator);this._root=qv(t.key,this._root,this._comparator,this);return{key:t.key,data:t.data}}return null};Jv.prototype.findStatic=function e(t){var r=this._root;var i=this._comparator;while(r){var n=i(t,r.key);if(n===0){return r}else if(n<0){r=r.left}else{r=r.right}}return null};Jv.prototype.find=function e(t){if(this._root){this._root=Wv(t,this._root,this._comparator);if(this._comparator(t,this._root.key)!==0){return null}}return this._root};Jv.prototype.contains=function e(t){var r=this._root;var i=this._comparator;while(r){var n=i(t,r.key);if(n===0){return true}else if(n<0){r=r.left}else{r=r.right}}return false};Jv.prototype.forEach=function e(t,r){var i=this._root;var n=[];var a=false;while(!a){if(i!==null){n.push(i);i=i.left}else{if(n.length!==0){i=n.pop();t.call(r,i);i=i.right}else{a=true}}}return this};Jv.prototype.range=function e(t,r,i,n){var a=this;var o=[];var s=this._comparator;var u=this._root,l;while(o.length!==0||u){if(u){o.push(u);u=u.left}else{u=o.pop();l=s(u.key,r);if(l>0){break}else if(s(u.key,t)>=0){if(i.call(n,u)){return a}}u=u.right}}return this};Jv.prototype.keys=function e(){var e=[];this.forEach(function(t){var r=t.key;return e.push(r)});return e};Jv.prototype.values=function e(){var e=[];this.forEach(function(t){var r=t.data;return e.push(r)});return e};Jv.prototype.min=function e(){if(this._root){return this.minNode(this._root).key}return null};Jv.prototype.max=function e(){if(this._root){return this.maxNode(this._root).key}return null};Jv.prototype.minNode=function e(t){if(t===void 0)t=this._root;if(t){while(t.left){t=t.left}}return t};Jv.prototype.maxNode=function e(t){if(t===void 0)t=this._root;if(t){while(t.right){t=t.right}}return t};Jv.prototype.at=function e(t){var r=this._root,i=false,n=0;var a=[];while(!i){if(r){a.push(r);r=r.left}else{if(a.length>0){r=a.pop();if(n===t){return r}n++;r=r.right}else{i=true}}}return null};Jv.prototype.next=function e(t){var r=this._root;var i=null;if(t.right){i=t.right;while(i.left){i=i.left}return i}var n=this._comparator;while(r){var a=n(t.key,r.key);if(a===0){break}else if(a<0){i=r;r=r.left}else{r=r.right}}return i};Jv.prototype.prev=function e(t){var r=this._root;var i=null;if(t.left!==null){i=t.left;while(i.right){i=i.right}return i}var n=this._comparator;while(r){var a=n(t.key,r.key);if(a===0){break}else if(a<0){r=r.left}else{i=r;r=r.right}}return i};Jv.prototype.clear=function e(){this._root=null;this._size=0;return this};Jv.prototype.toList=function e(){return rd(this._root)};Jv.prototype.load=function e(t,r,i){if(t===void 0)t=[];if(r===void 0)r=[];if(i===void 0)i=false;var n=t.length;var a=this._comparator;if(i){ad(t,r,0,n-1,a)}if(this._root===null){this._root=ed(this._root,t,r,0,n);this._size=n}else{var o=nd(this.toList(),td(t,r),a);n=this._size+n;this._root=id({head:o},0,n)}return this};Jv.prototype.isEmpty=function e(){return this._root===null};Qv.size.get=function(){return this._size};Jv.prototype.toString=function e(t){if(t===void 0)t=function(e){return e.key};var r=[];Kv(this._root,"",true,function(e){return r.push(e)},t);return r.join("")};Jv.prototype.update=function e(t,r,i){var n=this._comparator;var a=Zv(t,this._root,n);var o=a.left;var s=a.right;this._size--;if(n(t,r)<0){s=Yv(r,i,s,n,this)}else{o=Yv(r,i,o,n,this)}this._root=$v(o,s,n)};Jv.prototype.split=function e(t){return Zv(t,this._root,this._comparator)};Object.defineProperties(Jv.prototype,Qv);function ed(e,t,r,i,n){var a=n-i;if(a>0){var o=i+Math.floor(a/2);var s=t[o];var u=r[o];var l={key:s,data:u,parent:e};l.left=ed(l,t,r,i,o);l.right=ed(l,t,r,o+1,n);return l}return null}function td(e,t){var r={next:null};var i=r;for(var n=0;n<e.length;n++){i=i.next={key:e[n],data:t[n]}}i.next=null;return r.next}function rd(e){var t=e;var r=[],i=false;var n={next:null};var a=n;while(!i){if(t){r.push(t);t=t.left}else{if(r.length>0){t=a=a.next=r.pop();t=t.right}else{i=true}}}a.next=null;return n.next}function id(e,t,r){var i=r-t;if(i>0){var n=t+Math.floor(i/2);var a=id(e,t,n);var o=e.head;o.left=a;e.head=e.head.next;o.right=id(e,n+1,r);return o}return null}function nd(e,t,r){if(r===void 0)r=function(e,t){return e-t};var i={};var n=i;var a=e;var o=t;while(a!==null&&o!==null){if(r(a.key,o.key)<0){n.next=a;a=a.next}else{n.next=o;o=o.next}n=n.next}if(a!==null){n.next=a}else if(o!==null){n.next=o}return i.next}function ad(e,t,r,i,n){if(r>=i){return}var a=e[r+i>>1];var o=r-1;var s=i+1;while(true){do{o++}while(n(e[o],a)<0);do{s--}while(n(e[s],a)>0);if(o>=s){break}var u=e[o];e[o]=e[s];e[s]=u;u=t[o];t[o]=t[s];t[s]=u}ad(e,t,r,s,n);ad(e,t,s+1,i,n)}var od=function(e){function t(t){e.call(this,t,true)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;return t}(Jv);od.prototype.lte=function(e){var t=this._comparator;var r=this._root,i;while(r){i=t(r.key,e);if(r.left===null&&r.right===null&&i>0){return null}if(i<=0&&r.right===null||i<=0&&t(r.right.key,e)>0){return r}if(i>=0){r=r.left}else{r=r.right}}return r};od.prototype.gte=od.prototype.gte||function(e){var t=[];var r=this._comparator;var i=this._root;while(t.length!==0||i){if(i){t.push(i);i=i.left}else{i=t.pop();if(r(i.key,e)>=0){break}i=i.right}}return i};od.prototype.clear=od.prototype.clear||function(){this._root=null;this._size=0;return this};var sd=16;var ud=function e(t,r,i){if(t===void 0)t=Int32Array;if(r===void 0)r=sd;if(i===void 0)i=8;this._BIG_LIST=new Uint8Array([-1])[0];this._ArrayType=t;this._capacity=r;this._MAX_LIST_SIZE=i;this._freeIndex=-1;this.clear()};var ld={averageSize:{configurable:true}};ud.prototype.clear=function e(){this._buffer=new this._ArrayType(this._capacity*this._MAX_LIST_SIZE);this._sizes=new Uint8Array(this._capacity);this._bigLists=[];this._nextIndex=0;this._idToIndex={};this._constList=new Array(this._MAX_LIST_SIZE)};ud.prototype.addEntry=function e(t){var r;if(this._freeIndex===-1){r=this._nextIndex++}else{r=this._freeIndex;this._freeIndex=-1}this._idToIndex[t]=r;if(r>=this._capacity){this._expand(r+1)}this._sizes[r]=0;return r};ud.prototype.getItems=function e(t){var r=this;var i=this._idToIndex[t];var n=this._sizes[i];var a=this._MAX_LIST_SIZE*i;if(n<=this._MAX_LIST_SIZE){this._constList.length=n;for(var o=0,s=n;o<s;++o){r._constList[o]=r._buffer[a+o]}return this._constList}else if(n===this._BIG_LIST){var u=this._buffer[a];return this._bigLists[u]}};ud.prototype.removeEntry=function e(t){var r=this._idToIndex[t];var i=this._sizes[r];if(i===this._BIG_LIST){var n=this._MAX_LIST_SIZE*r;var a=this._buffer[n];this._bigLists[a].length=0}this._sizes[r]=0;this._freeIndex=r};ud.prototype.size=function e(t){var r=this._idToIndex[t];var e=this._sizes[r];return e<=this._MAX_LIST_SIZE?e:this._bigLists[this._buffer[r*this._MAX_LIST_SIZE]].length};ud.prototype.sizes=function e(t){var r=this;var e=this._sizes;var i=this._bigLists;var n=this._buffer;var a=this._MAX_LIST_SIZE;var o=t.length;var s=new Array(o);for(var u=0;u<o;u++){var l=r._idToIndex[t[u]];var f=e[l];s[u]=f<=a?f:i[n[l*a]].length}return s};ud.prototype.addTo=function e(t,value){var r=this;var i=this._idToIndex[t];var n=this._sizes[i];var a=i*this._MAX_LIST_SIZE;if(n<this._MAX_LIST_SIZE){this._buffer[a+n]=value;this._sizes[i]=n+1}else if(n===this._BIG_LIST){var o=this._buffer[a];this._bigLists[o].push(value)}else{var s=new Array(this._MAX_LIST_SIZE);for(var u=0;u<this._MAX_LIST_SIZE;++u){s[u]=r._buffer[a+u]}s.push(value);this._bigLists.push(s);this._sizes[i]=this._BIG_LIST;this._buffer[a]=this._bigLists.length-1}};ud.prototype.removeFrom=function e(t,value){this.removeFromAndGetSize(t,value)};ud.prototype.removeFromAndGetSize=function e(t,value){var r=this;var i=this._idToIndex[t];var n=this._sizes[i],a=this._MAX_LIST_SIZE*i;if(n<=this._MAX_LIST_SIZE){for(var o=a,s=a+n;o<s;++o){if(r._buffer[o]===value){n-=1;r._buffer[o]=r._buffer[s-1];r._sizes[i]=n;return n}}}else if(n===this._BIG_LIST){var u=this._buffer[a],l=this._bigLists[u],f=l.indexOf(value);if(f!==-1){l.splice(f,1);return l.length}}};ud.prototype.reserve=function e(t){if(this._capacity<t){this._expand(t)}};ud.prototype._expand=function e(t){this._capacity=Math.pow(2,Math.ceil(Math.log2(t)));this._buffer=fd(this._buffer,this._capacity*this._MAX_LIST_SIZE);this._sizes=fd(this._sizes,this._capacity)};ud.prototype.has=function e(t){var r=this._idToIndex[t];if(r===undefined||r>=this._capacity){return false}return this._sizes[r]!==0};ld.averageSize.get=function(){var e=this;var t=0;for(var r=0;r<this._capacity;r++){t+=e._sizes[r]}return t/this._capacity};Object.defineProperties(ud.prototype,ld);function fd(e,t){var r=new e.constructor(t);r.set(e);return r}var hd=[0,1],vd=[0,2];for(var dd=4;dd<65535;dd<<=2){for(var cd=0,_d=hd.length;cd<_d;cd++){hd.push(hd[cd]|dd);vd.push((hd[cd]|dd)<<1)}}function gd(e,t){return(vd[t&255]|hd[e&255])+(vd[t>>8&255]|hd[e>>8&255])*65536+(vd[t>>16&255]|hd[e>>16&255])*4294967296}gd.code=function e(t,r,i){if(t>24){throw"Morton codes are only supported up to Z=24"}var n=1<<24-t;return gd(r*n,i*n)};gd.range=function e(t,r,i){if(t>24){throw"Morton ranges are only supported up to Z=24"}var n=1<<24-t;var a=gd(r*n,i*n);return[a,a+n*n-1]};var pd,yd;function md(e,t){if(t===void 0)t=[];if(e>0xffffffffffff){throw"Only morton codes up to 48 bits are supported."}if(!pd){pd={};yd={};for(var r=0;r<256;r++){pd[gd(r,0)]=r;yd[gd(0,r)]=r}}var i=pd[e&21845];var n=yd[e&43690];if(e>65535){e/=65536;i|=pd[e&21845]<<8;n|=yd[e&43690]<<8;if(e>65535){e/=65536;i|=pd[e&21845]<<16;n|=yd[e&43690]<<16}}t[0]=i;t[1]=n;return t}gd.reverse=md;gd.decode=function e(t,r){var i=md(r);var n=1<<24-t;return[i[0]/n,i[1]/n]};gd.min=function e(t,r){var i=t&1431655765;var n=r&1431655765;var a=t&2863311530;var o=r&2863311530;return Math.min(i,n)+Math.min(a,o)};var xd=0;var bd=1;var Ad=3;var wd=4;var Ed=5;var Sd=eo;var Cd=ro;function Td(e,t){return e[3]>t[1]&&e[1]<t[3]&&(e[2]>t[0]&&e[0]<t[2])}function Md(e,t,r,i,n,a,o,s){if(e>=n&&t>=a&&e<=o&&t<=s){return true}if(r>=n&&i>=a&&r<=o&&i<=s){return true}if(Nd(e,t,r,i,n,a,n,s)){return true}if(Nd(e,t,r,i,o,a,o,s)){return true}if(Nd(e,t,r,i,n,a,o,a)){return true}if(Nd(e,t,r,i,n,s,o,s)){return true}return false}function kd(e,t,r){return Math.min(Math.max(t,e),r)}function Id(e,t,r,i,n,a,o){var s=kd(e,i,a);var u=kd(t,n,o);var l=e-s;var f=t-u;var h=l*l+f*f;return h<r*r}function Nd(e,t,r,i,n,a,o,s){var u=((o-n)*(t-a)-(s-a)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));var l=((r-e)*(t-a)-(i-t)*(e-n))/((s-a)*(r-e)-(o-n)*(i-t));if(u>=0&&u<=1&&l>=0&&l<=1){return true}return false}function Ld(e,t){var r=e.type;var i=e.coordinates;if(r===Ed){return Id(i[0],i[1],i[2],t[0],t[1],t[2],t[3])}else if(r===bd){return Md(i[0],i[1],i[2],i[3],t[0],t[1],t[2],t[3])}else if(r===Ad){return Sd(i[0],i[1],i[2],i[3],i[4],i[5],t[0],t[1],t[2],t[3])}else if(r===wd){return Cd(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],t[0],t[1],t[2],t[3])}else{return Td(i,t)}}function zd(e,t,r,i,n){var a=Math.abs(r-e),o=e<r?1:-1;var s=-Math.abs(i-t),u=t<i?1:-1;var l=a+s,f;for(;;){n(e,t);f=2*l;if(f>=s){if(e===r){break}l+=s;e+=o}if(f<=a){if(t===i){break}l+=a;t+=u}}}function Dd(e,t,r,i,n){var a=e<r?1:-1,o=t<i?1:-1,s;var u=Math.abs(r-e),l=Math.abs(i-t),f=u*u+l*l;var h=f==0?1:16777087/Math.sqrt(f);u*=h;l*=h;f=u-l;for(;;){n(e,t,Math.abs(f-u+l)>>16);h=f;s=e;if(2*h>=-u){if(e==r){break}if(h+l<16711680){n(e,t+o,h+l>>16)}f-=l;e+=a}if(2*h<=l){if(t==i){break}if(u-h<16711680){n(s+a,t,u-h>>16)}f+=u;t+=o}}}function Pd(e,t){if(t===void 0)t="assert error";if(!e){throw new Error(t)}}function Fd(e,t,r,i,n,a,o){var s=n-r,u=a-i;var l=e-r,f=t-i,h;var v,d,c,_=l*u-f*s;Pd(l*s<=0&&f*u<=0,"sign of gradient must not change");if(s*s+u*u>l*l+f*f){n=e;e=s+r;a=t;t=u+i;_=-_}if(_!=0){l+=s;l*=s=e<n?1:-1;f+=u;f*=u=t<a?1:-1;h=2*l*f;l*=l;f*=f;if(_*s*u<0){l=-l;f=-f;h=-h;_=-_}v=4*u*_*(r-e)+l-h;d=4*s*_*(t-i)+f-h;l+=l;f+=f;c=v+d+h;do{o(e,t);if(e==n&&t==a){return}i=2*c<v;if(2*c>d){e+=s;v-=h;c+=d+=f}if(i){t+=u;d-=h;c+=v+=l}}while(d<0&&v>0)}zd(e,t,n,a,o)}function Bd(e,t,r,i,n,a,o){var s=e-r,u=t-i;var l=e-2*r+n,f;if(s*(n-r)>0){if(u*(a-i)>0){if(Math.abs((t-2*i+a)/l*s)>Math.abs(u)){e=n;n=s+r;t=a;a=u+i}}l=(e-r)/l;f=(1-l)*((1-l)*t+2*l*i)+l*l*a;l=(e*n-r*r)*l/(e-r);s=Math.floor(l+.5);u=Math.floor(f+.5);f=(i-t)*(l-e)/(r-e)+t;Rd(e,t,s,Math.floor(f+.5),s,u,o);f=(i-a)*(l-n)/(r-n)+a;e=r=s;t=u;i=Math.floor(f+.5)}if((t-i)*(a-i)>0){l=t-2*i+a;l=(t-i)/l;f=(1-l)*((1-l)*e+2*l*r)+l*l*n;l=(t*a-i*i)*l/(t-i);s=Math.floor(f+.5);u=Math.floor(l+.5);f=(r-e)*(l-t)/(i-t)+e;Rd(e,t,Math.floor(f+.5),u,s,u,o);f=(r-n)*(l-a)/(i-a)+n;e=s;r=Math.floor(f+.5);t=i=u}Rd(e,t,r,i,n,a,o)}function Rd(e,t,r,i,n,a,o){var s=n-r,u=a-i;var l=e-r,f=t-i,h;var v,d,c,_,g=l*u-f*s;if(s*s+u*u>l*l+f*f){n=e;e=s+r;a=t;t=u+i;g=-g}if(g!=0){l+=s;l*=s=e<n?1:-1;f+=u;f*=u=t<a?1:-1;h=2*l*f;l*=l;f*=f;if(g*s*u<0){l=-l;f=-f;h=-h;g=-g}v=4*u*(r-e)*g+l-h;d=4*s*(t-i)*g+f-h;l+=l;f+=f;c=v+d+h;do{g=Math.min(v+h,-h-d);_=Math.max(v+h,-h-d);_+=2*_*g*g/(4*_*_+g*g);o(e,t,255*Math.abs(c-v-d-h)/_);if(e==n||t==a){break}r=e;g=v-c;i=2*c+d<0;if(2*c+v>0){if(c-d<_){o(e,t+u,255*Math.abs(c-d)/_)}e+=s;v-=h;c+=d+=f}if(i){if(g<_){o(r+s,t,255*Math.abs(g)/_)}t+=u;d-=h;c+=v+=l}}while(d<v)}Dd(e,t,n,a,o)}function Od(e,t,r,i,n,a,o,s,u){var l,f,h,v=1;var d=e<o?1:-1,c=t<s?1:-1;var _=-Math.abs(e+r-n-o),g=_-4*d*(r-n),p=d*(e-r-n+o);var y=-Math.abs(t+i-a-s),m=y-4*c*(i-a),x=c*(t-i-a+s);var b,A,w,E,S,C,T,M,k,I,N,L=.01;Pd((r-e)*(n-o)<L&&((o-e)*(r-n)<L||p*p<g*_+L),"slope change");Pd((i-t)*(a-s)<L&&((s-t)*(i-a)<L||x*x<m*y+L),"slope change");if(g==0&&m==0){d=Math.floor((3*r-e+1)/2);c=Math.floor((3*i-t+1)/2);return Fd(e,t,d,c,o,s,u)}r=(r-e)*(r-e)+(i-t)*(i-t)+1;n=(n-o)*(n-o)+(a-s)*(a-s)+1;do{b=g*x-p*m;A=g*y-_*m;w=p*y-_*x;I=b*(b+A-3*w)+A*A;l=I>0?1:Math.sqrt(1+1024/r);b*=l;A*=l;w*=l;I*=l*l;C=9*(b+A+w)/8;E=8*(g-m);M=27*(8*b*(x*x-m*y)+I*(m+2*x+y))/64-m*m*(C-m);k=27*(8*b*(p*p-g*_)-I*(g+2*p+_))/64-g*g*(C+g);S=3*(3*b*(3*x*x-m*m-2*m*y)-m*(3*A*(m+x)+m*E))/4;T=3*(3*b*(3*p*p-g*g-2*g*_)-g*(3*A*(g+p)+g*E))/4;C=g*m*(6*b+6*A-3*w+E);A=m*m;E=g*g;C=3*(C+9*l*(E*x*y-p*_*A)-18*p*x*b)/8;if(I<0){M=-M;k=-k;S=-S;T=-T;C=-C;A=-A;E=-E}b=6*m*A;A=-6*g*A;w=6*m*E;E=-6*g*E;M+=C;I=M+k;k+=C;e:for(N=C,f=h=l;e!=o&&t!=s;){u(e,t);do{if(M>N||k<N){break e}i=2*I-k;if(2*I>=M){f--;I+=M+=S;k+=C+=A;T+=w;S+=b}if(i<=0){h--;I+=k+=T;M+=C+=w;S+=A;T+=E}}while(f>0&&h>0);if(2*f<=l){e+=d;f+=l}if(2*h<=l){t+=c;h+=l}if(N==C&&M<0&&k>0){N=L}}S=e;e=o;o=S;d=-d;p=-p;T=t;t=s;s=T;c=-c;x=-x;r=n}while(v--);zd(e,t,o,s,u)}function Vd(e,t,r,i,n,a,o,s,u,l){var f=0,h=0;var v=e+r-n-o,d=v-4*(r-n);var c=e-r-n+o,_=c+4*(r+n);var g=t+i-a-s,p=g-4*(i-a);var y=t-i-a+s,m=y+4*(i+a);var x=e,b,A,w,E=t,S,C,T;var M=c*c-d*v,k,I=[0,0,0,0,0];if(d==0){if(Math.abs(v)<2*Math.abs(c)){I[f++]=v/(2*c)}}else if(M>0){k=Math.sqrt(M);M=(c-k)/d;if(Math.abs(M)<1){I[f++]=M}M=(c+k)/d;if(Math.abs(M)<1){I[f++]=M}}M=y*y-p*g;if(p==0){if(Math.abs(g)<2*Math.abs(y)){I[f++]=g/(2*y)}}else if(M>0){k=Math.sqrt(M);M=(y-k)/p;if(Math.abs(M)<1){I[f++]=M}M=(y+k)/p;if(Math.abs(M)<1){I[f++]=M}}for(h=1;h<f;h++){if((M=I[h-1])>I[h]){I[h-1]=I[h];I[h]=M;h=0}}M=-1;I[f]=1;for(h=0;h<=f;h++){k=I[h];b=(M*(M*c-2*v)-k*(M*(M*d-2*c)+v)+_)/8-x;S=(M*(M*y-2*g)-k*(M*(M*p-2*y)+g)+m)/8-E;A=(k*(k*c-2*v)-M*(k*(k*d-2*c)+v)+_)/8-x;C=(k*(k*y-2*g)-M*(k*(k*p-2*y)+g)+m)/8-E;x-=w=(k*(k*(3*c-k*d)-3*v)+_)/8;E-=T=(k*(k*(3*y-k*p)-3*g)+m)/8;o=Math.floor(w+.5);s=Math.floor(T+.5);if(x!=0){b*=x=(e-o)/x;A*=x}if(E!=0){S*=E=(t-s)/E;C*=E}if(e!=o||t!=s){u(e,t,e+b,t+S,e+A,t+C,o,s,l)}e=o;t=s;x=w;E=T;M=k}}function jd(e,t,r,i,n,a,o,s,u){Vd(e,t,r,i,n,a,o,s,Od,u)}/**
   * Bresenham rasterisation functions by Alois Zingl
   * @author Alois Zingl
   * @preserve
   */
var Ud=gd;var Gd=14;var Xd,Wd,Yd;function Hd(){return Xd}function qd(e){Xd=e;Wd=1<<Xd;Yd=1<<Xd-1}qd(Gd);function Zd(e,t,r){var i=1<<r;e=~~(i*((e+Yd)/Wd)),t=~~(i*((t+Yd)/Wd));return[e,t]}function $d(e,t,r){var i=1<<r;e=i*((e+Yd)/Wd),t=i*((t+Yd)/Wd);return[e,t]}function Kd(e,t,r,i,n,a){var o=Zd(e,t,n);var s=Zd(r,i,n);for(var u=o[0];u<=s[0];u++){for(var l=o[1];l<=s[1];l++){a.push(Ud(u,l,n))}}}function Jd(e,t,r,i){var n,a;for(var o=0;o<e.length-1;o++){var s=$d(e[o][0],e[o][1],t),u=$d(e[o+1][0],e[o+1][1],t),l=s[0],f=s[1],h=u[0],v=u[1],d=h-l,c=v-f;if(c===0&&d===0){continue}var _=d>0?1:-1,g=c>0?1:-1,p=Math.floor(l),y=Math.floor(f),m=d===0?Infinity:Math.abs(((d>0?1:0)+p-l)/d),x=c===0?Infinity:Math.abs(((c>0?1:0)+y-f)/c),b=Math.abs(_/d),A=Math.abs(g/c);if(p!==n||y!==a){i.push(Ud(p,y,t));if(r&&y!==a){r.push([p,y])}n=p;a=y}while(m<1||x<1){if(m<x){m+=b;p+=_}else{x+=A;y+=g}i.push(Ud(p,y,t));if(r&&y!==a){r.push([p,y])}n=p;a=y}}if(r&&y===r[0][1]){r.pop()}}function Qd(e,t,r){var i=Zd(e[0],e[1],t);var n=i[0];var a=i[1];var o=Zd(e[2],e[3],t);var s=o[0];var u=o[1];var l=Zd(e[4],e[5],t);var f=l[0];var h=l[1];Bd(n,a,s,u,f,h,function(e,i){r.push(Ud(e,i,t))})}function ec(e,t,r){var i=Zd(e[0],e[1],t);var n=i[0];var a=i[1];var o=Zd(e[2],e[3],t);var s=o[0];var u=o[1];var l=Zd(e[4],e[5],t);var f=l[0];var h=l[1];var v=Zd(e[6],e[7],t);var d=v[0];var c=v[1];jd(n,a,s,u,f,h,d,c,function(e,i){r.push(Ud(e,i,t))})}var tc=[[0,0],[0,0]];function rc(e,t){var r=e.type;var i=e.coordinates;var n=[];switch(r){case bd:tc[0][0]=i[0];tc[0][1]=i[1];tc[1][0]=i[2];tc[1][1]=i[3];Jd(tc,t,undefined,n);break;case xd:Kd(i[0],i[1],i[2],i[3],t,n);break;case Ed:var a=i[0];var o=i[1];var s=i[2];Kd(a-s,o-s,a+s,o+s,t,n);break;case Ad:Qd(i,t,n);break;case wd:ec(i,t,n);break;default:break}return n}var ic=1,nc=3,ac=4,oc=5;var sc=2863311530;var uc=4294967295;var lc=31;function fc(e,t,r){var i=e;for(var n=lc;n>=0;n--){var a=1<<n;var o=((r&a)<<2|(e&a)<<1|t&a)>>n;if(o===ic){var s=sc>>>lc-n&(~(uc<<n)&uc);t=(t|s)&~(1<<n)&uc}else if(o===nc){return i}else if(o===ac){return t}else if(o===oc){var u=sc>>>lc-n&(~(uc<<n)&uc);i=(t|u)&~(1<<n)&uc;var l=~(sc>>>lc-n)&uc;e=e&l|1<<n}}return i}function hc(e,t,r){var i=t;for(var n=lc;n>=0;n--){var a=1<<n;var o=((r&a)<<2|(e&a)<<1|t&a)>>n;if(o===ic){var s=~(sc>>>lc-n)&uc;i=e&s|1<<n;var u=sc>>>lc-n&(~(uc<<n)&uc);t=(t|u)&~(1<<n)&uc}else if(o===nc){return e}else if(o===ac){return i}else if(o===oc){var l=~(sc>>>lc-n)&uc;e=e&l|1<<n}}return i}function vc(e,t,r){for(var i=lc;i>=0;i--){var n=1<<i;var a=((r&n)<<2|(e&n)<<1|t&n)>>i;if(a===ic){var o=sc>>>lc-i&(~(uc<<i)&uc);t=(t|o)&~(1<<i)&uc}else if(a===nc){return false}else if(a===ac){return false}else if(a===oc){var s=~(sc>>>lc-i)&uc;e=e&s|1<<i}}return true}function dc(e,t,r){var i=r+1;var n=0;for(var a=lc;a>=0;a--){var o=1<<a;var s=(i&o)>>a;var u=(e&o)>>a;var l=(t&o)>>a;var f=a&1;var h=n&3<<2*f;if(h===0&&s>l&&u<=l){n|=2<<2*f;break}else if(h===0&&s<u){n|=1<<2*f;break}}if(n===0){return i}else{return hc(e,t,r)}}var cc=12;var _c=function e(t,r){if(r===void 0)r=8;this.setLevel(r);this.setAccessor(t);this._tree=new od(function(e,t){return e-t});this._nodeToId=new ud(Uint32Array,1e3,16);this._idToNode=new ud(Uint32Array,16,8);this._size=0;this._checkedNodes=[];this._codeCache=[0,0]};var gc={intersectionChecks:{configurable:true},level:{configurable:true},size:{configurable:true}};_c.prototype.setAccessor=function e(t){this._getGeometry=t;return this};_c.prototype.load=function e(t){var r=[];var i=this._nodeToId;var n=this._idToNode;var a=this._level;var o=this._getGeometry;for(var s=0;s<t.length;s++){var u=t[s];var l=o(u);var f=rc(l,a);n.addEntry(u);for(var h=0;h<f.length;h++){var v=f[h];if(!i.has(v)){i.addEntry(v);r.push(v)}i.addTo(v,u);n.addTo(u,v)}}this._tree.load(r,[],true);this._size+=t.length;return this};_c.prototype.addToPage=function e(){};_c.prototype.removeFromPage=function e(){};_c.prototype.insert=function e(t){var r=rc(this._getGeometry(t),this._level);var i=this._idToNode;var n=this._nodeToId;var a=this._tree;this._size++;i.addEntry(t);for(var o=0;o<r.length;o++){var s=r[o];if(!n.has(s)){a.insert(s);n.addEntry(s)}n.addTo(s,t);i.addTo(t,s)}};_c.prototype.remove=function e(t){var r=this._idToNode.getItems(t);var i=this._nodeToId;var n=this._tree;if(r){for(var a=0;a<r.length;a++){var o=r[a];var s=i.removeFromAndGetSize(o,t);if(s===0){n.remove(o)}}}this._idToNode.removeEntry(t);this._size--;return this};_c.prototype.update=function e(t){this.remove(t);this.insert(t);return this};_c.prototype.forEach=function e(t){this._tree.forEach(t);return this};_c.prototype.all=function e(){var e=[];this._tree.forEach(function(t){return e.push(t)});return e};_c.prototype.clear=function e(){this._tree.clear();this._nodeToId.clear();this._idToNode.clear();return this};_c.prototype.setLevel=function e(t){this._level=t;return this};_c.prototype.traverse=function e(t,r){var i=this;var n=r[0];var a=r[1];var o=r[2];var s=r[3];var u=$d(n,a,this._level);var l=u[0];var f=u[1];var h=$d(o,s,this._level);var v=h[0];var d=h[1];var c=gd(l,f);var _=gd(v,d);var g=this._tree;var p=g._root;var y=[];var m=c;while(y.length>0||p){if(p){y.push(p);p=p.left}else{p=y.pop();var x=p.key;if(x>_){break}else if(x>=c){if(x>=m){m=dc(c,_,x);if(t(p)){return i}}}p=p.right}}return this};_c.prototype.getKeys=function e(t){var r=t[0];var i=t[1];var n=t[2];var a=t[3];var o=$d(r,i,this._level);var s=o[0];var u=o[1];var l=$d(n,a,this._level);var f=l[0];var h=l[1];var v=gd(s,u);var d=gd(f,h);var c=this._tree;var _=c._root;var g=[];var p=v;while(g.length>0||_){if(_){g.push(_);_=_.left}else{_=g.pop();var y=_.key;if(y>d){break}else if(y>=v){if(y>=p){p=dc(v,d,y)}}_=_.right}}return this};_c.prototype.traverseDescend=function e(t,r){var i=r[0];var n=r[1];var a=r[2];var o=r[3];var s=$d(i,n,this._level);var u=$d(a,o,this._level);var l=gd(s[0],s[1]);var f=gd(u[0],u[1]);this._recurse(this._tree._root,l,f,l,f,t,i,n,a,o);return this};_c.prototype.traverseRange=function e(t,r){var i=this;var n=r[0];var a=r[1];var o=r[2];var s=r[3];var u=$d(n,a,this._level);var l=u[0];var f=u[1];var h=$d(o,s,this._level);var v=h[0];var d=h[1];var c=gd(l,f);var _=gd(v,d);this._tree.range(c,_,function(e){var r=e.key;if(vc(c,_,r)){if(t(e)){return i}}});return this};_c.prototype._recurse=function e(t,r,i,n,a,o){if(t===null){return}var s=t.key;if(s<r){return this._recurse(t.right,r,i,n,a,o)}if(s>i){return this._recurse(t.left,r,i,n,a,o)}if(vc(n,a,s)){this._recurse(t.left,r,s,n,a,o);if(o(t)){return}this._recurse(t.right,s,i,n,a,o)}else{var u=hc(n,a,s);var l=fc(n,a,s);this._recurse(t.left,r,l,n,a,o);this._recurse(t.right,u,i,n,a,o)}};_c.prototype.query=function e(t){var r=this;var i=[];var n=[];this.traverse(function(e){i.push(e)},t);var a={};var o=this._getGeometry;this._intersectionChecks=0;for(var s=0;s<i.length;s++){var u=i[s];var l=r._nodeToId.getItems(u.key);for(var f=0;f<l.length;f++){var h=l[f];if(!a[h]){var v=o(h);r._intersectionChecks++;if(Ld(v,t)){n.push(h)}a[h]=true}}}this._checkedNodes=i;return n};_c.prototype.getItems=function e(t){return this._nodeToId.getItems(t)};gc.intersectionChecks.get=function(){return this._intersectionChecks};gc.level.get=function(){return this._level};gc.size.get=function(){return this._size};_c.prototype.keyToBBox=function e(t){var r=Hd();var i=gd.reverse(t);var n=i[0];var a=i[1];var o=1<<cc-this._level+(r-cc);var s=1<<r-1;return[n*o-s,a*o-s,(n+1)*o-s,(a+1)*o-s]};Object.defineProperties(_c.prototype,gc);_c.MAX_ZOOM=cc;var pc=typeof Map==="undefined"?function(){function e(){this._values={};this._size=0}var t={size:{configurable:true}};t.size.get=function(){return this._size};e.prototype.has=function e(t){return!!this._values[t]};e.prototype.set=function e(t,value){if(!(t in this._values)){this._size++}this._values[t]=value};e.prototype.get=function e(t){return this._values[t]};e.prototype.delete=function e(t){if(t in this._values){delete this._values[t];this._size--}};e.prototype.keys=function e(){return Object.keys(this._values)};e.prototype.clear=function e(){this._values={};this._size=0};Object.defineProperties(e.prototype,t);return e}():Map;var yc=1<<16-1;var mc=16;var xc=16;var bc=Math.log2(mc);var Ac=(1<<bc)-1;var wc=function(e,t,r){return r|gd(e,t)<<4};var Ec=function(e,t){if(t===void 0)t=[];gd.reverse(e>>4,t);t[2]=e&Ac;return t};var Sc=function e(t,r,i,n,a){if(i===void 0)i=xc;if(n===void 0)n=yc;if(a===void 0)a=Int32Array;this._intersects=t;this._getBounds=r;this._minCellSize=i;this._occupied=0;this._cells=new ud(a);this._objectsAtLevel=new Array(mc).fill(0);this._idToCode=new pc;this._codeCache=[];this._offset=n};var Cc={averageCellOccupancy:{configurable:true},size:{configurable:true}};Sc.prototype.setMinCellSize=function e(t){this._minCellSize=t;return this};Sc.prototype.setOffset=function e(t){this._offset=t;return this};Sc.prototype.setIntersector=function e(t){this._intersects=t;return this};Sc.prototype.setBoundsGetter=function e(t){this._getBounds=t;return this};Sc.prototype.insert=function e(t,r){if(r===void 0)r=this._getBounds(t);var i=this._offset;var n=Math.max(r[2]-r[0],r[3]-r[1]);var a=this._minCellSize,o;for(o=0;a<n&&o<mc;o++){a<<=1}var s=i+(r[2]+r[0])/2;var u=i+(r[3]+r[1])/2;var l=wc(s/a|0,u/a|0,o);if(!this._cells.has(l)){this._cells.addEntry(l)}this._cells.addTo(l,t);this._objectsAtLevel[o]++;this._occupied|=1<<o;this._idToCode.set(t,l);return l};Sc.prototype.has=function e(t){return this._idToCode.has(t)};Sc.prototype.update=function e(t,r){this.remove(t);return this.insert(t,r)};Sc.prototype.remove=function e(t){var r=this._idToCode.get(t);Ec(r,this._codeCache);var i=this._codeCache[2];if(--this._objectsAtLevel[i]===0){this._occupied&=~(1<<i)}this._cells.removeFrom(r,t);this._idToCode.delete(t);return this};Sc.prototype.query=function e(t){var r=t[0];var i=t[1];var n=t[2];var a=t[3];var o=this._cells;var s=this._intersects;var u=this._offset;var l=0;var f=this._minCellSize;var h=this._occupied;var v=[];for(var d=l;d<mc;f<<=1,h>>=1,d++){if(h===0){break}if((h&1)===0){continue}var c=1/f;var _=(u+r)*c-1>>0;var g=(u+i)*c-1>>0;var p=(u+n)*c+1>>0;var y=(u+a)*c+1>>0;for(var m=_;m<=p;m++){for(var x=g;x<=y;x++){var b=wc(m,x,d);var A=o.getItems(b);if(A===undefined){continue}for(var w=0;w<A.length;w++){var E=A[w];if(s(E,t)){v.push(E)}}}}}return v};Sc.prototype.clear=function e(){this._occupied=0;this._cells.clear();this._idToCode.clear();this._objectsAtLevel=new Array(mc).fill(0);return this};Sc.prototype.keyToBBox=function e(t){var r=Ec(t);var i=r[0];var n=r[1];var a=r[2];var o=this._minCellSize<<a;var s=this._offset;return[i*o-s,n*o-s,(i+1)*o-s,(n+1)*o-s]};Sc.prototype.keys=function e(){return Object.keys(this._cells._idToIndex)};Cc.averageCellOccupancy.get=function(){return this._cells.averageSize};Cc.size.get=function(){return this._idToCode.size};Object.defineProperties(Sc.prototype,Cc);Sc.code=wc;Sc.decode=Ec;var Tc=function e(t){var r=this;var i=t.modules;var n=i.dom;var a=i.graph;var o=i.camera;var s=i.graphics;var u=i.settings;var l=i.events;this._dom=n;this._graph=a;this._camera=o;this._graphics=s;this._settings=u;this._events=l;this._index=new Sc(this._getIntersector(),this._boundsGetter());this._elementsToUpdate=new Ch(t);this._removedNodes=a.getAttribute(true,"removed");this._removedEdges=a.getAttribute(false,"removed");this._queryResult={edges:[],nodes:[]};this._queryBounds=[0,0,0,0];l.on("updateAttributes",function(e){return r._onAttributesUpdated(e)});l.on("removeNodes removeEdges",function(e){return r._onItemsRemove(e)})};Tc.prototype._onItemsRemove=function e(t){var r=this;var i=t.nodes;var n=t.edges;if(i){var a=i._indexes;for(var o=0;o<a.length;o++){r._index.remove(a[o])}}if(n){var s=n._indexes;for(var u=0;u<s.length;u++){r._index.remove(-s[u])}}};Tc.prototype._getIntersector=function e(){var t=this._graph;var r=t.getAttributes(true,["x","y","radius"]);var i=r[0];var n=r[1];var a=r[2];var o=t.getAttributes(false,["source","target","width","curvature"]);var s=o[0];var u=o[1];var l=o[2];var f=o[3];var h={};return function(e,t){if(e<0){e=-e;var r=s.get(e);var o=u.get(e);var v=f.get(e);var d=l.get(e)/2;var c=i.get(r),_=n.get(r);var g=i.get(o),p=n.get(o);if(r===o){ao(c,_,v,a.get(r)/2,h);return ro(c,_,h.x1,h.y1,h.x2,h.y2,g,p,t[0]-d,t[1]-d,t[2]+d,t[3]+d)}else if(v===0){return Bn(c,_,g,p,t[0]-d,t[1]-d,t[2]+d,t[3]+d)}else{io(c,_,g,p,v,h);return eo(c,_,h.x,h.y,g,p,t[0]-d,t[1]-d,t[2]+d,t[3]+d)}}else{var y=i.get(e),m=n.get(e),x=a.get(e);return xn(y,m,x,t[0],t[1],t[2],t[3])}}};Tc.prototype._boundsGetter=function e(){var t=this._graph;var r=t.getAttributes(true,["x","y","radius"]);var i=r[0];var n=r[1];var a=r[2];var o=t.getAttributes(false,["source","target","curvature"]);var s=o[0];var u=o[1];var l=o[2];var f={};var h={};return function(e){if(e<0){e=-e;var t=s.get(e);var r=u.get(e);var o=l.get(e);var v=i.get(t),d=n.get(t);var c=i.get(r),_=n.get(r);if(t===r){ao(v,d,o,a.get(t),f);yo(v,d,f.x1,f.y1,f.x2,f.y2,c,_,h)}else if(o===0){h.minX=Math.min(v,c);h.minY=Math.min(d,_);h.maxX=Math.max(v,c);h.maxY=Math.max(d,_)}else{io(v,d,c,_,o,f);po(v,d,f.x,f.y,c,_,h)}}else{var g=i.get(e);var p=n.get(e);var y=a.get(e);h.minX=g-y;h.minY=p-y;h.maxX=g+y;h.maxY=p+y}return[h.minX,h.minY,h.maxX,h.maxY]}};Tc.prototype._onAttributesUpdated=function e(t){this._elementsToUpdate.addElements(t.nodes);this._elementsToUpdate.addElements(t.edges)};Tc.prototype.reindex=function e(){this._graphics.forceAttributesComputation();this._index.clear();this._elementsToUpdate.clear();this._updateItems(this._graph.allNodeIndexesConst(),this._graph.allEdgeIndexesConst())};Tc.prototype._updateIndex=function e(){if(!this._elementsToUpdate.isEmpty()){var t=this._elementsToUpdate.getElements();var r=t.nodes;var i=t.edges;this._updateItems(r._indexes,i._indexes);this._elementsToUpdate.clear()}};Tc.prototype._updateItems=function e(t,r){var i=this._index;var n=this._removedNodes;var a=this._removedEdges;for(var o=0;o<t.length;o++){var s=t[o];if(n.get(s)!==0){continue}else if(i.has(s)){i.update(s)}else{i.insert(s)}}for(var u=0;u<r.length;u++){var l=-r[u];if(a.get(-l)!==0){continue}else if(i.has(l)){i.update(l)}else{i.insert(l)}}};Tc.prototype.getNodesInScreenByDistance=function e(t){var r=t.getPositionOnScreen();var i=r.x;var n=r.y;return this._graph.getNodes().filter(function(e){return e.isInScreen()&&e!==t}).sort(function(e,t){var r=e.getPositionOnScreen(),a=t.getPositionOnScreen();return distance(r.x,r.y,i,n)-distance(a.x,a.y,i,n)})};Tc.prototype.getNearestNodesForNode=function e(t,r,i){if(r===void 0)r=240;var n=t.getPosition();var a=n.x;var o=n.y;return this.getNearestNodes(a,o,r,i,t)};Tc.prototype.getNearestNodes=function e(t,r,i,n,a){this._updateIndex();if(n){var o=this._camera.screenToGraphVector({x:i,y:i});i=distance(0,0,o.x,o.y)}return this._getNearestNodes(t,r,i,a)};Tc.prototype._getNearestNodes=function e(t,r,i,n){var a=[];var o=i*i;var s=n?n._index:0;var u=this._graph._getIndexes(true);var l=this._graph.getAttributes(true,["excluded","x","y"]);var f=l[0];var h=l[1];var v=l[2];for(var d=0,c=u.length;d<c;d++){var _=u[d];if(_===s||f.get(_)){continue}var g=t-h._buffer[_],p=r-v._buffer[_];if(g*g+p*p<=o){a.push(_)}}return new this._graph.NodeList(a)};Tc.prototype.queryRaw=function e(t,r,i,n){this._updateIndex();var a=this._queryBounds;a[0]=t;a[1]=r;a[2]=i;a[3]=n;var o=this._index.query(a);var s=this._queryResult;var u=s.nodes;var l=s.edges;u.length=l.length=0;for(var f=0;f<o.length;f++){var h=o[f];if(h<0){l.push(-h)}else{u.push(h)}}return this._queryResult};Tc.prototype.queryRawProjected=function e(t,r,i,n){var a=this._queryBounds;a[0]=t;a[1]=r;a[2]=i;a[3]=n;this._camera.projectBounds(a);return this.queryRaw(a[0],a[1],a[2],a[3])};Tc.prototype.query=function e(t,r,i,n){var a=this._graph;var o=this.queryRaw(t,r,i,n);var s=o.nodes;var u=o.edges;return{nodes:new a.NodeList(s.slice()),edges:new a.EdgeList(u.slice())}};Tc.prototype.queryProjected=function e(t,r,i,n){var a=this._graph;var o=this.queryRawProjected(t,r,i,n);var s=o.nodes;var u=o.edges;return{nodes:new a.NodeList(s.slice()),edges:new a.EdgeList(u.slice())}};Tc.prototype.getNodesByBoundingBox=function e(t,r,i,n,a){this._updateIndex();if(a){var o;o=this._camera.screenToGraphVector({x:t,y:r});t=o.x;r=o.y;o=this._camera.screenToGraphVector({x:i,y:n});i=o.x;n=o.y}var s=this._graph;var u=s.allNodeIndexesConst();var l=[];var f=s.getAttributes(true,["excluded","x","y"]);var h=f[0];var v=f[1];var d=f[2];for(var c=0,_=u.length;c<_;c++){var g=u[c];if(h.get(g)){continue}var p=v._buffer[g],y=d._buffer[g];if(p>=t&&p<=i&&y>=r&&y<=n){l.push(g)}}return new s.NodeList(l)};Tc.prototype.toggleDebug=function e(t){if(t){this._canvas=it();this._graphics.addCanvas(this._canvas);this._ctx=this._canvas.getContext("2d")}else if(this._canvas){this._graphics.removeCanvas(this._canvas);this._canvas=this._ctx=null}};Tc.prototype.renderDebug=function e(t){if(!this._ctx){this.toggleDebug(true)}Mc(this,t)};function Mc(e,t){if(t===void 0)t={};var r=t.cells;if(r===void 0)r=true;var i=t.boxes;if(i===void 0)i=true;var n=t.query;if(n===void 0)n=true;var a=Ogma.utils.getPixelRatio();var o=e._ctx;var s=e._canvas;var u=e._camera;var l=e._index;var f=-u.getAngle();var h=u.getZoom()*a;var v=u._x;var d=u._y;var c=u._dimensions.width/2;var _=u._dimensions.height/2;var g=function(e,t){return{x:(e-v)*h,y:(t-d)*h}};var p=l.keys().map(function(e){return l.keyToBBox(e)});var y=Array.from(l._idToCode.keys()).map(function(e){return l._getBounds(e)});o.clearRect(0,0,s.width,s.height);o.save();o.translate(c,_);o.rotate(f);if(r){o.beginPath();o.lineWidth=1;o.strokeStyle="#707070";p.forEach(function(e){var t=g(e[0],e[1]);var r=g(e[2],e[3]);o.rect(t.x,t.y,r.x-t.x,r.y-t.y)});o.stroke()}if(i){o.beginPath();o.lineWidth=1;o.strokeStyle="#ff7070";y.forEach(function(e){var t=g(e[0],e[1]);var r=g(e[2],e[3]);o.rect(t.x,t.y,r.x-t.x,r.y-t.y)});o.closePath();o.stroke()}if(n&&e._queryBounds){var m=e._queryBounds;o.beginPath();o.lineWidth=2;o.strokeStyle="#3030ff";var x=g(m[0],m[1]);var b=g(m[2],m[3]);o.rect(x.x,x.y,b.x-x.x,b.y-x.y);o.closePath();o.stroke()}o.restore()}Ogma.extend(function(e){return e.modules.spatial=new Tc(e)});Ogma.extend(function(e){var t=new Ic(e);e.modules.watcher=t;e.schema={watchNodeObjectProperty:function e(r){return t.watchNodeObjectProperty(r)},watchEdgeObjectProperty:function e(r){return t.watchEdgeObjectProperty(r)},watchNodeNonObjectProperty:function e(r){return t.watchNodeNonObjectProperty(r)},watchEdgeNonObjectProperty:function e(r){return t.watchEdgeNonObjectProperty(r)}}});function kc(e){if(typeof e!=="object"||e===null||Array.isArray(e)){return{path:Nc(e),filter:"visible",unwindArrays:false}}else{return{path:Nc(e.path),filter:Lc(e.filter),unwindArrays:!!e.unwindArrays}}}var Ic=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._events=t.modules.events;this._propertyWatchers=[];this._objectPropertyWatchers=[];this._events.on({excludedStateChange:function(e){var t=e.elements;var value=e.value;var i=!value;for(var n=0,a=r._propertyWatchers.length;n<a;n++){var o=r._propertyWatchers[n];if(o.isNode===t.isNode&&o.filter==="visible"){if(i){Bc(o,t.getData(o.property))}else{Rc(o,t.getData(o.property))}zc(o)}}},"updateNodeData updateEdgeData":function(e){var t=e.isNode;var i=e.changes;for(var n=0;n<r._propertyWatchers.length;++n){var a=r._propertyWatchers[n],o=a.property,s=a.filter==="all";if(a.isNode!==t){continue}for(var u=0;u<i.length;++u){var l=i[u],f=l.property||[],h=Pc(f,o);if(h){var v=l.nodes||l.edges,d=[],c=[];for(var _=0;_<v.size;++_){var g=v.get(_);if(s||g.isVisible()){d.push(ls(l.newValues[_],h));c.push(ls(l.previousValues[_],h))}}if(d.length){Bc(a,d);Rc(a,c);zc(a)}}}}for(var p=0,y=r._objectPropertyWatchers.length;p<y;p++){var m=r._objectPropertyWatchers[p];var x=m._path;var b=function(e){var t=i[e];var r=t.property;var n=t.nodes;var a=t.edges;var o=n||a,s=o.isNode;if(!r||r.length<=x.length+1&&x.every(function(e,t){return e===r[t]})){m._updateSubPropertiesToWatch(s,o)}};for(var A=0;A<i.length;++A)b(A)}},"addNodes addEdges":function(e){var t=e.nodes;var i=e.edges;var n=t||i;for(var a=0;a<r._propertyWatchers.length;++a){var o=r._propertyWatchers[a];if(o.isNode===n.isNode){var s=n.getData(o.property);if(s.length){Bc(o,s);zc(o)}}}for(var u=0;u<r._objectPropertyWatchers.length;u++){r._objectPropertyWatchers[u]._updateSubPropertiesToWatch(n.isNode,n)}},"removeNodes removeEdges":function(e){var t=e.nodes;var i=e.edges;var n=t||i;for(var a=0;a<r._propertyWatchers.length;++a){var o=r._propertyWatchers[a];var s=o.filter==="all";if(o.isNode===n.isNode&&s){var u=n.getData(o.property);if(u.length){Rc(o,u);zc(o)}}}},clear:function(){r._propertyWatchers.forEach(function(e){e.nbNumbers=0;e.nbAny=0;e.nbTotal=0;e.boundaries=null;e.values.clear()})}})};Ic.prototype.watchNodeObjectProperty=function e(t){return this._watchObjectProperty(true,kc(t))};Ic.prototype.watchEdgeObjectProperty=function e(t){return this._watchObjectProperty(false,kc(t))};Ic.prototype.watchNodeNonObjectProperty=function e(t){return this._watchNonObjectProperty(true,kc(t))};Ic.prototype.watchEdgeNonObjectProperty=function e(t){return this._watchNonObjectProperty(false,kc(t))};Ic.prototype._watchPropertyInformation=function e(t,r,i,n,a){var o=this._findWatcher(t,r,n,a);if(!o){o=this._createWatcher(t,r,n,a)}if(i){o.onChange.push(i)}return o.info};Ic.prototype._unwatchPropertyInformation=function e(t,r,i,n,a){var o=this._findWatcher(t,r,n,a);if(!o){return}var s=o.onChange,u=s.indexOf(i);if(u!==-1){s.splice(u,1);if(s.length===0){var l=this._propertyWatchers.indexOf(o);this._propertyWatchers.splice(l,1)}}};Ic.prototype._watchObjectProperty=function e(t,r){var i=new jc(this,t,r);this._objectPropertyWatchers.push(i);i._updateSubPropertiesToWatch(t,this._graph[t?"getNodes":"getEdges"](r.filter));return i};Ic.prototype._watchNonObjectProperty=function e(t,r){return new Uc(this,t,r)};Ic.prototype._findWatcher=function e(t,r,i,n){var a=this;for(var o=0;o<this._propertyWatchers.length;++o){var s=a._propertyWatchers[o];if(s.isNode===t&&s.filter===i&&s.unwindArrays===n&&Dc(s.property,r)){return s}}return null};Ic.prototype._createWatcher=function e(t,r,i,n){var a={isNode:t,property:r,nbNumbers:0,nbAny:0,nbTotal:0,values:new Gt,boundaries:null,onChange:[],filter:i,unwindArrays:n,info:undefined};a.info=new Fc(a);Bc(a,this._ogma[t?"getNodes":"getEdges"](i).getData(r));this._propertyWatchers.push(a);return a};function Nc(value){if(value===null||value===undefined){return[]}else{return ir(value)}}function Lc(value){return value==="all"?"all":"visible"}function zc(e){for(var t=0;t<e.onChange.length;++t){e.onChange[t](e.info)}}function Dc(e,t){if(e.length!==t.length){return false}for(var r=0;r<e.length;++r){if(e[r]!==t[r]){return false}}return true}function Pc(e,t){if(e.length>t.length){return null}for(var r=0;r<e.length;++r){if(e[r]!==t[r]){return null}}return t.slice(r)}var Fc=function e(t){this._watcher=t};Fc.prototype.isNode=function e(){return this._watcher.isNode};Fc.prototype.getPath=function e(){return this._watcher.property.slice()};Fc.prototype.getBoundaries=function e(){var t=this._watcher.boundaries;return t?{min:t.min,max:t.max}:null};Fc.prototype.getValues=function e(){return this._watcher.values.keys()};Fc.prototype.getValueCount=function e(value){return this._watcher.values.get(value)||0};Fc.prototype.getCount=function e(){return this._watcher.nbTotal};Fc.prototype.getType=function e(){if(this._watcher.nbAny>0){return"any"}else if(this._watcher.nbNumbers>0){return"number"}else{return"undefined"}};function Bc(e,t,r){var i=e.values,n=!r&&e.unwindArrays;for(var a=0;a<t.length;++a){var value=t[a];if(!r&&value!==undefined){e.nbTotal+=1}if(n&&Array.isArray(value)){Bc(e,value,true)}else{var o=i.get(value);if(o){i.set(value,o+1)}else{i.set(value,1);if(Vc(value)){if(!e.boundaries){e.boundaries={min:value,max:value}}else if(value<e.boundaries.min){e.boundaries.min=value}else if(value>e.boundaries.max){e.boundaries.max=value}e.nbNumbers+=1}else if(value!==undefined){e.nbAny+=1}}}}}function Rc(e,t,r){var i=e.values,n=!r&&e.unwindArrays,a=e.boundaries,o=false;for(var s=0;s<t.length;++s){var value=t[s];if(!r&&value!==undefined){e.nbTotal-=1}if(n&&Array.isArray(value)){o|=Rc(e,value,true)}else{var u=i.get(value);if(u>1){i.set(value,u-1)}else{i.delete(value);if(Vc(value)){e.nbNumbers-=1;if(a&&(a.min===value||a.max===value)){o=true}}else if(value!==undefined){e.nbAny-=1}}}}if(!r&&o){e.boundaries=Oc(i.keys())}return o}function Oc(e){var t=undefined,r=undefined;for(var i=0;i<e.length;++i){var value=e[i];if(Vc(value)){if(t===undefined||value<t){t=value}if(r===undefined||value>r){r=value}}}return t===undefined?null:{min:t,max:r}}function Vc(value){return typeof value==="number"&&isFinite(value)}var jc=function e(t,r,i){var n=i.path;var a=i.filter;var o=i.unwindArrays;this._module=t;this._isNode=r;this._path=n;this._filter=a;this._unwindArrays=o;this._propertyList=[];this._properties={};this._onAddHandlers=[];this._onRemoveHandlers=[];this._onUpdateHandlers=[]};jc.prototype.onPropertyAdded=function e(t){this._onAddHandlers.push(t);return this};jc.prototype.onPropertyRemoved=function e(t){this._onRemoveHandlers.push(t);return this};jc.prototype.onPropertyUpdated=function e(t){this._onUpdateHandlers.push(t);return this};jc.prototype.getPath=function e(){return this._path.slice()};jc.prototype.getProperties=function e(){return this._propertyList.slice()};jc.prototype.getPropertyInfo=function e(t){var r=this._properties[t];return r?r.info:null};jc.prototype.destroy=function e(){var t=this;K(this._properties,function(e,r){var i=e.handler;var n=t._path.concat([r]);t._module._unwatchPropertyInformation(t._isNode,n,i,t._filter,t._unwindArrays)});this._propertyList=undefined;this._properties=undefined;this._onAddHandlers=undefined;this._onRemoveHandlers=undefined;this._onUpdateHandlers=undefined;var r=this._module._objectPropertyWatchers.indexOf(this);this._module._objectPropertyWatchers.splice(r,1)};jc.prototype.kill=function e(){return this.destroy()};jc.prototype._updateSubPropertiesToWatch=function e(t,r){var i=this;if(t!==this._isNode){return}var n=r.getData(this._path);for(var a=0;a<n.length;a++){var o=n[a];if(Z(o)){var s=Object.keys(o);for(var u=0;u<s.length;u++){i._addSubPropertyToWatch(s[u])}}}};jc.prototype._addSubPropertyToWatch=function e(t){var r=this;if(!this._properties[t]){var i=this._path.concat([t]);var n=function(){return r._triggerPropertyUpdate(t)};var a=this._unwindArrays;var o=this._isNode;var s=this._filter;var u=this._module._watchPropertyInformation(o,i,n,s,a);this._properties[t]={handler:n,info:u};this._triggerPropertyUpdate(t)}};jc.prototype._triggerPropertyUpdate=function e(t){var r=this._properties[t];var i=r.info;var n=this._propertyList.indexOf(t),a=n!==-1,o=i.getType()!=="undefined";if(!a&&o){this._propertyList.push(t);this._triggerHandlers("_onAddHandlers",t,i);this._triggerHandlers("_onUpdateHandlers",t,i)}else if(a&&!o){this._propertyList.splice(n,1);this._triggerHandlers("_onUpdateHandlers",t,i);this._triggerHandlers("_onRemoveHandlers",t,i)}else if(a&&o){this._triggerHandlers("_onUpdateHandlers",t,i)}};jc.prototype._triggerHandlers=function e(t,r,i){var n=this[t];for(var a=0,o=n.length;a<o;a++){n[a](r,i)}};var Uc=function e(t,r,i){var n=this;var a=i.path;var o=i.filter;var s=i.unwindArrays;this._module=t;this._isNode=r;this._path=a||[];this._filter=o;this._unwindArrays=s;this._onUpdateHandlers=[];this._triggerUpdate=function(e){for(var t=0;t<n._onUpdateHandlers.length;++t){n._onUpdateHandlers[t](e)}};this._info=t._watchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)};Uc.prototype.onUpdate=function e(t){this._onUpdateHandlers.push(t)};Uc.prototype.getPropertyInfo=function e(){return this._info};Uc.prototype.getPath=function e(){return this._path.slice()};Uc.prototype.destroy=function e(){this._module._unwatchPropertyInformation(this._isNode,this._path,this._triggerUpdate,this._filter,this._unwindArrays)};Uc.prototype.kill=function e(){return this.destroy()};var Gc=function e(t){var r=this;this._ogma=t;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._watcher=t.modules.watcher;this._events=t.modules.events;this._mappingList=[];this._events.on({"addNodes addEdges updateNodeData updateEdgeData removeNodes removeEdges excludedStateChange clear":function(){if(r._mappingList.length){for(var e=0;e<r._mappingList.length;++e){r._mappingList[e].markAsInvalid()}r._graphics.refreshAll();r._ogma.modules.legend.refresh()}}})};Gc.prototype.createMapping=function e(t){if(t===void 0)t={};var r=t.field;var i=t.values;if(i===void 0)i={};var n=t.fallback;r=ir(r);if(!H(n)){n=[n]}else if(n.length===0){n=[undefined]}if(typeof i!=="object"||i===null||H(i)){throw new Error('"mapping" should be an object')}return this._createMappingFunction(Wc,r,{values:i,fallback:n})};Gc.prototype.createSlices=function e(t){if(t===void 0)t={};var r=t.field;var i=t.fallback;var n=t.stops;if(n===void 0)n={};var a=t.values;if(a===void 0)a={nbSlices:7};var o=t.reverse;if(o===void 0)o=false;r=ir(r);if(!a.nbSlices){a.nbSlices=7}if(H(n)&&H(a)&&n.length!==a.length-1){throw new Error("there should be exactly one more value that stops")}return this._createMappingFunction(Yc,r,{fallback:i,stops:n,values:a,reverse:o})};Gc.prototype._createMappingFunction=function e(t,r,i){var n=new qc(this._ogma,t,r,i);this._mappingList.push(n);var a=function(e,t,r){return n.getValue(e,r)};a.mapping=n;return a};Gc.prototype.createTemplate=function e(t){if(typeof t!=="string"){throw new TypeError('"template" should be a string')}var r=[];var i=0;var n=false;while(!n){var a=-1;var o=t.indexOf("{{",i);if(o!==-1){a=t.indexOf("}}",o+2)}if(a!==-1){r.push(t.substring(i,o));r.push(t.substring(o+2,a));i=a+2}else{r.push(t.slice(i));n=true}}return function(e){var t=r[0];for(var i=1;i<r.length;i+=2){t+=e.getData(r[i]);t+=r[i+1]}return t}};function Xc(e,t,r){var i=t?e.getNodes():e.getEdges();var n=i.getData(r);var a={};for(var o=0;o<n.length;++o){var value=n[o];if(Array.isArray(value)){for(var s=0;s<value.length;++s){a[value[s]]=1}}else{a[value]=1}}delete a.undefined;return Object.keys(a).sort()}function Wc(e,t,r,i){var n=r.values;var a=r.fallback;var o=Xc(e,i,t);var s={};var u=0;for(var l=0;l<o.length;++l){var value=o[l];if(value in n){s[value]=n[value]}else{s[value]=a[u];u=(u+1)%a.length}}return s}function Yc(e,t,r,i){var n=r.fallback;var a=r.stops;var o=r.values;var s=r.reverse;var u=Xc(e,i,t);var l=Infinity;var f=-Infinity;for(var h=0;h<u.length;++h){var value=+u[h];if(Hc(value)){l=Math.min(l,value);f=Math.max(f,value);u[h]=value}}var v={};if(!isFinite(l)){for(var d=0;d<u.length;++d){v[u[d]]=n}}else{var c=H(o)?o.length:o.nbSlices,_,g;if(H(a)){_=a.slice()}else{var p=a.min;var y=a.max;if(p===undefined||y===undefined){p=l;y=f}var m=(y-p)/c;_=[];for(var x=1;x<c;++x){_.push(p+m*x)}}if(H(o)){g=o}else{var b=o.min;var A=o.max;var w=_.length+1,E=(A-b)/_.length;g=[];for(var S=0;S<w;++S){g.push(b+S*E)}}if(s){g.reverse()}for(var C=0;C<u.length;++C){var T=u[C];var M=+T;if(!isFinite(M)){v[T]=n}else{var k=0;while(k<_.length&&_[k]<=T){k+=1}v[T]=g[k]}}}return v}function Hc(value){return typeof value==="number"&&isFinite(value)}var qc=function e(t,r,i,n){this._ogma=t;this._computeMapping=r;this._field=i;this._options=n;this._nodeMapping={valid:false,values:null};this._edgeMapping={valid:false,values:null}};qc.prototype.getValue=function e(t,r){var i=t.isNode;var n=i?this._nodeMapping:this._edgeMapping;if(!n.valid){n.values=this._computeMapping(this._ogma,this._field,this._options,i);n.valid=true}var a=t.getData(this._field);var o;if(H(a)){if(r==="color"){o=a.map(function(e){return n.values[e]})}else{o=n.values[a[0]]}}else{o=n.values[a]}return o};qc.prototype.markAsInvalid=function e(){this._nodeMapping.valid=false;this._edgeMapping.valid=false};qc.prototype.getValues=function e(t){return t?this._nodeMapping.values:this._edgeMapping.values};qc.prototype.getField=function e(){return this._field};Ogma.extend(function(e){var t=new Gc(e);e.modules.rules=t;e.rules={map:function e(r){return t.createMapping(r)},slices:function e(r){return t.createSlices(r)},template:function e(r){return t.createTemplate(r)}}});var Zc={0:"left",1:"middle",2:"right"};Ogma.extend(function(e){e.modules.mouse=new $c(e)});var $c=function e(t){var r=this;this._dom=t.modules.dom;this._settings=t.modules.settings;this._events=t.modules.events;this._graphics=t.modules.graphics;this._focus=false;this._domElt=this._graphics.getDomElement();this._x=0;this._y=0;this._left=false;this._middle=false;this._right=false;this._settings.register("mouse.enabled",true);this._settings.register("mouse.wheelEnabled",true);this._settings.register("mouse.disableWheelUntilMouseDown",false);this._settings.register("mouse.doubleClickTimer",500);this._events.register(["mouseDown","mouseUp","mouseMove","mouseWheel","mouseClick","mouseDoubleClick","mouseLeave","documentMouseMove","documentMouseUp"]);this._dom.addDocumentEventListener("contextmenu",function(e){if(r._focus&&r._settings.get("mouse.enabled")){e.preventDefault()}},false);this._initializeListeners()};var Kc={x:{configurable:true},y:{configurable:true},left:{configurable:true},right:{configurable:true},middle:{configurable:true}};Kc.x.get=function(){return this._x};Kc.y.get=function(){return this._y};Kc.left.get=function(){return this._left};Kc.right.get=function(){return this._right};Kc.middle.get=function(){return this._middle};$c.prototype._isEnabled=function e(){return this._settings.get("mouse.enabled")};$c.prototype._isWheelEnabled=function e(){return this._settings.get("mouse.wheelEnabled")};$c.prototype._disableWheelUntilMouseDown=function e(){return this._settings.get("mouse.disableWheelUntilMouseDown")};$c.prototype._getDoubleClickTimer=function e(){return this._settings.get("mouse.doubleClickTimer")};$c.prototype._initializeListeners=function e(){var t=this;var r=6;var i=this;var n={left:0,middle:0,right:0};var a=function(e,t){return i._events.fire(e,t)};var o=0,s=0;var u=0,l=0;var f;var h={left:false,middle:false,right:false};var v=null;var d=null;var c=0,_=0;var g=false;var p=null;var y=function(e,value){if(value===void 0)value=0;if(e){n[e]=value}else{n.left=value;n.middle=value;n.right=value}i._dom.clearTimeout(p)};var m=function(e){f=bt(i._domElt);if(!f){return false}d=e;v=Zc[e.button];u=o;l=s;o=e.clientX-f.left;s=e.clientY-f.top;i._x=o;i._y=s;i._left=h.left;i._right=h.right;i._middle=h.middle;return true};var x=function(e){if(m(e)){var t=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));a("mouseWheel",{delta:t,x:o,y:s,domEvent:d})}};function b(e){if(i._isEnabled()&&i._isWheelEnabled()&&(!i._disableWheelUntilMouseDown()||i._focus)){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}x(e)}}this._dom.addElementEventListener(this._domElt,"mousewheel",b);this._dom.addElementEventListener(this._domElt,"DOMMouseScroll",b);this._dom.addDocumentEventListener("mousemove",function(e){if(!t._isEnabled()||!m(e)){return}var i=o-u;var n=s-l;if(o>0&&o<f.width&&s>0&&s<f.height){if(i===0&&n===0){return}if(g){g=false}else if(distance(o,s,c,_)>=r){y();a("mouseMove",{x:o,y:s,dx:i,dy:n,domEvent:d})}}else{a("documentMouseMove",{x:o,y:s,dx:i,dy:n,domEvent:d})}});this._dom.addElementEventListener(this._domElt,"mouseleave",function(){if(!t._isEnabled()){return}t._focus=false;a("mouseLeave",{domEvent:d})});this._dom.addElementEventListener(this._domElt,"mousedown",function(e){if(!t._isEnabled()||!m(e)){return}g=true;c=o;_=s;t._focus=true;h[v]=true;n[v]+=1;var r=v;p=t._dom.setTimeout(function(){return y(r,0)},t._getDoubleClickTimer());a("mouseDown",{button:v,x:o,y:s,domEvent:d})});this._dom.addDocumentEventListener("mouseup",function(e){if(!t._isEnabled()||!m(e)){return}h[v]=false;if(o>0&&o<f.width&&s>0&&s<f.height){if(n[v]===1){a("mouseClick",{button:v,x:o,y:s,domEvent:d})}else if(n[v]>1){a("mouseDoubleClick",{button:v,x:o,y:s,domEvent:d});y(v)}a("mouseUp",{button:v,x:o,y:s,domEvent:d})}else{a("documentMouseUp",{button:v,x:o,y:s,domEvent:d})}})};Object.defineProperties($c.prototype,Kc);Ogma.extend(function(e){var t=new Jc(e);e.modules.virtualMouse=t;e.mouse={move:function e(r){return t.move(r)},down:function e(r){return t.down(r)},up:function e(r){return t.up(r)},click:function e(r){return t.click(r)},doubleClick:function e(r){return t.doubleClick(r)},drag:function e(r,i){return t.drag(r,i)},wheel:function e(r){return t.wheel(r)}}});var Jc=function e(t){this._ogma=t;this._dom=t.modules.dom;this._events=t.modules.events;this._events.register(["virtualDown","virtualUp","virtualMove","virtualClick","virtualDoubleClick","virtualWheel"])};var Qc={x:{configurable:true},y:{configurable:true}};Qc.x.get=function(){return this._ogma.modules.captor._x||0};Qc.y.get=function(){return this._ogma.modules.captor._y||0};Jc.prototype._later=function e(){var t=this;return this._dom.afterNextFrame().then(function(){return new Promise(function(e){return t._dom.setTimeout(e,0)})})};Jc.prototype.move=function e(t){var r=this;var i=t.x;var n=t.y;if(i!==undefined&&n!==undefined){return this._dom.afterNextFrame().then(function(){var e=i-r.x;var t=n-r.y;r._events.fire("virtualMove",{x:i,y:n,dx:e,dy:t});return r._later()})}else{return Promise.resolve()}};Jc.prototype.down=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualDown",{x:r.x,y:r.y,button:a});r._events.fire("virtualMove",{x:r.x,y:r.y,dx:0,dy:0});return r._later()})};Jc.prototype.up=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualUp",{x:r.x,y:r.y,button:a});return r._later()})};Jc.prototype.click=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualClick",{x:r.x,y:r.y,button:a});return r._later()})};Jc.prototype.doubleClick=function e(t){var r=this;if(t===void 0)t={};var i=t.x;var n=t.y;var a=t.button;if(a===void 0)a="left";return this.move({x:i,y:n}).then(function(){r._events.fire("virtualDoubleClick",{x:r.x,y:r.y,button:a});return r._later()})};Jc.prototype.drag=function e(t,r){var i=this;return this.down(t).then(function(){return i.move(r)}).then(function(){return i.up()})};Jc.prototype.wheel=function e(t){var r=this;var i=t.x;var n=t.y;var a=t.delta;return this.move({x:i,y:n}).then(function(){r._events.fire("virtualWheel",{x:r.x,y:r.y,delta:a});return r._later()})};Object.defineProperties(Jc.prototype,Qc);var e_={doubleTapTimer:500,touchEventRate:15};Ogma.extend(function(e){e.modules.touch=new t_(e)});var t_=function e(t){this._dom=t.modules.dom;this._events=t.modules.events;this._settings=t.modules.settings;this._graphics=t.modules.graphics;this._x=0;this._y=0;this._pressed=false;this._domElt=this._graphics.getDomElement();this._settings.register("touch.enabled",true);this._events.register(["touchDown","touchUp","touchTap","touchDoubleTap","touchMove","touchStartGesture","touchProgressGesture","touchEndGesture","documentTouchMove","documentTouchUp"]);i_(this)};var r_={x:{configurable:true},y:{configurable:true},pressed:{configurable:true}};r_.x.get=function(){return this._x};r_.y.get=function(){return this._y};r_.pressed.get=function(){return this._pressed};t_.prototype._isEnabled=function e(){return this._settings.get("touch.enabled")};t_.prototype._bind=function e(t,r){this._dom.addElementEventListener(this._domElt,t,r)};Object.defineProperties(t_.prototype,r_);function i_(e){var t=function(t,r){return e._events.fire(t,r)};var r=0,i=0,n=0,a=0,o=false,s=0,u=false,l=false,f=1,h=0,v=null;var d=null;var c=function(){e._x=r;e._y=i;e._pressed=o};var _=function(e,t,n,a){f=e;h=t;r=n;i=a;c()};var g=function(t){var n=bt(e._domElt);if(!n){return null}var a=t.touches[0].clientX-n.left;var o=t.touches[0].clientY-n.top;var s=t.touches[1].clientX-n.left;var u=t.touches[1].clientY-n.top;var l=(a+s)/2,v=(o+u)/2,d=l-r,c=v-i,g=distance(a,o,s,u),p=g/f,y=kn(a,o,s,u),m=y-h,x={dx:d,dy:c,rotation:m,scale:p};_(g,y,l,v);return x};var p=function(e){if(e.touches.length!==2&&l){l=false;t("touchEndGesture",{domEvent:v})}else if(e.touches.length===2&&!l){if(g(e,true)){l=true;t("touchStartGesture",{domEvent:v})}}return e.touches.length===2};var y=function(e){if(e.touches.length===2&&l){var n=g(e);if(n){var a=n.dx;var o=n.dy;var s=n.rotation;var u=n.scale;t("touchProgressGesture",{dx:a,dy:o,rotation:s,scale:u,x:r,y:i,domEvent:v})}}};var m=function(t,r){e._bind(t,r)};var x=function(s){if(s.touches.length!==1){o=false;if(s.touches.length>1){t("touchUp",{x:r,y:i,domEvent:v})}return false}else{var u=bt(e._domElt);if(u){n=r;a=i;r=s.touches[0].clientX-u.left;i=s.touches[0].clientY-u.top;o=true;v=s;c()}return true}};var b=function(){s=0;e._dom.clearTimeout(d)};m("touchstart",function(n){p(n);if(x(n)){t("touchDown",{x:r,y:i,domEvent:v});s+=1;d=e._dom.setTimeout(b,e_.doubleTapTimer);u=true}});var A=function(e){p(e);x(e);if(e.touches.length===0){if(s===1){t("touchTap",{x:r,y:i,domEvent:v})}else if(s>1){t("touchDoubleTap",{x:r,y:i,domEvent:v});b()}t("touchUp",{x:r,y:i,domEvent:v})}};m("touchend",A);m("touchcancel",A);m("touchmove",function(e){y(e);if(u){u=false;return}b();if(x(e)){t("touchMove",{x:r,y:i,dx:r-n,dy:i-a,domEvent:v})}});var w=function(e){return e.preventDefault()};m("touchstart",w);m("touchend",w);m("touchcancel",w)}var n_={65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",46:"del",8:"backspace",32:"space",224:"cmd",91:"cmd",92:"cmd",93:"cmd",187:"+",189:"-"};var a_={};(function(){var e=Object.keys(n_);e.forEach(function(e){var t=n_[e];if(!a_[t]){a_[t]=[]}a_[t].push(e)})})();Ogma.extend(function(e){var t=new o_(e);e.modules.keyboard=t;e.events.onKeyPress=function(r,i){t.onKeyPress(r,i);return e.events};e.keyboard={isKeyPressed:function e(r){return t.isPressed(r)},resetKeys:function e(){t.resetKeys()}}});var o_=function e(t){var r=this;this._dom=t.modules.dom;this._events=t.modules.events;this._events.register(["keyUp","keyDown"]);this._binds=[];this._pressed=[];this._onKeyDown=function(e){var t=e.keyCode||e.which,i=r._binds[t];r._pressed[t]=true;if(i){for(var n=0;n<i.length;++n){var a=i[n],o=true;for(var s=0;s<a.keys.length;++s){var u=false,l=a.keys[s];for(var f=0;f<l.length;++f){if(r._pressed[l[f]]){u=true}}if(!u){o=false}}if(o){a.handler({domEvent:e})}}}r._events.fire("keyDown",{domEvent:e,key:n_[t],code:t})};this._onKeyUp=function(e){var t=e.keyCode||e.which;r._pressed[t]=false;r._events.fire("keyUp",{domEvent:e,key:n_[t],code:t})};this._onBlur=function(){return r._resetKeys()};this._dom.addWindowEventListener("keydown",this._onKeyDown);this._dom.addWindowEventListener("keyup",this._onKeyUp);this._dom.addWindowEventListener("visibilitychange",this._onBlur);this._dom.addWindowEventListener("blur",this._onBlur,false)};o_.prototype.resetKeys=function e(){this._resetKeys()};o_.prototype._resetKeys=function e(){var t=this;for(var r=0;r<this._pressed.length;++r){if(t._pressed[r]){t._pressed[r]=false;t._events.fire("keyUp",{key:n_[r],code:r})}}};o_.prototype.onKeyPress=function e(t,r){var i=this;if(typeof t==="number"){t=[t]}else if(typeof t==="string"){t=t.split(" ")}else if(!Array.isArray(t)){throw new TypeError(t+" is not a number, string or array")}else if(t.length===0){throw new Error("the array should contain at least one element")}var n=[];t.forEach(function(e){if(typeof e==="number"){n.push([e])}else if(typeof e==="string"){var t=a_[e];if(!t){throw new Error(e+" is not a valid key identifier")}n.push(t)}else{throw new TypeError(e+" is not a valid key identifier")}});var a=n.pop(),o={keys:n,handler:r};a.forEach(function(e){if(!i._binds[e]){i._binds[e]=[]}i._binds[e].push(o)})};o_.prototype.isPressed=function e(t){var r=this;if(typeof t==="number"){return this._pressed[t]}else if(typeof t==="string"){var i=a_[t];if(i){for(var n=0;n<i.length;++n){if(r._pressed[i[n]]){return true}}}}return false};Ogma.extend(function(e){var t=new s_(e);var r=e.modules.events;e.modules.captor=t;e.getHoveredElement=function(){return t.getPointedElement()};e.view.getElementAt=function(e){return t.getElementAt(e)};e.getPointerInformation=function(){return t.getCursorInformation()};te(e.events,{onMouseMove:function t(i){r.on("move",i);return e.events},onMouseButtonDown:function t(i){r.on("down",i);return e.events},onMouseButtonUp:function t(i){r.on("up",i);return e.events},onClick:function t(i){r.on("click",i,{delay:true});return e.events},onDoubleClick:function t(i){r.on("doubleClick",i,{delay:true});return e.events},onMouseWheel:function t(i){r.on("wheel",i,{delay:true});return e.events},onHover:function t(i){r.on("hover",i);return e.events},onUnhover:function t(i){r.on("unhover",i);return e.events},onDragStart:function t(i){r.on("dragStart",i,{delay:true});return e.events},onDragProgress:function t(i){r.on("dragProgress",i,{delay:true});return e.events},onDragEnd:function t(i){r.on("dragEnd",i,{delay:true});return e.events},onGestureStart:function t(i){r.on("gestureStart",i);return e.events},onGestureProgress:function t(i){r.on("gestureProgress",i);return e.events},onGestureEnd:function t(i){r.on("gestureEnd",i);return e.events}})});var s_=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._camera=t.modules.camera;this._mouse=t.modules.mouse;this._events=t.modules.events;this._settings=t.modules.settings;this._spatial=t.modules.spatial;this._elt=null;this._hoveredElt=null;this._draggedElt=null;this._enabled=true;this._init=false;this._hover=false;this._x=undefined;this._y=undefined;this._timeout=null;this._buttons={left:{isPressed:false,isDragging:false},middle:{isPressed:false,isDragging:false},right:{isPressed:false,isDragging:false}};this._events.register(["move","down","up","click","doubleClick","hover","unhover","wheel","dragStart","dragProgress","dragEnd","gestureStart","gestureProgress","gestureEnd"]);this._settings.register("detect.nodes",true);this._settings.register("detect.edges",true);this._settings.register("detect.nodeTexts",true);this._settings.register("detect.edgeTexts",true);this._settings.register("detect.nodeErrorMargin",5);this._settings.register("detect.edgeErrorMargin",7);this._settings.register("detect.enableSpatialIndex",true);this._settings.register("detect.spatialIndexMarginRatio",10);this._events.on({"removeNodes removeEdges clear":function(){p_(r,r._x,r._y);if(!r._timeout){r._timeout=r._dom.setTimeout(function(){h_(r,{x:r._x,y:r._y,dx:0,dy:0});r._timeout=null},0)}},"mouseMove touchMove virtualMove":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.dx;var s=e.dy;h_(r,{domEvent:i,x:n,y:a,dx:o,dy:s,source:u_(t)})},"mouseDown touchDown virtualDown":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";f_(r,{domEvent:i,x:n,y:a,button:o,source:u_(t)})},"mouseUp touchUp virtualUp":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";c_(r,{domEvent:i,x:n,y:a,button:o,source:u_(t)})},"mouseClick touchTap virtualClick":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";__(r,{domEvent:i,x:n,y:a,button:o,source:u_(t)})},"mouseDoubleClick touchDoubleTap virtualDoubleClick":function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";g_(r,{domEvent:i,x:n,y:a,button:o,source:u_(t)})},"mouseWheel virtualWheel":function(e){var t=e.domEvent;var i=e.x;var n=e.y;var a=e.delta;r._x=i;r._y=n;l_(r,"wheel",undefined,{domEvent:t,x:i,y:n,delta:a,source:"mouse",target:r._hoveredElt})},touchStartGesture:function(e){return r._events.fire("gestureStart",e)},touchProgressGesture:function(e){return r._events.fire("gestureProgress",e)},touchEndGesture:function(e){return r._events.fire("gestureEnd",e)},documentMouseMove:function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.dx;var s=e.dy;var u=u_(t);K(r._buttons,function(e,t){var l=e.isDragging;if(l){l_(r,"dragProgress",r._draggedElt,{domEvent:i,x:n,y:a,dx:o,dy:s,button:t,source:u})}})},documentMouseUp:function(e,t){var i=e.domEvent;var n=e.x;var a=e.y;var o=e.button;if(o===void 0)o="left";var s=u_(t);if(r._buttons[o].isDragging){l_(r,"dragEnd",r._draggedElt,{domEvent:i,x:n,y:a,button:o,source:s});if(v_(r)===0){r._draggedElt=null}var u=r._buttons[o];u.isDragging=false;u.isPressed=false}}})};s_.prototype.triggerUnhover=function e(){this._hover=false;this._hoveredElt=null};s_.prototype.triggerDetection=function e(){y_(this,this._x,this._y);if(this._elt){this._hoveredElt=this._elt;this._hover=true}};s_.prototype.getElementAt=function e(t,r){var i=t.x;var n=t.y;return m_(this,i,n,r)};s_.prototype.getPointedElement=function e(){return this._hoveredElt};s_.prototype.getDraggedElement=function e(){return this._draggedElt};s_.prototype.isAnyButtonPressed=function e(){return d_(this)>0};s_.prototype.isButtonPressed=function e(t){return this._buttons[t].isPressed};s_.prototype.isLeftPressed=function e(){return this.isButtonPressed("left")};s_.prototype.getCursorPosition=function e(){return{x:this._x,y:this._y}};s_.prototype.getCursorInformation=function e(){return{x:this._x,y:this._y,target:this._hoveredElt}};s_.prototype.setDetectionEnabled=function e(value){var t=this._enabled;this._enabled=!!value;return t};function u_(e){if(e.indexOf("touch")===0){return"touch"}else{return"mouse"}}function l_(e,t,r,i){i.target=r||null;e._events.fire(t,i);return i}function f_(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;y_(e,i,n);if(e._elt!==e._hoveredElt){p_(e,i,n)}var s=e._buttons[a];e._hoveredElt=e._elt;e._hoveredEltIsNode=e._elt&&e._elt.isNode;s.isPressed=true;l_(e,"down",e._hoveredElt,{domEvent:r,x:i,y:n,button:a,source:o})}function h_(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.dx;var o=t.dy;var s=t.source;e._events.fire("move",{domEvent:r,x:i,y:n,dx:a,dy:o,source:s});e._x=i;e._y=n;K(e._buttons,function(t,u){if(t.isPressed){if(!t.isDragging){t.isDragging=true;if(e._hoveredElt){if(e._hover){l_(e,"unhover",e._hoveredElt,{domEvent:r,x:i,y:n,source:s});e._hover=false}}if(!e._draggedElt){e._draggedElt=e._hoveredElt;e._draggedEltIsNode=e._hoveredEltIsNode}l_(e,"dragStart",e._draggedElt,{domEvent:r,x:i,y:n,button:u,source:s})}else{l_(e,"dragProgress",e._draggedElt,{domEvent:r,x:i,y:n,dx:a,dy:o,button:u,source:s})}}});if(!r||e._graphics.getDomElement().contains(r.target)){y_(e,i,n)}if(e._elt!==e._hoveredElt){if(e._hoveredElt&&e._hover){e._hover=true;l_(e,"unhover",e._hoveredElt,{domEvent:r,x:i,y:n,source:s})}e._hoveredElt=e._elt;e._hoveredEltIsNode=e._isNode;if(e._elt){e._hover=true;l_(e,"hover",e._hoveredElt,{domEvent:r,x:i,y:n,source:s})}}}function v_(e){return J(e._buttons,function(e,t){var r=t.isDragging;if(r===void 0)r=false;return e+r},0)}function d_(e){return J(e._buttons,function(e,t){var r=t.isPressed;if(r===void 0)r=false;return e+r},0)}function c_(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;var s=e._buttons[a];if(!s.isPressed){return}if(s.isDragging){l_(e,"dragEnd",e._draggedElt,{domEvent:r,x:i,y:n,button:a,source:o});s.isDragging=false;if(v_(e)===0){e._draggedElt=null}}s.isPressed=false;y_(e,i,n);l_(e,"up",e._elt,{domEvent:r,x:i,y:n,button:a,source:o});if(!d_(e)&&!e._hover&&o!=="touch"){e._hoveredElt=e._elt;e._hoveredEltIsNode=e._isNode;if(e._hoveredElt){l_(e,"hover",e._hoveredElt,{domEvent:r,x:i,y:n,source:o});e._hover=true}}}function __(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;l_(e,"click",e._hoveredElt,{domEvent:r,x:i,y:n,button:a,source:o})}function g_(e,t){var r=t.domEvent;var i=t.x;var n=t.y;var a=t.button;var o=t.source;l_(e,"doubleClick",e._hoveredElt,{domEvent:r,x:i,y:n,button:a,source:o})}function p_(e,t,r){var i=null;K(e._buttons,function(n,a){var o=n.isDragging;if(o){l_(e,"dragEnd",e._draggedElt,{domEvent:i,x:t,y:r,button:a})}});if(e._hover&&e._hoveredElt){l_(e,"unhover",e._hoveredElt,{domEvent:i,x:t,y:r})}Object.keys(e._buttons).forEach(function(t){var r=e._buttons[t];r.isPressed=false;r.isDragging=false});e._hover=false;e._hoveredElt=null;e._draggedElt=null}function y_(e,t,r,i){e._elt=m_(e,t,r,i);e._isNode=!e._elt||e._elt.isNode}function m_(e,t,r,i){if(!e._enabled||t===undefined||r===undefined){return null}var n=e._settings;var a=n.get("detect.enableSpatialIndex");var o=n.get("detect.nodeErrorMargin");var s=n.get("detect.edgeErrorMargin");var u=n.get("detect.nodes");var l=n.get("detect.edges");var f={x:t,y:r};var h=null,v,d;if(!i&&a){if(u||l){var c=n.get("detect.spatialIndexMarginRatio");var _=Math.max(o*c,s*c);var g=e._spatial.queryRawProjected(t-_,r-_,t+_,r+_);v=g.nodes;d=g.edges}}if(u){h=e._graphics.detectNode({position:f,indexes:v,margin:o,texts:n.get("detect.nodeTexts")})}if(!h&&l){h=e._graphics.detectEdge({position:f,indexes:d,margin:s,texts:n.get("detect.edgeTexts")})}return h}Ogma.extend(function(e){e.modules.sync=new x_(e)});var x_=function e(t){var r=this;this._dom=t.modules.dom;this._events=t.modules.events;this._captor=t.modules.captor;this._delayedCalls=[];this._idIdle=function(){return!r._captor.isAnyButtonPressed()&&!r._dom.isPlayingFrame()};this._events.on({"down up beforeNewFrame newFrame":function(){r._delayedCalls.forEach(function(e){return e.reset()})}})};x_.prototype._nextTimeIdle=function e(t){var r=this;var i=new b_(this._dom,this._idIdle,t);this._delayedCalls.push(i);return i.whenDone().then(function(){r._delayedCalls.splice(r._delayedCalls.indexOf(i),1)})};x_.prototype.debounceIdle=function e(t,r){var i=this;if(r===void 0)r=0;var n=false;var a=[];var o=function(){var e=a;n=false;a=[];t();e.forEach(function(e){return e()})};return function(){return new Promise(function(e){a.push(e);if(!n){n=true;i._nextTimeIdle(r).then(o)}})}};var b_=function e(t,r,i){var n=this;this._dom=t;this._promise=new Promise(function(e){return n._resolve=e});this._isIdle=r;this._delay=i;this._timeout=null;this._done=false;this._startTimeout()};b_.prototype._startTimeout=function e(){var t=this;this._timeout=this._dom.setTimeout(function(){if(t._isIdle()){t._done=true;t._resolve()}else{t._startTimeout()}},this._delay)};b_.prototype.reset=function e(){if(!this._done){this._dom.clearTimeout(this._timeout);this._startTimeout()}};b_.prototype.whenDone=function e(){return this._promise};var A_=40;var w_="quadraticInOut";var E_=200;Ogma.atInit(function(e){e.view.locateGraph()});Ogma.extend(function(e){var t=new S_(e);var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;e.modules.locate=t;r.prototype.locate=function(e){return t.locateElements(this,e)};n.prototype.locate=function(e){return t.locateElements(this,e)};i.prototype.locate=function(e){return t.locateElements(this,e)};a.prototype.locate=function(e){return t.locateElements(this,e)};r.prototype.getBoundingBox=function(){return t.getBoundingBox(this)};n.prototype.getBoundingBox=function(){return t.getBoundingBox(this)};i.prototype.getBoundingBox=function(e){return t.getBoundingBox(this,e)};a.prototype.getBoundingBox=function(e){return t.getBoundingBox(this,e)};e.view.locateGraph=function(e){return t.locateGraph(e)};e.view.locateRawGraph=function(e,r){return t.locateRawGraph(e,r)};e.view.getGraphBoundingBox=function(){return t.getGraphBoundingBox()}});var S_=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._events=t.modules.events;this._camera=t.modules.camera;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._settings=t.modules.settings;this._sync=t.modules.sync;this._cacheValid=true;this._cachedGraphBoundingBox=new vn;this._scheduleCacheUpdate=this._sync.debounceIdle(function(){r._updateCache()},50);this._events.on({"addNodes removeNodes addEdges removeEdges excludedStateChange clear updateAttributes":function(){r._invalidCache()}})};S_.prototype.locateGraph=function e(t){return this._locateBoundingBox(this.getGraphBoundingBox(),t)};S_.prototype.locateElements=function e(t,r){return this._locateBoundingBox(this.getBoundingBox(t),r)};S_.prototype.locateRawGraph=function e(t,r){return this._locateBoundingBox(this._getRawGraphBoundingBox(t),r)};S_.prototype.getGraphBoundingBox=function e(){if(!this._cacheValid){this._updateCache()}return Object.assign({},this._cachedGraphBoundingBox)};S_.prototype.forceInvalidCache=function e(){this._invalidCache()};S_.prototype._invalidCache=function e(){this._cacheValid=false};S_.prototype._updateCache=function e(){this._cacheValid=true;this._cachedGraphBoundingBox=this.getBoundingBox(this._ogma.getNodes())};S_.prototype.getBoundingBox=function e(t,r){if(t.isNode){return this._getNodesBoundingBox(t.toList())}else{return this._getEdgesBoundingBox(t.toList(),r)}};S_.prototype._getNodesBoundingBox=function e(t){var r=t.size;var i=t.getAttribute("x");var n=t.getAttribute("y");var a=t.getAttribute("radius");var o=[];var s=[];var u=[];for(var l=0;l<r;++l){var f=a[l];var h=i[l];var v=n[l];o.push(h-f,h+f);s.push(v-f,v+f);u.push(f*2)}return new vn({xValues:o,yValues:s,sizeValues:u})};S_.prototype._getEdgesBoundingBox=function e(t,r){if(r===void 0)r=false;var i=t.size;var n=t.getSource();var a=t.getTarget();var o=t.getAttribute("curvature");var s=n.getAttribute("x");var u=n.getAttribute("y");var l=n.getAttribute("radius");var f=a.getAttribute("x");var h=a.getAttribute("y");var v=a.getAttribute("radius");var d={x1:0,y1:0,x2:0,y2:0};var c={x:0,y:0};var _={minX:0,minY:0,maxX:0,maxY:0};var g=[];var p=[];var y=[];for(var m=0;m<i;++m){var x=n.get(m);var b=a.get(m);var A=o[m];var w=s[m];var E=u[m];var S=l[m];var C=f[m];var T=h[m];var M=v[m];y.push(S*2,M*2);if(r||A===0){g.push(w-S,w+S,C-M,C+M);p.push(E-S,E+S,T-M,T+M)}else if(x===b){ao(w,E,A,S,d);yo(w,E,d.x1,d.y1,d.x2,d.y2,C,T,_);g.push(_.minX,_.maxX);p.push(_.minY,_.maxY)}else{io(w,E,C,T,A,c);po(w,E,c.x,c.y,C,T,_);g.push(_.minX,_.maxX);p.push(_.minY,_.maxY)}}return new vn({xValues:g,yValues:p,sizeValues:y})};S_.prototype._getRawGraphBoundingBox=function e(t){return new vn({xValues:t.nodes.map(function(e){return e.x||0}),yValues:t.nodes.map(function(e){return e.y||0}),sizeValues:t.nodes.map(function(e){return+(e.attributes&&e.attributes.radius)||5})})};S_.prototype._computeCameraConfig=function e(t,r,i){var n,a,o,s;if(typeof r==="number"){n=r;a=r;o=r;s=r}else{n=ns(r.left,A_);a=ns(r.right,A_);o=ns(r.top,A_);s=ns(r.bottom,A_)}var u=this._dom.getDimensions();var l=(u.width-n-a)/(t.maxX-t.minX);var f=(u.height-o-s)/(t.maxY-t.minY);var h=Math.min(l,f);var v=this._settings.get("minZoom");var d=this._settings.get("maxZoom");var c=t.maxSize;if(c&&i&&c*h>i){h=i/c}h=Qt(h,v,d);return{x:t.cx+(a-n)/(h*2),y:t.cy+(s-o)/(h*2),zoom:h}};S_.prototype._locateBoundingBox=function e(t,r){if(r===void 0)r={};if(isNaN(t.cx)){return Promise.resolve()}var i=r.padding;if(i===void 0)i={};var n=r.easing;if(n===void 0)n=w_;var a=r.duration;if(a===void 0)a=0;var o=r.maxNodeSizeOnScreen;if(o===void 0)o=E_;var s=r.ignoreZoomLimits;if(s===void 0)s=false;var u=this._computeCameraConfig(t,i,o);var l=u.x;var f=u.y;var h=u.zoom;var v=h/this._camera.getZoom();return this._moveCamera(l,f,h,a,n,v,s)};S_.prototype._moveCamera=function e(t,r,i,n,a,o,s){if(o>1.01){this._camera.setCenter({x:t,y:r},{duration:n,easing:a,ignoreZoomLimits:s});return this._camera.setZoom(i,{duration:n,easing:a,ignoreZoomLimits:s,startAfter:.5})}else if(o<.99){this._camera.setCenter({x:t,y:r},{duration:n,easing:a,ignoreZoomLimits:s,startAfter:.5});return this._camera.setZoom(i,{duration:n,easing:a,ignoreZoomLimits:s})}else{return this._camera.setCenter({x:t,y:r},{duration:n,easing:a,ignoreZoomLimits:s})}};S_.prototype.computeConfigForBounds=function e(t,r){if(r===void 0)r={};var i=r.padding;if(i===void 0)i={};var n=r.maxNodeSizeOnScreen;if(n===void 0)n=E_;return this._computeCameraConfig(t,i,n)};function C_(e,t){var r=e.x;var i=e.y;var n=e.indexes;var a=t.getAttribute(true,"radius").getMultiple(n);var o=[];var s=[];var u=[];for(var l=0;l<n.length;++l){var f=r[l];var h=i[l];var v=a[l]*2;u.push(v);o.push(f+v,f-v);s.push(h+v,h-v)}return new vn({xValues:o,yValues:s,sizeValues:u})}Ogma.extend(function(e){e.modules.imports=new T_(e);e.fetch=function(e){return yt(e)}});var T_=function e(t){this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._locate=t.modules.locate;this._dom=t.modules.dom;this._camera=t.modules.camera;this._importers={}};T_.prototype.from=function e(t,r){var i=this._importers[t];if(!i){throw new Error(t+" is not a valid importer.")}return new Promise(function(e,t){try{var n=i.translate(r);e(n)}catch(e){t(e)}})};T_.prototype.register=function e(t,r){if(typeof r==="function"){r={translate:r,webWorkerCompatible:false}}ss(this._importers,t,r,"importer")};var M_=J_(" "),k_=J_("<"),I_=J_(">"),N_=J_('"'),L_=J_("\n"),z_=J_("\r"),D_=J_("/"),P_=J_("\\"),F_=J_("a"),B_=J_("z"),R_=J_("A"),O_=J_("Z"),V_=J_("0"),j_=J_("9"),U_=J_(":");var G_=-1,X_=-2,W_=-3,Y_=-4;function H_(e){var t=new Int32Array(e.length);for(var r=0,i=e.length;r<i;++r){t[r]=e.charCodeAt(r)}return t}function q_(e,t,r,i){var n=i.length;if(r-t!==n){return false}for(var a=0;a<n;++a){if(e[t+a]!==i[a]){return false}}return true}function Z_(e,t,r,i){return K_(e.tags,t,r,i)}function $_(e,t,r,i){return K_(e.attributes,t,r,i)}function K_(e,t,r,i){var n=e.length;for(var a=0;a<n;++a){if(q_(t,r,i,e[a])){return a}}e.push(t.slice(r,i));return n}function J_(e){return e.charCodeAt(0)}function Q_(e,t,r){var i,n,a;r=rg(t,r);i=t[r];if(i===I_||i===D_){return r}n=r;r=ng(t,r);a=$_(e,t,n,r);while(t[r]!==N_){++r}++r;n=r;while((i=t[r])!==N_){if(i===P_){++r}++r}e.tokens.push(W_,a,n,r);return r+1}function eg(e,t){var r,i,n,a,o=e.length;var s={tags:[],attributes:[],tokens:[]};var u=s.tokens;t=rg(e,t);while(t<o){a=e[t];if(a===k_){t=rg(e,++t);if(e[t]===D_){u.push(X_);while(e[++t]!==I_){}}else{r=t;t=ng(e,r);n=Z_(s,e,r,t);u.push(G_,n);a=e[t];while(a!==I_&&a!==D_){t=Q_(s,e,t);a=e[t]}if(a===D_){u.push(X_);while(e[++t]!==I_){}}}t+=1}else{r=t;while(e[++t]!==k_){}i=t-1;while(tg(e[i])){--i}u.push(Y_,r,i+1)}t=rg(e,t)}return s}function tg(e){return e===M_||e===L_||e===z_}function rg(e,t){while(tg(e[t])){++t}return t}function ig(e){return e>=F_&&e<=B_||e>=R_&&e<=O_||e===U_||e>=V_&&e<=j_}function ng(e,t){while(ig(e[t])){++t}return t}function ag(e,t){var r=["this.id = undefined;","this.attributes = {","  text: undefined,","  color: undefined,","  "+(e?"radius":"width")+": undefined",e?"  ,x: undefined":"",e?"  ,y: undefined":"","};"];if(!e){r.push("this.source = undefined;","this.target = undefined;")}var i=Object.keys(t);if(i.length){r.push("  this.data = {")}for(var n=0;n<i.length;++n){var a=i[n],o=t[a],s=o.title;r.push('  "'+s+'": '+(o.default!==undefined?JSON.stringify(o.default):undefined)+(n===i.length-1?"":","))}if(i.length){r.push("};")}return new Function(r.join("\n"))}function og(e){if(e.indexOf("\\")===-1){return e}e=e.replace(/\\"/g,'"');return e}function sg(e){if(e.indexOf("<gexf")===-1){throw new Error("not a GEXF file")}var t=H_(e),r=eg(t,e.indexOf("<gexf ")),i={},n={};r.tags.forEach(function(e,t){var r=String.fromCharCode.apply(null,e);i[r]=t});r.attributes.forEach(function(e,t){var r=String.fromCharCode.apply(null,e);n[r]=t});var a=i.attributes,o=i.attribute,s=i.node,u=i.edge,l=i.default,f=i["viz:position"],h=i["viz:size"],v=i["viz:color"],d=i.attvalue,c=n.class,_=n.id,g=n.type,p=n.title,y=n.label,m=n.source,x=n.target,b=n.x,A=n.y,w=n.r,E=n.g,S=n.b,C=n.a,T=n.value,M=n.for,k=n.weight,I=4,N=5,L=6;var z=1,D=2,P=3,F=4,B=5;var R={float:z,double:z,integer:D,boolean:P,string:F,"list-string":B};var O=0,V=r.tokens,j=V.length;var U=new Array(16),G=0,X=0,W=0,Y=true,H={},q={},Z=null,$=null,K=null,J=undefined,Q=null,ee=0,te=0,re=0,ie=1,ne=null,ae=undefined,oe=false,se=true,ue=null,le=null,fe=[],he=[],ve=0,de=null;while(O<j){var ce=V[O];if(ce===G_){X=G;G=V[O+1];U[W]=G;W+=1;if(G===s){if(!ue){ue=ag(true,H)}Q=new ue;se=true;de=H}else if(G===u){if(!le){le=ag(false,q)}Q=new le;se=false;de=q}O+=2}else if(ce===X_){if(Z&&G===o){de=Y?H:q;var _e=R[$],value=J;if(value){if(_e===z){value=+value}else if(_e===D){value=+value|0}else if(_e===P){value=value==="true"}else if(_e===B){value=value.split(" ").filter(function(e){return e})}}de[Z]={title:K||Z,type:_e,default:value};Z=null;K=null;$=null;J=undefined}else if(G===s&&W===I){if(oe){Q.attributes.color="rgba("+ee+", "+te+", "+re+", "+ie+")";ee=0;te=0;re=0;ie=1;oe=false}if(!Q.id){Q.id=++ve}fe.push(Q)}else if(G===u&&W===I){if(!Q.id){Q.id=++ve}he.push(Q)}else if(G===d&&W===L&&ne){var ge=(se?H:q)[ne];if(ge){if(ae===undefined){ae=ge.default}else{_e=ge.type;if(_e){if(_e===z){ae=+ae}else if(_e===D){ae=+ae|0}else if(_e===P){ae=ae==="true"}else if(_e===B){ae=ae.split(" ").filter(function(e){return e}).map(function(e){return og(e)})}else{ae=og(ae)}}}Q.data[de[ne].title]=ae}ne=null;ae=null}W-=1;G=X;X=U[W-2];O+=1}else if(ce===W_){var pe=V[O+1];value=e.substring(V[O+2],V[O+3]);if(G===a){if(pe===c){Y=value!=="edge"&&value!=="edges"}}else if(G===o){if(pe===_){Z=value}else if(pe===g){$=value}else if(pe===p){K=value}}else if((G===s||G===u)&&W===I){if(pe===_){Q.id=value}else if(pe===y){Q.attributes.text=value}else if(pe===m){Q.source=value}else if(pe===x){Q.target=value}else if(pe===k){Q.attributes.width=+value}}else if(G===f&&W===N){if(pe===b){Q.attributes.x=+value}else if(pe===A){Q.attributes.y=-value}}else if(G===v&&W===N){oe=true;if(pe===w){ee=value}else if(pe===E){te=value}else if(pe===S){re=value}else if(pe===C){ie=value}}else if(G===h&&W===N){if(pe===T){if(se){Q.attributes.radius=+value}else{Q.attributes.width=+value}}}else if(G===d&&W===L){if(pe===M||pe===_){ne=value}else if(pe===T){ae=value}}O+=4}else if(ce===Y_){value=e.substring(V[O+1],V[O+2]);if(G===l){J=value}O+=3}else{throw new Error("at index "+O+": token "+ce)}}return{nodes:fe,edges:he}}Ogma.extend(function(e){e.modules.imports.register("gexf",{translate:sg,webWorkerCompatible:true});e.parse.gexf=function(t){return e.modules.imports.from("gexf",t)};e.parse.gexfFromUrl=function(t){return yt(t).then(function(t){return e.modules.imports.from("gexf",t)})}});function ug(e,t,r){r=r||t;if(t in e){if(!e.attributes){e.attributes={}}e.attributes[r]=e[t]}}function lg(e){var t=JSON.parse(e),r=t.nodes||[],i=t.edges||[];for(var n=0,a=r.length;n<a;++n){var o=r[n];if(typeof o.size==="string"){o.size=+o.size}if(typeof o.x==="string"){o.x=+o.x}if(typeof o.y==="string"){o.y=+o.y}ug(o,"x");ug(o,"y");ug(o,"size","radius");ug(o,"color");ug(o,"text")}for(var s=0,u=i.length;s<u;++s){var l=i[s];if(typeof l.size==="string"){l.size=+l.size}ug(l,"size","width");ug(l,"color");ug(l,"text")}return t}Ogma.extend(function(e){e.modules.imports.register("json",{translate:lg,webWorkerCompatible:true});e.parse.json=function(t){return e.modules.imports.from("json",t)};e.parse.jsonFromUrl=function(t){return yt(t).then(function(t){return e.modules.imports.from("json",t)})}});var fg=function e(){this._decimalPowerOfTwo=new Uint8Array(20);this._binaryNumber=new Uint8Array(64);this._decimalNumber=new Uint8Array(20)};fg.prototype._addDecimalNumbers=function e(t,r){var i=0;for(var n=0;n<20;++n){var a=i+t[n]+r[n];i=+(a>=10);t[n]=a%10}};fg.prototype._loadNumberInBits=function e(t,r,i){for(var n=0;n<32;++n){i[n]=+!!(t&1<<n)}for(var a=0;a<32;++a){i[a+32]=+!!(r&1<<a)}return i};fg.prototype._negateBinaryNumber=function e(t){for(var r=0;r<64;++r){t[r]^=1}for(var i=0;i<64&&!(t[i]^=1);++i){}};fg.prototype.int64ToString=function e(t){var r=this;var i=t.low;var n=t.high;if(i===0&&n===0){return"0"}this._loadNumberInBits(i,n,this._binaryNumber);this._decimalNumber.fill(0);this._decimalPowerOfTwo.fill(0);this._decimalPowerOfTwo[0]=1;var a=this._binaryNumber[63]===1;if(a){this._negateBinaryNumber(this._binaryNumber)}for(var o=0;o<64;++o){if(r._binaryNumber[o]){r._addDecimalNumbers(r._decimalNumber,r._decimalPowerOfTwo)}r._addDecimalNumbers(r._decimalPowerOfTwo,r._decimalPowerOfTwo)}var s=[];var u=this._decimalNumber.length-1;if(a){s.push("-")}while(!this._decimalNumber[u]){u-=1}for(var l=u;l>=0;--l){s.push(r._decimalNumber[l])}return s.join("")};Ogma.extend(function(e){e.modules.imports.register("neo4j",yg);e.parse.neo4j=function(t){return e.modules.imports.from("neo4j",t)}});var hg=new fg;function vg(e){return hg.int64ToString(e)}function dg(e){if(typeof e!=="object"||e===null){throw new Error("Ogma can only retrieve nodes and relationships from Neo4j. "+"Please make sure that your Cypher query returns nodes and edges, not values.")}var t=Object.keys(e.properties);for(var r=0;r<t.length;r++){var i=t[r];var n=e.properties[i];if(typeof n==="object"&&"high"in n&&"low"in n){n=vg(n)}}if(typeof e.identity!=="number"){e.identity=vg(e.identity);if("start"in e&&"end"in e){e.start=vg(e.start);e.end=vg(e.end)}}}var cg=function(e){return"start"in e&&"end"in e&&"type"in e};var _g=function(e){return"segments"in e};function gg(e,t){t.segments.forEach(function(t){pg(e,t.start);pg(e,t.end);pg(e,t.relationship)})}function pg(e,t){if(t){if(Array.isArray(t)){t.forEach(function(t){return pg(e,t)})}else if(_g(t)){gg(e,t)}else{dg(t);if(cg(t)){e.edges.push({id:t.identity,source:t.start,target:t.end,data:{neo4jType:t.type,neo4jProperties:t.properties}})}else{e.nodes.push({id:t.identity,attributes:{x:Math.random()*100,y:Math.random()*100},data:{neo4jLabels:t.labels,neo4jProperties:t.properties}})}}}}function yg(e){var t={nodes:[],edges:[]};e.records.forEach(function(e){e.forEach(function(e){pg(t,e)})});return t}Ogma.extend(function(e){e.modules.imports.register("janus",mg);e.parse.janus=function(t){return e.modules.imports.from("janus",t)}});function mg(e){var t=[],r=[];var i=function(e){if(!e||typeof e!=="object"){return}if(e.type==="vertex"){var n={};if(e.properties){Object.keys(e.properties).forEach(function(t){n[t]=e.properties[t][0].value})}t.push({id:e.id+"",data:{id:e.id+"",categories:[e.label],properties:n}})}else if(e.type==="edge"){r.push({id:e.id+"",source:e.inV+"",target:e.outV+"",data:{id:e.id+"",type:e.label,properties:e.properties||{}}})}else if(Array.isArray(e)){e.forEach(function(e){return i(e)})}else{Object.keys(e).forEach(function(t){return i(e[t])})}};i(e);return{nodes:t,edges:r}}Ogma.extend(function(e){e.modules.labels=new Bg(e.modules)});var xg=1.2;var bg=5;var Ag=Math.PI/2;var wg="topDown";var Eg="bottomUp";var Sg=.25;var Cg=200;var Tg=6;var Mg=5;var kg={left:-1,right:1,top:0,bottom:0,center:0};var Ig={left:0,right:0,top:-1,bottom:1,center:0};var Ng=4;var Lg={left:-1,right:0,top:-1/2,bottom:-1/2,center:-1/2};var zg={left:-1/2,right:-1/2,top:-1,bottom:0,center:-1/2};var Dg={x1:0,y1:0,x2:0,y2:0};var Pg=new Nr;var Fg=["x","y","radius","width","text.content","text.minVisibleSize","text.size","text.scale","text.scaling","text.padding","text.margin","text.position"].reduce(function(e,t){e[t]=true;return e},{});var Bg=function e(t){var r=this;var i=t.dom;var n=t.graph;var a=t.graphics;var o=t.camera;var s=t.events;var u=t.settings;var l=t.sync;var f=t.spatial;this._dom=i;this._graph=n;this._graphics=a;this._camera=o;this._events=s;this._settings=u;this._sync=l;this._spatial=f;this._engine=a.getGraphicsEngine();this._textBBoxes=[];this._textQuad=new Jo(function(e){var t=Tg;var i=t*e;return r._textBBoxes.slice(i,i+t)},bg);this._enabled=false;this._forceEnabled=false;this._events.register(["labelCollisionsRemoved"]);this.setRate(Cg);u.register("texts.preventOverlap",true,function(e){return r._onToggle(e)});u.register("texts.debug",false,function(e){return r._toggleDebug(e)});u.register("texts.removalStrategy",wg);this._rects=[];this._events.on({viewChanged:function(){r._update()},updateAttributes:function(){r._update()},setContainer:function(e){var t=e.element;if(t){r._enable()}else{r._disable()}}})};Bg.prototype.setRate=function e(t){var r=this;this._updateDebounced=this._sync.debounceIdle(function(){return r._updateLabels()},t)};Bg.prototype._update=function e(){if(this._enabled||this._forceEnabled){this._updateDebounced()}};Bg.prototype._enable=function e(){this._enabled=true;this._update()};Bg.prototype._disable=function e(){this._enabled=false};Bg.prototype.forceEnable=function e(){this._forceEnabled=true};Bg.prototype._onToggle=function e(t){if(t){this._update()}else{this._reset()}};Bg.prototype._toggleDebug=function e(t){if(t){this._canvas=it();this._graphics.addCanvas(this._canvas);this._ctx=this._canvas.getContext("2d");this._update()}else if(this._canvas){this._graphics.removeCanvas(this._canvas);this._canvas=this._ctx=null}};Bg.prototype.update=function e(){this._update()};Bg.prototype._onCameraMove=function e(){this._update()};Bg.prototype.forceUpdate=function e(){this._updateLabels()};Bg.prototype._updateLabels=function e(){if(!this._settings.get("texts.preventOverlap")){return}this._intersects=[];var t=this._textQuad;t.clear();var r=this._textBBoxes=[];var i=this._rects=[];var n=this._camera.getAngle();var a=this._camera.getProjectedScreenBounds(Sg);var o=this._settings.get("texts.removalStrategy")===Eg;this._screen=a;var s={angle:n,zoom:this._camera.getZoom(),sin:Math.sin(n),cos:Math.cos(n),screen:a};var u={remove:{nodes:[],edges:[]},redraw:{nodes:[],edges:[]}};var l=this._spatial.queryRaw(a[0],a[1],a[2],a[3]);var f=l.nodes;var h=l.edges;this._fillNodeTexts(f,t,r,i,s,o,u);this._fillEdgeTexts(h,t,r,i,s,o,u);this._clearOverlaps(u);if(this._settings.get("texts.debug")){this.drawAll(s)}};Bg.prototype._fillNodeTexts=function e(t,r,i,n,a,o,s){var u=this;var l=this._graph;var f=s.remove.nodes;var h=s.remove.edges;var v=s.redraw.nodes;var d=a.angle;var c=a.zoom;var _=a.sin;var g=a.cos;var p=l.getNodeAttribute("layer");W(t,p);var y=l.getAttributes(true,["x","y","radius","innerStroke.width","outerStroke.width","text.content","text.position","text.size","text.font","text.style","text.maxLineLength","text.scaling","text.scale","text.minVisibleSize","text.padding","text.margin","animationDuration"]);var m=y[0];var x=y[1];var b=y[2];var A=y[3];var w=y[4];var E=y[5];var S=y[6];var C=y[7];var T=y[8];var M=y[9];var k=y[10];var I=y[11];var N=y[12];var L=y[13];var z=y[14];var D=y[15];var P=y[16];var F,B;for(var R=0,O=t.length;R<O;R++){F=t[R];var V=P.get(F);var j=E.get(F);if(j===null||j===""||V){continue}var U=b.get(F);var G=L.get(F);if(U*2*c<G){continue}var X=m.get(F);var Y=x.get(F);if(typeof j==="number"){j=j.toString()}var H=!I.get(F);var q=S.get(F);var Z=z.get(F);var $=N.get(F);var K=(H?C.get(F):$*U)*xg;var J=M.get(F);var Q=T.get(F);var ee=k.get(F);var te=Bf(j,ee);var re=te.lines;var ie=Z+A.get(F)+w.get(F)+D.get(F);var ne=kg[q];var ae=Ig[q];var oe=u._engine.measureText(j,Q,J,K).width;var se=re*K*xg;var ue=oe/2/c;var le=se/2/c;var fe=ie/c;var he=Lg[q]*oe;var ve=zg[q]*se;if(H){he/=c;ve/=c}he=he+ne*fe+ue+ne*U;ve=ve+ae*fe+le+ae*U;var de=bo(X-ue,Y-le,oe/c,se/c,-d,_,-g);var ce=[X-ue,Y-le,oe/c,se/c,d];var _e=g*he-_*ve;var ge=_*he+g*ve;de[0]+=_e;de[1]+=ge;de[2]+=_e;de[3]+=ge;ce[0]+=_e;ce[1]+=ge;var pe=r.query(de[0],de[1],de[2],de[3]);if(pe.length!==0){var ye=false;var me=Ao(ce[0],ce[1],ce[2],ce[3],ce[4]);for(var xe=0;xe<pe.length;xe++){var be=pe[xe];var Ae=be*Mg;var we=Ao(n[Ae],n[Ae+1],n[Ae+2],n[Ae+3],n[Ae+4]);if(ia(me,we)){u._intersects.push(me,we);ye=true;if(o){r.remove(be);if(i[be*Tg+4]===1){f.push(i[be*Tg+5])}else{h.push(i[be*Tg+5])}}else{break}}}if(ye&&!o){f.push(F);continue}}v.push(F);B=i.length/Tg;i.push(de[0],de[1],de[2],de[3],1,F);r.insert(B);n.push(ce[0],ce[1],ce[2],ce[3],ce[4])}};Bg.prototype._fillEdgeTexts=function e(t,r,i,n,a,o,s){var u=this;var l=this._graph;var f,h;var v=s.remove.nodes;var d=s.remove.edges;var c=s.redraw.edges;var _=a.angle;var g=a.zoom;var p=l.getAttributes(true,["x","y","radius"]);var y=p[0];var m=p[1];var x=p[2];var b=l.getEdgeAttribute("layer");W(t,b);var A=Math.PI;var w=this._graph.getAttributes(false,["source","target","width","curvature"]);var E=w[0];var S=w[1];var C=w[2];var T=w[3];var M=this._graph.getAttributes(false,["text.content","text.scaling","text.size","text.font","text.style","text.scale","text.maxLineLength","text.padding","animationDuration","text.minVisibleSize"]);var k=M[0];var I=M[1];var N=M[2];var L=M[3];var z=M[4];var D=M[5];var P=M[6];var F=M[7];var B=M[8];var R=M[9];for(var O=0,V=t.length;O<V;O++){f=t[O];var j=B.get(f);var U=k.get(f);if(U===null||U===""||j){continue}var G=E.get(f);var X=S.get(f);var Y=C.get(f);var H=T.get(f);var q=R.get(f);if(Y*g<q){continue}var Z=(y.get(G)+y.get(X))/2;var $=(m.get(G)+m.get(X))/2;if(typeof U==="number"){U=U.toString()}var K=!I.get(f);var J=D.get(f);var Q=L.get(f);var ee=(K?N.get(f):J*Y)*xg;var te=z.get(f);var re=P.get(f);var ie=F.get(f);var ne=y.get(G),ae=m.get(G);var oe=y.get(X),se=m.get(X);var ue=void 0;if(G===X){ue=A/4-_;ao(ne,ae,H,x.get(G)/2,Dg);lo(.5,ne,ae,oe,se,Dg.x1,Dg.y1,Dg.x2,Dg.y2,Pg);Z=Pg.x;$=Pg.y;ie*=-g}else if(H===0){ue=kn(ne,ae,oe,se)-_}else{ue=kn(ne,ae,oe,se)-_;io(ne,ae,oe,se,H,Dg);oo(.5,ne,ae,oe,se,Dg.x,Dg.y,Pg);Z=Pg.x;$=Pg.y}var le=ie+Ng;var fe=Bf(U,re);var he=fe.lines;var ve=u._engine.measureText(U,Q,te,ee).width*xg;var de=he*ee;var ce=ve/g/2;var _e=de/g/2;var ge=Math.abs(ue)<Ag?1:-1;var pe=ge*(le/g+Y/2+_e);var ye=[Z-ce,$-_e,Z+ce,$+_e,ue+_];wo(ye,-(ue+_),-pe,ye);ye[2]=ye[2]-ye[0];ye[3]=ye[3]-ye[1];ue=A-ue-_;var me=bo(Z-ce,$-_e,ce*2,_e*2,ue);wo(me,ue,pe,me);var xe=r.query(me[0],me[1],me[2],me[3]);if(xe.length){var be=false;var Ae=Ao(ye[0],ye[1],ye[2],ye[3],ye[4]);for(var we=0;we<xe.length;we++){var Ee=xe[we];var Se=Ee*Mg;var Ce=Ao(n[Se],n[Se+1],n[Se+2],n[Se+3],n[Se+4]);if(ia(Ae,Ce)){be=true;u._intersects.push(Ae,Ce);if(o){r.remove(Ee);if(i[Ee*Tg+4]===1){v.push(i[Ee*Tg+5])}else{d.push(i[Ee*Tg+5])}}else{break}}}if(be&&!o){d.push(f);continue}}c.push(f);h=i.length/Tg;i.push(me[0],me[1],me[2],me[3],0,f);r.insert(h);n.push(ye[0],ye[1],ye[2],ye[3],ye[4])}};Bg.prototype._clearOverlaps=function e(t){var r=this;var i=this._graph.NodeList;var n=this._graph.EdgeList;var a=new i(t.remove.nodes);var o=new n(t.remove.edges);var s=new i(t.redraw.nodes);var u=new n(t.redraw.edges);this._graphics.setTextHidden(a,true);this._graphics.setTextHidden(o,true);this._graphics.setTextHidden(s,false);this._graphics.setTextHidden(u,false);this._events.fire("labelCollisionsRemoved",t);this._dom.setTimeout(function(){return r._events.fire("labelCollisionsRemoved",t)})};Bg.prototype._reset=function e(){var t=this._graph;var r=t.getEdges()._indexes;var i=t.getNodes()._indexes;if(!i.length&&!r.length){return}var n=[];var a=[];var o=t.getNodeAttribute("textHidden");var s=t.getEdgeAttribute("textHidden");var u;for(var l=0;l<i.length;l++){u=i[l];if(o.get(u)){n.push(u)}}for(var f=0;f<r.length;f++){u=r[f];if(s.get(u)){a.push(u)}}o.reset();s.reset();this._clearOverlaps({remove:{nodes:[],edges:[]},redraw:{nodes:n,edges:a}})};Bg.prototype.drawAll=function e(){var t=this;this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);var r=this._textBBoxes;for(var i=0,n=r.length;i<n;i+=6){Rg(r.slice(i,i+4),t._ctx,t._camera,"#aaaaaa")}var a=this._rects;for(var o=0;o<a.length;o+=5){var s=Ao(a[o],a[o+1],a[o+2],a[o+3],a[o+4]);Og(s,t._ctx,t._camera,"green")}this._intersects.forEach(function(e){return Og(e,t._ctx,t._camera,"red")})};function Rg(e,t,r,i){if(i===void 0)i="#22ff00";return Og([[e[0],e[1]],[e[2],e[1]],[e[2],e[3]],[e[0],e[3]]].map(function(e){return{x:e[0],y:e[1]}}),t,r,i)}function Og(e,t,r,i){if(i===void 0)i="#ff0000";t.strokeStyle=i;t.lineWidth=1;t.beginPath();var n=Ogma.utils.getPixelRatio();for(var a=0,o=e.length;a<o;a++){var s=r.graphToScreenCoordinates(e[a]);if(a===0){t.moveTo(s.x*n,s.y*n)}else{t.lineTo(s.x*n,s.y*n)}}t.closePath();t.stroke()}var Vg=["hover","zoom","panning","rotation","gesture","drag","selection","tooltip","user","interactions","resizing","rewiring","connectNodes","lasso"];Ogma.extend(function(e){var t=new jg(e);e.modules.interactions=t});var jg=function e(t){this._dom=t.modules.dom;this._captor=t.modules.captor;this._events=t.modules.events;this._settings=t.modules.settings;this._timeout=null;this._current=null;this._started=false;this._scheduled=[];this._priority=0;this._startFunc=null};jg.prototype.onDrag=function e(t){return Ug(this,"dragStart","dragProgress","dragEnd",t)};jg.prototype.onGesture=function e(t){return Ug(this,"gestureStart","gestureProgress","gestureEnd",t)};jg.prototype.onClick=function e(t){return Gg(this,"click",t)};jg.prototype.onDoubleClick=function e(t){return Gg(this,"doubleClick",t)};jg.prototype.onHover=function e(t){return Gg(this,"hover",t)};jg.prototype.onUnhover=function e(t){return Gg(this,"unhover",t)};jg.prototype.onMouseWheel=function e(t){return Gg(this,"wheel",t)};jg.prototype.onMouseDown=function e(t){return Gg(this,"down",t)};jg.prototype.onMouseUp=function e(t){return Gg(this,"up",t)};jg.prototype.onMouseMove=function e(t){return Gg(this,"move",t)};function Ug(e,t,r,i,n){var a;var o=n.check;var s=n.onStart;var u=n.onStop;var l=n.onProgress;var f=n.priority;var h=n.disableDetection;if(f!==undefined){var v=Xg(e,{priority:us(Vg,f,"interaction"),disableDetection:h,check:o,onStart:s,onStop:u,onProgress:l});e._events.on((a={},a[t]=function(e){return v.start(e)},a[r]=function(e){return v.progress(e)},a[i]=function(e){return v.stop(e)},a));return v}else{var d=false;e._events.on(t,function(e){d=!o||o(e);if(d&&s){s(e)}});if(l){e._events.on(r,function(e){if(d){l(e)}})}if(u){e._events.on(i,function(e){if(d){if(u){u(e)}d=false}})}}}function Gg(e,t,r){if(typeof r==="function"){r={handler:r}}var i=r.priority;var n=r.handler;var a=r.check;if(i!==undefined){var o=Xg(e,{priority:us(Vg,i,"interaction"),check:a,handler:n});e._events.on(t,o)}else if(n){if(a){e._events.on(t,function(e){if(a(e)){n(e)}})}else{e._events.on(t,n)}}}function Xg(e,t){if(t===void 0)t={};if(typeof t==="function"){t={onStart:t}}else if(!Z(t)){throw new TypeError("invalid parameters "+t+": not an object")}var r=ns(t.onStart,t.handler),i=ns(t.onProgress,function(){}),n=ns(t.onStop,function(){}),a=ns(t.check,function(){return true}),o=ns(t.disableDetection,false),s=ns(t.priority,0),u=null,l=null;r=ns(r,function(){});var f=function(t){if(a(t)&&(!e._current||s>=e._priority)){e._priority=s;if(e._current!==u){if(e._current){e._current.stop()}e._current=u;e._started=false;e._scheduled=null;e._startFunc=function(){if(o){l=e._captor.setDetectionEnabled(false)}r(t)};Wg(e)}return true}return false};var h=function(t){if(e._current===u){if(e._started){if(o){e._captor.setDetectionEnabled(l)}n(t)}if(e._timeout){e._dom.clearTimeout(e._timeout)}e._timeout=null;e._current=null;e._priority=0;e._started=false;e._scheduled=null}};var v=function(t){if(e._current===u&&e._started){i(t)}};u=function(t){if(f(t)){e._scheduled=h}};u.start=f;u.stop=h;u.progress=v;return u}function Wg(e){if(!e._timeout){e._timeout=e._dom.setTimeout(function(){if(e._startFunc){e._startFunc();e._startFunc=null;e._started=true}if(e._scheduled){e._scheduled()}e._scheduled=null;e._timeout=null},0)}}var Yg=function(){return{}},Hg=function(){return undefined},qg=function(){return false},Zg=function(){},$g=function(){},Kg=function(){};var Jg=function(e){function t(t,r,i){e.call(this);this._dependencies=r;this._dom=i;this.configure(t);this._complete=false}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.configure=function e(t){this._onStart=t.onStart||$g;this._onEnd=t.onEnd||Kg;this._update=t.update||Hg;this._onUpdate=t.onUpdate||Zg;this._createContext=t.context||Yg;this._isRunning=t.isRunning||qg};t.prototype.onStart=function e(){this.fire("start",{target:this});this._onStart.call(this);return this};return t}(cn);var Qg=function(e){function t(t,r,i){var n=this;e.call(this,t,r,i);var a=[ep(t.imports),"","","var __CONTEXT = ("+this._createContext.toString()+")(),","    __UPDATE_FUNC = "+this._update.toString()+",","    __IS_RUNNING_FUNC = "+this._isRunning.toString()+";","",'self.addEventListener("message", function (evt) {',"  var result    = __UPDATE_FUNC(evt.data, __CONTEXT);","  var isRunning = __IS_RUNNING_FUNC(__CONTEXT, evt.data);","  self.postMessage({ result: result, isRunning: isRunning });","});"].join("\n");this._worker=Xi(a);this._sync=function(e){if(!n._dom.isDestroyed()){n.sync(e)}};this._worker.addEventListener("message",this._sync)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.sync=function e(t){var r=t.data.isRunning;var i=t.data.result;var n=this._onUpdate.call(this,i,this._dependencies,r);this.fire("update",{target:this,isRunning:r});if(r){this.send(n)}else{this.stop(i)}};t.prototype.stop=function e(t){if(!this._complete){this._onEnd.call(this,t,this._dependencies);this._worker.terminate();this.fire("stop",{target:this})}this._complete=true};t.prototype.send=function e(t){this._worker.postMessage(t);return this};return t}(Jg);function ep(e){if(!e||e.length===0){return""}var t=[];var r=Object.keys(e);for(var i=0,n=r.length;i<n;i++){var a=r[i];var o=e[a];if(typeof o!=="function"){throw new Error('Asynchronous task: dependency "'+a+'" is not found')}else{t.push("var "+a+" = "+o.toString()+";")}}return t.join("\n")}var tp=function(e){function t(t,r,i){e.call(this,t,r,i);this._context=this._createContext()}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.sync=function e(t){var r=this._update(t,this._context),i=this._isRunning(this._context,t);t=this._onUpdate.call(this,r,this._dependencies,i);this.fire("update",{target:this,isRunning:i});if(i){this.send(t)}else{this.stop(r)}};t.prototype.send=function e(t){var r=this;if(!this._complete){this._dom.setTimeout(function(){return r.sync(t)},0)}return this};t.prototype.stop=function e(t){if(!this._complete){this._onEnd(t,this._dependencies);this._complete=true}};return t}(Jg);Ogma.extend(function(e){return e.modules.tasks=new rp(e)});var rp=function e(t){this._ogma=t;this._dom=t.modules.dom};rp.prototype.run=function e(t,r,i,n){var a=ns(i,true),o=t.configure||function(e){return e};var s=ip(o,r,n);var u=a?Qg:tp;var l=new u(t,n,this._dom);l.onStart();l.send(s);return l};function ip(e,t,r){var i=e(t,r);if(i===undefined){i=t}return i}Ogma.extend(function(e){e.modules.generators=new np(e);e.generate={}});var np=function e(t){this._ogma=t;this._graph=t.modules.graph;this._tasks=t.modules.tasks;this._generators={}};np.prototype.register=function e(t,r){ss(this._generators,t,r,"generator")};np.prototype.load=function e(t,r){var i=us(this._generators,t,"generator"),n=i.configure(r);return Promise.resolve(i.generate(n))};function ap(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=10;var r=e.edges;if(r===void 0)r=10;var i=e.texts;if(i===void 0)i=false;return{nodes:t,edges:r,texts:i}}function op(e){var t=e.nodes;var r=e.edges;var i=e.texts;var n=[],a=[];for(var o=0;o<t;o++){n.push({id:o,attributes:{x:Math.random()*200,y:Math.random()*200,text:i?"Node "+o:undefined}})}for(var s=0;s<r;s++){a.push({id:s,source:Math.random()*t|0,target:Math.random()*t|0,attributes:{text:i?"Edge "+s:undefined}})}return{nodes:n,edges:a}}Ogma.extend(function(e){e.modules.generators.register("random",{configure:ap,generate:op});e.generate.random=function(t){return e.modules.generators.load("random",t)}});function sp(e){if(e===void 0)e={};var t=e.rows;if(t===void 0)t=4;var r=e.columns;if(r===void 0)r=4;return{rows:t,columns:r}}function up(e){var t=e.rows;var r=e.columns;var i={nodes:[],edges:[]},n=20,a=20,o=0;for(var s=0;s<t;++s){for(var u=0;u<r;++u){var l=s*r+u;i.nodes.push({id:l,attributes:{x:u*n,y:s*a}});if(u!==r-1){i.edges.push({id:o,source:l,target:s*r+u+1});o+=1}if(s!==t-1){i.edges.push({id:o,source:l,target:(s+1)*r+u});o+=1}}}return i}Ogma.extend(function(e){e.modules.generators.register("grid",{configure:sp,generate:up});e.generate.grid=function(t){return e.modules.generators.load("grid",t)}});function lp(e){if(e===void 0)e={};var t=e.length;if(t===void 0)t=5;return{length:t}}function fp(e){var t=e.length;var r={nodes:[],edges:[]};if(t<=0){return r}r.nodes.push({id:0,attributes:{x:Math.random()*100,y:Math.random()*100}});for(var i=1;i<t;++i){r.nodes.push({id:i,attributes:{x:Math.random()*100,y:Math.random()*100}});r.edges.push({id:i-1,source:i-1,target:i})}return r}Ogma.extend(function(e){e.modules.generators.register("path",{configure:lp,generate:fp});e.generate.path=function(t){return e.modules.generators.load("path",t)}});function hp(e){if(e===void 0)e={};var t=e.children;if(t===void 0)t=2;var r=e.height;if(r===void 0)r=3;if(!Si(t)){throw new TypeError('Invalid argument: "children" is not a positive number, was '+t)}if(!Ei(r)){throw new TypeError('Invalid argument: "height" is not a positive number, was '+r)}return{children:t,height:r}}function vp(e){var t=e.children;var r=e.height;r+=1;var i=Math.pow(t,r),n=[],a=[],o=1,s=0,u=0;for(var l=0;l<r;++l){var f=i/(o+1)/1.5;for(var h=0;h<o;++h){var v=s++;n.push({id:v,attributes:{x:(h+1)*f*10,y:l*20}});if(l!==r-1){for(var d=0;d<t;++d){a.push({id:u,source:v,target:v*t+d+1});u+=1}}}o*=t}return{nodes:n,edges:a}}Ogma.extend(function(e){e.modules.generators.register("balancedTree",{configure:hp,generate:vp});e.generate.balancedTree=function(t){return e.modules.generators.load("balancedTree",t)}});function dp(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=20;var r=e.edges;var i=e.p;if(!wi(t)||t<3){throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t)}if(r!==undefined&&i!==undefined){throw new TypeError("Invalid argument: choose between options.edges and options.p")}if(r===undefined&&i===undefined){i=.1}return{nodes:t,edges:r,p:i}}function cp(e){var t={nodes:[],edges:[]},r,i,n,a=0,o=e.nodes,s=e.p;if(e.p>=0){for(i=0;i<o;i++){t.nodes.push({id:i,attributes:{x:Math.random()*100,y:Math.random()*100}});for(n=0;n<i;n++){if(Math.random()<s){t.edges.push({id:a++,source:i,target:n})}}}}else{var u=[],l=e.edges;for(i=0;i<o;i++){t.nodes.push({id:i,x:Math.random()*100,y:Math.random()*100,size:1});for(n=i+1;n<o;n++){u.push({source:i,target:n})}}a=u.length-1;for(i=0;i<l;i++){r=u.splice(Math.floor(Math.random()*a),1)[0];r.id=i;t.edges.push(r);a--}}return t}Ogma.extend(function(e){e.modules.generators.register("erdosRenyi",{configure:dp,generate:cp});e.generate.erdosRenyi=function(t){return e.modules.generators.load("erdosRenyi",t)}});function _p(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=40;var r=e.m0;if(r===void 0)r=5;var i=e.m;if(i===void 0)i=1;var n=e.scale;if(n===void 0)n=100;if(!wi(t)||t<3){throw new TypeError("Invalid argument: options.nodes is not a number >= 3, was "+t)}if(!wi(r)||r>=t){throw new TypeError("Invalid argument: options.m0 is not a number < "+t+", was "+r)}if(!wi(r)||i>=r){throw new TypeError("Invalid argument: options.m is not a number <= "+r+", was "+i)}if(!wi(n)||n<0){throw new TypeError("Invalid argument: options.scale is not a number or is less than 0")}return{nodes:t,m0:r,m:i,scale:n}}function gp(e){var t={nodes:[],edges:[]},r={},i=[],n,a,o,s,u,l,f,h,v=e.scale,d=0,c=e.nodes,_=e.m0,g=e.m;var p=v/10;for(n=0;n<_;n++){t.nodes.push({id:n,attributes:{x:Math.random()*p,y:Math.random()*p}});i[n]=0}for(n=0;n<_;n++){for(a=n+1;a<_;a++){o={id:d++,source:n,target:a};r[o.source+"-"+o.target]=o;t.edges.push(o);i[n]++;i[a]++}}for(n=_;n<c;n++){t.nodes.push({id:n,attributes:{x:Math.random()*v,y:Math.random()*v}});i[n]=0;s=0;for(a=0;a<n;a++){s+=i[a]}u=0;for(l=0;l<g;l++){f=Math.random();h=0;for(a=0;a<n;a++){if(r[n+"-"+a]||r[a+"-"+n]){continue}if(n==1){h=1}else{h+=i[a]/s+u/(n-l)}if(f<=h){u+=i[a]/s;o={id:d++,source:n,target:a};r[o.source+"-"+o.target]=o;t.edges.push(o);i[n]++;i[a]++;break}}}}return t}Ogma.extend(function(e){e.modules.generators.register("barabasiAlbert",{configure:_p,generate:gp});e.generate.barabasiAlbert=function(t){return e.modules.generators.load("barabasiAlbert",t)}});function pp(e){if(e===void 0)e={};var t=e.nodes;if(t===void 0)t=50;var r=e.width;if(r===void 0)r=100;var i=e.height;if(i===void 0)i=100;var n=e.x;if(n===void 0)n=0;var a=e.y;if(a===void 0)a=0;if(!isFinite(t)||t<1){throw new RangeError("Tree generator: number of nodes must be a positive integer")}return{nodes:t,width:r,height:i,x:n,y:a}}function yp(e){var t=e.nodes;var r=e.x;var i=e.y;var n=e.width;var a=e.height;var o=r-n/2;var s=i-a/2;return{nodes:new Array(t).fill(0).map(function(e,t){return{id:t,attributes:{x:o+Math.random()*n,y:s+Math.random()*a}}}),edges:new Array(t-1).fill(0).map(function(e,t){return{id:t,source:Math.floor(Math.sqrt(t)),target:t+1}})}}Ogma.extend(function(e){e.modules.generators.register("randomTree",{configure:pp,generate:yp});e.generate.randomTree=function(t){return e.modules.generators.load("randomTree",t)}});var mp=5;var xp=10;var bp=10;var Ap=2.7;var wp=1/5;function Ep(e){var t=e.depth;if(t===void 0)t=3;var r=e.breadth;if(r===void 0)r=3;var i=e.nbNodes;if(i!==undefined){r=5;t=Math.ceil(Math.log(i)/Math.log(5))}return{depth:t,breadth:r,nbNodes:i}}function Sp(e){var t=e.depth;var r=e.breadth;var i=e.nbNodes;var n={id:0,attributes:{x:0,y:0,radius:Tp(t+1)}};var a={nodes:[n],edges:[]};Mp(a,r,t,n,1);if(i!==undefined){a.nodes=a.nodes.slice(0,i);a.edges=a.edges.slice(0,Math.max(i-1,0))}return a}function Cp(e){return Math.pow(Ap,e)*xp}function Tp(e){return mp+Cp(e)/bp}function Mp(e,t,r,i,n){if(r===0){return n}var distance=Cp(r);var a=Tp(r);var o=a*wp;var s=-Math.PI;var u=Math.PI*2/t;var l=i.attributes.x;var f=i.attributes.y;for(var h=0;h<t;++h){var v=Math.cos(s);var d=Math.sin(s);var c={id:n,attributes:{x:l+distance*v,y:f+distance*d,radius:a}};var _={id:n,source:i.id,target:n,attributes:{width:o}};e.nodes.push(c);e.edges.push(_);n=Mp(e,t,r-1,c,n+1);s+=u}return n}Ogma.extend(function(e){e.modules.generators.register("flower",{configure:Ep,generate:Sp});e.generate.flower=function(t){return e.modules.generators.load("flower",t)}});var kp=40;var Ip="layoutStart";var Np="layoutEnd";var Lp="layoutComputed";var zp="complete";var Dp={defaultSyncDuration:500,skipTextDrawing:true,useWebWorker:true,locate:false};Ogma.extend(function(e){var t=new Pp(e);e.modules.layouts=t;e.layouts={stop:function(){return t.stop()}};e.events.onLayoutStart=function(t){e.modules.events.on(Ip,t);return e.events};e.events.onLayoutComplete=function(t){e.modules.events.on(Np,t);return e.events};e.events.onLayoutComputed=function(t){e.modules.events.on(Lp,t);return e.events}});var Pp=function e(t){var r=this;this._modules=t.modules;this._dom=t.modules.dom;this._events=t.modules.events;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._tasks=t.modules.tasks;this._settings=t.modules.settings;this._locate=t.modules.locate;this._camera=t.modules.camera;this._layouts={};Object.keys(Dp).forEach(function(e){r._settings.register("layouts."+e,Dp[e])});this._events.register([Ip,Np,Lp]);this._currentLayout=null;this._events.on("clear",function(){return r.stop()})};Pp.prototype.register=function e(t,r){ss(this._layouts,t,r,"layout")};Pp.prototype.getAvailableLayouts=function e(){return Object.keys(this._layouts)};Pp.prototype.start=function e(t,r){var i=this;if(r===void 0)r={};var n=this._layouts[t];var a=this._settings;var o=this;return new Promise(function(e){if(!n){throw new Error("layout "+t+" does not exist")}if(i._currentLayout){i.stop()}var s=typeof r.duration==="number"?r.duration:a.get("layouts.defaultSyncDuration");var u=n.onSync;var l=r.onSync;var f=r.onEnd;var h=r.onUpdate;var v=r.dryRun;var d=-Infinity;var c=ns(r.skipTextDrawing,a.get("layouts.skipTextDrawing"));var _=r.locate||a.get("layouts.locate");r.name=t;r.skipTextDrawing=c;if(_&&typeof _==="boolean"){_={}}var g={update:n.update,isRunning:n.isRunning,configure:n.configure,context:n.context,imports:n.imports,onStart:function(){if(c){o._graphics.hideTexts()}o.onStart(n,r,this)},onUpdate:function(e,r,i){var n=this;var a=R();if(i&&a-d<kp){return}d=a;if(l){o._dom.setTimeout(function(){return l(e,r,i)},s)}if(u){var f=u(e,r,i);o._events.fire(Lp,{type:Lp,name:t,positions:f});if(h){h(e,f,i)}var c=o._assignNodePositions(f,s,v);if(!i){if(_){o._animateCamera(f,_,s)}c.then(function(){return n.fire(zp,f)})}}else if(!i){this.fire(zp,e)}},onEnd:function(t,i){this.once(zp,function(a){o.onComplete(t,n,r,i,e,f,a)})}};delete r.onSync;delete r.onEnd;i._graphics.forceAttributesComputation();i._currentLayout=i._tasks.run(g,r,ns(r.useWebWorker,i._settings.get("layouts.useWebWorker")),i._modules)})};Pp.prototype._animateCamera=function e(t,r,i){var n=C_(t,this._graph);var a=this._locate.computeConfigForBounds(n,r);return this._camera.setView(a,{duration:i,easing:r.easing})};Pp.prototype.onComplete=function e(t,r,i,n,a,o,s){var u=this;this._graphics.refreshAll();this._currentLayout=null;if(r.onEnd){r.onEnd(t,n,null,false)}if(i.skipTextDrawing){this._dom.setTimeout(function(){return u._graphics.showTexts()},50)}var l=i.nodeData.indexes;var f=s?Bp(s,l,this._graph):Fp(l,this._graph);var h=i.nodeData;this._events.fire(Np,{type:Np,name:i.name,positions:{current:f.positions,before:h.positions},ids:f.ids});this._dom.setTimeout(function(){if(o){o(t)}a({name:i.name,positions:{current:f.positions,before:h.positions},ids:f.ids})},0)};Pp.prototype.onStart=function e(t,r,i){var n=this._graph;var a=n.nodeIndexList(r.nodes);var o=Fp(a,n,this._graphics);r.nodeData=o;a=o.ids;this._events.fire(Ip,{type:Ip,name:r.name,ids:a,task:i})};Pp.prototype.stop=function e(){if(this._currentLayout){this._currentLayout.stop();this._currentLayout.fire(zp);this._currentLayout=null}return this};Pp.prototype.isRunning=function e(){return!!this._currentLayout};Pp.prototype._assignNodePositions=function e(t,r,i){if(!t||i){return Promise.resolve()}var n=t.indexes;var a=t.x;var o=t.y;var s=this._graph._getElements(true,n),u=new Array(n.length);for(var l=0;l<u.length;++l){u[l]={x:a[l],y:o[l]}}return s.setAttributes(u,r)};function Fp(e,t){var r=e.length;var i=t._getIds(true,e);var n=t._getElements(true,e).getPosition();return{positions:n,indexes:e,ids:i,size:r}}function Bp(e,t,r){var i=e.indexes;var n=e.x;var a=e.y;var o=i.length;var s={};for(var u=0;u<i.length;u++){s[i[u]]=u}var l=[];for(var f=0;f<t.length;f++){var h=s[t[f]];l.push({x:n[h],y:a[h]})}return{positions:l,indexes:t,ids:r._getIds(true,t),size:o}}var Rp={configure:function(e,t){var r=t.graph;var i=t.camera;var n=t.graphics;if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&e.nodes instanceof r.NodeList){e.nodes=e.nodes.getId()}var a=r.nodeIndexList(e.nodes);var o,s={},u={};var l=a.length,f,h;var v=r._nodes,d=r._edges;if(e.nodes){e=ne(e);delete e.nodes}var c=n._getAttributeArray(true,"innerStroke.width");var _=n._getAttributeArray(true,"outerStroke.width");var g=r._degrees(a);var p=r.getNodeAttributesArrays(["x","y","radius"],{ids:a,destArrays:[new Float32Array(l),new Float32Array(l),new Array(l)]});var y=p[0];var m=p[1];var x=p[2];c=c.getMultiple(a);_=_.getMultiple(a);var b=new r.NodeList(a).getAttribute("layoutable");var A=typeof e.nodeMass==="function"?e.nodeMass:function(e,t,r){return t+1};delete e.nodeMass;var w=typeof e.edgeWeight==="function"?e.edgeWeight:function(e){return 1};delete e.edgeWeight;if(!isFinite(e.scalingRatio)){delete e.scalingRatio}var E=a.reduce(function(e,t,r){if(!b[r]){e[t]=true}return e},{});var S=0,C=0,T=0;var M=i.getZoom();for(h=0;h<a.length;++h){var k=a[h];var I=y[h],N=m[h];var L=x[h]+(c[h]+_[h])/M;s[k]={id:k,x:I,y:N,degree:g[h],size:L,pinned:!!E[k],mass:A(v.get(k),g[h],h)};T=Math.max(L,T)}if(l>1){for(h=0;h<l;h++){var z=s[a[h]];S+=z.x;C+=z.y}}S/=l;C/=l;var D={x:S,y:C};o=r._getAdjacentElements(false,a);f=o.length;var P=r._getSources(o);var F=r._getTargets(o);for(h=0;h<f;h++){var B=o[h];var R=P[h];var O=F[h];if(s[R]&&s[O]){u[B]={source:R,target:O};u[B].weight=w(d.get(B))}}return{nodes:s,edges:u,maxSize:T,config:Se(e),barycentre:D}},context:function(){return{}},update:function(e,t){var r;if(!t.W){r={ppn:10,ppe:3,ppr:9,MAX_SUBDIVISION_RETRIES:3,maxForce:10,iterations:0,converged:false,settings:{linLogMode:false,outboundAttractionDistribution:false,adjustSizes:false,edgeWeightInfluence:0,scalingRatio:100,strongGravityMode:true,gravity:1,slowDown:1,barnesHutOptimize:false,barnesHutTheta:.5,startingIterations:10,iterationsPerRender:10,maxIterations:1e3,avgDistanceThreshold:.01,autoStop:true,alignNodeSiblings:true,nodeSiblingsScale:5,nodeSiblingsAngleMin:0}};t.W=r;c(e,e.config);r.settings=o(e.config,r.settings);t.nodes=e.nodes;t.edges=e.edges;t.barycentre=e.barycentre}else{r=t.W}var i=t.NodeMatrix,n=t.EdgeMatrix,a;function o(){var e=arguments;var t,r,i={},n=arguments.length;for(t=n-1;t>=0;t--){for(r in arguments[t]){i[r]=e[t][r]}}return i}function s(e,t,r,i){var n=r-e,a=i-t;return Math.sqrt(n*n+a*a)}function u(value,e,t,r,i){return(i-r)*(value-e)/(t-e)+r}function l(e){return Math.acos(e.x/Math.sqrt(e.x*e.x+e.y*e.y))}function f(e,t,r,i){return{xi:-(i-t),yi:r-e,xiPrime:i-t,yiPrime:-(r-e)}}function h(e,t){return{x:(e.xiPrime-e.xi)/t,y:(e.yiPrime-e.yi)/t}}function v(e,t,r,i,n){return{x:e+(r-e)*n,y:t+(i-t)*n}}function d(e,t){var i=e.nodes,n=e.edges,a=e.maxSize,o=Object.keys(e.nodes),s=Object.keys(e.edges),u=o.length*r.ppn,l=s.length*r.ppe,f={},h,v,d;var c=Math.pow(10,Math.log(Math.max(a,1))-6);var _=c/2;var g=Math.random;var p=t.randomizeFactor||1;var y;if(t.randomize==="locally"){y=function(e){return e+g()*p}}else if(t.randomize==="globally"){y=function(e){return g()*p}}else{y=function(e){return e+g()*c-_}}var m=new Float32Array(u);var x=new Float32Array(l);for(h=v=0,d=o.length;h<d;h++){var b=o[h],A=i[b];var w=A.x;var E=A.y;if(!A.pinned){w=y(w);E=y(E)}f[b]=v;m[v]=w;m[v+1]=E;m[v+2]=0;m[v+3]=0;m[v+4]=0;m[v+5]=0;m[v+6]=A.mass;m[v+7]=1;m[v+8]=A.size;m[v+9]=A.pinned||0;v+=r.ppn}for(h=v=0,d=s.length;h<d;h++){b=s[h];var S=n[b];x[v]=f[S.source];x[v+1]=f[S.target];x[v+2]=S.weight||0;v+=r.ppe}return{nodes:m,edges:x}}function c(e,i){var n=d(e,i);t.NodeMatrix=n.nodes;t.EdgeMatrix=n.edges;r.nodesLength=t.NodeMatrix.length;r.edgesLength=t.EdgeMatrix.length}function _(){var e,t,o,d,c,_,g,p;var y,m,x,b,A,w,E,distance,S;for(o=0;o<r.nodesLength;o+=r.ppn){i[o+4]=i[o+2];i[o+5]=i[o+3];i[o+2]=0;i[o+3]=0}if(r.settings.outboundAttractionDistribution){y=0;for(o=0;o<r.nodesLength;o+=r.ppn){y+=i[o+6]}y/=r.nodesLength}if(r.settings.barnesHutOptimize){var C=Infinity,T=-Infinity,M=Infinity,k=-Infinity,I,N,L,z;a=[];for(o=0;o<r.nodesLength;o+=r.ppn){C=Math.min(C,i[o+0]);T=Math.max(T,i[o+0]);M=Math.min(M,i[o+1]);k=Math.max(k,i[o+1])}var D=T-C,P=k-M;if(D>P){M-=(D-P)/2;k=M+D}else{C-=(P-D)/2;T=C+P}a[0+0]=-1;a[0+1]=(C+T)/2;a[0+2]=(M+k)/2;a[0+3]=Math.max(T-C,k-M);a[0+4]=-1;a[0+5]=-1;a[0+6]=0;a[0+7]=0;a[0+8]=0;e=1;for(o=0;o<r.nodesLength;o+=r.ppn){t=0;L=r.MAX_SUBDIVISION_RETRIES;while(true){if(a[t+5]>=0){if(i[o+0]<a[t+1]){if(i[o+1]<a[t+2]){I=a[t+5]}else{I=a[t+5]+r.ppr}}else{if(i[o+1]<a[t+2]){I=a[t+5]+r.ppr*2}else{I=a[t+5]+r.ppr*3}}a[t+7]=(a[t+7]*a[t+6]+i[o+0]*i[o+6])/(a[t+6]+i[o+6]);a[t+8]=(a[t+8]*a[t+6]+i[o+1]*i[o+6])/(a[t+6]+i[o+6]);a[t+6]+=i[o+6];t=I;continue}else{if(a[t+0]<0){a[t+0]=o;break}else{a[t+5]=e*r.ppr;g=a[t+3]/2;p=a[t+5];a[p+0]=-1;a[p+1]=a[t+1]-g;a[p+2]=a[t+2]-g;a[p+3]=g;a[p+4]=p+r.ppr;a[p+5]=-1;a[p+6]=0;a[p+7]=0;a[p+8]=0;p+=r.ppr;a[p+0]=-1;a[p+1]=a[t+1]-g;a[p+2]=a[t+2]+g;a[p+3]=g;a[p+4]=p+r.ppr;a[p+5]=-1;a[p+6]=0;a[p+7]=0;a[p+8]=0;p+=r.ppr;a[p+0]=-1;a[p+1]=a[t+1]+g;a[p+2]=a[t+2]-g;a[p+3]=g;a[p+4]=p+r.ppr;a[p+5]=-1;a[p+6]=0;a[p+7]=0;a[p+8]=0;p+=r.ppr;a[p+0]=-1;a[p+1]=a[t+1]+g;a[p+2]=a[t+2]+g;a[p+3]=g;a[p+4]=a[t+4];a[p+5]=-1;a[p+6]=0;a[p+7]=0;a[p+8]=0;e+=4;z=t+0;if(i[a[z]+0]<a[t+1]){if(i[a[z]+1]<a[t+2]){I=a[t+5]}else{I=a[t+5]+r.ppr}}else{if(i[a[z]+1]<a[t+2]){I=a[t+5]+r.ppr*2}else{I=a[t+5]+r.ppr*3}}a[t+6]=i[a[z]+6];a[t+7]=i[a[z]+0];a[t+8]=i[a[z]+1];a[I+0]=a[t+0];a[t+0]=-1;if(i[o+0]<a[t+1]){if(i[o+1]<a[t+2]){N=a[t+5]}else{N=a[t+5]+r.ppr}}else{if(i[o+1]<a[t+2]){N=a[t+5]+r.ppr*2}else{N=a[t+5]+r.ppr*3}}if(I===N){if(L--){t=I;continue}else{L=r.MAX_SUBDIVISION_RETRIES;break}}a[N+0]=o;break}}}}}if(r.settings.barnesHutOptimize){m=r.settings.scalingRatio;for(o=0;o<r.nodesLength;o+=r.ppn){t=0;while(true){if(a[t+5]>=0){distance=Math.sqrt((i[o+0]-a[t+7])*(i[o+0]-a[t+7])+(i[o+1]-a[t+8])*(i[o+1]-a[t+8]));if(2*a[t+3]/distance<r.settings.barnesHutTheta){x=i[o+0]-a[t+7];b=i[o+1]-a[t+8];if(r.settings.adjustSizes){if(distance>0){S=m*i[o+6]*a[t+6]/distance/distance;i[o+2]+=x*S;i[o+3]+=b*S}else if(distance<0){S=-m*i[o+6]*a[t+6]/distance;i[o+2]+=x*S;i[o+3]+=b*S}}else{if(distance>0){S=m*i[o+6]*a[t+6]/distance/distance;i[o+2]+=x*S;i[o+3]+=b*S}}if(a[t+4]<0){break}t=a[t+4];continue}else{t=a[t+5];continue}}else{if(a[t+0]>=0&&a[t+0]!==o){x=i[o+0]-i[a[t+0]+0];b=i[o+1]-i[a[t+0]+1];distance=Math.sqrt(x*x+b*b);if(r.settings.adjustSizes){if(distance>0){S=m*i[o+6]*i[a[t+0]+6]/distance/distance;i[o+2]+=x*S;i[o+3]+=b*S}else if(distance<0){S=-m*i[o+6]*i[a[t+0]+6]/distance;i[o+2]+=x*S;i[o+3]+=b*S}}else{if(distance>0){S=m*i[o+6]*i[a[t+0]+6]/distance/distance;i[o+2]+=x*S;i[o+3]+=b*S}}}if(a[t+4]<0){break}t=a[t+4];continue}}}}else{m=r.settings.scalingRatio;for(d=0;d<r.nodesLength;d+=r.ppn){for(c=0;c<d;c+=r.ppn){x=i[d+0]-i[c+0];b=i[d+1]-i[c+1];if(r.settings.adjustSizes){distance=Math.sqrt(x*x+b*b)-i[d+8]-i[c+8];if(distance>0){S=m*i[d+6]*i[c+6]/distance/distance;i[d+2]+=x*S;i[d+3]+=b*S;i[c+2]+=x*S;i[c+3]+=b*S}else if(distance<0){S=100*m*i[d+6]*i[c+6];i[d+2]+=x*S;i[d+3]+=b*S;i[c+2]-=x*S;i[c+3]-=b*S}}else{distance=Math.sqrt(x*x+b*b);if(distance>0){S=m*i[d+6]*i[c+6]/distance/distance;i[d+2]+=x*S;i[d+3]+=b*S;i[c+2]-=x*S;i[c+3]-=b*S}}}}}p=r.settings.gravity/r.settings.scalingRatio;m=r.settings.scalingRatio;for(o=0;o<r.nodesLength;o+=r.ppn){S=0;x=i[o+0];b=i[o+1];distance=Math.sqrt(x*x+b*b);if(r.settings.strongGravityMode){if(distance>0){S=m*i[o+6]*p}}else{if(distance>0){S=m*i[o+6]*p/distance}}i[o+2]-=x*S;i[o+3]-=b*S}m=1*(r.settings.outboundAttractionDistribution?y:1);for(_=0;_<r.edgesLength;_+=r.ppe){d=n[_+0];c=n[_+1];g=n[_+2];E=Math.pow(g,r.settings.edgeWeightInfluence);x=i[d+0]-i[c+0];b=i[d+1]-i[c+1];if(r.settings.adjustSizes){distance=Math.sqrt(x*x+b*b)-i[d+8]-i[c+8];if(r.settings.linLogMode){if(r.settings.outboundAttractionDistribution){if(distance>0){S=-m*E*Math.log(1+distance)/distance/i[d+6]}}else{if(distance>0){S=-m*E*Math.log(1+distance)/distance}}}else{if(r.settings.outboundAttractionDistribution){if(distance>0){S=-m*E/i[d+6]}}else{if(distance>0){S=-m*E}}}}else{distance=Math.sqrt(x*x+b*b);if(r.settings.linLogMode){if(r.settings.outboundAttractionDistribution){if(distance>0){S=-m*E*Math.log(1+distance)/distance/i[d+6]}}else{if(distance>0){S=-m*E*Math.log(1+distance)/distance}}}else{if(r.settings.outboundAttractionDistribution){distance=1;S=-m*E/i[d+6]}else{distance=1;S=-m*E}}}if(distance>0){i[d+2]+=x*S;i[d+3]+=b*S;i[c+2]-=x*S;i[c+3]-=b*S}}var F,B,R,O,V=0;if(r.settings.adjustSizes){for(o=0;o<r.nodesLength;o+=r.ppn){if(!i[o+9]){F=Math.sqrt(i[o+2]*i[o+2]+i[o+3]*i[o+3]);if(F>r.maxForce){i[o+2]=i[o+2]*r.maxForce/F;i[o+3]=i[o+3]*r.maxForce/F}B=i[o+6]*Math.sqrt((i[o+4]-i[o+2])*(i[o+4]-i[o+2])+(i[o+5]-i[o+3])*(i[o+5]-i[o+3]));R=Math.sqrt((i[o+4]+i[o+2])*(i[o+4]+i[o+2])+(i[o+5]+i[o+3])*(i[o+5]+i[o+3]))/2;O=.1*Math.log(1+R)/(1+Math.sqrt(B));A=i[o+0];w=i[o+1];i[o+0]=i[o+0]+i[o+2]*(O/r.settings.slowDown);i[o+1]=i[o+1]+i[o+3]*(O/r.settings.slowDown);x=i[o+0];b=i[o+1];distance=Math.sqrt((x-A)*(x-A)+(b-w)*(b-w));V+=distance}}}else{for(o=0;o<r.nodesLength;o+=r.ppn){if(!i[o+9]){B=i[o+6]*Math.sqrt((i[o+4]-i[o+2])*(i[o+4]-i[o+2])+(i[o+5]-i[o+3])*(i[o+5]-i[o+3]));R=Math.sqrt((i[o+4]+i[o+2])*(i[o+4]+i[o+2])+(i[o+5]+i[o+3])*(i[o+5]+i[o+3]))/2;O=i[o+7]*Math.log(1+R)/(1+Math.sqrt(B));i[o+7]=Math.min(1,Math.sqrt(O*(i[o+2]*i[o+2]+i[o+3]*i[o+3])/(1+Math.sqrt(B))));A=i[o+0];w=i[o+1];i[o+0]=i[o+0]+i[o+2]*(O/r.settings.slowDown);i[o+1]=i[o+1]+i[o+3]*(O/r.settings.slowDown);x=i[o+0];b=i[o+1];distance=Math.sqrt((x-A)*(x-A)+(b-w)*(b-w));V+=distance}}}r.iterations++;if(r.settings.autoStop){r.converged=r.iterations>r.settings.maxIterations||V/r.nodesLength<r.settings.avgDistanceThreshold;if(r.converged&&r.settings.alignNodeSiblings){var j={},U={},G,X;for(_=0;_<r.edgesLength;_+=r.ppe){d=n[_+0];c=n[_+1];if(d===c){continue}j[d]=j[d]||{};j[c]=j[c]||{};j[d][c]=true;j[c][d]=true}Object.keys(j).forEach(function(e){e=~~e;X=Object.keys(j[e]);if(X.length==2){G=X[0]+";"+X[1];if(G in U){U[G].push(e)}else{G=X[1]+";"+X[0];if(!U[G]){U[G]=[~~X[1],~~X[0]]}U[G].push(e)}}});var W,Y,H,q,Z,$,K,J,Q,ee,te,re,ie,ne,ae,oe=r.settings.nodeSiblingsAngleMin;Object.keys(U).forEach(function(e){Y=U[e].shift();H=U[e].shift();W=U[e].filter(function(e){return!i[e+9]});if(W.length==1){return}$=i[Y+0];K=i[Y+1];J=i[H+0];Q=i[H+1];q=Object.keys(j[Y]).length;Z=Object.keys(j[H]).length;ee=u(q/(q+Z),0,1,1/4,3/4);re=v($,K,J,Q,ee);ie=f($,K,J,Q);te=s($,K,J,Q);ne=h(ie,te);ae=l(ne);if(2*oe>Math.PI){throw new Error("ForceLink.Worker - Invalid parameter: angleMin must be smaller than 2 PI.")}if(oe>0){if(ae<oe||ae>Math.PI-oe&&ae<=Math.PI){ne={x:Math.cos(Math.PI-oe)*2,y:Math.sin(Math.PI-oe)*2}}else if(ae>2*Math.PI-oe||ae>=Math.PI&&ae<Math.PI+oe){ne={x:Math.cos(oe)*2,y:Math.sin(oe)*2}}}var t=0,n=1,a=1;if(W.length%2==1){a=0;t=1}for(var o=0;o<W.length;o++){i[W[o]+0]=re.x+n*ne.x*a*(t||o>=2?r.settings.nodeSiblingsScale:r.settings.nodeSiblingsScale*2/3);i[W[o]+1]=re.y+n*ne.y*a*(t||o>=2?r.settings.nodeSiblingsScale:r.settings.nodeSiblingsScale*2/3);n=-n;a+=(o+t)%2}})}}}function g(){if(r.settings.autoStop){while(!r.converged){_()}}else{var e=r.iterations===0?r.settings.startingIterations:r.iterations+r.settings.iterationsPerRender;while(r.iterations!==e){_()}}return{nodes:p(t.nodes),barycentre:t.barycentre}}function p(e){var t=Object.keys(e);var n={};for(var a=0;a<i.length;a+=r.ppn){var o=t[a/r.ppn];n[o]={id:o,x:i[a+0],y:i[a+1],pinned:i[a+9]}}return n}return g()},isRunning:function(e){return!e.W.settings.autoStop},onSync:function(e,t){var r=e.nodes;var i=e.barycentre;var n=t.graph;var a=Object.keys(r);var o=a.length;var s=0,u=0;var l,f,h,v,d,c,_,g;var p=new Array(o);var y=new Array(o);var m=new Array(o);var x=new Array(o);var b=n.getAttributes(true,["x","y"]);var A=b[0];var w=b[1];for(l=0;l<o;l++){f=a[l];h=r[f];g=parseInt(f);p[l]=g;x[l]=h.pinned;if(h.pinned){v=A.get(g);d=w.get(g)}else{v=h.x;d=h.y}y[l]=v;m[l]=d;s+=v;u+=d}c=s/o-i.x;_=u/o-i.y;for(l=0;l<o;l++){if(!x[l]){y[l]-=c;m[l]-=_}}return{indexes:p,x:y,y:m}}};Ogma.extend(function(e){e.layouts.forceLink=function(t){if(t===void 0)t={};return e.modules.layouts.start("forceLink",t)};e.modules.layouts.register("forceLink",Rp)});var Op={configure:function(e,t){var r=t.graph;var i=e.sortBy;var n=e.rows;var a=e.cols;if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&!(e.nodes instanceof r.NodeList)){e.nodes=r.getNodes(e.nodes)}function o(e){return e===undefined||typeof e==="number"&&isFinite(e)&&e>0}if(!o(n)){throw new TypeError('"rows" should be a positive integer')}if(!o(a)){throw new TypeError('"cols" should be a positive integer')}var s=e.nodes;var u=e.nodes._indexes;var l=u.length;if(n){a=Math.ceil(l/n)}else if(a){n=Math.ceil(l/a)}else{a=Math.ceil(Math.sqrt(l));n=Math.ceil(l/a)}var f,h;var v;var d=e.sortFallbackValue;if(typeof i==="string"){if(i==="radius"){v=r.getAttribute(true,"radius").getMultiple(u)}else if(i==="random"){v=new Array(l);for(f=0;f<l;f++){v[f]=Math.random()}}else{v=s.getData(i);if(d!==undefined){for(f=0;f<l;f++){if(v[f]===undefined){v[f]=d}}}}}else{v=new Array(l);for(f=0;f<l;f++){v[f]=f}}var c=[];var _=s.getAttribute("layoutable");for(f=0;f<l;++f){h=u[f];if(_[f]){c.push({id:h,attr:v[f]})}}var g=s.getBoundingBox(),p=g.maxSize*.65,y=g.minX+p,m=g.maxX-p,x=g.minY+p,b=g.maxY-p;if(g.width<p*a*2){y=g.cx-p*a+p;m=g.cx+p*a-p}if(g.height<p*n*2){x=g.cy-p*n+p;b=g.cy+p*n-p}return{sort:!!i,nodes:c,reverse:!!e.reverse,cols:a,rows:n,minX:y,maxX:m,minY:x,maxY:b}},update:function(e){if(e.sort){e.nodes.sort(function(e,t){var r=e.attr,i=t.attr;if(r<i){return-1}else if(r>i){return 1}else{return 0}})}if(e.reverse){e.nodes.reverse()}var t=(e.maxX-e.minX)/(e.cols-1),r=(e.maxY-e.minY)/(e.rows-1),i=0,n=0,a=e.minX,o=e.minY;if(!isFinite(t)){t=0}if(!isFinite(r)){r=0}for(var s=0;s<e.nodes.length;++s){var u=e.nodes[s];u.x=a+i*t;u.y=o+n*r;i+=1;if(i===e.cols){n+=1;i=0}}return e.nodes},onSync:function(e){var t=e.length;var r=new Uint32Array(t);var i=new Array(t);var n=new Array(t);for(var a=0;a<e.length;++a){var o=e[a];r[a]=o.id;i[a]=o.x;n[a]=o.y}return{indexes:r,x:i,y:n}}};Ogma.extend(function(e){e.layouts.grid=function(t){if(t===void 0)t={};return e.modules.layouts.start("grid",t)};e.modules.layouts.register("grid",Op)});var Vp={configure:function(e,t){var r=t.graph;var i=t.data;if(e.centralNode===undefined){throw new Error('concentric layout: missing parameter "centralNode"')}else if(!(e.centralNode instanceof r.Node)){e.centralNode=r.getNode(e.centralNode)}if(!e.nodes){e.nodes=r.getNodes()}else if(!(e.nodes instanceof r.NodeList)){e.nodes=r.getNodes(e.nodes)}var n=r._getIndex(true,e.centralNode);var a=e.centralNode.getPosition();var o=a.x,s=a.y;var u=null,l,f;var h=r.nodeIndexList(e.nodes);var v=[];var d=h.length;var c=r.getNodeAttributesArrays(["radius"],{ids:h,destArrays:[new Array(d)]});var _=c[0];var g=e.nodes.getAttribute("layoutable");for(l=0;l<d;l++){f=h[l];if(f===n||g[l]){v.push(f)}}if(v.indexOf(n)===-1){v.push(n)}d=v.length;var p={},y=new Array(d);for(l=0;l<d;l++){p[v[l]]=y[l]=l}var m=new Array(d);for(l=0;l<d;l++){var x=r._getAdjacentElements(true,[v[l]]);for(var b=0,A=x.length;b<A;b++){x[b]=p[x[b]]}m[l]=x}if(e.sortBy){if(e.sortBy==="random"){u="random"}else if(e.sortBy==="radius"){u=_.slice()}else if(e.sortBy==="degree"){u=e.nodes.getDegree()}else{u=i.getProperty(e.nodes,e.sortBy)}}return{sourceNodeIndex:v.indexOf(n),centerX:e.centerX==="number"?e.centerX:o,centerY:e.centerY==="number"?e.centerY:s,list:v,indexes:y,size:d,totalSize:d,attributes:{adjacentNodes:m,size:_},sortAttr:u,clockwise:e.clockwise===undefined?true:e.clockwise,circleHopRatio:e.circleHopRatio||5,allowOverlap:!!e.allowOverlap}},context:function(){return{dijkstra:function(e,t,r,i,n){var a=Math.pow(2,31)-1,o=new Int32Array(i),s=new Int32Array(i),u=new Int8Array(i),l,f,h;for(h=0;h<i+1;++h){o[h]=a;s[h]=-1}for(h=0;h<i;++h){l=t[h];if(l!==undefined){o[l]=a;s[l]=-1}}o[n]=0;while(true){var v=a,d=-1;for(h=0;h<r;++h){l=t[h];f=o[l];if(!u[l]&&f<v){v=f;d=l;u[l]=true}}if(d===-1){break}var c=e[d],_=c.length,g=v+1;for(h=0;h<_;++h){l=c[h];f=o[l];if(g<f){o[l]=g;s[l]=d}}}return o},determinePropertyType:function(e,t,r){for(var i=0;i<r;++i){if(typeof e[t[i]]!=="number"){return"string"}}return"number"}}},update:function(e,t){var r=e.attributes.adjacentNodes,i=e.attributes.size,n=e.indexes,a=e.size,o=e.sourceNodeIndex,s=e.centerX,u=e.centerY,l=e.sortAttr,f=new Array(e.totalSize),h=new Array(e.totalSize);var v=t.dijkstra(r,n,e.size,e.totalSize,o),d=0,c={},_;for(_=0;_<a;++_){var g=i[n[_]];if(g>d){d=g}}var p=d*e.circleHopRatio,y=0,m=0,x=Math.PI/9;for(_=0;_<a;++_){var b=n[_],distance=v[b],A=c[distance];if(!A){A=[];c[distance]=A}A.push(b)}var w=null,E=true;if(l==="random"){w=function(){return Math.random()-.5}}else if(l){var S=t.determinePropertyType(l,n,g);w=S==="number"?function(e,t){return l[e]-l[t]}:function(e,t){return l[e]<l[t]?-1:1}}else{E=false}var C=Object.keys(c).sort(function(e,t){return parseInt(e)-parseInt(t)});for(_=0;_<C.length;++_){var T=c[C[_]],M=T.length,k=m,I=Math.PI*2/M;if(_!==0&&!e.allowOverlap){var N=Math.PI*2*y,L=0,z=0;for(D=0;D<M;++D){L+=i[T[D]]}z=L*2*Math.SQRT2;if(z>N){y+=z/(2*Math.PI)-y}}if(E){T.sort(w);if(!e.clockwise){T.reverse()}}for(var D=0;D<M;++D){b=T[D];f[b]=Math.cos(k)*y+s;h[b]=Math.sin(k)*y+u;g=i[b];var P=e.allowOverlap?1:g/L*M;k+=I*P}y+=p;m+=x}return{x:f,y:h,indexes:e.list}},isRunning:function(){return false},onSync:function(e){var t=e.indexes;var r=e.x;var i=e.y;return{indexes:t,x:r,y:i}}};Ogma.extend(function(e){e.layouts.concentric=function(t){if(t===void 0)t={};return e.modules.layouts.start("concentric",t)};e.modules.layouts.register("concentric",Vp)});var jp={defaultDirected:true,defaultMultigraph:true,defaultCompound:false,defaultRankDir:"TB",maxNbEdges:500,maxNbNodes:500};Ogma.extend(function(e){e.layouts.hierarchical=function(t){if(t===void 0)t={};t.useWebWorker=false;return e.modules.layouts.start("hierarchical",t)};e.modules.layouts.register("hierarchical",Up)});var Up={configure:function(e,t){if(e===void 0)e={};var r=t.graph;var i=P("dagre",{globalVarName:"dagre"});if(!i||!i.graphlib){throw new Error("to use the dagre plugin, please include lib/dagre.min.js")}if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&e.nodes instanceof r.NodeList){e.nodes=e.nodes.getId()}var n=os(e,jp);var a=r.getEdges();var o=r.getNodes(e.nodes);e.directed=ns(e.directed,n.defaultDirected);e.multigraph=ns(e.multigraph,n.defaultMultigraph);e.compound=ns(e.compound,n.defaultCompound);e.rankdir=ns(e.rankdir,n.defaultRankDir);if(e.nodeDistance!==undefined){e.nodesep=e.nodeDistance;delete e.nodeDistance}if(e.levelDistance!==undefined){e.ranksep=e.levelDistance;delete e.levelDistance}if(e.edgeDistance!==undefined){e.edgesep=e.edgeDistance;delete e.edgeDistance}if(["TB","BT","LR","RL"].indexOf(e.rankdir)===-1){throw new Error('defaultRankDir should be one of the "TB", "BT", "LR", "RL"')}var s=o.getId();var u=o.getAttribute("layoutable").reduce(function(e,value,t){e[s[t]]=value;return e},{});return{nodes:s,edges:a.map(function(e){return{id:e.getId(),source:e.getSource().getId(),target:e.getTarget().getId()}}),options:Se(e),layoutable:u}},context:function(){},update:function(e){var t=e.nodes;var r=e.edges;var i=e.options;var n=e.layoutable;var a=P("dagre",{globalVarName:"dagre"});var o=new a.graphlib.Graph({directed:i.directed,multigraph:i.multigraph,compound:i.compound});o.setGraph(i);t.forEach(function(e){if(n[e]){o.setNode(e,{})}});r.forEach(function(e){var t=e.source;var r=e.target;var i=e.id;if(o.node(t)&&o.node(r)){o.setEdge(t,r,{id:i})}});a.layout(o);var s=o.nodes();return{ids:s,positions:s.map(function(e){return o.node(e)})}},isRunning:function(){return false},onSync:function(e,t){var r=e.ids;var i=e.positions;var n=t.graph;var a=new Array(r.length);var o=new Array(r.length);var s=new Array(r.length);for(var u=0;u<r.length;++u){var l=i[u];var f=l.x;var h=l.y;a[u]=n._getIndex(true,r[u]);o[u]=f;s[u]=h}return{indexes:a,x:o,y:s}}};function Gp(e,t,r,i,n){return{x:e+n*(r-e),y:t+n*(i-t)}}function Xp(e,t,r){var i=Infinity;var n,a;for(var o=1,s=t.length;o<s;o+=2){var u=t[o-1],l=t[o%s];var f=(u[0]+l[0])/2,h=(u[1]+l[1])/2;var v=e[0]-f,d=e[1]-h;var c=v*v+d*d;if(c<i){i=c;n=u;a=l}}return Wp(n[0],n[1],a[0],a[1],r)}function Wp(e,t,r,i,n){var a=(e+r)/2,o=(t+i)/2;var s=e-r,u=t-i;var l=-u,f=s;var h=Math.sqrt(l*l+f*f);l/=h;f/=h;return[a-n*l,o-n*f]}function Yp(e,t){var r=t[0];var i=t[1];var n=t[2];var a=Math.abs;for(var o=0,s=e.length;o<s;o++){var u=e[o];var l=u[0];var f=u[1];var h=a(l-r),v=a(f-i);if(h+v<=n){return true}if(h>n||v>n){continue}if(h*h+v*v<=n*n){return true}}return false}function Hp(e,t,r){var i=Pn(r.cx,r.cy,e,t,r.minX,r.minY,r.maxX,r.maxY);var n=+Infinity,a,o;for(var s=0,u=i.length;s<u;s++){var l=i[s];a=distance(e,t,l.x,l.y);if(a<n){n=a;o=l}}return o}function qp(e,t,r){var i=t.nodes;var n=t.margin;if(n===void 0)n=5;var a=t.duration;if(a===void 0)a=0;var o=i.inverse();var s=o.getPosition().map(function(e){return[e.x,e.y]});var u=r;var l=i.getBoundingBox();var f=o.getBoundingBox();var h=minDisk(u.map(function(e){return e.x}),u.map(function(e){return e.y}),i.getAttribute("radius"));var v=h[0];var d=h[1];var c=h[2]+(l.maxSize+f.maxSize)+n;var _=0,g=0,p;if(Yp(s,[h[0],h[1],c])){if(o.size<=3){if(xn(v,d,h[2],f.minX,f.minY,f.maxX,f.maxY)){var y=Hp(v,d,f);p=distance(f.cx,f.cy,y.x,y.y);var m=Gp(f.cx,f.cy,y.x,y.y,(p+c)/p);_=m.x-v;g=m.y-d}}else{var x=new Mo(s.slice()).triangulate();var convexhull=No(s);var b=Lo(o,20,c,x,convexhull);if(b.length>0){var A=Infinity;for(var w=0,E=b.length;w<E;w++){var S=b[w];_=v-S[0];g=d-S[1];p=Math.sqrt(_*_+g*g);if(p<A){A=p;y=S}}_=y[0]-v;g=y[1]-d}else{y=Xp([v,d],convexhull,c);_=y[0]-l.cx;g=y[1]-l.cy}}}if(_||g){return i.setAttributes(u.map(function(e){e.x+=_;e.y+=g;return e}),a)}else{return Promise.resolve()}}function Zp(e,t){var r=ne(t);r.duration=0;r.dryRun=true;return e.layouts.forceLink(r).then(function(r){return qp(e,t,r.positions.current)})}function $p(e,t){var r=t.nodes;var i=t.duration;var n=t.centralNode;var a=r;var o=a.reduce(function(e,t){e[t._index]=true;return e},{});var s=e.getNodes();if(t.focusOnGroupShape){return e.layouts.forceLink({nodes:a,duration:0}).then(function(){var t=a.concat(n);var r=t.getAttribute("layoutable");t.setAttributes({layoutable:false});return e.layouts.forceLink({nodes:e.getNodes(),duration:i}).then(function(){return t.setAttributes(r)})})}else{var u=ne(t);delete u.centralNode;u.nodes=s;u.nodeMass=function(e,t){var r=o[e._index]?1:2;return(t+1)*r};return e.layouts.forceLink(u)}}Ogma.extend(function(e){e.layouts.incremental=function(t){if(t===void 0)t={};var r=t.nodes;var i=t.centralNode;if(!r){throw new Error("Incremental ForceLink layout: no nodes are selected")}if("margin"in t&&!isFinite(t.margin)){throw new Error("Incremental ForceLink layout: margin has to be a positive number")}if(i&&!i.getAttribute("layoutable")){return $p(e,t)}else{return Zp(e,t)}}});var Kp=function(e,t){return e-t};var Jp={imports:{minHeap:minHeap,bellmanFord:bellmanFord,dijkstra:dijkstra,johnson:johnson,distance:distance,circleCircleIntersection:circleCircleIntersection,circleSortCompare:circleSortCompare,weightedStress:weightedStress,distanceStress:distanceStress,constrainedStress:constrainedStress,stressMinimizationStep:stressMinimizationStep,removeRadialOverlap:removeRadialOverlap},configure:function(e,t){if(e===void 0)e={};var r=t.graph;var i=null,n,a,o,s=-1;var u=null;if(e.centralNode!==undefined&&e.centralNode!==null){i=r.getNode(e.centralNode,true);o=i.getPosition();n=isFinite(e.centerX)?parseFloat(e.centerX):o.x;a=isFinite(e.centerY)?parseFloat(e.centerY):o.y;s=i._index}else{throw new Error('concentric layout: missing parameter "centralNode"')}if(!e.nodes){e.nodes=r.getNodes()}if(e.nodes&&!(e.nodes instanceof r.NodeList)){e.nodes=r.getNodes(e.nodes)}if(!e.nodes.includes(i)){e.nodes=e.nodes.concat(i)}var l=r._getIndexes(true,e.nodes);var f=r._getElements(true,l);var h=f.getAttribute("layoutable");l=l.filter(function(e,t){return h[t]||e===s});l.sort(Kp);var v=l.length;var d=r.getConnectedComponents(f,{internalIndexes:true});var c=ty(l,d,s);d=c;var _=r._degrees(l);var g=r.getNodeAttributesArrays(["x","y","radius"],{ids:l,destArrays:[new Float32Array(v),new Float32Array(v),new Float32Array(v)]});var p=g[0];var y=g[1];var m=g[2];var x=r.getEdgeAttributesArrays(["source","target","width"]);var b=x[0];var A=x[1];var w=r.getAdjacencyList({internalIndexes:true,weight:1,nodes:e.nodes});var E=isFinite(e.radiusRatio)?parseFloat(e.radiusRatio):Math.SQRT2;var S=isFinite(e.radiusDelta)?parseFloat(e.radiusDelta):0;var C=isFinite(e.nodeGap)?parseInt(e.nodeGap):10;var T=v*(isFinite(e.repulsion)?parseFloat(e.repulsion):1);var M=isFinite(e.maxIterations)?parseInt(e.maxIterations):100;if(M<1){throw new RangeError("maxIterations must be a positive integer")}var k=isFinite(e.iterationsPerRender)?parseInt(e.iterationsPerRender):20;if(k<1){throw new RangeError("iterationsPerRender must be a positive integer")}var I=isFinite(e.epsilon)?parseFloat(e.epsilon):.001;if(I<=0){throw new RangeError("epsilon has to be a positive number")}return{centerIndex:s,centerX:n,centerY:a,list:l,components:c,X:p,Y:y,degree:_,size:v,currStress:Number.POSITIVE_INFINITY,epsilon:I,maxSteps:M,iterationsPerRender:k,attributes:{size:m,adjacency:w,weights:A.map(function(){return 1}),sources:b,targets:A},sortAttr:u,allowOverlap:!!e.allowOverlap,nodeGap:C,radiusRatio:E,radiusDelta:S,repulsion:T,randomize:"randomize"in e?!!e.randomize:true,renderSteps:!!e.renderSteps}},context:function(){return{getHighestNodeSize:function e(t,r){var i=0;for(var n=0,a=r.length;n<a;n++){var o=t[r[n]];if(o>i){i=o}}return i},grid:function e(t,r){if(r===void 0)r=8;var i=t.size;var n=new Float32Array(i);var a=new Float32Array(i);var o,s,u=this.getHighestNodeSize(t.attributes.size,t.list,i);var l=u*r;var f=Math.ceil(Math.sqrt(i));var h=Math.ceil(i/f);var v=-Math.floor((h-1)*l/2);var d=-Math.floor((f-1)*l/2);for(o=0;o<f;o++){for(s=0;s<h;s++){n[o*h+s]=v+s*l;a[o*h+s]=d+o*l}}return{x:n,y:a}},connectSubgraphs:function e(t,r,i,n,a,o){var s,u;function l(e,value){var t=new Uint32Array(e.length+1);t.set(e);t[e.length]=value;return t}var f=function(e){s=t[e];var f=0,h=0;s.forEach(function(e,t){if(a[e]>f){h=t;f=a[e]}});u=s[h];var v=r[o[u]];v.nodes=l(v.nodes,i);v.weights.push(n);v=r[i];v.nodes=l(v.nodes,u);v.weights.push(n)};for(var h=1;h<t.length;h++)f(h)},correctSubgraphsDistances:function e(t,r,i,n,a){var o=Array.prototype.reduce.call(t[i],function(e,t,r){if(r!==i&&t<n&&t>e){e=t}return e},0);var s=n-o-1;for(var u=1;u<r.length;u++){var l=r[u];for(var f=0,h=l.length;f<h;f++){var v=a[l[f]];t[i][v]-=s;t[v][i]-=s}}},establishRadii:function e(t,r,i,n,a,o,s,u){var l=Object.create(null);var f=a[r];var h=f,v=0;var d=f;for(var c in n){var _=n[c];var g=0;var p=0,y=void 0;for(var m=0,x=_.length;m<x;m++){y=a[_[m]];p=Math.max(p,y);g+=y*2+o}var b=g/(2*Math.PI)+p;var A=p+h;var w=u?v+Math.max(u,A):v*s;v=Math.max(v,b,d,w);l[c]=v;h=p}l[0]=0;l[Number.POSITIVE_INFINITY]=v;return l},initData:function e(t,r){t.step=0;t.data=r;t.totalSteps=r.totalSteps;t.currStress=Number.POSITIVE_INFINITY;t.prevStress=0;t.epsilon=t.data.epsilon;var i={},n={};t.normIndexes=r.list.reduce(function(e,a,o){e[o]=i[a]=o;n[a]=r.degree[o];if(a===r.centerIndex){t.centerIndexPos=o}return e},new Uint32Array(r.list.length));var a=t.centerIndexPos;var o=r.components[0].length;this.connectSubgraphs(r.components,r.attributes.adjacency,r.centerIndex,o,n,i);var s=johnson({sources:r.attributes.sources,targets:r.attributes.targets,weights:r.attributes.weights,indexes:r.list,adjacency:r.attributes.adjacency,undirected:true});this.correctSubgraphsDistances(s,r.components,a,o,i);t.D=s;t.rings=this.groupRings(s,a,t.normIndexes);t.radii=this.establishRadii(s,a,t.normIndexes,t.rings,r.attributes.size,r.nodeGap,r.radiusRatio,r.radiusDelta)},groupRings:function e(t,r,i){var n=t[r];var a=Object.create(null);for(var o=0,s=i.length;o<s;o++){if(o!==r){var u=n[o];a[u]=a[u]||[];a[u].push(i[o])}}return a},removeOverlaps:function e(t,r){var i=t.centerIndexPos;var n=r.attributes.size;var a=t.rings;var o=r.X[i];var s=r.Y[i];for(var u in a){var l=a[u];var f=distance(o,s,r.X[l[0]],r.Y[l[0]]);removeRadialOverlap({X:r.X,Y:r.Y,sizes:n,indexes:l,center:[o,s],R:f,gap:r.nodeGap,inPlace:true})}},easingQuadraticInOut:function(e){if((e*=2)<1){return.5*e*e}return-.5*(--e*(e-2)-1)}}},update:function(e,t){e=e||t.data;var r=e.list;var i=e.centerIndex;var n=e.X||new Float32Array(e.size);var a=e.Y||new Float32Array(e.size);var o=null;var s;if(t.step===undefined){t.initData(t,e)}else{t.step++}var u=e.repulsion;var l=function(e){return t.radii[e]||1};if(t.step===0){if(e.randomize){s=t.grid(e);e.X=s.x;e.Y=s.y}e.spent=0}else if(!t.converged){var f=e.maxSteps;var h=e.iterationsPerRender;var v=t.step;var d=Math.min(v+h,f+1);while(v<=d||!t.converged){var c=t.easingQuadraticInOut(Math.min(v,f)/f);t.step=v++;s=stressMinimizationStep(t.D,n,a,e.size,t.centerIndexPos,u,c,t.normIndexes,l);e.X=s.X;e.Y=s.Y;t.prevStress=t.currStress;t.currStress=constrainedStress(t.D,e.X,e.Y,e.size,t.centerIndexPos,u,c,t.normIndexes,r,i);t.converged=t.converged||Math.abs(t.currStress-t.prevStress)<=t.epsilon}}if(t.converged){if(t.overlapRemoved||t.data.allowOverlap){t.done=true;o=Object.keys(t.rings).reduce(function(e,i){e[i]=t.rings[i].map(function(e){return r[e]});return e},{})}else{t.removeOverlaps(t,e,i);t.overlapRemoved=true}}return{x:e.X,y:e.Y,indexes:e.list,components:t.overlapRemoved?e.components:undefined,rings:o,centerIndex:t.centerIndexPos,cx:e.centerX,cy:e.centerY,step:t.step,renderSteps:e.renderSteps,converged:t.converged,overlapRemoved:t.overlapRemoved,stress:t.currStress,done:t.done}},isRunning:function(e){if(!e.converged){return true}else{return e.data.allowOverlap?false:!e.done}},onSync:function(e,t){if(e.renderSteps||e.done){return Qp(e,t)}},onEnd:function(e,t){return Qp(e,t)}};function Qp(e){var t=e.x,r=e.y;var i=e.indexes.length;var n=t[e.centerIndex]-e.cx;var a=r[e.centerIndex]-e.cy;for(var o=0;o<i;o++){t[o]-=n;r[o]-=a}return{indexes:e.indexes,x:t,y:r}}function ey(e,t){var r=0,i=e.length-1,n;var a;while(r<=i){n=(r+i)/2|0;a=e[n];if(a<t){r=n+1}else if(a>t){i=n-1}else{return n}}return-1}function ty(e,t,r){var i=e.slice().sort(Kp),n=[];for(var a=0,o=t.length;a<o;a++){var s=[],u=t[a];var l=false;for(var f=0,h=u.length;f<h;f++){var v=u[f];var d=ey(i,v);if(d!==-1){if(v===r){l=true}s.push(v)}}if(s.length!==0){n[l?"unshift":"push"](s.sort(Kp))}}return n}Ogma.extend(function(e){e.layouts.radial=function(t){if(t===void 0)t={};return e.modules.layouts.start("radial",t)};e.modules.layouts.register("radial",Jp)});var ry=function e(t,r){var i=this;this._module=t;this._id=r;this._whenApplied=t.whenApplied().then(function(){return i})};ry.prototype.getName=function e(){return this._module.getName(this._id)};ry.prototype.getId=function e(){return this._id};ry.prototype.whenApplied=function e(){return this._whenApplied};ry.prototype.isEnabled=function e(){return this._module.isEnabled(this._id)};ry.prototype.enable=function e(t){return this._module.enable(this._id,t)};ry.prototype.disable=function e(t){return this._module.disable(this._id,t)};ry.prototype.toggle=function e(t){return this._module.toggle(this._id,t)};ry.prototype.getIndex=function e(){return this._module.getIndex(this._id)};ry.prototype.setIndex=function e(t){return this._module.setIndex(this._id,t)};ry.prototype.destroy=function e(t){return this._module.remove(this._id,t)};ry.prototype.refresh=function e(){return this._module.refresh(this._id)};ry.prototype.delete=function e(t){return this.destroy(t)};var iy=function e(t){var r=this;this._ogma=t;this._settings=t.modules.settings;this._dom=t.modules.dom;this._events=t.modules.events;this._graph=t.modules.graph;this._list=[];this._currentPipeline=[];this._idCounter=0;this._mustRefresh=false;this._resolvers=[];this._safeGuard=false;this._afterCurrentUpdate=Promise.resolve();this._ogma.styles.createClass({name:av,isBuiltin:true,nodeAttributes:{opacity:0,radius:0},edgeAttributes:{opacity:0,width:0}});this._nodeTransformationIdList=this._graph.createNodeAttribute({storage:16,default:0});this._edgeTransformationIdList=this._graph.createEdgeAttribute({storage:16,default:0});this._settings.register("transformations.updateOnDataChange",true);this._events.on({"addNodes addEdges removeNodes removeEdges":function(e){var t=e.virtual;if(!t){r._invalidState()}},"updateNodeData updateEdgeData":function(){if(r._settings.get("transformations.updateOnDataChange")&&!r._safeGuard){r._invalidState()}},afterNewFrame:function(){r._computeTransformations()}})};iy.prototype._invalidState=function e(){var t=this;this._afterCurrentUpdate.then(function(){if(t._list.length||t._currentPipeline.length){t._mustRefresh=true;t._dom.refresh()}})};iy.prototype._onUpdate=function e(){var t=this;return this._afterCurrentUpdate.then(function(){t._dom.refresh();return new Promise(function(e){return t._resolvers.push(e)})})};iy.prototype._resetEltTransformationIds=function e(){this._nodeTransformationIdList.reset();this._edgeTransformationIdList.reset()};iy.prototype._assignTransformationIds=function e(t){this._assignTransformationIdsToElements(true,t);this._assignTransformationIdsToElements(false,t)};iy.prototype._assignTransformationIdsToElements=function e(t,r){var i=t?this._graph.allNodeIndexesConst():this._graph.allEdgeIndexesConst();var n=this._graph.getAttribute(t,"virtual");var a=this._graph.getAttribute(t,"excluded");var o=t?this._nodeTransformationIdList:this._edgeTransformationIdList;for(var s=0;s<i.length;++s){var u=i[s];var l=o.get(u);if(!l){var f=a.get(u);var h=n.get(u);if(!f&&h){o.set(u,r)}}}};iy.prototype._resolveTransformations=function e(t,r,i){var n=this;if(!i){t.forEach(function(e){return e.duration=0});r.forEach(function(e){return e.duration=0})}this._resetEltTransformationIds();var a=Promise.resolve();var o=function(e){var i=t[e];if(i.context!==null){a=a.then(function(){return i.methods.undo(i)})}if(!r.some(function(e){return e.id===i.id})){a=a.then(function(){return i.methods.cleanup(i)}).then(function(){i.context=null})}};for(var s=t.length-1;s>=0;--s)o(s);var u=function(e){var t=r[e];var i=null;a=a.then(function(){return t.methods.run(t)}).then(function(e){i=e;if(t.context){return t.methods.cleanup(t)}}).then(function(){n._assignTransformationIds(t.id);t.context=i})};for(var l=0;l<r.length;++l)u(l);return a};iy.prototype._computeTransformations=function e(){var t=this;if(this._safeGuard){return}this._safeGuard=true;this._afterCurrentUpdate=Promise.resolve();if(this._mustRefresh){var r=this._currentPipeline.filter(function(e){var t=e.enabled;return t});var i=this._list.filter(function(e){var t=e.enabled;return t});var n;var a;var o;if(r.length===i.length+1&&ny(r,i,i.length)){n=[r.pop()];a=[];o=true}else if(i.length===r.length+1&&ny(r,i,r.length)){n=[];a=[i.pop()];o=true}else{n=r;a=i;o=false}this._afterCurrentUpdate=this._afterCurrentUpdate.then(function(){return t._resolveTransformations(n,a,o)}).then(function(){t._currentPipeline=t._list.map(function(e){return Object.assign({},e)});t._mustRefresh=false})}this._afterCurrentUpdate=this._afterCurrentUpdate.then(function(){return t._ogma.view.afterNextFrame()}).then(function(){t._safeGuard=false;t._resolvers.forEach(function(e){return e()});t._resolvers=[]})};iy.prototype.getList=function e(){return this._list.map(function(e){var t=e.wrapper;return t})};iy.prototype.clear=function e(){this._list=[];this._invalidState();return this._onUpdate()};iy.prototype._get=function e(t,r){var i=this;if(r===void 0)r=true;for(var n=0;n<this._list.length;++n){var a=i._list[n];if(a.id===t){a.index=n;return a}}if(r){throw new Error("calling a method on a destroyed transformation")}return null};iy.prototype.getName=function e(t){return this._get(t).methods.getName()};iy.prototype.enable=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);if(!e.enabled){e.enabled=true;e.duration=r;i._invalidState()}return i._onUpdate()})};iy.prototype._setRemovalDuration=function e(t,r){var i=this;for(var n=0;n<this._currentPipeline.length;++n){var a=i._currentPipeline[n];if(a.id===t){a.duration=r}}};iy.prototype.disable=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);if(e.enabled){e.enabled=false;i._setRemovalDuration(t,r);i._invalidState()}return i._onUpdate()})};iy.prototype.remove=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);i._list.splice(e.index,1);i._setRemovalDuration(t,r);i._invalidState();return i._onUpdate()})};iy.prototype.toggle=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);if(e.enabled){return i.disable(t,r)}else{return i.enable(t,r)}})};iy.prototype.setIndex=function e(t,r){var i=this;return this._afterCurrentUpdate.then(function(){var e=i._get(t);i._list.splice(e.index,1);i._list.splice(Qt(r,0,i._list.length),0,e);i._invalidState();return i._onUpdate()})};iy.prototype.getIndex=function e(t){return this._get(t).index};iy.prototype.add=function e(t,r){if(r===void 0)r={};var i=r.duration;if(i===void 0)i=0;var n=r.enabled;if(n===void 0)n=true;if(!t.cleanup){t.cleanup=function(){}}var a={ogma:this._ogma,id:++this._idCounter,methods:t,duration:i,enabled:n,context:null,wrapper:new ry(this,this._idCounter),index:-1};this._list.push(a);this._invalidState();return a.wrapper};iy.prototype.whenApplied=function e(){return this._onUpdate()};iy.prototype.refresh=function e(){this._invalidState();return this._onUpdate()};iy.prototype.isEnabled=function e(t){return this._get(t).enabled};iy.prototype._getElementTransformationId=function e(t){var r=t.isNode?this._nodeTransformationIdList:this._edgeTransformationIdList;return r.get(t._index)};iy.prototype.isElementVirtual=function e(t){return!!this._getElementTransformationId(t)};iy.prototype.getElementTransformation=function e(t){var r=this._get(this._getElementTransformationId(t),false);return r&&r.wrapper};function ny(e,t,r){for(var i=0;i<r;++i){if(e[i].id!==t[i].id){return false}}return true}Ogma.extend(function(e){var t=e.Node;var r=e.Edge;var i=new iy(e);e.modules.transformations=i;Object.assign(e.transformations,{getList:function e(){return i.getList()},clear:function e(){return i.clear()},afterNextUpdate:function e(){return i.whenApplied()}});t.prototype.isVirtual=function(){return i.isElementVirtual(this)};r.prototype.isVirtual=function(){return i.isElementVirtual(this)};t.prototype.getTransformation=function(){return i.getElementTransformation(this)};r.prototype.getTransformation=function(){return i.getElementTransformation(this)}});Ogma.extend(function(e){var t=new ay(e);e.modules.pathfinding=t;e.pathfinding={astar:function e(r,i,n){if(n===void 0)n={};return t.astar(r,i,n)},dijkstra:function e(r,i,n){if(n===void 0)n={};return t.dijkstra(r,i,n)},dijkstraBig:function e(r,i,n){if(n===void 0)n={};return t.dijkstraBig(r,i,n)}}});var ay=function e(t){this._graph=t.modules.graph;this._objectList=this._graph.getAttribute(true,"object")};ay.prototype.astar=function e(t,r,i){return hy(this,t,r,os(i,oy))};ay.prototype.dijkstra=function e(t,r,i){return hy(this,t,r,os(i,sy))};ay.prototype.dijkstraBig=function e(t,r,i){var n=dijkstra(this._graph.getAdjacencyList({directed:i.directed,ids:true,weight:1,nodes:this._graph.getNodes()}),t._index,r._index,this._graph.getNodes()._indexes,undefined,false);return n.path?new this._graph.NodeList(n.path):null};var oy={pathLengthFunction:uy,heuristicLengthFunction:uy};var sy={pathLengthFunction:ly,heuristicLengthFunction:fy};function uy(e,t){var r=e.getPosition(),i=t.getPosition();return distance(r.x,r.y,i.x,i.y)}function ly(){return 1}function fy(){return 0}function hy(e,t,r,i){if(i===void 0)i={};var n=e._graph._getIndex(true,t),a=e._graph._getIndex(true,r),o=i.pathLengthFunction,s=i.heuristicLengthFunction,u=i.filter,l=i.directed?"out":"both",f=e._objectList,h=f.get(n),v=f.get(a),d=null;if(n===a){d=[n]}else{var c=e._graph._elts.nodes._nextIndex,_=new pr(Uint32Array),g=new pr(Uint32Array),p=new Int32Array(c),y=new Float32Array(c),m=new Float32Array(c);for(var x=0;x<c;++x){p[x]=-1;y[x]=Infinity;m[x]=Infinity}g.add(n);y[n]=0;m[n]=s(h,v);while(g.length!==0){var b=g.length,A=g.get(0),w=0,E=m[A];for(var S=1;S<b;++S){var C=g.get(S),T=m[C];if(T<E){E=T;A=C;w=S}}if(A===a){d=vy(p,n,a);break}var M=f.get(A);g.removeByPosition(w);_.add(A);var k=e._graph._getElement(true,A).getAdjacentNodes({direction:l,filter:u})._indexes;for(var I=0;I<k.length;++I){var N=k[I],L=f.get(N);if(_.has(N)){continue}var z=y[A]+o(M,L);if(!g.add(N)&&z>=y[N]){continue}p[N]=A;y[N]=z;m[N]=z+s(L,v)}}}return d?e._graph._getElements(true,d):null}function vy(e,t,r){var i=[r],n=r;while(n!==t){n=e[n];i.push(n)}i.reverse();return i}Ogma.extend(function(e){e.modules.cameraInteractions=new _y(e)});var dy=function(e){var t=e.graphWidth;var r=e.graphHeight;var i=e.viewWidth;var n=e.viewHeight;return Math.min(i/t,n/r)*.2};var cy=function(e){var t=e.smallestNodeSize;var r=e.viewWidth;var i=e.viewHeight;return Math.min(r,i)/t*.5};var _y=function e(t){var r=this;this._ogma=t;this._locate=t.modules.locate;this._dom=t.modules.dom;this._camera=t.modules.camera;this._settings=t.modules.settings;this._interactions=t.modules.interactions;this._graphics=t.modules.graphics;this._settings.register("interactions.zoom.enabled",true);this._settings.register("interactions.zoom.onDoubleClick",false);this._settings.register("interactions.zoom.duration",150);this._settings.register("interactions.zoom.modifier",1.8);this._settings.register("interactions.zoom.easing","quadraticOut");this._settings.register("interactions.zoom.minValue",dy);this._settings.register("interactions.zoom.maxValue",cy);this._settings.register("interactions.zoom.hideNodes",false);this._settings.register("interactions.zoom.hideEdges",false);this._settings.register("interactions.zoom.hideNodeTexts",false);this._settings.register("interactions.zoom.hideEdgeTexts",false);this._settings.register("interactions.pan.enabled",true);this._settings.register("interactions.pan.hideNodes",false);this._settings.register("interactions.pan.hideEdges",false);this._settings.register("interactions.pan.hideNodeTexts",false);this._settings.register("interactions.pan.hideEdgeTexts",false);this._settings.register("interactions.rotation.enabled",true);this._settings.register("interactions.rotation.hideNodes",false);this._settings.register("interactions.rotation.hideEdges",false);this._settings.register("interactions.rotation.hideNodeTexts",false);this._settings.register("interactions.rotation.hideEdgeTexts",false);this._settings.register("interactions.gesture.enabled",true);this._settings.register("interactions.gesture.hideNodes",false);this._settings.register("interactions.gesture.hideEdges",false);this._settings.register("interactions.gesture.hideNodeTexts",false);this._settings.register("interactions.gesture.hideEdgeTexts",false);this._interactions.onMouseWheel({priority:"zoom",disableDetection:true,check:function(){return r._settings.get("interactions.zoom.enabled")},handler:function(e){var t=e.x;var i=e.y;var n=e.delta;return py(r,n,t,i)}});this._interactions.onDoubleClick({priority:"zoom",disableDetection:true,check:function(){var e=r._settings.get("interactions.zoom.enabled");var t=r._settings.get("interactions.zoom.onDoubleClick");return e&&t},handler:function(e){var t=e.x;var i=e.y;return py(r,1,t,i)}});this._interactions.onDrag({priority:"panning",disableDetection:true,check:function(e){var t=e.button;var i=r._settings.get("interactions.pan.enabled");return t==="left"&&i},onStart:function(){gy(r,"pan",true)},onProgress:function(e){var t=e.dx;var i=e.dy;r._camera.move({x:-t,y:-i})},onStop:function(){gy(r,"pan",false)}});this._interactions.onDrag({priority:"rotation",disableDetection:true,check:function(e){var t=e.button;return t==="right"&&r._settings.get("interactions.rotation.enabled")},onStart:function(e){var t=e.x;var i=e.y;r._rotationStart={x:t,y:i};gy(r,"rotation",true)},onProgress:function(e){var t=e.x;var i=e.y;r._rotate({x:t,y:i})},onStop:function(){gy(r,"rotation",false)}});this._interactions.onGesture({priority:"gesture",disableDetection:true,check:function(){return r._settings.get("interactions.gesture.enabled")},onStart:function(){gy(r,"gesture",true)},onProgress:function(e){var t=e.dx;var i=e.dy;var n=e.rotation;var a=e.scale;var o=e.x;var s=e.y;r._camera.rotate(-n);r._camera.zoomIn(a,undefined,{x:o,y:s});r._camera.move({x:-t,y:-i})},onStop:function(){gy(r,"gesture",true)}})};_y.prototype._rotate=function e(t){var r=t.x;var i=t.y;var n=this._ogma.view.getSize();var a=n.width;var o=n.height;var s=a/2;var u=o/2;var l=this._rotationStart.x-s;var f=this._rotationStart.y-u;var h=r-s;var v=i-u;var d=Math.atan2(f,l)-Math.atan2(v,h);this._rotationStart={x:r,y:i};this._camera.rotate(d)};function gy(e,t,r){var value=!r;var i=e._settings.get("interactions."+t+".hideNodes");var n=e._settings.get("interactions."+t+".hideEdges");var a=e._settings.get("interactions."+t+".hideNodeTexts");var o=e._settings.get("interactions."+t+".hideEdgeTexts");if(i){e._ogma.styles.setNodesVisibility(value)}if(a){e._ogma.styles.setNodeTextsVisibility(value)}if(n){e._ogma.styles.setEdgesVisibility(value)}if(o){e._ogma.styles.setEdgeTextsVisibility(value)}}function py(e,t,r,i){var n=e._settings.get("interactions.zoom.modifier");var a=e._settings.get("interactions.zoom.duration");var o=e._settings.get("interactions.zoom.easing");var s=e._ogma.view.getZoom();var u=s*(t>0?n:1/n);var l={duration:a,easing:o};gy(e,"zoom",true);e._camera.setZoom(u,l,{refX:r,refY:i}).then(function(){gy(e,"zoom",false)})}var yy={layer:uv,outline:true,outerStroke:{color:"red",width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0}};var my={layer:uv,outline:true,color:"red",text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0}};var xy=100;var by=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._settings=t.modules.settings;this._captor=t.modules.captor;this._events=t.modules.events;this._delay=xy;this._manualTriggerDetection=false;this._settings.register("cursor.node","pointer",function(value,e){if(r._hovered&&r._hovered.isNode){r._graphics.removeCursorStyle(e);r._graphics.addCursorStyle(value)}});this._settings.register("cursor.edge","pointer",function(value,e){if(r._hovered&&!r._hovered.isNode){r._graphics.removeCursorStyle(e);r._graphics.addCursorStyle(value)}});this._settings.register("nodeHover",true,function(value){if(!value&&r._hovered&&r._hovered.isNode){r._unhoverElement(r._hovered)}});this._settings.register("edgeHover",true,function(value){if(!value&&r._hovered&&!r._hovered.isNode){r._unhoverElement(r._hovered)}});this._hoverExtremityHighlightedClass=this._ogma.styles.createClass({name:Qh,isBuiltin:true,nodeAttributes:yy});this._hoverClass=this._ogma.styles.createClass({name:Jh,isBuiltin:true,nodeAttributes:yy,edgeAttributes:my});var i=function(){r._hoverExtremityHighlightedClass.clearNodes();r._hoverClass.getEdges().getExtremities().addClass(Qh)};this._ogma.events.onEdgesClassAdded(Jh,i);this._ogma.events.onEdgesClassRemoved(Jh,i);this._timeout=null;this._hovered=null;this._events.on({hover:function(e){var t=e.target;return r._hoverElement(t)},unhover:function(e){var t=e.target;return r._unhoverElement(t)},animate:function(e){var t=e.duration;if(t){r._manualTriggerDetection=true;if(r._hovered){r._unhoverElement(r._hovered);r._captor.triggerUnhover()}}},beforeNewFrame:function(){if(r._manualTriggerDetection&&!r._graphics.isAnimating()){r._manualTriggerDetection=false;r._captor.triggerDetection();var e=r._captor.getPointedElement();if(e){r._hoverElement(e)}}},clear:function(){r._hovered=null;if(r._timeout){r._dom.clearTimeout(r._timeout)}}})};by.prototype.updateNodeAttributes=function e(t,r){this._hoverClass.update({nodeAttributes:t,fullOverwrite:r});this._hoverExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};by.prototype.updateEdgeAttributes=function e(t,r){this._hoverClass.update({edgeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};by.prototype._updateExtremityHighlightLayer=function e(){var t=this._hoverClass.getDefinition().edgeAttributes.layer;this._hoverExtremityHighlightedClass.update({nodeAttributes:{layer:t},fullOverwrite:false})};by.prototype.setRate=function e(t){this._delay=t};by.prototype._removeTimeout=function e(){if(this._timeout){this._dom.clearTimeout(this._timeout);this._timeout=null}};by.prototype._isAnimating=function e(){return this._graphics.isAnimating()};by.prototype._hoverElement=function e(t){var r=this;var i=t.isNode?"nodeHover":"edgeHover";var n=this._settings.get(i);if(!n||this._isAnimating()){return}this._removeTimeout();this._timeout=this._dom.setTimeout(function(){if(!r._isAnimating()){r._setElementHighlight(true,t);r._hovered=t}r._timeout=null},this._delay)};by.prototype._unhoverElement=function e(t){this._removeTimeout();if(this._hovered===t){this._setElementHighlight(false,t);this._hovered=null}};by.prototype._setElementHighlight=function e(t,r){var i=this._settings.get(r.isNode?"cursor.node":"cursor.edge");if(t){this._graphics.addCursorStyle(i);r.addClass(Jh)}else{this._graphics.removeCursorStyle(i);r.removeClass(Jh)}if(r.isNode&&t){this._graph.getAttribute(r.isNode,"textHidden").set(r._index,false)}};Ogma.extend(function(e){e.modules.hover=new by(e);e.styles.setHoveredNodeAttributes=function(t,r){return e.modules.hover.updateNodeAttributes(t,r)};e.styles.setHoveredEdgeAttributes=function(t,r){return e.modules.hover.updateEdgeAttributes(t,r)}});var Ay={number:1,duration:1e3,interval:800,startColor:"rgba(0 ,0 ,0 , 0.6)",endColor:"rgba(0, 0, 0, 0.0)",width:50,startRatio:1,endRatio:2};var wy={number:1,duration:1e3,interval:800,startColor:"rgba(0, 0, 0, 0.6)",endColor:"rgba(0, 0, 0, 0.0)",width:10,startRatio:1,endRatio:2};Ogma.extend(function(e){var t=new Ey(e);e.modules.pulses=t;e.Node.prototype.pulse=function(e){t.pulse(this,e)};e.NodeList.prototype.pulse=function(e){t.pulse(this,e)};e.Edge.prototype.pulse=function(e){t.pulse(this,e)};e.EdgeList.prototype.pulse=function(e){t.pulse(this,e)}});var Ey=function e(t){this._graph=t.modules.graph;this._dom=t.modules.dom;this._graphics=t.modules.graphics;this._events=t.modules.events;this._classes=t.modules.classes;this._engine=this._graphics.getGraphicsEngine();this._block=this._engine.createBlock();this._singleNodePulse=this._singleNodePulse.bind(this);this._singleEdgePulse=this._singleEdgePulse.bind(this)};Ey.prototype.pulse=function e(t,r){var i=this;this._dom.setTimeout(function(){return i._doPulse(t,r)},0)};Ey.prototype._doPulse=function e(t,r){var i=this;var n=t.isNode,a=os(r,n?Ay:wy),o=a.number,s=a.interval,u=0;for(var l=0;l<o;++l){i._dom.setTimeout(function(){(n?i._singleNodePulse:i._singleEdgePulse)(t,a)},u);u+=s}};Ey.prototype._singleNodePulse=function e(t,r){var i=this;var n=r.startRatio;var a=r.endRatio;var o=r.startColor;var s=r.endColor;var u=r.width;var l=r.duration;var f=t._indexes,h=this._engine.getCurrentTime(),v=this._graphics.getNodeAttributes(),d=v.layer,c=v.x,_=v.y,g=v.radius,p=v.color,y=new Array(f.length);n=Math.min(n,8);a=Math.min(a,8);for(var m=0;m<f.length;++m){var x=f[m],b=p.get(x),A=d.get(x),w=c.get(x),E=_.get(x),S=g.get(x),C=S*2*n,T=S*2*a,M=ph(A).nodeBody,k=i._graphics.allocateGraphicsEngineBlockId(),I=i._block.reset(Qs,true,M),N=I.nextAndReset(),L=Sy(o,b),z=Sy(s,b);N.end.x=w;N.end.y=E;N.end.thicknessScaled=T;N.end.lengthScaled=T;N.end.strokeWidthAbsolute=u;N.end.strokeColor=z;N.start.x=w;N.start.y=E;N.start.thicknessScaled=C;N.start.lengthScaled=C;N.start.strokeWidthAbsolute=u;N.start.strokeColor=L;N.animation.duration=l;N.animation.beginTime=h;i._engine.storeBlock(k,I);y[m]=k}this._dom.setTimeout(function(){for(var e=0;e<y.length;++e){i._graphics.releaseGraphicsEngineBlockId(y[e])}},l);this._dom.refresh(h+l)};Ey.prototype._singleEdgePulse=function e(t,r){var i=this;var n=r.startRatio;var a=r.endRatio;var o=r.startColor;var s=r.endColor;var u=r.duration;var l=r.width,f=t._indexes,h=new Array(f.length),v={},d={},c=this._engine.getCurrentTime(),_=this._graphics.getEdgeAttributes(),g=this._graphics.getNodeAttributes(),p=_.layer,y=_.source,m=_.target,x=_.curvature,b=_.width,A=_.shape.type,w=_.shape.style,E=_.shape.head,S=_.shape.tail,C=g.x,T=g.y,M=g.radius;n=Math.min(n,8);a=Math.min(a,8);for(var k=0;k<f.length;++k){var I=f[k],N=p.get(I),L=ph(N).edgeBody,z=i._graphics.allocateGraphicsEngineBlockId(),D=i._block.reset(Qs,true,L),P=y.get(I),F=m.get(I),B=x.get(I),R=P===F,O=b.get(I),V=A.get(I),j=w.get(I),U=S.get(I),G=E.get(I),X=M.get(P),W=M.get(F),Y=C.get(P),H=T.get(P),q=C.get(F),Z=T.get(F);v.width=O;v.shapeType=V;v.shapeStyle=j;v.shapeTail=U;v.shapeHead=G;v.sourceRadius=X;v.targetRadius=W;v.sourceX=Y;v.sourceY=H;v.targetX=q;v.targetY=Z;v.curvature=B;v.isSelfLoop=R;Gf(v,d);var $=d.bodyType;var K=d.bodyX;var J=d.bodyY;var Q=d.bodyLength;var ee=d.bodyWidth;var te=d.bodyAngle;var re=d.tailX;var ie=d.tailY;var ne=d.tailLength;var ae=d.tailWidth;var oe=d.tailAngle;var se=d.headX;var ue=d.headY;var le=d.headLength;var fe=d.headWidth;var he=d.headAngle;var ve=ee*n,de=ee*a;var ce=true,_e=null,ge=1,pe=0,ye=0,me=0,xe=0,be=0,Ae=0,we=null,Ee=null;rh(ce,D,B,R,$,K,J,Q,de,te,we,re,ie,ne,ae,oe,Ee,se,ue,le,fe,he,_e,ge,s,l,pe,ye,me,xe,be,Ae,$,K,J,Q,ve,te,we,re,ie,ne,ae,oe,Ee,se,ue,le,fe,he,_e,ge,o,l,pe,ye,me,xe,be,Ae);D.setGlobalAnimation(c,u,"linear");i._engine.storeBlock(z,D);h[k]=z}this._dom.setTimeout(function(){for(var e=0;e<h.length;++e){i._graphics.releaseGraphicsEngineBlockId(h[e])}},u);this._dom.refresh(c+u)};function Sy(e,t){if(e==="inherit"){return Array.isArray(t)?t[0]:t}else{return e}}var Cy={layer:sv,outline:true,outerStroke:{color:"red",width:5},innerStroke:{minVisibleSize:0},text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0}};var Ty={layer:sv,color:"red",outline:true,text:{backgroundColor:"rgb(220, 220, 220)",minVisibleSize:0},stroke:{width:2}};var My=function e(t){var r=this;this._ogma=t;this._events=t.modules.events;this._settings=t.modules.settings;this._graph=t.modules.graph;this._keyboard=t.modules.keyboard;this._graphics=t.modules.graphics;this._interactions=t.modules.interactions;this._selectionExtremityHighlightedClass=this._ogma.styles.createClass({name:tv,isBuiltin:true,nodeAttributes:Cy});this._selectedClass=this._ogma.styles.createClass({name:ev,isBuiltin:true,nodeAttributes:Cy,edgeAttributes:Ty});var i=function(){r._selectionExtremityHighlightedClass.clearNodes();r._selectedClass.getEdges().getExtremities().addClass(tv)};this._ogma.events.onEdgesClassAdded(ev,i);this._ogma.events.onEdgesClassRemoved(ev,i);this._settings.register("interactions.selection.enabled",true);this._settings.register("interactions.selection.multiSelectionKey","ctrl");this._interactions.onClick({priority:"selection",check:function(e){var t=e.button;return t==="left"&&r._settings.get("interactions.selection.enabled")},handler:function(e){var t=e.target;if(!t){r._selectedClass.clearNodes();r._selectedClass.clearEdges()}else{var i=r._settings.get("interactions.selection.multiSelectionKey");var n=i&&r._keyboard.isPressed(i);if(t.isNode){r._selectedClass.clearEdges()}else{r._selectedClass.clearNodes()}if(!n){var a=t.isNode?r._selectedClass.getNodes():r._selectedClass.getEdges();a.filter(function(e){return e!==t}).removeClass(ev);if(!t.hasClass(ev)){t.addClass(ev)}}else if(t.hasClass(ev)){t.removeClass(ev)}else{t.addClass(ev)}}}});this._events.on("beforeRemoveEdges",function(e){var t=e.edges;return t.setSelected(false)})};My.prototype.setNodeAttributes=function e(t,r){this._selectedClass.update({nodeAttributes:t,fullOverwrite:r});this._selectionExtremityHighlightedClass.update({nodeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};My.prototype.setEdgeAttributes=function e(t,r){this._selectedClass.update({edgeAttributes:t,fullOverwrite:r});this._updateExtremityHighlightLayer()};My.prototype._updateExtremityHighlightLayer=function e(){var t=this._selectedClass.getDefinition().edgeAttributes.layer;this._selectionExtremityHighlightedClass.update({nodeAttributes:{layer:t},fullOverwrite:false})};My.prototype.setActive=function e(t,r){if(H(r)){var i=function(e,t){return r[t]?"toSelect":"toUnselect"};var n=i.toSelect;var a=i.toUnselect;if(n){n.addClass(ev)}if(a){n.removeClass(ev)}}else{t[r?"addClass":"removeClass"](ev)}};My.prototype.areActive=function e(t){return t.hasClass(ev)};My.prototype.getSelectedNodes=function e(){return this._selectedClass.getNodes()};My.prototype.getSelectedEdges=function e(){return this._selectedClass.getEdges()};My.prototype.getNonSelectedNodes=function e(){return this._graph.getNodes().filter(function(e){return!e.hasClass(ev)})};My.prototype.getNonSelectedEdges=function e(){return this._graph.getEdges().filter(function(e){return!e.hasClass(ev)})};My.prototype.clear=function e(){this._selectedClass.clearNodes();this._selectedClass.clearEdges()};Ogma.extend(function(e){var t=new My(e);var r=e.Node;var i=e.Edge;var n=e.NodeList;var a=e.EdgeList;e.modules.selection=t;e.events.onNodesSelected=function(t){return e.events.onNodesClassAdded(ev,t)};e.events.onNodesUnselected=function(t){return e.events.onNodesClassRemoved(ev,t)};e.events.onEdgesSelected=function(t){return e.events.onEdgesClassAdded(ev,t)};e.events.onEdgesUnselected=function(t){return e.events.onEdgesClassRemoved(ev,t)};e.styles.setSelectedNodeAttributes=function(e,r){return t.setNodeAttributes(e,r)};e.styles.setSelectedEdgeAttributes=function(e,r){return t.setEdgeAttributes(e,r)};e.clearSelection=function(){return t.clear()};e.getSelectedNodes=function(){return t.getSelectedNodes()};e.getNonSelectedNodes=function(){return t.getNonSelectedNodes()};e.getSelectedEdges=function(){return t.getSelectedEdges()};e.getNonSelectedEdges=function(){return t.getNonSelectedEdges()};r.prototype.setSelected=function(e){t.setActive(this,e)};r.prototype.isSelected=function(){return t.areActive(this)};n.prototype.setSelected=function(e){t.setActive(this,e)};n.prototype.isSelected=function(){return t.areActive(this)};i.prototype.setSelected=function(e){t.setActive(this,e)};i.prototype.isSelected=function(){return t.areActive(this)};a.prototype.setSelected=function(e){t.setActive(this,e)};a.prototype.isSelected=function(){return t.areActive(this)}});Ogma.extend(function(e){e.modules.drag=new ky(e);e.events.onNodeDragStart=function(t){e.modules.events.on("startMoveNodesByDragging",t);return e.events};e.events.onNodeDragProgress=function(t){e.modules.events.on("progressMoveNodesByDragging",t);return e.events};e.events.onNodeDragEnd=function(t){e.modules.events.on("endMoveNodesByDragging",t);return e.events}});var ky=function e(t){var r=this;this._graph=t.modules.graph;this._camera=t.modules.camera;this._graphics=t.modules.graphics;this._selection=t.modules.selection;this._events=t.modules.events;this._settings=t.modules.settings;this._captor=t.modules.captor;t.styles.createClass({name:rv,isBuiltin:true,nodeAttributes:{layer:lv}});this._events.register(["startMoveNodesByDragging","progressMoveNodesByDragging","endMoveNodesByDragging"]);this._settings.register("interactions.drag.enabled",true);this._settings.register("interactions.drag.cursor","move");this._settings.register("interactions.drag.onBeforeDrag",null);this._settings.register("interactions.drag.applyResult",true);this._dragged=null;this._start=null;this._end=null;this._startDrag=null;this._mousePos={x:0,y:0};this._events.on({down:function(e){var t=e.x;var i=e.y;var n=e.button;if(n==="left"){r._mousePos.x=t;r._mousePos.y=i}}});t.modules.interactions.onDrag({priority:"drag",disableDetection:true,check:function(e){var t=e.target;var i=e.button;var n=i==="left";var a=r._settings.get("interactions.drag.enabled");var o=t&&t.isNode&&t.getAttribute("draggable");return n&&a&&o},onStart:function(e){var t=e.target;if(t.isSelected()){r._dragged=r._selection.getSelectedNodes().filter(function(e){return e.getAttribute("draggable")})}else{r._dragged=t.toList()}r._start=r._dragged.getPosition();r._end=ne(r._start);r._onBeforeDrag=r._settings.get("interactions.drag.onBeforeDrag");r._startDrag=r._camera.screenToGraphCoordinates(r._mousePos);r._dragged.addClass(rv);r._events.fire("startMoveNodesByDragging",{nodes:r._dragged});r._graphics.addCursorStyle(r._settings.get("interactions.drag.cursor"))},onProgress:function(){var e=r._captor.getCursorInformation();var t=e.x;var i=e.y;var n=r._dragged._indexes;var a=r._camera.screenToGraphCoordinates({x:t,y:i});var o=a.x-r._startDrag.x;var s=a.y-r._startDrag.y;for(var u=0;u<n.length;++u){var l=r._start[u];var f=r._end[u];f.x=l.x+o;f.y=l.y+s}if(r._onBeforeDrag){r._onBeforeDrag(r._dragged,t,i,r._end)}if(r._settings.get("interactions.drag.applyResult")){r._dragged.setAttributes(r._end)}r._events.fire("progressMoveNodesByDragging",{nodes:r._dragged,dx:o,dy:s})},onStop:function(){r._dragged.removeClass(rv);r._graphics.removeCursorStyle(r._settings.get("interactions.drag.cursor"));r._events.fire("endMoveNodesByDragging",{nodes:r._dragged,start:r._start,end:r._end});r._dragged=null;r._start=null;r._end=null}})};Ogma.extend(function(e){var t=new Ny(e);e.modules.filters=t;Object.assign(e.transformations,{addNodeFilter:function e(r){return t.addNodeFilter(r)},addEdgeFilter:function e(r){return t.addEdgeFilter(r)}});Object.assign(e,{addNodeFilter:function t(r){return e.transformations.addNodeFilter(r)},addEdgeFilter:function t(r){return e.transformations.addEdgeFilter(r)},getNodeFilters:function t(){return e.transformations.getList().filter(function(e){return e.getName()==="node-filter"})},getEdgeFilters:function t(){return e.transformations.getList().filter(function(e){return e.getName()==="edge-filter"})},clearNodeFilters:function t(){return Promise.all(e.getNodeFilters().map(function(e){return e.destroy()}))},clearEdgeFilters:function t(){return Promise.all(e.getEdgeFilters().map(function(e){return e.destroy()}))}})});function Iy(e){if(typeof e!=="object"){return{criteria:e,enabled:true,duration:0}}else{return e}}var Ny=function e(t){this._transformations=t.modules.transformations};Ny.prototype.addNodeFilter=function e(t){var r=Iy(t);var i=r.criteria;var n=r.enabled;var a=r.duration;return this._transformations.add(new zy(i),{enabled:n,duration:a})};Ny.prototype.addEdgeFilter=function e(t){var r=Iy(t);var i=r.criteria;var n=r.enabled;var a=r.duration;return this._transformations.add(new Dy(i),{enabled:n,duration:a})};var Ly=function e(t){this._getNodesToFilter=t.getNodesToFilter;this._getEdgesToFilter=t.getEdgesToFilter};Ly.prototype.run=function e(t){var r=t.ogma;var i=t.duration;var n=this._getNodesToFilter(r);var a=this._getEdgesToFilter(r,n);var o=n.getAttribute("opacity");var s=a.getAttribute("opacity");return Promise.all([n.setAttribute("opacity",0,i),a.setAttribute("opacity",0,i)]).then(function(){n.setExcluded(true);a.setExcluded(true);return{nodes:n,edges:a,nodeOpacities:o,edgeOpacities:s}})};Ly.prototype.undo=function e(t){var r=t.duration;var i=t.context;var n=i.nodes;var a=i.edges;var o=i.nodeOpacities;var s=i.edgeOpacities;n.setExcluded(false);a.setExcluded(false);return Promise.all([n.setAttribute("opacity",o,r),a.setAttribute("opacity",s,r)])};var zy=function(e){function t(t){e.call(this,{getNodesToFilter:function(e){return e.getNodes().filter(function(e){return!t(e)})},getEdgesToFilter:function(e,t){return t.getAdjacentEdges()}})}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"node-filter"};return t}(Ly);var Dy=function(e){function t(t){e.call(this,{getNodesToFilter:function(e){return e.createNodeList()},getEdgesToFilter:function(e){return e.getEdges().filter(function(e){return!t(e)})}})}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"edge-filter"};return t}(Ly);var Py=function e(t){this._nodeSelector=t.nodeSelector;this._nodeGroupIdFunction=t.nodeGroupIdFunction;this._nodeGenerator=t.nodeGenerator;this._edgeSelector=t.edgeSelector;this._edgeGroupIdFunction=t.edgeGroupIdFunction;this._edgeGenerator=t.edgeGenerator;this._edgeSource=t.edgeSource;this._edgeTarget=t.edgeTarget;this._separateEdgesByDirection=t.separateEdgesByDirection;this._groupSelfLoopEdges=t.groupSelfLoopEdges;this._groupEdges=t.groupEdges};Py.prototype._computeNodeGroupId=function e(t){return this._nodeSelector(t)?this._nodeGroupIdFunction(t):undefined};Py.prototype._computeEdgeGroupId=function e(t){return this._edgeSelector(t)?this._edgeGroupIdFunction(t):undefined};Py.prototype._addMetaNodes=function e(t,r){var i=this;var n=r.getId();var a=t.getNodes();var o=new Gt;for(var s=0;s<a.size;++s){var u=a.get(s);var l=i._computeNodeGroupId(u);if(l!==undefined){var f=o.get(l);if(!f){f={id:l,nodes:[]};o.set(l,f)}f.nodes.push(u)}}var h=o.values();var v=h.map(function(e){var r=e.nodes;return t.getNodes(r)});var d=[];for(var c=0;c<h.length;++c){var _=h[c].id;var g=v[c];var p=i._nodeGenerator(g,_,r);if(p.id===undefined){p.id=Oy(_,n)}p.position=Cr(g.getPosition());d.push(p)}return t.addNodes(d.map(function(e){return{id:e.id,attributes:e.position}}),{virtual:true}).then(function(){var e=t.getNodes(d.map(function(e){return e.id}));e.replaceOriginalAttributes(d.map(function(e){return e.attributes}),["x","y"]);e.setData(null,d.map(function(e){return e.data}));t.modules.grouping.setSubElements(e,v);v.forEach(function(r,i){t.modules.grouping.setMetaElement(r,e.get(i))});return e})};Py.prototype._addMetaEdges=function e(t,r){var i=this;var n=r.getId();var a=t.getEdges();var o=new Gt;var s=t.modules.graphics.getAttributesManager().getUsedEdgeAttributes();for(var u=0;u<a.size;++u){var l=a.get(u);var f=i._computeEdgeGroupId(l);if(f!==undefined){var h=i._edgeSource(l);var v=i._edgeTarget(l);var d=i._groupEdges?By(f,h.getId(),v.getId(),i._separateEdgesByDirection):l.getId();var c=o.get(d);if(!c){c={id:d,source:h,target:v,edges:[]};o.set(d,c)}c.edges.push(l)}}var _=o.values();var g=_.map(function(e){var r=e.edges;return t.getEdges(r)});var p=[];for(var y=0;y<_.length;++y){var m=_[y];var x=m.id;var b=g[y];var A=i._groupEdges?i._edgeGenerator(b,x,r):Ry(b,s);if(A.id===undefined){A.id=Oy(x,n)}A.source=m.source;A.target=m.target;p.push(A)}return t.addEdges(Fy(p),{virtual:true}).then(function(){var e=t.getEdges(p.map(function(e){return e.id}));e.replaceOriginalAttributes(p.map(function(e){return e.attributes}));e.setData(null,p.map(function(e){return e.data}));t.modules.grouping.setSubElements(e,g);g.forEach(function(r,i){t.modules.grouping.setMetaElement(r,e.get(i))});return e})};function Fy(e){return e.map(function(e){var t=e.id;var r=e.source;var i=e.target;return{id:t,source:r,target:i}})}function By(e,t,r,i){var n=t;var a=r;if(!i&&n.toString()>a.toString()){n=r;a=t}return e+"["+n+"-"+a+"]"}function Ry(e,t){var r=e.get(0);return{data:r.getData(),attributes:r.getAttributes(t)}}function Oy(e,t){return"gen_grp_"+t+"_"+e}var Vy=function(e){function t(t){var r=t.selector;if(r===void 0)r=function(){return true};var i=t.groupIdFunction;if(i===void 0)i=function(){return""};var n=t.nodeGenerator;if(n===void 0)n=function(){return{}};var a=t.edgeGenerator;if(a===void 0)a=function(){return{}};var o=t.separateEdgesByDirection;if(o===void 0)o=false;var s=t.groupSelfLoopEdges;if(s===void 0)s=false;var u=t.groupEdges;if(u===void 0)u=true;var l=t.restorePositions;if(l===void 0)l=true;e.call(this,{nodeSelector:r,nodeGroupIdFunction:i,nodeGenerator:n,edgeSelector:function(e){return e.getSource().getMetaNode()||e.getTarget().getMetaNode()},edgeGroupIdFunction:function(){return""},edgeGenerator:a,edgeSource:function(e){return jy(e.getSource())},edgeTarget:function(e){return jy(e.getTarget())},separateEdgesByDirection:o,groupEdges:u});this._groupSelfLoopEdges=s;this._restorePositions=l}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"node-grouping"};t.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=t.wrapper;var o,s,u,l,f;return this._addMetaNodes(i,a).then(function(e){o=e;o.setVisible(false);return r._addMetaEdges(i,a)}).then(function(e){s=e;s.setVisible(false);u=o.getSubNodes().reduce(function(e,value){return e.concat(value)},i.createNodeList());l=s.getSubEdges().reduce(function(e,value){return e.concat(value)},i.createEdgeList());var t=i.getNodes(u.getMetaNode()).getPosition();f=u.getPosition().map(function(e,r){var i=t[r];return{x:e.x-i.x,y:e.y-i.y}});return u.setAttributes(t,n)}).then(function(){u.setVisible(false);l.setVisible(false);o.setVisible(true);s.filter(function(e){return r._groupSelfLoopEdges||e.getSource()!==e.getTarget()}).setVisible(true);return{metaNodes:o,metaEdges:s,subNodes:u,subEdges:l,offsets:f}})};t.prototype.undo=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=t.context;var o=a.metaNodes;var s=a.metaEdges;var u=a.subNodes;var l=a.subEdges;var f=a.offsets;var h=i.getNodes(u.getMetaNode()).getPosition();var v=h.map(function(e,t){return Uy(e,f[t])});u.setVisible(true);l.setVisible(true);i.modules.grouping.setMetaElement(u,null);i.modules.grouping.setMetaElement(l,null);o.setVisible(false);s.setVisible(false);return u.setAttributes(h).then(function(){if(r._restorePositions){return u.setAttributes(v,n)}})};t.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;var n=i.metaNodes;var a=i.metaEdges;var o=n.filter(function(e){return!e.isVisible()});var s=a.filter(function(e){return!e.isVisible()});return Promise.all([r.removeEdges(s,{virtual:true}),r.removeNodes(o,{virtual:true})])};return t}(Py);function jy(e){return e.getMetaNode()||e}function Uy(e,t){return{x:e.x+t.x,y:e.y+t.y}}var Gy=function(e){function t(t){var r=t.selector;if(r===void 0)r=function(){return true};var i=t.groupIdFunction;if(i===void 0)i=function(){return""};var n=t.generator;if(n===void 0)n=function(){return{}};var a=t.separateEdgesByDirection;if(a===void 0)a=false;e.call(this,{nodeSelector:null,nodeGroupIdFunction:null,nodeGenerator:null,edgeSelector:r,edgeGroupIdFunction:i,edgeGenerator:n,edgeSource:function(e){return e.getSource()},edgeTarget:function(e){return e.getTarget()},separateEdgesByDirection:a,groupEdges:true})}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.getName=function e(){return"edge-grouping"};t.prototype.run=function e(t){var r=t.ogma;var i=t.wrapper;var n,a;return this._addMetaEdges(r,i).then(function(e){n=e;a=n.getSubEdges().reduce(function(e,value){return e.concat(value)},r.createEdgeList());a.setVisible(false);return{metaEdges:n,subEdges:a}})};t.prototype.undo=function e(t){var r=t.context;var i=r.metaEdges;var n=r.subEdges;n.setVisible(true);i.setVisible(false)};t.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;var n=i.metaEdges;return r.removeEdges(n.filter(function(e){return!e.isVisible()}),{virtual:true})};return t}(Py);Ogma.extend(function(e){var t=e.Node;var r=e.NodeList;var i=e.Edge;var n=e.EdgeList;var a=new Xy(e);e.modules.grouping=a;e.transformations.addNodeGrouping=function(e){return a.addNodeGrouping(e)};e.transformations.addEdgeGrouping=function(e){return a.addEdgeGrouping(e)};t.prototype.getMetaNode=function(){return this._ogma.modules.grouping.getMetaElement(this)[0]};r.prototype.getMetaNode=function(){return this._ogma.modules.grouping.getMetaElement(this)};t.prototype.getSubNodes=function(){return this._ogma.modules.grouping.getSubElements(this)[0]};r.prototype.getSubNodes=function(){return this._ogma.modules.grouping.getSubElements(this)};i.prototype.getMetaEdge=function(){return this._ogma.modules.grouping.getMetaElement(this)[0]};n.prototype.getMetaEdge=function(){return this._ogma.modules.grouping.getMetaElement(this)};i.prototype.getSubEdges=function(){return this._ogma.modules.grouping.getSubElements(this)[0]};n.prototype.getSubEdges=function(){return this._ogma.modules.grouping.getSubElements(this)}});var Xy=function e(t){this._ogma=t;this._graph=t.modules.graph;this._transformations=t.modules.transformations;this._subNodesList=this._graph.createNodeAttribute({storage:"any",default:null});this._subEdgesList=this._graph.createEdgeAttribute({storage:"any",default:null});this._metaNodeList=this._graph.createNodeAttribute({storage:"any",default:null});this._metaEdgeList=this._graph.createEdgeAttribute({storage:"any",default:null})};Xy.prototype._fetchSubEltsList=function e(t){return t.isNode?this._subNodesList:this._subEdgesList};Xy.prototype._fetchMetaEltList=function e(t){return t.isNode?this._metaNodeList:this._metaEdgeList};Xy.prototype.setSubElements=function e(t,r){this._fetchSubEltsList(t).setMultiple(t._indexes,r)};Xy.prototype.setMetaElement=function e(t,r){this._fetchMetaEltList(t).setMultiple(t._indexes,r)};Xy.prototype.getSubElements=function e(t){return this._fetchSubEltsList(t).getMultiple(t._indexes)};Xy.prototype.getMetaElement=function e(t){return this._fetchMetaEltList(t).getMultiple(t._indexes)};Xy.prototype.addNodeGrouping=function e(t){if(t===void 0)t={};return this._transformations.add(new Vy(t),t)};Xy.prototype.addEdgeGrouping=function e(t){if(t===void 0)t={};return this._transformations.add(new Gy(t),t)};var Wy=function e(t){this._transformations=t.modules.transformations};Wy.prototype.addNodeCollapsing=function e(t){if(t===void 0)t={};return this._transformations.add(new Yy(t),t)};var Yy=function e(t){var r=t.selector;if(r===void 0)r=function(){return false};var i=t.edgeGenerator;if(i===void 0)i=function(){return{}};this._selector=r;this._edgeGenerator=i};Yy.prototype.getName=function e(){return"node-collapsing"};Yy.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=i.getNodes().filter(this._selector);var o=a.getAdjacentEdges();var s=[];for(var u=0;u<a.size;++u){var l=a.get(u);var f=l.getAdjacentNodes().filter(function(e){return!r._selector(e)});for(var h=0;h<f.size-1;++h){var v=f.get(h);var d=i.modules.graph.getEdgesBetweenTwoNodes(l,v);if(v===l){continue}for(var c=h+1;c<f.size;++c){var _=f.get(c);var g=i.modules.graph.getEdgesBetweenTwoNodes(l,_);var p=r._edgeGenerator(d,g,v,_);if(p){var y=q(p);for(var m=0;m<y.length;++m){var x=y[m];Hy(i,x,m,v,_,d,g);s.push(x)}}}}}return i.addEdges(s,{virtual:true}).then(function(e){return e.addClass(av)}).then(function(e){return Promise.all([e.removeClass(av,n),a.addClass(av,n),o.addClass(av,n)])}).then(function(e){var t=e[0];a.setVisible(false);o.setVisible(false);return{virtualEdges:t,hiddenNodes:a,hiddenEdges:o}})};Yy.prototype.undo=function e(t){var r=t.duration;var i=t.context;var n=i.virtualEdges;var a=i.hiddenNodes;var o=i.hiddenEdges;a.setVisible(true);o.setVisible(true);return Promise.all([a.addClass(av),o.addClass(av)]).then(function(){return Promise.all([a.removeClass(av,r),o.removeClass(av,r),n.addClass(av,r)])}).then(function(){n.setVisible(false)})};Yy.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;return r.removeEdges(i.virtualEdges.filter(function(e){return!e.isVisible()}),{virtual:true})};function Hy(e,t,r,i,n,a,o){var s=null;var u=null;if(t.source!==undefined){s=e.getNode(t.source);if(s!==i&&s!==n){throw new Error(["addNodeCollapsing: edge generator produced RawEdge with invalid source ["+t.source+"]","expected to be ["+i.getId()+"] or ["+n.getId()+"]"].join("; "))}}if(t.target!==undefined){u=e.getNode(t.target);if(u!==i&&u!==n){throw new Error(["addNodeCollapsing: edge generator produced RawEdge with invalid target ["+t.target+"]","expected to be ["+i.getId()+"] or ["+n.getId()+"]"].join("; "))}}if(s&&u&&s===u){throw new Error("addNodeCollapsing: edge generator produced RawEdge with same source and target ["+s.getId()+"]")}if(s&&!u){u=s===i?n:i}else if(u&&!s){s=u===i?n:i}else if(!s&&!u){var l=true;for(var f=0;f<a.size;++f){var h=a.get(f);if(h.getSource()===i){l=false}}for(var v=0;v<o.size;++v){var d=o.get(v);if(d.getTarget()===n){l=false}}if(l){s=n;u=i}else{s=i;u=n}}t.id="_gen_"+s.getId()+"_"+u.getId()+"_"+r;t.source=s;t.target=u}Ogma.extend(function(e){e.modules.nodeCollapsing=new Wy(e);Object.assign(e.transformations,{addNodeCollapsing:function t(r){return e.modules.nodeCollapsing.addNodeCollapsing(r)}})});var qy=function e(t){var r=t.nodeSelector;if(r===void 0)r=function(){return true};var i=t.edgeSelector;if(i===void 0)i=function(){return true};var n=t.nodeDataFunction;if(n===void 0)n=null;var a=t.edgeDataFunction;if(a===void 0)a=null;this._nodeSelector=r;this._edgeSelector=i;this._nodeDataFunction=n;this._edgeDataFunction=a};qy.prototype.getName=function e(){return"virtual-properties"};qy.prototype.run=function e(t){var r=t.ogma;var i={nodes:null,oldNodesData:null,edges:null,oldEdgesData:null};if(this._nodeDataFunction){i.nodes=r.getNodes().filter(this._nodeSelector);i.oldNodesData=Zy(i.nodes,this._nodeDataFunction)}if(this._edgeDataFunction){i.edges=r.getEdges().filter(this._edgeSelector);i.oldEdgesData=Zy(i.edges,this._edgeDataFunction)}return i};qy.prototype.undo=function e(t){var r=t.context;var i=r.nodes;var n=r.oldNodesData;var a=r.edges;var o=r.oldEdgesData;if(i){i.setData(n)}if(a){a.setData(o)}};qy.prototype.cleanup=function e(){};function Zy(e,t){var r=[];for(var i=0;i<e.size;++i){var n=e.get(i);var a=n.getData();var o=t(n);var s=ke(a,o);r.push(a);n.setData(s)}return r}Ogma.extend(function(e){Object.assign(e.transformations,{addVirtualProperties:function t(r){return e.modules.transformations.add(new qy(r),r)}})});var $y=function e(t){var r=t.selector;if(r===void 0)r=function(){return false};var i=t.dataFunction;if(i===void 0)i=function(){return undefined};this._selector=r;this._dataFunction=i};$y.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=i.getNodes().filter(this._selector);var o=[];var s=new Gt;for(var u=0;u<a.size;++u){var l=a.get(u);var f=l.getAdjacentEdges();var h=r._dataFunction(l);for(var v=0;v<f.size;++v){var d=f.get(v);var c=d.getSource();var _=d.getTarget();if(c!==_&&h!==undefined){var g=c===l?_:c;var p=s.get(g);if(!p){p=[];s.set(g,p)}p.push(h)}o.push(d)}}var y=i.getEdges(o);var m=i.getNodes(s.keys());var x=s.values();var b=m.getData();var A=new Array(m.size);for(var w=0;w<A.length;++w){var E=x[w];var S=b[w];for(var C=0;C<E.length;++C){S=ke(S,E[C])}A[w]=S}return Promise.all([a.addClass(av,n),y.addClass(av,n)]).then(function(){a.setVisible(false);y.setVisible(false);m.setData(A);return{hiddenNodes:a,hiddenEdges:y,nodesWithDataChange:m,oldDataList:b}})};$y.prototype.undo=function e(t){var r=t.duration;var i=t.context;var n=i.hiddenNodes;var a=i.hiddenEdges;var o=i.nodesWithDataChange;var s=i.oldDataList;n.setVisible(true);a.setVisible(true);n.addClass(av);a.addClass(av);return Promise.all([n.removeClass(av,r),a.removeClass(av,r)]).then(function(){o.setData(s)})};$y.prototype.cleanup=function e(){};Ogma.extend(function(e){Object.assign(e.transformations,{addNeighborMerging:function t(r){return e.modules.transformations.add(new $y(r),r)}})});var Ky=function e(t){var r=t.selector;if(r===void 0)r=function(){return true};var i=t.neighborIdFunction;if(i===void 0)i=function(){return null};var n=t.nodeGenerator;if(n===void 0)n=function(){return{}};var a=t.edgeGenerator;if(a===void 0)a=function(){return{}};this._generateIds=function(e){return r(e)&&i(e)};this._nodeGenerator=n;this._edgeGenerator=a};Ky.prototype.run=function e(t){var r=this;var i=t.ogma;var n=t.duration;var a=t.wrapper;var o=a.getId();var s=i.getNodes();var u=new Gt;for(var l=0;l<s.size;++l){var f=s.get(l);var h=Jy(r._generateIds(f));if(h){for(var v=0;v<h.length;++v){var d=h[v];var c=u.get(d);if(!c){c=[];u.set(d,c)}c.push(f)}}}var _=new Array(u.size);var g=u.keys();var p=u.values().map(function(e){return i.getNodes(e)});for(var y=0;y<_.length;++y){var m=g[y];var x=p[y];var b=r._nodeGenerator(m,x);b.id="_gen_"+o+"_"+m;b.position=Cr(x.getPosition());_[y]=b}var A,w;return i.addNodes(_.map(function(e){return{id:e.id,attributes:e.position}}),{virtual:true}).then(function(e){A=e;A.replaceOriginalAttributes(_.map(function(e){return e.attributes}),["x","y"]);A.setData(null,_.map(function(e){return e.data}));var t=[];for(var n=0;n<e.size;++n){var a=e.get(n);var o=p[n];for(var s=0;s<o.size;++s){var u=o.get(s);var l=r._edgeGenerator(u,a);if(!l.source&&!l.target){l.source=u;l.target=a}t.push(l)}}return i.addEdges(t,{virtual:true})}).then(function(e){w=e;A.setVisible(true);w.setVisible(true);A.addClass(av);w.addClass(av);return Promise.all([A.removeClass(av,n),w.removeClass(av,n)])}).then(function(){return{virtualNodes:A,virtualEdges:w}})};Ky.prototype.undo=function e(t){var r=t.context;var i=t.duration;var n=r.virtualNodes;var a=r.virtualEdges;return Promise.all([n.addClass(av,i),a.addClass(av,i)]).then(function(){n.setVisible(false);a.setVisible(false)})};Ky.prototype.cleanup=function e(t){var r=t.ogma;var i=t.context;var n=i.virtualNodes.filter(function(e){return!e.isVisible()});var a=i.virtualEdges.filter(function(e){return!e.isVisible()});r.removeNodes(n,{virtual:true});r.removeEdges(a,{virtual:true})};function Jy(value){return Array.isArray(value)?value:value?[value]:null}Ogma.extend(function(e){Object.assign(e.transformations,{addNeighborGeneration:function t(r){return e.modules.transformations.add(new Ky(r),r)}})});var Qy=function e(t){this._ogma=t;this._graph=t.modules.graph;this._nodeList=this._graph.getNodeAttribute("object");this._edgeList=this._graph.getEdgeAttribute("object");this._sourceList=this._graph.getEdgeAttribute("source");this._targetList=this._graph.getEdgeAttribute("target");this._excludedList=this._graph.getEdgeAttribute("excluded");this._virtualList=this._graph.getEdgeAttribute("virtual")};Qy.prototype.shortestPath=function e(t){var r=this;if(t===void 0)t={};var i=t.source;var n=t.target;var a=t.directed;if(a===void 0)a=false;var o=t.filter;if(o===void 0)o="visible";var s=t.edgeCostFunction;if(s===void 0)s=function(){return 1};var u=t.heuristicFunction;if(u===void 0)u=function(){return 0};var l=this._ogma.getNode(i);var f=this._ogma.getNode(n);if(!l){throw new Error("the source is not a node")}if(!f){throw new Error("the target is not a node")}var h=l._index;var v=f._index;var d=null;if(h===v){d={nodes:l.toList(),edges:this._ogma.createEdgeList()}}else{var c=this._graph.getNodeMaxIndex();var _=new Int32Array(c);var g=new Float32Array(c);var p=new Float32Array(c);var y=new ii;var m=new fn(p);g.fill(Infinity);p.fill(Infinity);_.fill(-1);m.add(h);g[h]=0;p[h]=u(l,f);while(!m.isEmpty()){var x=m.removeMin();if(x===v){d=r._constructPath(_,h,v);break}y.add(x);var b=r._graph.getAdjacentDirections(x);if(!b){continue}for(var A=0;A<b.length;++A){var w=b[A];var E=r._graph.getEdgeIndexesInDirection(w);var S=-1;var C=0;var T=-1;for(var M=0;M<E.length;++M){var k=E[M];var I=r._sourceList.get(k);var N=r._targetList.get(k);if(I===N){continue}if(a&&x!==I){continue}if(o==="visible"&&r._excludedList.get(k)){continue}if(o==="raw"&&r._virtualList.get(k)){continue}var L=r._edgeList.get(k);var z=s(L);if(S===-1||z<C){S=k;C=z;T=I===x?N:I}}if(T!==-1||y.has(T)){var D=g[x]+C;if(!m.has(T)||D<g[T]){var P=r._nodeList.get(x);_[T]=S;g[T]=D;p[T]=D+u(P,f);m.add(T)}}}}}return Promise.resolve(d)};Qy.prototype._constructPath=function e(t,r,i){var n=this;var a=[i];var o=[];var s=i;while(s!==r){var u=t[s];var l=n._sourceList.get(u);var f=n._targetList.get(u);s=s===l?f:l;a.push(s);o.push(u)}a.reverse();o.reverse();return{nodes:new this._ogma.NodeList(a),edges:new this._ogma.EdgeList(o)}};Ogma.extend(function(e){var t=new Qy(e);e.modules.algorithms=t;Object.assign(e.algorithms,{shortestPath:function e(r){return t.shortestPath(r)}})});var em={"top-left":"left","bottom-left":"left","top-right":"right","bottom-right":"right"};var tm={"top-left":"top","bottom-left":"bottom","top-right":"top","bottom-right":"bottom"};Ogma.extend(function(e){var t=new im(e);e.modules.brand=t;e.tools.brand={set:function e(r,i){return t.set(r,i)},remove:function e(){t.remove()}}});var rm={position:"bottom-right",horizontalMargin:0,verticalMargin:0,className:null};var im=function e(t){this._dom=t.modules.dom;this._brand=null};im.prototype.set=function e(t,r){var i=os(r,rm);var n=i.position;var a=i.horizontalMargin;var o=i.verticalMargin;var s=i.className;if(!em[n]){n=rm.position}this.remove();var u=document.createElement("div");u.innerHTML=t;u.style.position="absolute";u.style[em[n]]=a+"px";u.style[tm[n]]=o+"px";u.style.padding="0px 0px 0px 0px";u.style.zIndex="1000";if(s){u.setAttribute("class",s)}this._brand=u;this._dom.setLayer("brand",this._brand);return u};im.prototype.remove=function e(){this._dom.setLayer("brand",null);this._brand=null};var nm="geo.latitude";var am="geo.longitude";var om={latitudePath:"latitude",longitudePath:"longitude",maxZoomLevel:17,wrapCoordinates:true,tileUrlTemplate:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png",tileUrlSubdomains:"abc",attribution:null,backgroundColor:"silver",opacity:1,duration:0,detectRetina:false,disableNodeDragging:true,tileBuffer:1,sizeRatio:1};var sm=256;var um=300;var lm=100;var fm=150;var hm=0;var vm=10;function dm(e){if(e===void 0)e={};var t=e.tileUrlSubdomains;var r=e.tileUrlTemplate;var i=e.attribution;var n=e.latitudePath;var a=e.longitudePath;var o=e.sizeRatio;if(r&&typeof r!=="string"){throw new TypeError("Geo mode: tileUrlTemplate must be a URL string")}if(t&&typeof t!=="string"){throw new TypeError("Geo mode: tileUrlTemplate must be a string")}if(i&&typeof i!=="string"){throw new TypeError("Geo mode: Map attribution must be a string")}if(n&&typeof n!=="string"&&!Array.isArray(n)){throw new TypeError("Geo mode: Latitude path must be a valid property path: "+"a string or an array of strings.")}if(a&&typeof a!=="string"&&!Array.isArray(a)){throw new TypeError("Geo mode: Longitude path must be a valid property path: "+"a string or an array of strings.")}if(typeof o!=="undefined"&&(!isFinite(o)||o<=0)){throw new TypeError("Geo mode: sizeRatio must be a positive number.")}}var cm=function e(t){var r=this;this._dom=t.modules.dom;this._graphics=t.modules.graphics;this._graph=t.modules.graph;this._data=t.modules.data;this._camera=t.modules.camera;this._events=t.modules.events;this._settingsModule=t.modules.settings;this._locate=t.modules.locate;this._brand=t.modules.brand;this._filters=t.modules.filters;this._individualAttributes=t.modules.individualAttributes;this._settings=te({},om);this._screen=this._dom.getDimensions();this._tiles={};this._tileSize=sm*nt();this._enableMapBackground=false;this._initialized=false;this._enabled=false;this._sIndex=0;this._lat=0;this._lng=0;this._zoom=1;this._zoomOffset=0;this._loadingTiles=0;this._graph.createNodeAttribute({name:"geo.prevLat",storage:"float"});this._graph.createNodeAttribute({name:"geo.prevLng",storage:"float"});this._graph.createNodeAttribute({name:nm,storage:"float"});this._graph.createNodeAttribute({name:am,storage:"float"});this._offsetX=this._graph.createNodeAttribute({name:"offsetX",storage:"float"});this._offsetY=this._graph.createNodeAttribute({name:"offsetY",storage:"float"});this._events.register(["geoEnabled","geoDisabled","geoLoaded","geoReady"]);this._events.on({addNodes:function(e){return r._onNodesAdded(e.nodes)},setContainer:function(e){if(e&&r._enabled){r._initializeCanvas(e)}},progressMoveNodesByDragging:function(e){return r._onNodesDragged(e)},startMoveNodesByDragging:function(){return r._onNodesDragStart()},cameraMove:function(e){return r._setViewFromCamera(e)},resize:function(){return r._onResize()},viewChanged:function(){return r._onMoveend()}})};cm.prototype._onMoveend=function e(){if(this._enabled&&!this._transition){var t=this._camera.zoom;if(t!==this._prevZoom){this._updateSizes()}this._prevZoom=t}};cm.prototype._updateSizes=function e(){this._graphics.refreshAll()};cm.prototype._onResize=function e(){this._resize();this._setViewFromCamera()};cm.prototype._resize=function e(){if(this._initialized){var t=this._screen=this._dom.getDimensions();var r=t.width;var i=t.height;this._tileSize=sm*nt();ft(this._canvas,r,i);ft(this._rcanvas,r,i)}};cm.prototype._setViewFromCamera=function e(){if(this._enabled){var t=this._camera;var r=Math.max(0,Math.log2(t.zoom));var i=qm(t.x,t.y);this._setView(i[0],i[1],r)}};cm.prototype._setCameraFromView=function e(){var t=Hm(this._lat,this._lng);var r=t[0];var i=t[1];var n=Math.pow(2,this._zoom);this._camera.setView({x:r,y:i,zoom:n})};cm.prototype._readNodesCoordinates=function e(t){var r=this._graph;var i=this._settings;var n=i.longitudePath;var a=i.latitudePath;var o=i.wrapCoordinates;var s=r.getAttributes(true,[nm,am]);var u=s[0];var l=s[1];var f=t._indexes;var h=t.getId();var v=f.length;var d=t.getData(a);var c=t.getData(n);var _,g,p,y;for(var m=0;m<v;m++){g=c[m];_=d[m];y=f[m];p=h[m];if(_!==undefined&&g!==undefined){_m(p,g);gm(p,_);if(o){g=g%180;_=Qt(+_,-Om,Om)}l.set(y,g);u.set(y,_)}}};cm.prototype._onNodesAdded=function e(t){this._readNodesCoordinates(t);if(this._enabled){zm(this,t)}};cm.prototype._onNodesDragStart=function e(){if(this._enabled){this._nodeDragOffsetX=this._nodeDragOffsetY=0}};cm.prototype._onNodesDragged=function e(t){var r=t.nodes;var i=t.dx;var n=t.dy;if(this._enabled){var a=r.getAttributes(["x","y"]);var o=r.getGeoCoordinates();var s=[];var u=this._nodeDragOffsetX,l=this._nodeDragOffsetY;for(var f=0;f<r.size;f++){var h=a[f];var v=o[f];qm(h.x+i-u,h.y+n-l,s);v.latitude=s[0];v.longitude=s[1]}this._nodeDragOffsetX=i;this._nodeDragOffsetY=n;r.setGeoCoordinates(o)}};cm.prototype._onSettingsChanged=function e(t,r){if(this._enabled){if(t.tileUrlTemplate!==r.tileUrlTemplate){this._dom.clearTimeout(this._redrawTimer);xm(this);this._setViewFromCamera()}if(t.sizeRatio!==r.sizeRatio){this._updateSizes()}if(t.attribution!==r.attribution){this.setAttribution()}if(t.maxZoomLevel!==r.maxZoomLevel){this._settingsModule.update({minZoom:1,maxZoom:Math.pow(2,r.maxZoomLevel)})}}if(t.wrapCoordinates!==r.wrapCoordinates){this._readNodesCoordinates(this._graph.getNodes("all"))}if(t.latitudePath!==r.latitudePath||t.longitudePath!==r.longitudePath){this._readNodesCoordinates(this._graph.getNodes("all"))}};cm.prototype._nodeIsVisible=function e(t){var r=this._settings;var i=r.longitudePath;var n=r.latitudePath;var a=r.wrapCoordinates;var o=t.getData(i);var s=t.getData(n);if(o===undefined||s===undefined){return false}else if(a){return true}else{return Math.abs(s)<=Om&&Math.abs(o)<=180}};cm.prototype._transformToGeoSpace=function e(t,r){var i=r.X;var n=r.Y;var a=r.indexes;var o=this._graph;var s=this._camera;var u=o.getAttributes(true,["x","y","radius"]);var l=u[0];var f=u[1];var h=u[2];var v=l.getMultiple(a);var d=f.getMultiple(a);var c=h.getMultiple(a);var _=new vn({xValues:v,yValues:d,sizes:c});var g=new vn({xValues:i,yValues:n});var p=0;if(v.length===0||d.length===0){_.cx=_.cy=0;_.width=_.height=0}if(!isFinite(g.width)||!isFinite(g.height)){g.cx=g.cy=0;g.width=g.height=0}var y=g.cx-_.cx;var m=g.cy-_.cy;var x=1;if(v.length>1){x=Math.max(g.width,g.height)/Math.max(_.width,_.height)*nt()}p=cr(h.getMultiple(a));g.pad(p*x);var b=this._locate.computeConfigForBounds(g);b.zoom=Jm(b.zoom);var A=s.zoom/b.zoom;y+=(_.cx-s.x)*A;m+=(_.cy-s.y)*A;var w=_.cx+y;var E=_.cy+m;this._transformation=this._graphics.addAttributeLayer({priority:Kh,nodeAttributes:{radius:function(e){return e.getAttribute("radius")*A},x:function(e){return(e.getAttribute("x")+y-w)*A+w},y:function(e){return(e.getAttribute("y")+m-E)*A+E}},edgeAttributes:{width:function(e){return e.getAttribute("width")*A}}});this._scaleInfo={ratio:A,sizeRatio:x,dx:y,dy:m,tx:w,ty:E,zoom:s.zoom,x:s.x,y:s.y};this._scaleInfo.cameraConfig={zoom:s.zoom/A,x:(s.x+y-w)*A+w,y:(s.y+m-E)*A+E}};cm.prototype._show=function e(){var t=this;var r=this._dom.getContainer();var i=this._settings.duration;if(r){if(!this._initialized){this._initializeCanvas(r)}this._dom.setLayer("geo",this._rcanvas)}this._enableTime=R();this._enableMapBackground=false;this._filter=this._filters.addNodeFilter(function(e){return t._nodeIsVisible(e)});return this._filter.whenApplied().then(function(){var e=t._graph.getNodes("all");var r=t._graph.getEdges("all");t._offsetX.setMultiple(e._indexes,0);t._offsetY.setMultiple(e._indexes,0);t._graphics.hideTexts();var i=Dm(t,e);t._transformToGeoSpace(e,i);t._camera.setView(t._scaleInfo.cameraConfig);return{projected:i,nodes:e,edges:r,targetZoom:t._scaleInfo.cameraConfig.zoom}}).then(function(e){var r=e.nodes;zm(t,r);return t._graphics.animate(r,function(){t._projection=t._graphics.addAttributeLayer({priority:Kh,nodeAttributes:{radius:function(e){return e.getAttribute("radius")*t._settings.sizeRatio/(t._camera.zoom*t._scaleInfo.ratio)},x:function(e){var r=e.getData(t._settings.longitudePath);return r!==undefined?Vm*(Gm*(Rm*r*jm)+Xm):0},y:function(e){var r=e.getData(t._settings.latitudePath);var i=Math.max(Math.min(Om,r),-Om);var n=Math.sin(i*jm);return r!==undefined?Vm*(Wm*(Rm*Math.log((1+n)/(1-n))/2)+Ym):0}},edgeAttributes:{width:function(e){return e.getAttribute("width")*t._settings.sizeRatio/(t._camera.zoom*t._scaleInfo.ratio)}}});return t._projection},i)}).then(function(){t._transformation.destroy();t._scaleInfo.ratio=1;t._transformation=null;t._enableMapBackground=true;t.setAttribution();t._graphics.showTexts();var e=t._graphics.getGraphicsEngine().parseColor(t._settings.backgroundColor);e[3]=0;t._prevSettings=t._settingsModule.update({backgroundColor:rn(e),minZoom:1,maxZoom:Math.pow(2,t._settings.maxZoomLevel),"interactions.rotation.enabled":false,"interactions.zoom.minValue":function(){return 0},"interactions.zoom.maxValue":function(){return Math.pow(2,t._settings.maxZoomLevel)}});if(t._graph.getNodes().size===0){t.setCenter(0,0)}Am(t,t._settings.opacity,t._settings.backgroundColor)})};cm.prototype._transformToGraphSpace=function e(t,r){var i=t.getAttributes(["x","y","radius"]);var n=r.getAttribute("width");var a=t.getBoundingBox();var o=this._camera;var s=t.reduce(function(e,t,r){var i=t._index;return e[i]=r,e},{});var u=r.reduce(function(e,t,r){var i=t._index;return e[i]=r,e},{});this._projection.destroy();var l=t.getAttribute("x");var f=t.getAttribute("y");var h=t.getAttribute("radius");var v=new vn({xValues:l,yValues:f,sizeValues:h});var d=v.cx-a.cx;var c=v.cy-a.cy;var _=1;var g=this._locate.computeConfigForBounds(v);g.zoom=Jm(g.zoom);var p=this._camera.zoom/g.zoom;d+=(a.cx-o.x)*p;c+=(a.cy-o.y)*p;var y=a.cx+d;var m=a.cy+c;this._projection=this._graphics.addAttributeLayer({priority:Kh,nodeAttributes:{radius:function(e){return i[s[e._index]].radius*p},x:function(e){return(i[s[e._index]].x+d-y)*p+y},y:function(e){return(i[s[e._index]].y+c-m)*p+m}},edgeAttributes:{width:function(e){return n[u[e._index]]*p}}});this._scaleInfo={ratio:p,sizeRatio:_,dx:d,dy:c,tx:y,ty:m,zoom:o.zoom,x:o.x,y:o.y};this._scaleInfo.cameraConfig={zoom:o.zoom/p,x:(o.x+d-y)*p+y,y:(o.y+c-m)*p+m};this._camera.setView(this._scaleInfo.cameraConfig)};cm.prototype._hide=function e(){var t=this;var r=this._dom.getContainer();var i=this._settings.duration;var n=i/2;var a=O();var o=function(){var e=O();var r=(e-a)/n;if(r<1&&r>=0){Am(t,1-r,t._prevBgColor);t._dom.afterNextFrame().then(o)}};this._dom.clearTimeout(this._redrawTimer);if(n!==0){this._dom.afterNextFrame().then(o)}else{o()}var s=this._graph.getNodes("all");var u=this._graph.getEdges("all");this._transformToGraphSpace(s,u);this._graphics.hideTexts();return this._graphics.animate(s,function(){return t._projection.destroy()},i).then(function(){return t._filter.delete()}).then(function(){return t._dom.afterNextFrame()}).then(function(){return t._locate.locateGraph()}).then(function(){t._projection=null;t._graphics.refreshAll();t.setAttribution(null);t._graphics.showTexts()}).then(function(){if(r){t._dom.setLayer("geo",null)}xm(t)}).then(function(){return t._settingsModule.update(t._prevSettings)})};cm.prototype.enable=function e(t){return this.setEnabled(true,t)};cm.prototype.disable=function e(t){return this.setEnabled(false,t)};cm.prototype.isEnabled=function e(){return this._enabled};cm.prototype.toggle=function e(t){return this.setEnabled(!this._enabled,t)};cm.prototype.setOptions=function e(t){if(t===void 0)t={};dm(t);var r=this._settings;this._settings=te({},this._settings,om,t);this._onSettingsChanged(r,this._settings)};cm.prototype.setAttribution=function e(t){if(t===void 0)t=this._settings.attribution;if(!this._enabled){return}if(t===null){this._brand.remove()}if(t){this._brand.set(t)}else{this._brand.remove()}};cm.prototype.setEnabled=function e(value,t){var r=this;if(t===void 0)t={};this.setOptions(t);if(value!==this._enabled&&!this._transition){var i=this._settingsModule;var n=this._settings;this._enabled=value;this._transition=true;if(value){if(n.disableNodeDragging){this._nodeDraggingSetting=i.get("interactions.drag.enabled");i.update({interactions:{drag:{enabled:false}}})}else{i.update({interactions:{drag:{applyResult:false}}})}this._show().then(function(){r._transition=false;r._events.fire("geoEnabled");r._events.fire("geoReady")})}else{this._hide().then(function(){r._transition=false;r._events.fire("geoDisabled");if(n.disableNodeDragging){i.update({interactions:{drag:{enabled:r._nodeDraggingSetting}}})}else{i.update({interactions:{drag:{applyResult:true}}})}})}}return new Promise(function(e){if(r._transition){r._events.once(value?"geoEnabled":"geoDisabled",e)}else{e()}})};cm.prototype.resetCoordinates=function e(){if(!this._enabled){return}var t=this._graph.getNodes();Fm(this,t,"geo.prevLat",nm);Fm(this,t,"geo.prevLng",am)};cm.prototype.updateCoordinates=function e(){Pm(this,this._graph.getNodes())};cm.prototype._redrawNodes=function e(t,r){if(this._enabled){this._graphics.refreshAll()}return Promise.resolve(r)};cm.prototype._setView=function e(t,r,i){if(!this._enabled){return}this._lat=t;this._lng=r;this._zoom=i;Am(this)};cm.prototype._initializeCanvas=function e(t){var r=this;this._rcanvas=document.createElement("canvas");this._rctx=this._rcanvas.getContext("2d");this._canvas=document.createElement("canvas");this._ctx=this._canvas.getContext("2d");this._rcanvas.style.position="absolute";this._rcanvas.style.zIndex=+(t.style.zIndex||0)-1;this._rcanvas.className="ogma-geo-container";this._initialized=true;this._drawFromBuffer=function(){return r._rctx.drawImage(r._canvas,0,0)};this._resize()};cm.prototype.setView=function e(t,r,i){if(!this._enabled){throw new Error("Geo mode is not enabled")}$m(this,i);Km(t,r);this._setView(t,r,i);this._setCameraFromView()};cm.prototype.setCenter=function e(t,r){this.setView(t,r,this._zoom)};cm.prototype.setZoom=function e(t){this.setView(this._lat,this._lng,t)};cm.prototype.getView=function e(){return{latitude:this._lat,longitude:this._lng,zoom:this._zoom}};cm.prototype.getCenter=function e(){return{latitude:this._lat,longitude:this._lng}};cm.prototype.getZoom=function e(){return this._zoom};cm.prototype.exportBackground=function e(t,r){var i=this;r=r||this._camera.getView();return new Promise(function(e){var n=Math.log2(r.zoom);var a=qm(r.x,r.y);var o=a[0];var s=a[1];var u=r.pixelRatio||nt();i._tileSize=sm*u;if(!pm(i,t.getContext("2d"),t.width,t.height,n,o,s,false)){i._dom.setTimeout(function(){i.exportBackground(t,r).then(function(){i._tileSize=sm*nt()}).then(e)},lm)}else{i._tileSize=sm*nt();e()}})};cm.prototype.whenReady=function e(){var t=this;return new Promise(function(e){var r=function(){return t.whenReady().then(e)};if(t.isEnabled()){if(t._transition){t._events.once("geoReady",r)}else if(!bm(t)){t._dom.setTimeout(r,50)}else{e()}}else{t._events.once("geoEnabled",r)}})};function _m(e,t){if(isNaN(t)){throw new TypeError("node "+e+": "+t+" is not a valid longitude")}}function gm(e,t){if(isNaN(t)){throw new TypeError("node "+e+": "+t+" is not a valid latitude")}}function pm(e,t,r,i,n,a,o,s){t=t||e._ctx;var u=Math.ceil(n);var l=1/Math.pow(2,u-n);var f=e._settings.tileBuffer;var h=e._tileSize*l;var v=u;var d=nt();var c=e._camera.animationInProgress();if(e._settings.detectRetina){h/=d;v+=Math.log2(d);f*=d}r+=f*2*h;i+=f*2*h;var _=Zm(a,o,v);var g=_.x|0;var p=_.y|0;var y=r/2-(_.x-g)*h;var m=i/2-(_.y-p)*h;while(y>0){y-=h;g-=1}while(m>0){m-=h;p-=1}var x=true;y-=f*h;m-=f*h;var b=[];var A,w,E,S,C;for(A=y,w=g;A<r;A+=h,++w){for(E=m,S=p;E<i;E+=h,++S){b.push([w,S,A,E])}}e._tileBounds=[g-f,p-f,w+f,S+f];var T=g+(w-g)/2;var M=p+(S-p)/2;b.sort(function(e,t){return br(e[0],e[1],T,M)-br(t[0],t[1],T,M)});for(A=0,C=b.length;A<C;A++){var k=b[A];x&=Em(e,t,k[2],k[3],v,k[0],k[1],h,s,c)}e._dom.clearTimeout(e._pruneTimer);e._pruneTimer=e._dom.setTimeout(function(){return ym(e,v)},um);return x}function ym(e,t){var r={};var i=e._settings.tileBuffer;var n=e._tileBounds;var a,o,s,u,l,f;for(var h in e._tiles){var v=h.split("/");f=parseInt(v[0]);u=parseInt(v[1]);l=parseInt(v[2]);r[f]=r[f]||[];r[f].push([u,l])}var d=[];for(f in r){var c=parseInt(f);var _=Math.pow(2,c-t);var g=r[f];for(a=0,o=g.length;a<o;a++){s=g[a];u=s[0];l=s[1];if(u<n[0]*_-i||u>n[2]*_+i||l<n[1]*_-i||l>n[3]*_+i){d.push(Nm(c,s[0],s[1]))}}}mm(e,d);return d.length}function mm(e,t){for(var r=0,i=t.length;r<i;r++){var n=t[r];var a=e._tiles[n];if(a){if(!a.img.complete){hm--}if(a.img){Im(a.img)}}delete e._tiles[n]}}function xm(e){mm(e,Object.keys(e._tiles));e._tiles={}}function bm(e){var t=Object.keys(e._tiles);for(var r=0;r<t.length;r++){var i=e._tiles[t[r]];if(i&&!i.img.complete){return false}}return true}function Am(e,t,r){if(!e._enableMapBackground||!e._ctx){return}var i=e._ctx;var n=nt();var a=e._screen.width*n;var o=e._screen.height*n;i.fillStyle=r||e._settings.backgroundColor;i.fillRect(0,0,a,o);if(typeof t==="number"&&t!==e._opacity){e._opacity=t;e._rcanvas.style.opacity=t}if(!pm(e,e._ctx,a,o,e._zoom,e._lat,e._lng,true)){e._dom.clearTimeout(e._redrawTimer);e._redrawTimer=e._dom.setTimeout(function(){return Am(e,t,r)},fm)}else{e._events.fire("geoLoaded")}e._dom.afterNextFrame().then(e._drawFromBuffer)}function wm(e){return e instanceof Image}function Em(e,t,r,i,n,a,o,s,u,l){var f=Lm(e,n,a,o,true,l);if(wm(f)){t.drawImage(f,r,i,s,s);return true}else if(f===Sm.LOADING){if(u){var h;f=Lm(e,n-1,a/2|0,o/2|0,false,l);if(wm(f)){h=f.naturalWidth/2;var v=a&1?h:0;var d=o&1?h:0;t.drawImage(f,v,d,h,h,r,i,s,s)}else{var c=Lm(e,n+1,a*2,o*2,false,l);var _=Lm(e,n+1,a*2+1,o*2,false,l);var g=Lm(e,n+1,a*2,o*2+1,false,l);var p=Lm(e,n+1,a*2+1,o*2+1,false,l);if(wm(c)&&wm(_)&&wm(g)&&wm(p)){h=s/2;t.drawImage(c,r,i,h,h);t.drawImage(_,r+h,i,h,h);t.drawImage(g,r,i+h,h,h);t.drawImage(p,r+h,i+h,h,h)}}}return false}else{return true}}var Sm={INVALID:1,LOADING:2,MISSING:3};function Cm(e,t){var r=e._sIndex;if(t.length>0){r=(r+1)%t.length;e._sIndex=r;return r}return 0}function Tm(e,t,r,i){var n=e._settings.tileUrlSubdomains;var a=Cm(e,n);return e._settings.tileUrlTemplate.replace("{z}",i).replace("{x}",t).replace("{y}",r).replace("{s}",n.charAt(a))}function Mm(){hm--;this.error=true;Im(this)}function km(){hm--;Im(this)}function Im(e){e.onload=e.onerror=null}function Nm(e,t,r){return e+"/"+t+"/"+r}function Lm(e,t,r,i,n,a){var o=Math.pow(2,t)-1;if(t<0||r<0||r>o||i<0||i>o){return Sm.INVALID}var s=Nm(t,r,i);var u=e._tiles[s];if(!u){if(!n){return Sm.MISSING}else{if(!a&&hm<vm){var l=new Image;u={img:l,err:false,loaded:false};l.setAttribute("crossOrigin","anonymous");l.onerror=Mm;l.onload=km;l.src=Tm(e,r,i,t);hm++}e._tiles[s]=u;return Sm.LOADING}}else if(u.img.error){return Sm.MISSING}else if(!u.img.complete){return Sm.LOADING}else{return u.img}}function zm(e,t){Fm(e,t,nm,"geo.prevLat");Fm(e,t,am,"geo.prevLng")}function Dm(e,t){var r=e._graph.getAttributes(true,[nm,am]);var i=r[0];var n=r[1];var a=new Array(2),o,s,u;var l=t._indexes;var f=i.getMultiple(l);var h=n.getMultiple(l);var v=l.length;var d=[];var c=[];var _=[];for(var g=0,p=v;g<p;++g){u=l[g];o=f[g],s=h[g];if(e._nodeIsVisible(t.get(g))){Hm(o,s,a);c.push(a[0]);_.push(a[1]);d.push(u)}}return{X:c,Y:_,indexes:d}}function Pm(e,t){var r=e._graph.getAttributes(true,["x","y",nm,am]);var i=r[0];var n=r[1];var a=r[2];var o=r[3];var s=new Array(2),u,l,f;var h=t._indexes;var v=[],d=[],c=[];for(var _=0,g=h.length;_<g;_++){f=h[_];u=a.get(f);l=o.get(f);if(l!==undefined&&u!==undefined){qm(i.get(f),n.get(f),s);c.push(f);v.push(s[0]);d.push(s[1])}}a.setMultiple(c,v);o.setMultiple(c,d)}function Fm(e,t,r,i){Bm(e,true,t,r,i)}function Bm(e,t,r,i,n){var a=e._graph;var o=a.getAttribute(t,i);var s=a.getAttribute(t,n);var u=r._indexes;s.setMultiple(u,o.getMultiple(u))}var Rm=6378137;var Om=85.0511287798;var Vm=256;var jm=Math.PI/180;var Um=180/Math.PI;var Gm=.5/(Math.PI*Rm),Xm=.5,Wm=-Gm,Ym=.5;function Hm(e,t,r){if(r===void 0)r=[];var i=Math.max(Math.min(Om,e),-Om);var n=Math.max(Math.min(Math.sin(i*jm),.9999),-.9999);r[0]=Vm*(Gm*(Rm*t*jm)+Xm);r[1]=Vm*(Wm*(Rm*Math.log((1+n)/(1-n))/2)+Ym);return r}function qm(e,t,r){if(r===void 0)r=[];e=(e/Vm-Xm)/Gm;t=(t/Vm-Ym)/Wm;r[0]=(2*Math.atan(Math.exp(t/Rm))-Math.PI/2)*Um;r[1]=e*Um/Rm;return r}function Zm(e,t,r){var i=1<<r;e=e*jm;return{x:i*((t+180)/360),y:i*(1-Math.log(Math.tan(e)+1/Math.cos(e))/Math.PI)/2}}function $m(e,t){var r=e._settings.maxZoomLevel;if(typeof t!=="number"||!(t>=0&&t<=r)){throw new Error("invalid zoom value "+t+": expected value between 0 and "+r)}}function Km(e,t){if(typeof e!=="number"){throw new Error("invalid latitude "+e+": expected number")}if(typeof t!=="number"){throw new Error("invalid longitude "+t+": expected number")}}function Jm(e){return Math.pow(2,Math.floor(Math.log2(e)))}Ogma.extend(function(e){var t=new cm(e);var r=e.modules;var i=r.graph;e.modules.geo=t;e.geo={enable:function(e){return t.enable(e)},disable:function(e){return t.disable(e)},setOptions:function(e){return t.setOptions(e)},enabled:function(){return t.isEnabled()},getCenter:function(){return t.getCenter()},getView:function(){return t.getView()},getZoom:function(){return t.getZoom()},setZoom:function(e){return t.setZoom(e)},setView:function(e,r,i){return t.setView(e,r,i)},setCenter:function(e,r){return t.setCenter(e,r)},toggle:function(e){return t.toggle(e)},resetCoordinates:function(){return t.resetCoordinates()},updateCoordinates:function(){return t.updateCoordinates()}};i.Node.prototype.getGeoCoordinates=function(){return{latitude:i.getAttribute(true,nm).get(this._index),longitude:i.getAttribute(true,am).get(this._index)}};i.Node.prototype.setGeoCoordinates=function(e,t){var r=this;return this.toList().setGeoCoordinates([e],t).then(function(){return r})};i.NodeList.prototype.getGeoCoordinates=function(){var e=new Array(this._indexes.length);var t=i.getAttribute(true,nm).getMultiple(this._indexes);var r=i.getAttribute(true,am).getMultiple(this._indexes);for(var n=0,a=this._indexes.length;n<a;n++){e[n]={latitude:t[n],longitude:r[n]}}return e};i.NodeList.prototype.setGeoCoordinates=function(r,n){var a=this;var o=this.getId();var s=this._indexes;var u=new Array(s.length);var l=new Array(s.length);var f=t.isEnabled();var h=0;if(r===null){r=new Array(s.length).fill(null)}if(r.length!==s.length){throw new RangeError("You must provide coordinates for each node in the NodeList")}var v=this.isVisible();for(var d=0,c=s.length;d<c;d++){var _=r[d];var g=o[d];var p=void 0,y=void 0;var m=v[d];if(_===null||_.latitude===null&&_.longitude===null){p=y=undefined;n=0;if(m){h++}}else{p=_.latitude;y=_.longitude;gm(g,p);_m(g,y);if(f&&!m){h++}}u[d]=p;l[d]=y}this.setData(t._settings.latitudePath,u);this.setData(t._settings.longitudePath,l);i.getAttribute(true,nm).setMultiple(s,u);i.getAttribute(true,am).setMultiple(s,l);return t._redrawNodes(n,this).then(function(){return h===0?Promise.resolve(a):e.transformations.afterNextUpdate().then(function(){return a})})};e.events.onGeoModeEnabled=function(t){e.modules.events.on("geoEnabled",t);return e.events};e.events.onGeoModeDisabled=function(t){e.modules.events.on("geoDisabled",t);return e.events};e.events.onGeoModeLoaded=function(t){e.modules.events.on("geoLoaded",t);return e.events}});var Qm={strokeColor:"black",strokeWidth:5,dashed:true,cursorStyle:"cell",createNodes:true,condition:function(){return true},onNodeCreated:function(){},onEdgeCreated:function(){},onComplete:function(){}};Ogma.extend(function(e){var t=new ex(e);e.modules.connectNodes=t;e.tools.connectNodes={enable:function e(r){t.enable(r);return this},disable:function e(){t.disable();return this},enabled:function e(){return t.enabled()}};e.events.onNodesConnected=function(t){e.modules.events.on("connectedNodes",t);return e.events}});var ex=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._camera=t.modules.camera;this._captor=t.modules.captor;this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._interactions=t.modules.interactions;this._events=t.modules.events;this._settings=t.modules.settings;this._engine=this._graphics.getGraphicsEngine();this._block=this._engine.createBlock();this._depth=ph(0).edgeBody;this._enabled=false;this._options=null;this._blockId=null;this._startNode=null;this._startPos=null;this._endPos=null;this._cursorEnabled=false;this._events.register(["connectNodes"]);this._interaction=this._interactions.onDrag({priority:"connectNodes",check:function(e){var t=e.target;var i=e.button;if(i===void 0)i="left";return r._enabled&&i==="left"&&t&&t.isNode},onStart:function(e){var t=e.target;r._cursorEnabled=true;r._startNode=t;r._startPos=t.getPosition();r._graphics.addCursorStyle(r._options.cursorStyle);r._blockId=r._graphics.allocateGraphicsEngineBlockId()},onProgress:function(e){var t=e.x;var i=e.y;r._endPos=r._camera.screenToGraphCoordinates({x:t,y:i});r._drawLine()},onStop:function(){var e=r._options;var t=e.condition;var i=e.onNodeCreated;var n=e.onEdgeCreated;var a=e.onComplete;var o=r._captor.getPointedElement(),s=null,u=null;r._graphics.releaseGraphicsEngineBlockId(r._blockId);if(!o&&r._options.createNodes){o=r._ogma.addNode({attributes:{x:r._endPos.x,y:r._endPos.y}});u=o;if(i){i(u)}}if(o&&(u||!t||t(o))){s=r._ogma.addEdge({source:r._startNode,target:o});if(n){n(s)}}if(a){a({source:r._startNode,target:o,edge:s})}r.disable()}});this._events.on({clear:function(){return r.disable()}})};ex.prototype._drawLine=function e(){this._block.reset(Qs,false,this._depth);var t=this._block.nextAndReset(),r=t.end,i=jn(this._startPos,this._endPos);r.x=i.x;r.y=i.y;r.lengthScaled=i.length;r.angle=i.angle;r.angleAffectedByView=true;r.fillColor=this._options.strokeColor;r.thicknessAbsolute=this._options.strokeWidth;r.thicknessScaled=0;r.shape="line";if(this._options.dashed){r.dashLength=3;r.gapLength=1}this._engine.storeBlock(this._blockId,this._block);this._dom.refresh()};ex.prototype.enable=function e(t){if(this._enabled){return}this._options=os(t,Qm);this._enabled=true;this._cursorEnabled=false;this._prevSettings=this._settings.update({"cursor.node":this._options.cursorStyle,"detect.edges":false});if(this._captor.isLeftPressed()){this._interaction.start(this._captor.getCursorInformation())}return this};ex.prototype.disable=function e(){if(!this._enabled){return}this._enabled=false;this._settings.update(this._prevSettings);if(this._cursorEnabled){this._graphics.removeCursorStyle(this._options.cursorStyle)}};ex.prototype.enabled=function e(){return this._enabled};var tx=[{name:"color",isNode:true},{name:"shape",isNode:true},{name:"radius",isNode:true},{name:"icon.content",isNode:true},{name:"image.url",isNode:true},{name:"color",isNode:false},{name:"shape",isNode:false},{name:"width",isNode:false}];var rx=Math.PI;var ix=2*Math.PI;var nx=1.6;var ax=3;var ox=.9;var sx={position:"bottom",widgetWidth:130,fontFamily:"Arial",fontSize:10,fontColor:"black",titleFontSize:12,titleFontColor:"black",titleMaxLength:20,titleTextAlign:"left",shapeColor:"grey",backgroundColor:"white",borderColor:"black",borderRadius:0,borderWidth:1,innerMargin:10,outerMargin:5,circleStrokeWidth:3,titleFunction:function(e){return e[e.length-1]}};Ogma.extend(function(e){var t=new lx(e);e.modules.legend=t;e.tools.legend={enable:function e(r){return t.enable(r)},disable:function e(){return t.disable()},enabled:function e(){return t.enabled()}}});var ux=["widgetWidth","fontSize","titleFontSize","borderRadius","borderWidth","innerMargin","outerMargin","circleStrokeWidth"];var lx=function e(t){var r=this;this._ogma=t;this._graphics=t.modules.graphics;this._dom=t.modules.dom;this._settings=null;this._enabled=false;this._mustRefresh=false;this._canvas=it();this._ctx=this._canvas.getContext("2d");this._promises=[];t.modules.events.on({newFrame:function(){if(r._enabled&&r._mustRefresh){r._ctx.clearRect(0,0,r._canvas.width,r._canvas.height);r._drawOnCanvas(r._settings,r._canvas,nt());var e=r._promises;r._promises=[];e.forEach(function(e){return e()})}},"resize reloadFonts":function(){r._mustRefresh=true}})};lx.prototype.enable=function e(t){if(!this._enabled){this._enabled=true;this._mustRefresh=true;this._settings=t;this._graphics.addCanvas(this._canvas);return this._afterNextUpdate()}return Promise.resolve()};lx.prototype._afterNextUpdate=function e(){var t=this;return new Promise(function(e){return t._promises.push(e)})};lx.prototype._formatSettings=function e(t,r){var i=os(t,sx);ux.forEach(function(e){return i[e]*=r});return i};lx.prototype.disable=function e(){if(this._enabled){this._enabled=false;this._graphics.removeCanvas(this._canvas)}};lx.prototype.enabled=function e(){return this._enabled};lx.prototype.refresh=function e(){this._mustRefresh=true;this._dom.refresh();return this._afterNextUpdate()};lx.prototype.getCurrentOptions=function e(){return this._settings};lx.prototype._drawOnCanvas=function e(t,r,i){var n=this._formatSettings(t,i);var a=this._computeWidgetList(n);hx(n,r,a)};lx.prototype.exportOnCanvas=function e(t,r){return this._drawOnCanvas(r,t,1)};lx.prototype._computeWidgetList=function e(t){var r=this;var i=[];tx.forEach(function(e){var n=e.name;var a=e.isNode;var o=r._computeWidget(t,n,a);if(o){i.push(o)}});return i};lx.prototype._computeWidget=function e(t,r,i){var n=this._computePropertyMapping(t,r,i);if(n){if(r==="icon.content"){var a=this._getRulesForAttribute(i,"icon.font");var o=null;if(!a.length){o="Arial"}else if(typeof a[0]==="string"){o=a[0]}if(o){n.iconFont=o;return n}}else{return n}}return null};lx.prototype._computePropertyMapping=function e(t,r,i){var n=this._getRulesForAttribute(i,r);var a=n[0];var o=a&&a.mapping;var s=o&&o.getValues(i);if(o&&s){var u=o.getField();var l={};K(s,function(e,t){if(e===undefined||t==="undefined"){return}if(e in l){l[e].push(t)}else{l[e]=[t]}});if(Object.keys(l).length===0){return null}return{isNode:i,title:t.titleFunction(u),styleProperty:r,dataProperty:u,mapping:l,height:fx(l,r,i,t)}}else{return null}};lx.prototype._getRulesForAttribute=function e(t,r){return this._ogma.modules.styleRules.getRuleList().map(function(e){var i=e.getDefinition();var n=t?i.nodeAttributes:i.edgeAttributes;return ls(n,r)}).filter(function(e){return e})};function fx(e,t,r,i){var n=i.outerMargin+Fx(i);var a=i.fontSize*nx;var o=n-i.innerMargin*.8;if(t!=="radius"&&t!=="width"){o+=Object.keys(e).length*a}else{o+=a*(r?3:2)}return o}function hx(e,t,r){var i={width:t.width,height:t.height};var n=false;if(!i.width||!i.height||!r){return false}if(e.position==="top"||e.position==="bottom"){n=Lx(i,e,r,e.position==="bottom")}else{n=kx(i,e,r,e.position==="left")}if(n){r.forEach(function(r){return vx(e,t,r)})}return n}function vx(e,t,r){var i=t.getContext("2d");var n=r.x;var a=r.y;var o=r.height;var s=r.isNode;var u=r.styleProperty;var l=r.title;var f=r.mapping;var h=r.iconFont;gx(i,e,n,a,o);px(i,e,l,n,a);var v=e.fontSize*nx,d=e.fontSize/2*nx*ox,c=e.fontSize*ax,_=e.fontSize,g=_x(e,s),p=a+Fx(e),y=n+e.innerMargin+g/2,m=n+e.innerMargin*2+g,x=$(f),b=Bx(x),A=e.fontColor,w=e.shapeColor,E=Object.keys(f);if(b){E.sort(function(e,t){return _r(f[t])-_r(f[e])})}if(u!=="radius"&&u!=="width"){E.forEach(function(t){var r=f[t];if(u==="color"){if(s){mx(i,y,p,d,t)}else{xx(i,y,p,c,_,t)}}else if(u==="shape"){if(s){Ex(i,y,p,d,t,w)}else{Cx(i,y,p,c,_,t,w)}}else if(u==="icon.content"){bx(i,y,p,t,h,d,A)}else if(u==="image.url"){Ax(i,y,p,d,t)}yx(i,e,m,p,r,b);p+=v})}else if(b){var S=Rx(x),C=Ox(x),T=(S+C)/2;if(S%2===0||C%2===0){T=Math.round(T)}if(s){var M=e.fontSize*.7,k=M*3,I=(M+k)/2,N=n+e.innerMargin+k,L=N+k+e.innerMargin,z=p+k*2-e.innerMargin*.5,D=e.circleStrokeWidth;dx(i,N,z-M,M,w,D);dx(i,N,z-I,I,w,D);dx(i,N,z-k,k,w,D);cx(i,e.fontFamily,e.fontSize,e.fontColor,"left");i.fillText(Vx(S),L,z+M-M*2);i.fillText(Vx(T),L,z+M-I*2);i.fillText(Vx(C),L,z+M-k*2)}else{var P=(e.widgetWidth-2*e.innerMargin)/3,F=e.fontSize,B=p-e.innerMargin/2,R=B+F*2,O=n+e.innerMargin;i.fillStyle=w;i.fillRect(O,B-F/2,P+1,F);i.fillRect(O+P,B-F/3,P+1,F/1.5);i.fillRect(O+P*2,B-F/6,P,F/3);cx(i,e.fontFamily,e.fontSize,e.fontColor,"center");i.fillText(Vx(C),O+P*.5,R);i.fillText(Vx(T),O+P*1.5,R);i.fillText(Vx(S),O+P*2.5,R)}}}function dx(e,t,r,i,n,a){e.beginPath();e.arc(t,r,i,0,ix);e.strokeStyle=n;e.lineWidth=a;e.stroke()}function cx(e,t,r,i,n,a){if(n===void 0)n="left";if(a===void 0)a="middle";e.textAlign=n;e.textBaseline=a;e.fillStyle=i;e.font=r+'px "'+t+'"'}function _x(e,t){return t?e.fontSize:e.fontSize*ax}function gx(e,t,r,i,n){Tx(e,r,i,t.widgetWidth,n,t.borderRadius,t.backgroundColor,t.borderColor,t.borderWidth)}function px(e,t,r,i,n){cx(e,t.fontFamily,t.titleFontSize,t.titleFontColor,t.titleTextAlign);var a=t.titleTextAlign==="center",o=t.widgetWidth-t.innerMargin*2,s=e.measureText(r).width,u=i+(a?t.widgetWidth/2:t.innerMargin),l=n+t.titleFontSize/2+t.innerMargin;if(s>o){var f=o/s,h=(r.length*f|0)-2;r=r.substr(0,h)+""}e.fillText(r,u,l)}function yx(e,t,r,i,n,a){var o;if(a){if(n.length===1){o=Vx(n[0])}else{var s=_r(n),u=cr(n);o=Vx(s)+" - "+Vx(u)}}else{o=n.join()}cx(e,t.fontFamily,t.fontSize,t.fontColor);e.fillText(o,r,i)}function mx(e,t,r,i,n){e.beginPath();e.arc(t,r,i,0,2*rx);e.fillStyle=n;e.fill()}function xx(e,t,r,i,n,a){e.fillStyle=a;e.fillRect(t-i/2,r-n/2,i,n)}function bx(e,t,r,i,n,a,o){cx(e,n,a*2,o,"center");e.fillText(i,t,r)}function Ax(e,t,r,i,n){if(!e._imgStore){e._imgStore={}}var a=e._imgStore[n];if(!a){a=new Image;a.src=n;a.onload=function(){e.drawImage(a,t-i,r-i,i*2,i*2)};e._imgStore[n]=a}else{e.drawImage(a,t-i,r-i,i*2,i*2)}}var wx=.31;function Ex(e,t,r,i,n,a){e.fillStyle=a;if(n==="circle"){mx(e,t,r,i,a)}else if(n==="square"){e.fillRect(t-i,r-i,i*2,i*2)}else if(n==="cross"){e.fillRect(t-i,r-i*wx,i*2,i*2*wx);e.fillRect(t-i*wx,r-i,i*2*wx,i*2)}else if(n==="diamond"){e.beginPath();e.moveTo(t-i,r);e.lineTo(t,r-i);e.lineTo(t+i,r);e.lineTo(t,r+i);e.fill()}else if(n==="equilateral"){e.beginPath();e.moveTo(t,r-i);e.lineTo(t+Math.cos(rx/2-ix/5)*i,r+Math.sin(-rx/2+ix/5)*i);e.lineTo(t+Math.cos(rx/2-ix/5*2)*i,r+Math.sin(-rx/2+ix/5*2)*i);e.lineTo(t+Math.cos(rx/2-ix/5*3)*i,r+Math.sin(-rx/2+ix/5*3)*i);e.lineTo(t+Math.cos(rx/2-ix/5*4)*i,r+Math.sin(-rx/2+ix/5*4)*i);e.fill()}else if(n==="star"){e.beginPath();e.moveTo(t,r-i);e.lineTo(t+Math.cos(rx/2-ix/5*2)*i,r+Math.sin(-rx/2+ix/5*2)*i);e.lineTo(t+Math.cos(rx/2-ix/5*4)*i,r+Math.sin(-rx/2+ix/5*4)*i);e.lineTo(t+Math.cos(rx/2-ix/5)*i,r+Math.sin(-rx/2+ix/5)*i);e.lineTo(t+Math.cos(rx/2-ix/5*3)*i,r+Math.sin(-rx/2+ix/5*3)*i);e.fill()}}var Sx=1/3;function Cx(e,t,r,i,n,a,o){e.fillStyle=o;if(a==="line"){e.fillRect(t-i/2,r-n/4,i,n/2)}else if(a==="arrow"){e.fillRect(t-i/2,r-n/4,i*(1-Sx),n/2);e.beginPath();e.moveTo(t+i*(1-Sx-.5),r-n/2);e.lineTo(t+i*(1-Sx-.5),r+n/2);e.lineTo(t+i/2,r);e.fill()}else if(a==="dashed"||a==="dotted"){e.beginPath();e.moveTo(t-i/2,r);e.lineTo(t+i/2,r);e.strokeStyle=o;e.lineWidth=n/2;e.setLineDash(a==="dashed"?[8,3]:[3,3]);e.stroke()}else if(a==="tapered"){e.beginPath();e.moveTo(t-i/2,r-n/2);e.lineTo(t-i/2,r+n/2);e.lineTo(t+i/2,r);e.fill()}}function Tx(e,t,r,i,n,a,o,s,u){e.setLineDash([]);e.beginPath();e.moveTo(t+a,r);e.lineTo(t+i-a,r);e.quadraticCurveTo(t+i,r,t+i,r+a);e.lineTo(t+i,r+n-a);e.quadraticCurveTo(t+i,r+n,t+i-a,r+n);e.lineTo(t+a,r+n);e.quadraticCurveTo(t,r+n,t,r+n-a);e.lineTo(t,r+a);e.quadraticCurveTo(t,r,t+a,r);e.closePath();e.fillStyle=o;e.fill();e.strokeStyle=s;e.lineWidth=u;e.stroke()}function Mx(e,t){if(e.isNode!==t.isNode){return e.isNode?e:t}else{return e.title<=t.title?-1:1}}function kx(e,t,r,i){var n=t.widgetWidth+t.outerMargin,a=Math.floor((e.width-t.outerMargin)/n),o=e.height,s=t.outerMargin,u=i?t.outerMargin:e.width-n,l=1;r=r.slice().sort(Mx);for(var f=0;f<r.length;++f){var h=r[f];if(s+h.height>o){if(s===t.outerMargin){return false}else{s=t.outerMargin;l+=1;if(i){u+=n}else{u-=n}}}h.x=u;h.y=s;s+=h.height}return l<=a}function Ix(e,t,r){var i=null;for(var n=0;n<t.length;++n){var a=t[n];if((a.isNode===e.isNode||t.length===1)&&(i===null||a.height<t[i].height)){i=n}}a=t[i];a.content.push(e);a.height+=e.height+r.outerMargin}function Nx(e){var t=0;for(var r=1;r<e.length;++r){if(e[r].height>e[t].height){t=r}}return t}function Lx(e,t,r,i){r=r.slice();var n=t.widgetWidth+t.outerMargin,a=Math.floor((e.width-t.outerMargin)/n),o=e.height-t.outerMargin,s=new Array(Math.min(a,r.length)),u=r.length,l=0,f=0,h=0,v=0;for(var d=0;d<u;++d){var c=r[d];if(c.isNode){l+=1;f+=c.height}else{h+=1;v+=c.height}}var _=f+v,g=f/_,p=v/_,y=Math.round(g*a),m=Math.round(p*a);if(y>l){y=l}else if(m>h){y=a-h}if(a===0){return false}for(var x=0;x<s.length;++x){s[x]={content:[],height:0,isNode:x<y}}for(x=0;x<u;++x){var b=Nx(r);Ix(r[b],s,t);r.splice(b,1)}if(s.every(function(e){var t=e.content;return t.length===1})){s.sort(Px)}else{s.sort(Dx)}var A=t.outerMargin;for(x=0;x<s.length;++x){var w=s[x];if(w.height>o){return false}w.content.sort(zx);var E=0;for(var S=0;S<w.content.length;++S){var C=w.content[S];C.x=A;C.y=i?e.height-E-C.height-t.outerMargin:E+t.outerMargin;E+=C.height+t.outerMargin}A+=n}return true}function zx(e,t){return e.height-t.height}function Dx(e,t){if(e.isNode!==t.isNode){return e.isNode?e:t}else{return t.height-e.height}}function Px(e,t){if(e.isNode!==t.isNode){return e.isNode?e:t}else{return e.content[0].title<=t.content[0].title?-1:1}}function Fx(e){return e.innerMargin+(e.titleFontSize+e.fontSize)*nx}function Bx(e){if(H(e)){return e.reduce(function(e,t){return e&&Bx(t)},true)}else{return e==="undefined"||!isNaN(+e)}}function Rx(e){if(H(e)){return e.reduce(function(e,t){return Math.min(e,Rx(t))},Infinity)}else{return isNaN(e)?Infinity:+e}}function Ox(e){if(H(e)){return e.reduce(function(e,t){return Math.max(e,Ox(t))},-Infinity)}else{return isNaN(e)?-Infinity:+e}}function Vx(e,t){e=+e;var r=["K","M","B","T","P","E","Z","Y"];if(e>9999){var i=0;while(i<r.length&&e>999){e/=1e3;++i}return jx(e)+r[i-1]}else if(t){return Math.round(e).toString()}else if(e<10){return(Math.round(e*1e3)/1e3).toString()}else if(e<100){return(Math.round(e*100)/100).toString()}else if(e<1e3){return(Math.round(e*10)/10).toString()}else{return Math.round(e).toString()}}function jx(e){if(e<10){return Math.round(e*100)/100}else if(e<100){return Math.round(e*10)/10}else if(e<1e3){return Math.round(e)}}var Ux={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:function(e){var t=e.nodes;return t.setSelected(true)}};Ogma.extend(function(e){var t=new Gx(e);e.modules.lasso=t;e.tools.lasso={enable:function(e){return t.enable(e)},disable:function(){return t.disable()},enabled:function(){return t.enabled()}}});var Gx=function e(t){var r=this;this._ogma=t;this._graphics=t.modules.graphics;this._graph=t.modules.graph;this._selection=t.modules.selection;this._captor=t.modules.captor;this._render=t.modules.render;this._interactions=t.modules.interactions;this._spatial=t.modules.spatial;this._options=ne(Ux);this._enabled=false;this._points=[];this._bbox=new vn;this._canvas=it();this._ctx=this._canvas.getContext("2d");this._interaction=this._interactions.onDrag({priority:"lasso",check:function(){return r._enabled},onStart:function(e){var t=e.x;var i=e.y;r._bbox.reset();Wx(r,t,i,false)},onProgress:function(e){var t=e.x;var i=e.y;return Wx(r,t,i,true)},onStop:function(){var e=r._bbox;var t=e.minX;var i=e.minY;var n=e.maxX;var a=e.maxY;var o=r._spatial.queryProjected(t,i,n,a);var s=o.nodes;var u=s.filter(function(e){return e.getAttribute("detectable")&&Xx(e.getPositionOnScreen(),r._points)});r._ctx.clearRect(0,0,r._canvas.width,r._canvas.height);r._points=[];r.disable();r._options.callback({nodes:u})}})};Gx.prototype.enable=function e(t){if(this._enabled){return}this._enabled=true;this._prevDetect=this._captor.setDetectionEnabled(false);this._options=os(t,Ux);this._graphics.addCanvas(this._canvas);xt(this._canvas,this._options.cursorStyle);if(this._captor.isLeftPressed()){this._interaction.start(this._captor.getCursorPosition())}};Gx.prototype.disable=function e(){if(!this._enabled){return}this._enabled=false;this._captor.setDetectionEnabled(this._prevDetect);this._graphics.removeCanvas(this._canvas)};Gx.prototype.enabled=function e(){return this._enabled};function Xx(e,t){return qn(e.x,e.y,t)}function Wx(e,t,r,i){var n=nt();var a=e._ctx;var o=e._options;var s=e._points;e._bbox.addPoint(t,r);a.clearRect(0,0,e._canvas.width,e._canvas.height);s.push({x:t,y:r});if(i){var u=s[0];a.lineWidth=o.strokeWidth;a.lineJoin="bevel";a.strokeStyle=o.strokeColor;a.fillStyle=o.fillColor;a.beginPath();a.moveTo(u.x*n,u.y*n);for(var l=1;l<s.length;++l){var f=s[l];a.lineTo(f.x*n,f.y*n)}a.stroke();if(o.fillColor){a.fill()}}}var Yx={strokeColor:"#00C3FF",fillColor:"rgba(0,195,255,0.1)",strokeWidth:1,cursorStyle:"cell",callback:function(e){var t=e.nodes;var r=e.edges;t.setSelected(true);r.setSelected(true)}};Ogma.extend(function(e){var t=new Hx(e);e.modules.rectangleSelect=t;e.tools.rectangleSelect={enable:function(e){return t.enable(e)},disable:function(){return t.disable()},enabled:function(){return t.enabled()}}});var Hx=function e(t){var r=this;this._ogma=t;this._graph=t.modules.graph;this._selection=t.modules.selection;this._camera=t.modules.camera;this._dom=t.modules.dom;this._graphics=t.modules.graphics;this._interactions=t.modules.interactions;this._keyboard=t.modules.keyboard;this._captor=t.modules.captor;this._spatial=t.modules.spatial;this._options=ne(Yx);this._canvas=it();this._ctx=this._canvas.getContext("2d");this._enabled=false;this._start=null;this._rectangle=new vn;this._interaction=this._interactions.onDrag({priority:"lasso",disableDetection:true,check:function(){return r._enabled},onStart:function(e){var t=e.x;var i=e.y;r._rectangle.reset();r._start={x:t,y:i};r._ctx.fillStyle=r._options.fillColor;r._ctx.strokeStyle=r._options.strokeColor;r._ctx.lineWidth=r._options.strokeWidth},onProgress:function(e){var t=e.x;var i=e.y;return r._refreshRectangle({x:t,y:i})},onStop:function(){var e=r._ogma;var t=r._captor.getCursorPosition();var i=r._formatRectangle(t);var n=r._spatial.queryProjected(i.minX,i.minY,i.maxX,i.maxY);var a=n.nodes;var o=n.edges;var s=a.filter(function(e){return e.getAttribute("detectable")&&r._camera.isNodeInRectangle(e,i)});var u=s.size?e.createEdgeList():o.filter(function(e){return e.getAttribute("detectable")&&r._camera.isEdgeInRectangle(e,i)});r._clearCanvas();r.disable();r._options.callback({nodes:s,edges:u})}})};Hx.prototype.enable=function e(t){if(this._enabled){return}this._enabled=true;this._options=os(t,Yx);this._graphics.addCanvas(this._canvas);xt(this._canvas,this._options.cursorStyle);if(this._captor.isLeftPressed()){this._interaction.start(this._captor.getCursorPosition())}};Hx.prototype.disable=function e(){if(!this._enabled){return}this._enabled=false;this._graphics.removeCanvas(this._canvas)};Hx.prototype.enabled=function e(){return this._enabled};Hx.prototype._clearCanvas=function e(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)};Hx.prototype._formatRectangle=function e(t){var r=this._start.x;var i=this._start.y;var n=t.x;var a=t.y;var o=Math.abs(r-n);var s=Math.abs(i-a);var u=r<n?r:n;var l=i<a?i:a;return this._rectangle.reset().addPoint(u,l).addPoint(u+o,l+s)};Hx.prototype._refreshRectangle=function e(t){var r=this._formatRectangle(t);var i=r.minX;var n=r.minY;var a=r.width;var o=r.height;var s=nt();this._clearCanvas();this._ctx.strokeRect(i*s,n*s,a*s,o*s);if(this._options.fillColor){this._ctx.fillRect(i*s,n*s,a*s,o*s)}};var qx={cursor:"nesw-resize",color:"#00C3FF",lineWidth:1,handleSize:6,detectionMargin:5,snappingRatio:1.25,nbNodesToSnapTo:5,previewColor:"rgba(0, 0, 0, 0.2)",sizeIndicatorColor:"black",sizeIndicatorOffset:5,sizeIndicatorWidth:3,sizeIndicatorThickness:1};Ogma.extend(function(e){var t=new Zx(e);e.modules.resizing=t;e.tools.resize={enable:function e(r){return t.enable(r)},disable:function e(){return t.disable()},enabled:function e(){return t.enabled()}}});var Zx=function e(t){var r=this;this._dom=t.modules.dom;this._interactions=t.modules.interactions;this._events=t.modules.events;this._camera=t.modules.camera;this._dom=t.modules.dom;this._spatial=t.modules.spatial;this._graphics=t.modules.graphics;this._engine=this._graphics.getGraphicsEngine();this._canvas=it();this._init();this._interactions.onDrag({priority:"resizing",disableDetection:true,check:function(){return r._enabled&&r._pointedNode},onStart:function(e){var t=e.x;var i=e.y;r._x=t;r._y=i;r._nodeBeingResized=r._pointedNode},onProgress:function(e){var t=e.x;var i=e.y;r._x=t;r._y=i;r._displayHandles()},onStop:function(){r._nodesToHighlight.forEach(function(e,t){var i=r._additionalRadiuses[t]/r._camera.zoom;e.setAttributes({radius:e.getAttribute("radius")+i,x:e.getPosition().x+i,y:e.getPosition().y-i})});r._pointedNode=null;r._nodeBeingResized=null;r._displayHandles()}});this._onSelectionChange=function(){if(!r._enabled){return}r._nodesToHighlight=t.getSelectedNodes();r._displayHandles()};this._events.on({"cameraMove progressMoveNodesByDragging":function(){return r._displayHandles()},"move down":function(e){var t=e.x;var i=e.y;return r._detectBoundingBoxes(t,i)}});t.events.onNodesSelected(this._onSelectionChange);t.events.onNodesUnselected(this._onSelectionChange)};Zx.prototype._init=function e(){this._enabled=false;this._nodesToHighlight=null;this._options=null;this._nodeBeingResized=null;this._pointedNode=null;this._cursorEnabled=false;this._x=0;this._y=0;this._additionalRadiuses=[]};Zx.prototype._enableCursor=function e(){if(!this._cursorEnabled){this._graphics.addCursorStyle(this._options.cursor);this._cursorEnabled=true}};Zx.prototype._disableCursor=function e(){if(this._cursorEnabled){this._graphics.removeCursorStyle(this._options.cursor);this._cursorEnabled=false}};Zx.prototype._detectBoundingBoxes=function e(t,r){var i=this;if(!this._enabled||this._nodeBeingResized||!this._nodesToHighlight){return}var n=this._options.handleSize,a=this._options.detectionMargin;this._pointedNode=null;this._forEachNodeToHighlight(function(e,o,s){var u=o.x+s-n/2-a,l=o.x+s+n/2+a,f=o.y-s-n/2-a,h=o.y-s+n/2+a;if(t>=u&&t<=l&&r>=f&&r<=h){i._pointedNode=e}});if(this._pointedNode){this._enableCursor()}else{this._disableCursor()}};Zx.prototype._forEachNodeToHighlight=function e(t){var r=this;this._nodesToHighlight.forEach(function(e){var i=e.getPositionOnScreen(),n=r._getTotalOnScreenRadius(e);t(e,i,n)})};Zx.prototype._displayHandles=function e(){var t=this;if(!this._enabled||!this._nodesToHighlight){return}var r=this._canvas,i=r.getContext("2d"),n=r.width,a=r.height,o=nt();var s=this._options;var u=s.color;var l=s.lineWidth;var f=s.handleSize;var h=0;i.clearRect(0,0,n,a);if(this._nodeBeingResized){var v=this._getTotalOnScreenRadius(this._nodeBeingResized),d=this._nodeBeingResized.getPositionOnScreen();h=Math.max(this._x-(d.x+v),-(this._y-(d.y-v)))/2}this._additionalRadiuses=[];this._forEachNodeToHighlight(function(e,r,n){var a=0;if(t._nodeBeingResized){a=h;var s=-n+e.getAttribute("innerStroke.width")+e.getAttribute("outerStroke.width")+l/2+1;if(a<s){a=s}else{a=t._snap(e,a)}t._additionalRadiuses.push(a);var v=e.getAttribute("shape"),d=t._engine.getShapePoints(v),c=r.x+a,_=r.y-a,g=n+a;t._displayNodePreview(i,o,c,_,g,d)}i.strokeStyle=u;i.fillStyle=u;i.lineWidth=l;i.strokeRect((r.x-n)*o,(r.y-n-a*2)*o,(a+n)*2*o,(a+n)*2*o);i.fillRect((r.x+n+a*2-f/2)*o,(r.y-n-a*2-f/2)*o,f*o,f*o)})};Zx.prototype._displayNodePreview=function e(t,r,i,n,a,o){i*=r;n*=r;a*=r;t.beginPath();if(o.length===1){t.arc(i,n,a,0,Math.PI*2)}else{for(var s=0;s<o.length;++s){var u=o[s],l=i+u.x*a,f=n+u.y*a;if(s===0){t.moveTo(l,f)}else{t.lineTo(l,f)}}}t.fillStyle=this._options.previewColor;t.fill()};Zx.prototype._getTotalOnScreenRadius=function e(t){return t.getAttribute("radius")*this._camera.zoom+t.getAttribute("innerStroke.width")+t.getAttribute("outerStroke.width")+this._options.lineWidth/2};Zx.prototype._snap=function e(t,r){var i=this;var n=this._spatial.getNodesInScreenByDistance(t).filter(function(e){return!e.isSelected()}).slice(0,this._options.nbNodesToSnapTo),a=this._canvas.getContext("2d"),o=this._getTotalOnScreenRadius(t),s=o+r,u=this._options.snappingRatio,l=s/o,f=Math.round($x(l,u)),h=Math.pow(u,f),v=o*h,d=null;n.forEach(function(e){var t=i._getTotalOnScreenRadius(e);if(Math.abs(t-s)<=Math.abs(v-s)){v=t;d=e}});if(d){a.save();a.strokeStyle=this._options.sizeIndicatorColor;a.lineWidth=this._options.sizeIndicatorThickness;var c=d.getAttribute("radius");this._displaySizeIndicator(t,v);n.filter(function(e){return e.getAttribute("radius")===c}).forEach(function(e){return i._displaySizeIndicator(e)});a.restore()}return v-o};Zx.prototype._displaySizeIndicator=function e(t,r){var i=this._canvas.getContext("2d"),n=nt(),a=t.getPositionOnScreen(),o=this._getTotalOnScreenRadius(t),s=r||o,u=r?r-o:0,l=u-this._options.sizeIndicatorOffset-(r?t.getAttribute("innerStroke.width")+t.getAttribute("outerStroke.width"):0),f=a.x-s+l|0,h=a.y-s-u|0,v=a.y+s-u|0,d=this._options.sizeIndicatorWidth;i.beginPath();i.moveTo((f-d)*n,h*n);i.lineTo((f+d)*n,h*n);i.moveTo(f*n,h*n);i.lineTo(f*n,v*n);i.moveTo((f-d)*n,v*n);i.lineTo((f+d)*n,v*n);i.stroke()};Zx.prototype.enable=function e(t){if(this._enabled){return}this._options=os(t,qx);this._graphics.addCanvas(this._canvas);this._enabled=true};Zx.prototype.disable=function e(){if(!this._enabled){return}this._graphics.removeCanvas(this._canvas);this._disableCursor();this._init()};Zx.prototype.enabled=function e(){return this._enabled};function $x(e,t){return Math.log(e)/Math.log(t)}var Kx={color:"#00C3FF",radius:7,cursorOnHover:"grab",cursorOnDrag:"grabbing"};var Jx=function e(t){var r=this;this._ogma=t;this._dom=t.modules.dom;this._captor=t.modules.captor;this._mouse=t.modules.mouse;this._graph=t.modules.graph;this._camera=t.modules.camera;this._graphics=t.modules.graphics;this._selection=t.modules.selection;this._events=t.modules.events;this._settings=t.modules.settings;this._interactions=t.modules.interactions;this._rewirableClass=t.styles.createClass({name:iv,isBuiltin:true,edgeAttributes:{layer:fv}});this._enabled=false;this._canvas=it();this._ctx=this._canvas.getContext("2d");this._nodesToHighlight=null;this._movedEdges=null;this._startNode=null;this._cursorOnHoverEnabled=false;this._prevSettings=null;this._x=0;this._y=0;this._interaction=this._interactions.onDrag({priority:"rewiring",check:function(e){var t=e.x;var i=e.y;var n=e.target;if(!r._enabled||!n||!n.isNode||!ab(r,n,t,i)){return false}var a=n.getAdjacentEdges().filter(function(e){return e.isSelected()});if(a.size){r._movedEdges=a;r._edgeColors=r._movedEdges.getAttribute("color");r._startNode=n;return true}else{return false}},onStart:function(){r._nodesToHighlight=r._nodesToHighlight.filter(function(e){return e!==r._startNode});nb(r,true);var e=r._options.cursorOnDrag;r._prevSettings=r._settings.update({edgeHover:false,cursor:{default:e,node:e,edge:e}})},onProgress:function(e){var t=e.x;var i=e.y;r._x=t;r._y=i},onStop:function(){Qx(r);var e=ib(r);if(e){r._movedEdges.forEach(function(t){if(t.getTarget()===r._startNode){t.setTarget(e)}else{t.setSource(e)}})}nb(r,false);r._movedEdges.setSelected(true);r._movedEdges=null;r._refreshHandles(r)}});this._refreshHandles=function(){if(!r._enabled||r._movedEdges){return}var e=r._ogma.getSelectedEdges();r._nodesToHighlight=e.getExtremities().dedupe();r._rewirableClass.clearEdges();r._rewirableClass.add(e);sb(r)};this._refreshCanvas=function(){return sb(r)};this._events.on({cameraMove:this._refreshCanvas,mouseMove:this._refreshCanvas,progressMoveNodesByDragging:this._refreshCanvas});t.events.onEdgesSelected(this._refreshHandles);t.events.onEdgesUnselected(this._refreshHandles)};Jx.prototype.enable=function e(t){if(this._enabled){return}this._options=os(t,Kx);this._enabled=true;this._graphics.addCanvas(this._canvas);this._refreshHandles()};Jx.prototype.disable=function e(){if(!this._enabled){return}this._interaction.stop();this._graphics.removeCursorStyle(this._options.cursorOnDrag);eb(this);Qx(this);this._graphics.removeCanvas(this._canvas);this._rewirableClass.clearEdges();this._enabled=false};Jx.prototype.enabled=function e(){return this._enabled};function Qx(e){if(e._prevSettings){e._settings.update(e._prevSettings);e._prevSettings=null}}function eb(e){if(e._cursorOnHoverEnabled){e._cursorOnHoverEnabled=false;e._graphics.removeCursorStyle(e._options.cursorOnHover)}}function tb(e){if(!e._cursorOnHoverEnabled){e._cursorOnHoverEnabled=true;e._graphics.addCursorStyle(e._options.cursorOnHover)}}function rb(e){if(!e._movedEdges){return}var t=e._x;var r=e._y;var i=e._ctx;var n=nt();var a={x:t,y:r};var o=e._camera.getZoom();var s=e._movedEdges;s.forEach(function(t,r){var s=e._edgeColors[r];var u=t.getSource();var l=t.getTarget();var f=ib(e);var h=l===e._startNode?u:l;var v=t.getAttribute("width")*o;var d=h.getPositionOnScreen();var c=f?f.getPositionOnScreen():a;h.addClass(tv);i.beginPath();i.moveTo(d.x*n,d.y*n);i.lineTo(c.x*n,c.y*n);i.strokeStyle=s;i.lineWidth=v*n;i.stroke()})}function ib(e){var t=e._captor.getPointedElement();return t&&t.isNode?t:null}function nb(e,value){e._movedEdges.setExcluded(value)}function ab(e,t,r,i){var n=e._camera.graphToScreenCoordinates(t.getPosition());return t.getAttribute("radius")*e._camera.zoom>e._options.radius&&distance(n.x,n.y,r,i)<e._options.radius}function ob(e){e._canvas.getContext("2d").clearRect(0,0,e._canvas.width,e._canvas.height)}function sb(e){if(!e._enabled||!e._nodesToHighlight){return}var t={x:e._mouse.x,y:e._mouse.y},r=ib(e),i=e._camera.zoom,n=e._canvas.getContext("2d"),a=nt(),o=e._nodesToHighlight;var s=e._options;var u=s.color;var l=s.radius;var f=o.getPosition().map(function(t){return e._camera.graphToScreenCoordinates(t)});ob(e);rb(e);n.fillStyle=u;n.strokeStyle=u;var h=false;f.forEach(function(e,r){var s=e.x;var u=e.y;if(o.get(r).getAttribute("radius")*i>l){n.fillRect((s-l)*a,(u-l)*a,l*a*2,l*a*2);if(distance(s,u,t.x,t.y)<l){h=true}}});if(e._movedEdges){var v=t;if(r){v=e._camera.graphToScreenCoordinates(r.getPosition())}n.fillRect((v.x-l)*a,(v.y-l)*a,l*a*2,l*a*2)}if(h){tb(e)}else{eb(e)}}Ogma.extend(function(e){var t=new Jx(e);e.modules.rewiring=t;e.tools.rewire={enable:function e(r){return t.enable(r)},disable:function e(){return t.disable()},enabled:function e(){return t.enabled()}}});var ub={tolerance:5,centerSnapDistance:240,sideSnapDistanceFactor:3,guidelineWidth:1,guidelineColor:"#ff0000",preferredDistance:{enabled:true,ratio:1.13,tolerance:10,lineColor:"#00C3FF",lineWidth:1},neighbours:{enabled:true,offset:5,tolerance:3,lineColor:"#00C3FF",lineWidth:1}};var lb={NONE:0,CENTER:1,LEFT:2,RIGHT:3,TOP:4,BOTTOM:5};var fb=function e(t){this._graph=t.modules.graph;this._graphics=t.modules.graphics;this._spatial=t.modules.spatial;this._settings=t.modules.settings;this._events=t.modules.events;this._camera=t.modules.camera;this._options=ne(ub);this._enabled=false;this._canvas=it();this._ctx=this._canvas.getContext("2d");this._ysnap=lb.NONE;this._xsnap=lb.NONE;this._node=null;this._r=0;this._viewport=null;this._horizontalGuideLine=null;this._verticalGuideLine=null;this._vguideline={start:{x:0,y:0},end:{x:0,y:0}};this._hguideline={start:{x:0,y:0},end:{x:0,y:0}};this._distanceGuidelines=[-1,-1];this._neighbourGuidelines=[]};fb.prototype.enable=function e(t){var r=this;if(this._enabled){return}var i=this._events;this._options=os(t,ub);this._enabled=true;this._graphics.addCanvas(this._canvas);this._dragStartListener=i.on("startMoveNodesByDragging",function(e){return r._onNodeDragStart(e)});this._dragEndListener=i.on("endMoveNodesByDragging",function(e){return r._onNodeDragEnd(e)});this._settings.update({"interactions.drag.onBeforeDrag":function(e,t,i,n){return r._onBeforeDrag(t,i,n)}})};fb.prototype.disable=function e(){if(!this._enabled){return}var t=this._events;t.removeListener(this._dragStartListener);t.removeListener(this._dragEndListener);this._graphics.removeCanvas(this._canvas);this._settings.update({"interactions.drag.onBeforeDrag":null});this._enabled=false};fb.prototype.enabled=function e(){return this._enabled};fb.prototype._onNodeDragStart=function e(t){var r=t.nodes;if(r.size===1){this._node=r.get(0);this._cacheViewport();this._r=this._node.getAttribute("radius")}};fb.prototype._onBeforeDrag=function e(t,r,i){if(this._node){var n=i[0];this._scan(n);this._node.setAttributes(n)}};fb.prototype._onNodeDragEnd=function e(){this._node=null;this._clearCanvas()};fb.prototype._cacheViewport=function e(){var t=this._camera;var r=t.screenToGraphCoordinates({x:0,y:0});var i=t.screenToGraphCoordinates({x:t.width,y:t.height});this._viewport={xmin:r.x,ymin:r.y,xmax:i.x,ymax:i.y};this._nodes=this._spatial.getNodesByBoundingBox(r.x,r.y,i.x,i.y);var n=this._node._index;var a=this._nodes._indexes.slice();a.splice(a.indexOf(n),1);var o=this._graphics._getAttributeArray(true,"radius");var s=this._graph.getNodeAttribute("x");var u=this._graph.getNodeAttribute("y");var l=s._buffer;var f=u._buffer;var h=X(a.slice(),s);var v=X(a.slice(),u);var d={},c={};var _={},g={};var p=this._gridResolution=this._node.getAttribute("radius");for(var y=0,m=a.length;y<m;y++){var x=h[y],b=v[y];var A=l[x]/p|0,w=f[b]/p|0;if(!d[A]){d[A]=[]}if(!c[w]){c[w]=[]}d[A].push(x);c[w].push(b);_[x]=g[b]=y}this._nodesByX=h;this._nodesByY=v;this._nodesByXIndex=_;this._nodesByYIndex=g;this._xGrid=d;this._yGrid=c;this._xList=s;this._yList=u;this._X=l;this._Y=f;this._R=o};fb.prototype._clearCanvas=function e(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height)};fb.prototype._drawLine=function e(t,r,i,n){var a=this._ctx,o=nt(),s=this._camera.graphToScreenCoordinates(t),u=this._camera.graphToScreenCoordinates(r);a.beginPath();a.moveTo(s.x*o,s.y*o);a.lineTo(u.x*o,u.y*o);a.strokeStyle=n;a.lineWidth=i;a.stroke()};fb.prototype._scan=function e(t){this._clearCanvas();var r=this._node._index;var i=t.x,n=t.y,a=this._r;var o=this._options;var s=this._xList;var u=this._yList;var l=this._R;var f=this._X;var h=this._Y;var v=this._camera.zoom;var d=Math.min(a,this._options.tolerance/v);var c=a*2*o.sideSnapDistanceFactor;var _=o.guidelineWidth;var g=o.guidelineColor;var p,y;var m=r;var x=r;var b,A,w,E,S,C,T;var M=false,k=false;m=hb(this._nodesByX,f,i);x=hb(this._nodesByY,h,n);if(Math.abs(f[m]-i)>o.centerSnapDistance){m=r}if(Math.abs(h[x]-n)>o.centerSnapDistance){x=r}this._xsnap=lb.NONE;if(m!==r){p=this._vguideline.start;y=this._vguideline.end;T=m;b=f[T];A=h[T];w=l.get(T);C=Math.abs(i-b);var I=Math.abs(i-a-(b-w));var N=Math.abs(i+a-(b+w));if(C<Math.max(a,w)){if(A<n){p.y=A-w;y.y=n+a}else{p.y=A+w;y.y=n-a}var L=Math.min(I,C,N);if(L===C){p.x=y.x=b;y.y=n;p.y=A;this._xsnap=lb.CENTER}else if(Math.abs(n-A)<w+a+c){if(L===I){p.x=y.x=b-w;this._xsnap=lb.LEFT}else{p.x=y.x=b+w;this._xsnap=lb.RIGHT}}if(L<d){M=true}}if(this._xsnap!==lb.NONE){this._drawLine(p,y,_,g)}}this._ysnap=lb.NONE;if(x!==r){p=this._hguideline.start;y=this._hguideline.end;T=x;b=f[T];A=h[T];w=l.get(T);C=Math.abs(n-A);var z=Math.abs(n-a-(A-w));var D=Math.abs(n+a-(A+w));if(C<Math.max(a,w)){if(b<i){p.x=b-w;y.x=i+a}else{p.x=b+w;y.x=i-a}var P=Math.min(z,C,D);if(P===C){p.y=y.y=A;y.x=i;p.x=b;this._ysnap=lb.CENTER}else if(Math.abs(i-b)<w+a+c){if(P===z){p.y=y.y=A-w;this._ysnap=lb.TOP}else{p.y=y.y=A+w;this._ysnap=lb.BOTTOM}}if(P<d){k=true}}if(this._ysnap!==lb.NONE){this._drawLine(p,y,_,g)}}if(o.preferredDistance.enabled){var F=o.preferredDistance.ratio;var B=Math.min(o.preferredDistance.tolerance/v,a);var R=Math.max(a,w);if(m!==r&&(this._xsnap===lb.NONE||!M)){T=m;b=f[T];A=h[T];w=l.get(T);E=Math.abs(i-b)-(a+w)*(1+F);if(E<=B&&E>=-B){var O=i<b?-1:1;p=this._vguideline.start;y=this._vguideline.end;p.x=y.x=b+O*(1+F)*(a+w);p.y=A-R;y.y=A+R;p.x=y.x=b;this._drawLine(p,y,_,g);p.y=n-R;y.y=n+R;p.x=y.x=b+O*(1+F)*(a+w);this._drawLine(p,y,_,g);this._xsnap=lb.CENTER;M=true}}else if(x!==r&&(this._ysnap===lb.NONE||!k)){T=x;b=f[T];A=h[T];w=l.get(T);S=Math.abs(n-A)-(a+w)*(1+F);if(S<=B&&S>=-B){var V=n<A?-1:1;p=this._hguideline.start;y=this._hguideline.end;p.x=b-R;y.x=b+R;p.y=y.y=A;this._drawLine(p,y,_,g);p.x=i-R;y.x=i+R;p.y=y.y=A+V*(1+F)*(a+w);this._drawLine(p,y,_,g);this._ysnap=lb.CENTER;k=true}}}if(o.neighbours.enabled){var j=this._gridResolution;var U=i/j|0,G=n/j|0;var W=this._xGrid,Y=this._yGrid,H=[];var q=[].concat(Y[G-1]||H,Y[G]||H,Y[G+1]||H);var Z=[].concat(W[U-1]||H,W[U]||H,W[U+1]||H);var $;if(q.length>1){X(q,s);$=this.findNeighboursToAlign(q,f,r,i,a,l,d);if($){this.drawNeighbourGuidelines($,t);M=false}}if(Z.length>1&&!$){X(Z,u);$=this.findNeighboursToAlign(Z,h,r,n,a,l,d);if($){this.drawNeighbourGuidelines($,t,true);k=false}}}if(M||k){this._snap(t,!M,!k)}};fb.prototype.findNeighboursToAlign=function e(t,r,i,n,a,o,s){var u,l,f,h=false,v,d,c;var _=Math.abs;for(var g=0,p=t.length;!h&&g<p;g++){for(var y=0;!h&&y<p;y++){if(g===y){continue}var m=t[g],x=t[y];if(y<g){v=x;x=m;m=v}var b=r[m],A=r[x];var w=o.get(m),E=o.get(x);if(b+w<n-a&&A-E>n+a&&_(_(b+w-(n-a))-_(A-E-(n+a)))<=s){u=m;l=i,f=x;c=b+w+Math.abs(A-E-(b+w))/2;d=[b+w,c-a,c+a,A-E];h=true}else if(b+w<n-a&&A+E<n-a&&_(_(b+w-(A-E))-_(Math.max(b+w,A+E)-(n-a)))<=s){u=m;l=x;f=i;c=A+w+_(_(b+w-(A-E)))+a;d=[b+w,A-E,A+E,c-a];h=true}else if(b-w>n+a&&A-E>n+a&&_(_(b+w-(A-E))-_(Math.min(b-w,A-E)-(n+a)))<=s){u=i;l=m;f=x;c=b-w-_(_(b+w-(A-E)))-a;d=[c+a,b-w,b+w,A-E];h=true}}}return h?{a:u,b:l,c:f,current:i,target:c,points:d}:null};fb.prototype.drawNeighbourGuidelines=function e(t,r,i){var n=t.a;var a=t.b;var o=t.c;var s=t.points;var u=t.target;var l=new Nr;var f=new Nr;var h=this._R,v=this._X,d=this._Y;var c=h.getMultiple([n,a,o]);var _=c[0];var g=c[1];var p=c[2];var y=this._options.neighbours;var m=y.offset;var x=y.lineWidth;var b=y.lineColor;var A,w;if(i){r.y=u;_=-_;g=-g;p=-p;A=f.x=l.x=Math.min(v[n]+_,v[a]+g,v[o]+p)-m;w=v}else{r.x=u;A=f.y=l.y=Math.max(d[n]+_,d[a]+g,d[o]+p)+m;w=d}var E=i?"y":"x";var S=i?"x":"y";l[E]=s[0];f[E]=s[1];this._drawLine(l,f,x,b);l[E]=s[2];f[E]=s[3];this._drawLine(l,f,x,b);l[E]=s[0];l[S]=A-m/2;f[E]=s[0];l[S]=w[n]+_;this._drawLine(l,f,x,b);l[E]=s[1];l[S]=A-m/2;f[E]=s[1];l[S]=w[a]+g;this._drawLine(l,f,x,b);l[E]=s[2];l[S]=A-m/2;f[E]=s[2];l[S]=w[a]+g;this._drawLine(l,f,x,b);l[E]=s[3];l[S]=A-m/2;f[E]=s[3];l[S]=w[o]+p;this._drawLine(l,f,x,b)};fb.prototype._snap=function e(t,r,i){var n=this._xsnap;var a=this._ysnap;var o;if(!r&&n!==lb.NONE){o=this._vguideline.end;if(n===lb.LEFT){t.x=o.x+this._r}else if(n===lb.RIGHT){t.x=o.x-this._r}else{t.x=o.x}}if(!i&&a!==lb.NONE){o=this._hguideline.end;if(a===lb.TOP){t.y=o.y+this._r}else if(a===lb.BOTTOM){t.y=o.y-this._r}else{t.y=o.y}}};function hb(e,t,r,i){var n=0,a=e.length-1;var o,s,u;var l=Math.abs;while(n<a){o=(n+a)/2|0;s=l(t[e[o]]-r);u=l(t[e[o+1]]-r);if(u<=s){n=o+1}else{a=o}}return i?a:e[a]}Ogma.extend(function(e){var t=new fb(e);e.modules.snapping=t;e.tools.snapping={enable:function(e){return t.enable(e)},disable:function(){return t.disable()}}});Ogma.extend(function(e){var t=new db(e);e.modules.tooltip=t;e.tools.tooltip={};e.tools.tooltip.onNodeHover=function(e,r){bb(t,"hover.node",e,r)};e.tools.tooltip.onNodeClick=function(e,r){bb(t,"click.left.node",e,r)};e.tools.tooltip.onNodeRightClick=function(e,r){bb(t,"click.right.node",e,r)};e.tools.tooltip.onNodeDoubleClick=function(e,r){bb(t,"doubleClick.left.node",e,r)};e.tools.tooltip.onEdgeHover=function(e,r){bb(t,"hover.edge",e,r)};e.tools.tooltip.onEdgeClick=function(e,r){bb(t,"click.left.edge",e,r)};e.tools.tooltip.onEdgeRightClick=function(e,r){bb(t,"click.right.edge",e,r)};e.tools.tooltip.onEdgeDoubleClick=function(e,r){bb(t,"doubleClick.left.edge",e,r)};e.tools.tooltip.onBackgroundClick=function(e,r){bb(t,"click.left.background",e,r)};e.tools.tooltip.onBackgroundRightClick=function(e,r){bb(t,"click.right.background",e,r)};e.tools.tooltip.onBackgroundDoubleClick=function(e,r){bb(t,"doubleClick.left.background",e,r)};e.tools.tooltip.refresh=function(){return t.refresh()};e.tools.tooltip.isShown=function(){return t.isShown()};e.tools.tooltip.hide=function(){return t.hide()};e.events.onTooltipShown=function(t){e.modules.events.on("showTooltip",t);return e.events};e.events.onTooltipHidden=function(t){e.modules.events.on("hideTooltip",t);return e.events};e.tools.tooltip.show=function(e,r){return t.show(e,r)}});var vb=["top","bottom","left","right","cssDefined"];var db=function e(t){var r=this;this._dom=t.modules.dom;this._connectNodes=t.modules.connectNodes;this._interactions=t.modules.interactions;this._camera=t.modules.camera;this._events=t.modules.events;this._handlers={};this._currentHandlerName=null;this._tooltip=null;this._isHover=false;this._events.register(["showTooltip","hideTooltip"]);this._events.on({"up dragStart":function(){if(!r._isHover){Sb(r)}},unhover:function(){if(r._isHover){Sb(r)}},clear:function(){Sb(r)}});this._interactions.onHover(gb(this,"hover",true));this._interactions.onClick(gb(this,"click"));this._interactions.onDoubleClick(gb(this,"doubleClick"))};db.prototype.hide=function e(){Sb(this,true)};db.prototype.isShown=function e(){return!!this._tooltip};db.prototype.refresh=function e(){pb(this)};db.prototype.show=function e(t,r){if(r===void 0)r={};var i=r.position;if(i===void 0)i="top";var n=r.autoAdjust;if(n===void 0)n=true;var a=r.className;if(a===void 0)a=null;var o=r.x;if(o===void 0)o=0;var s=r.y;if(s===void 0)s=0;Eb(this,t,{position:i,autoAdjust:n,className:a},{x:o,y:s})};function cb(e,t,r){if(e._timeout){e._dom.clearTimeout(e._timeout)}e._timeout=e._dom.setTimeout(function(){e._timeout=null;t()},r)}function _b(e,t){var r=t.button;var i=t.target;var n=[];n.push(e);if(r){n.push(r)}n.push(i?i.isNode?"node":"edge":"background");return n.join(".")}function gb(e,t,r){if(r===void 0)r=false;return{priority:"tooltip",check:function(i){var n=_b(t,i);var a=e._handlers[n];if(r&&e._connectNodes.enabled()){return false}if(a&&a.condition(i)){return true}if(!r&&e._currentHandlerName&&!e._isHover){return!!e._tooltip}return false},handler:function i(n){var a=n.target;var o=n.x;var s=n.y;var u=e._tooltip;Sb(e);if(!u){e._isHover=r;e._elt=a;e._x=o;e._y=s;e._currentHandlerName=_b(t,n);pb(e)}}}}function pb(e){if(!e._currentHandlerName){Sb(e);return}var t=e._handlers[e._currentHandlerName];if(!t){return}var r=t.settings;var i=t.handler;var n=e._elt;if(n){var a=n.isNode?"node":"edge";if(e._currentHandlerName.indexOf(a)===-1){return}}var o=i(n);var s=o instanceof Promise?o:Promise.resolve(o);s.then(function(t){cb(e,function(){Eb(e,t,r)},r.delay)})}var yb={top:{x:0,y:-1},bottom:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}};var mb={position:"top",autoAdjust:true,delay:100,className:null};var xb={hover:{node:function(e){var t=e.target;return t&&t.isNode},edge:function(e){var t=e.target;return t&&!t.isNode}},click:{left:{node:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="left"&&!t}},right:{node:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="right"&&!t}}},doubleClick:{left:{node:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="left"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="left"&&!t}},right:{node:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&t.isNode},edge:function(e){var t=e.target;var r=e.button;return r==="right"&&t&&!t.isNode},background:function(e){var t=e.target;var r=e.button;return r==="right"&&!t}}}};function bb(e,t,r,i){var n=os(i,mb,"position");if(vb.indexOf(n.position)===-1){n.position="top"}e._handlers[t]={handler:r,condition:ls(xb,t),settings:n}}function Ab(e){return typeof HTMLElement!=="undefined"?e instanceof HTMLElement:false}function wb(e){return typeof document==="object"?document.createElement(e):{style:{},offsetWidth:10,offsetHeight:10}}function Eb(e,t,r,i){Sb(e,false);var n=r.position;var a=r.className;var o=r.autoAdjust;var s=e._x;var u=e._y;var l=e._elt;var f=e._dom.getDimensions();var h=0;var v=0;if(i){s=i.x;u=i.y;l=null}if(typeof t==="string"){e._tooltip=wb("div");e._tooltip.innerHTML=t}else if(Ab(t)){e._tooltip=t}else{throw new Error("invalid tooltip "+t+", expected HTML string or HTML element")}e._tooltip.__isOgmaTooltip=true;if(a){e._tooltip.className+=e._tooltip.className?" "+a:a}if(n!=="cssDefined"){e._tooltip.style.position="absolute"}e._dom.setLayer("tooltip",e._tooltip);if(l&&l.isNode){var d=e._camera.graphToScreenCoordinates(l.getPosition()),c=l.getAttribute("radius")*e._camera.getZoom()+l.getAttribute("innerStroke.width")+l.getAttribute("outerStroke.width")+1;s=d.x;u=d.y;h=c;v=c}var _=e._tooltip.offsetWidth;var g=e._tooltip.offsetHeight;var p=_/2;var y=g/2;h+=p;v+=y;if(n!=="cssDefined"){var m=yb[n],x=m.x,b=m.y;if(o){var A=s+h*m.x,w=u+v*m.y;if(A-p<0||A+p>=f.width){if(n==="left"||n==="right"){x*=-1}else{if(A-p<0){x=(p-A+1)/h}else{x=(f.width-(A+p)-1)/h}}}if(w-y<0||w+y>=f.height){if(n==="top"||n==="bottom"){b*=-1}else{if(w-y<0){b=(y-w+1)/v}else{b=(f.height-(w+y)-1)/v}}}}e._tooltip.style.left=s+h*x-p+"px";e._tooltip.style.top=u+v*b-y+"px"}e._events.fire("showTooltip",{tooltip:e._tooltip})}function Sb(e,t){if(e._timeout){e._dom.clearTimeout(e._timeout);e._timeout=null}if(t){e._currentHandlerName=null}if(e._tooltip){var r=e._tooltip;e._dom.setLayer("tooltip",null);e._tooltip=null;e._events.fire("hideTooltip",{tooltip:r})}}Ogma.extend(function(e){e.debug={wait:function e(t){return new Promise(function(e){return setTimeout(e,t)})},initRandomGraph:function t(r){return e.generate.random(r).then(function(t){e.setGraph(t);e.view.locateGraph()})},initLine:function t(r){e.setGraph({nodes:[{id:0,attributes:{x:0,y:0}},{id:1,attributes:r?{x:0,y:50}:{x:50,y:0}}],edges:[{id:0,source:1,target:0}]});return e.view.locateGraph()},initSingleNode:function t(){e.setGraph({nodes:[{id:0,attributes:{x:0,y:0}}]});return e.view.locateGraph()},initContinuousRenderLoop:function t(r){if(r===void 0)r={};var i=r.triggerKey;if(i===void 0)i="r";var n=r.start;if(n===void 0)n=true;var a=n;document.addEventListener("keydown",function(e){var t=e.key;if(t===i){a=!a;o()}});var o=function(){if(a){e.modules.dom.beforeNextFrame().then(o)}};o()},appendToBody:function t(){var r=document.createElement("div");r.style.position="absolute";r.style.top="0";r.style.left="0";r.style.bottom="0";r.style.right="0";document.body.appendChild(r);e.setContainer(r)},loadFile:function t(r){var i=r.endsWith(".gexf")?e.parse.gexfFromUrl(r):e.parse.jsonFromUrl(r);return i.then(function(t){return e.setGraph(t)}).then(function(){return e.view.locateGraph()})}}});function Cb(e,t){var r=t.styles;var i=t.nodes;var n=t.edges;var a=t.filter;var o={nodes:Mb(true,e,r,i,a),edges:Mb(false,e,r,n,a)};return o}var Tb={get:function(){return undefined}};function Mb(e,t,r,i,n){var a=t.modules.graph,o=a._filter(e,a._getIndexes(e,i),n);var s=a.getAttributes(e,["source","target","data","x","y","text.content","color","shape",e?"radius":"width"]).map(function(e){return e||Tb});var u=s[0];var l=s[1];var f=s[2];var h=s[3];var v=s[4];var d=s[5];var c=s[6];var _=s[7];var g=s[8];var p=new Array(o.length);if(r==="none"){d=Tb;c=Tb;_=Tb;g=Tb}else if(r==="original"){var y=t.modules.graphics._elts.fetch(e)._originalStyles;d=y["text.content"]||Tb;c=y.color||Tb;_=y.shape||Tb;g=y.size||Tb}for(var m=0;m<o.length;++m){var x=o[m],b={id:a._getId(e,x),data:f.get(x),x:h.get(x),y:v.get(x),color:c.get(x),size:g.get(x),shape:_.get(x),text:d.get(x)};if(!e){b.source=a._getId(true,u.get(x));b.target=a._getId(true,l.get(x))}if(Array.isArray(b.color)){b.color=b.color[0]}p[m]=b}return p}function kb(e,t){for(var r=0;r<t.length;++r){if(e===undefined||e===null){return undefined}e=e[t[r]]}return e}function Ib(e,t,value){for(var r=0;r<t.length-1;++r){var i=t[r],n=e[i];if(n===undefined){n={};e[i]=n}e=n}e[t[t.length-1]]=value}function Nb(e,t,r){var i=new Wr,n=t?1:3,a=[];var o=function(o){var s=e[o],u=new Array(n),l=s.data;if(r){var f={};r.forEach(function(e){var t=ir(e),value=kb(l,t);Ib(f,t,value)});l=f}var h=Xr(l);u[0]=s.id;if(!t){u[1]=s.source;u[2]=s.target}for(var v=0;v<h.length;++v){var d=h[v];var c=d.path;var value=d.value;if(c.length){if(i.has(c)){u[i.get(c)]=value}else{i.set(c,n);u[n]=value;n++}}}a.push(u)};for(var s=0;s<e.length;++s)o(s);var u=[];u.push("id");if(!t){u.push("source");u.push("target")}i.keys().forEach(function(e){return u.push(e[e.length-1])});a.unshift(u);a.forEach(function(e){return e.length=n});return a}var Lb={what:undefined,dataProperties:undefined,separator:",",textSeparator:'"',download:true,filename:"graph.csv",filter:"visible",nodes:undefined,edges:undefined};Ogma.extend(function(e){e.export.csv=function(t){var r=os(t,Lb,"what");var i=r.what;var n=r.dataProperties;var a=r.nodes;var o=r.edges;var s=r.separator;var u=r.textSeparator;var l=r.download;var f=r.filename;var h=r.filter;var v=Cb(e,{styles:"none",nodes:a,edges:o,filter:h}),d=zb(v,{what:i,separator:s,textSeparator:u,dataProperties:n});if(l){lt(d,f,"text")}return Promise.resolve(d)}});function zb(e,t){var r=t.what;var i=t.separator;var n=t.textSeparator;var a=t.dataProperties;var o=new RegExp(""+n,"g");function s(e){e=Db(e);e=n+e.replace(o,"\\$&")+n;return e}if(n&&n!=='"'&&n!=="'"){throw new TypeError('Invalid argument :"textSeparator" is not single-quote or double-quote, was '+n)}if(r!=="nodes"&&r!=="edges"){throw new TypeError('missing argument: "what": should have value "nodes" or "edges"')}var u=r==="nodes",l=u?e.nodes:e.edges,f=Nb(l,u,a).map(function(e){return e.map(function(value){return s(value)})});return f.map(function(e){return e.join(i)}).join("\n")}function Db(e){if(e instanceof Date){return e.toISOString()}else{return""+e}}var Pb={creator:undefined,description:undefined,styles:"all",download:true,filename:"graph.gexf",nodes:undefined,edges:undefined,filter:"visible"};Ogma.extend(function(e){e.export.gexf=function(t){if(t===void 0)t={};var r=os(t,Pb);var i=r.styles;var n=r.nodes;var a=r.edges;var o=r.download;var s=r.filename;var u=r.creator;var l=r.description;var f=r.filter;var h=Cb(e,{styles:i,nodes:n,edges:a,filter:f});var v=Fb(h,{creator:u,description:l});if(o){lt(v,s,"text")}return Promise.resolve(v)}});function Fb(e,t){var r=new gn;var i=ln();var n;var a={};var o=0;var s={};var u=0;var l;var f;var h;var v;var d;var c;var _;var g;var p;var y;var m;var x;var b;var A;var w;var E;var S;var C;w=i.createElement("gexf");w.setAttribute("xmlns","http://www.gexf.net/1.2draft");w.setAttribute("xmlns:viz","http://www.gexf.net/1.2draft/viz");w.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");w.setAttribute("xsi:schemaLocation","http://www.gexf.net/1.2draft http://www.gexf.net/1.2draft/gexf.xsd");w.setAttribute("version","1.2");x=i.createElement("meta");x.setAttribute("lastmodifieddate",V());if(t.creator){_=i.createElement("creator");C=i.createTextNode(""+t.creator);_.appendChild(C);x.appendChild(_)}if(t.description){g=i.createElement("description");C=i.createTextNode(""+t.description);g.appendChild(C);x.appendChild(g)}m=i.createElement("graph");m.setAttribute("mode","static");b=i.createElement("nodes");e.nodes.forEach(function(e){A=i.createElement("node");A.setAttribute("id",e.id);if(e.text){A.setAttribute("label",e.text)}if(Ob(e.data)){n=Vb(e.data);f=i.createElement("attvalues");Object.keys(n).forEach(function(e){if(!(e in a)){a[e]={id:o,type:"integer"};o++}var t=n[e];a[e].type=Rb(t,a[e].type);h=i.createElement("attvalue");h.setAttribute("for",a[e].id);h.setAttribute("value",t);f.appendChild(h)});A.appendChild(f)}if(e.color){var t=r.parseColor(e.color);c=i.createElement("viz:color");c.setAttribute("r",Bb(t[0]));c.setAttribute("g",Bb(t[1]));c.setAttribute("b",Bb(t[2]));c.setAttribute("a",t[3]);A.appendChild(c)}E=i.createElement("viz:position");E.setAttribute("x",e.x);E.setAttribute("y",-parseInt(e.y,10));A.appendChild(E);if(e.size){S=i.createElement("viz:size");S.setAttribute("value",e.size);A.appendChild(S)}b.appendChild(A)});v=i.createElement("attributes");v.setAttribute("class","node");Object.keys(a).forEach(function(e){l=i.createElement("attribute");l.setAttribute("id",a[e].id);l.setAttribute("title",e);l.setAttribute("type",a[e].type);v.appendChild(l)});p=i.createElement("edges");e.edges.forEach(function(e){y=i.createElement("edge");y.setAttribute("id",e.id);y.setAttribute("source",e.source);y.setAttribute("target",e.target);if(e.size){y.setAttribute("weight",e.size)}if(e.text){y.setAttribute("label",e.text)}if(Ob(e.data)){n=Vb(e.data);f=i.createElement("attvalues");Object.keys(n).forEach(function(e){if(!(e in s)){s[e]={id:u,type:"integer"};u++}var t=n[e];s[e].type=Rb(t,s[e].type);h=i.createElement("attvalue");h.setAttribute("for",s[e].id);h.setAttribute("value",t);f.appendChild(h)});y.appendChild(f)}if(e.color){var t=r.parseColor(e.color);c=i.createElement("viz:color");c.setAttribute("r",Bb(t[0]));c.setAttribute("g",Bb(t[1]));c.setAttribute("b",Bb(t[2]));c.setAttribute("a",t[3]);y.appendChild(c)}if(e.size){S=i.createElement("viz:size");S.setAttribute("value",e.size);y.appendChild(S)}p.appendChild(y)});d=i.createElement("attributes");d.setAttribute("class","edge");Object.keys(s).forEach(function(e){l=i.createElement("attribute");l.setAttribute("id",s[e].id);l.setAttribute("title",e);l.setAttribute("type",s[e].type);d.appendChild(l)});m.appendChild(v);m.appendChild(d);m.appendChild(b);m.appendChild(p);w.appendChild(x);w.appendChild(m);i.appendChild(w);return'<?xml version="1.0" encoding="UTF-8"?>'+i.serialize()}function Bb(value){return Math.round(value*255)}function Rb(e,t){if(t==="integer"&&typeof e==="number"){if(e%1!==0){t="float"}}else if(typeof e!=="number"){t="string";if(typeof e==="boolean"){t="boolean"}}return t}function Ob(value){return typeof value==="object"&&value!==null&&value.constructor===Object}function Vb(e,t){if(t===void 0)t={};K(e,function(value,e){if(Ob(value)){Vb(value,t)}else{t[e]=value}});return t}var jb={graphId:"G",directedEdges:true,styles:"all",download:true,filename:"graph.graphml",nodes:undefined,edges:undefined,filter:"visible"};Ogma.extend(function(e){e.export.graphml=function(t){if(t===void 0)t={};var r=os(t,jb);var i=r.styles;var n=r.nodes;var a=r.edges;var o=r.download;var s=r.filename;var u=r.graphId;var l=r.directedEdges;var f=r.filter;var h=Cb(e,{styles:i,nodes:n,edges:a,filter:f}),v=Ub(h,{graphId:u,directedEdges:l});if(o){lt(v,s,"text")}return Promise.resolve(v)}});function Ub(e,t){var r=new gn;var i=tt();function n(e){return r.parseColor(e)}function a(e){return r.toHexa(e)}function o(e,t){var r=n(t);e.r=r[0];e.g=r[1];e.b=r[2]}function s(e,t,r,n,a){r=r||{};var o=i.createElement(t);for(var s in r){if(!r.hasOwnProperty(s)){continue}var value=r[s];if(value!==undefined){o.setAttribute(s,value)}}if(n!==undefined||a){if(Object.prototype.toString.call(n)==="[object Object]"){n=JSON.stringify(n)}var u=i.createTextNode(n);o.appendChild(u)}e.appendChild(o);return o}var u=["id","source","target"];var l=["size","x","y","shape","color","text"];var f={size:{for:"all",type:"double"},x:{for:"node",type:"double"},y:{for:"node",type:"double"},shape:{for:"all",type:"string"},color:{for:"all",type:"string"},r:{for:"all",type:"int"},g:{for:"all",type:"int"},b:{for:"all",type:"int"},a:{for:"all",type:"double"},text:{for:"all",type:"string"}},h=[],v=[];function d(e,t){var r={id:e.id};l.forEach(function(i){var value=e[i];if(i==="y"&&value){value=-parseFloat(value)}if(value!==undefined){r[(t==="edge"?"edge_":"")+i]=value;if(i==="color"){o(r,value)}}});var i=e.data||{};K(i,function(value,e){if(l.indexOf(e)!==-1||u.indexOf(e)!==-1){return}if(!f[e]){f[e]={for:t,type:"string"}}else if(f[e].for!==t){f[e].for="all"}r[e]=value});if(t==="edge"){r.source=e.source;r.target=e.target;v.push(r)}else{h.push(r)}}e.nodes.forEach(function(e){d(e,"node")});e.edges.forEach(function(e){d(e,"edge")});var c=s(i,"graphml",{xmlns:"http://graphml.graphdrawing.org/xmlns","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://graphml.graphdrawing.org/xmlns "+"http://www.yworks.com/xml/schema/graphml/1.1/ygraphml.xsd","xmlns:y":"http://www.yworks.com/xml/graphml","xmlns:java":"http://www.yworks.com/xml/yfiles-common/1.0/java","xmlns:sys":"http://www.yworks.com/xml/yfiles-common/markup/primitives/2.0","xmlns:x":"http://ww.yworks.com/xml/yfiles-common/markup/2.0"});K(f,function(value,e){if(value.for==="node"||value.for==="all"){s(c,"key",{"attr.name":e,"attr.type":value.type,for:"node",id:e})}if(value.for==="edge"||value.for==="all"){s(c,"key",{"attr.name":e,"attr.type":value.type,for:"edge",id:"edge_"+e})}});s(c,"key",{id:"nodegraphics",for:"node","yfiles.type":"nodegraphics","attr.type":"string"});s(c,"key",{id:"edgegraphics",for:"edge","yfiles.type":"edgegraphics","attr.type":"string"});var _=s(c,"graph",{edgedefault:t.directedEdges||t.directedEdges===undefined?"directed":"undirected",id:t.graphId?t.graphId:"G","parse.nodes":e.nodes.length,"parse.edges":e.edges.length,"parse.order":"nodesfirst"});function g(e,t){var r=s(e,"data",{key:"nodegraphics"});var i=s(r,"y:ShapeNode");s(i,"y:Geometry",{x:t.x,y:t.y,width:t.size,height:t.size});s(i,"y:Fill",{color:a(t.color),transparent:false});s(i,"y:NodeLabel",null,t.text||"");s(i,"y:Shape",{type:t.shape})}function p(e,t){var r=s(e,"data",{key:"edgegraphics"});var i=s(r,"y:PolyLineEdge");s(i,"y:LineStyle",{type:t.edge_type,color:a(t.edge_color),width:t.edge_size});s(i,"y:EdgeLabel",null,t.edge_label)}h.forEach(function(e){var t=s(_,"node",{id:e.id});g(t,e);K(e,function(value,e){if(u.indexOf(e)!==-1){return}s(t,"data",{key:e},value,true)})});v.forEach(function(e){var t=s(_,"edge",{id:e.id,source:e.source,target:e.target});p(t,e);K(e,function(value,e){if(u.indexOf(e)!==-1){return}s(t,"data",{key:e},value,true)})});var y=rt(i);return'<?xml version="1.0" encoding="UTF-8"?>\n'+y}var Gb={nodeAttributes:["x","y","color","radius","shape","text"],edgeAttributes:["color","width","text"],nodeData:function(e){return e},edgeData:function(e){return e},filter:"visible",pretty:false,download:true,filename:"graph.json"};Ogma.extend(function(e){e.export.json=function(t){if(t===void 0)t={};var r=os(t,Gb);var i=r.nodeAttributes;var n=r.edgeAttributes;var a=r.nodeData;var o=r.edgeData;var s=r.filter;var u=r.pretty;var l=r.download;var f=r.filename;var h={nodes:e.getNodes(typeof s==="object"?s.nodes:s).toJSON({attributes:i,data:a}),edges:e.getEdges(typeof s==="object"?s.edges:s).toJSON({attributes:n,data:o})};var v=u?JSON.stringify(h,null," "):JSON.stringify(h);if(l){lt(v,f,"text")}return Promise.resolve(v)}});Ogma.atInit(function(e){return e.styles.createClass({name:nv,isBuiltin:true})});var Xb=10;function Wb(e,t){var r=e.view.get();var i=typeof t.margin==="number"?t.margin:Xb;var n={pixelRatio:1,backgroundColor:r.backgroundColor};if(t.width&&t.height){n.width=t.width;n.height=t.height}else{n.width=r.width;n.height=r.height}if(t.clip){n.zoom=r.zoom;n.x=r.x;n.y=r.y}else{var a=e.getNodes(t.filter).getBoundingBox();n.x=a.cx;n.y=a.cy;n.zoom=Math.min(n.width/(a.width+i),n.height/(a.height+i))}if(e.modules.geo.isEnabled()){n.backgroundColor=null}else if(t.background!==undefined){n.backgroundColor=t.background}return n}function Yb(e,t,r,i,n){if(n===void 0)n=false;r.hideImages=n;r.isBufferDisplayable=function(e){return t.texts||!mh(e)};var a={};if(t.badges===false){var o={text:null,image:null};a.badges={topLeft:o,topRight:o,bottomRight:o,bottomLeft:o}}e.styles.getClass(nv).update({nodeAttributes:a});return e.modules.graphics.export(i,r,t.filter,t)}Ogma.extend(function(e){e.export.png=function(t){return eA(e,t,"png")};e.export.jpg=function(t){return eA(e,t,"jpg")};e.export.tiff=function(t){return eA(e,t,"tiff")};e.export.gif=function(t){return eA(e,t,"gif")}});function Hb(e){return{download:true,filter:"visible",filename:"graph."+e,clip:false,margin:10,width:undefined,height:undefined,background:null,badges:true,legend:undefined,texts:true,images:true,map:true,textWatermark:{content:null,fontFamily:"Arial",fontSize:48,fontStyle:null,fontColor:"red",repeat:false,angle:0,alpha:.65,space:50,x:undefined,y:undefined},imageWatermark:{url:null,width:undefined,height:undefined,repeat:false,angle:0,alpha:.65,space:50,x:undefined,y:undefined},imageCrossOrigin:undefined}}var qb={png:Hb("png"),jpg:Hb("jpg"),tiff:Hb("tiff"),gif:Hb("gif")};function Zb(e){var t=e.canvas;var r=e.parameters;if(r.textWatermark.content){aA(t,r.textWatermark,tA,rA)}if(r.imageWatermark.url){return gt(r.imageWatermark.url).then(function(i){if(i){r.imageWatermark.content=i;aA(t,r.imageWatermark,nA,iA)}return e})}else{return e}}function $b(e){var t=e.ogma;var r=e.canvas;var i=e.parameters;var n=t.modules.legend;var a=i.legend;if(a===undefined){a=n.enabled()?n.getCurrentOptions():false}else if(a===true){a={}}if(a){n.exportOnCanvas(r,a)}return e}function Kb(e){var t=e.canvas;var r=e.ogma;var i=e.view;if(r.modules.geo.isEnabled()){return r.modules.geo.whenReady().then(function(){return r.modules.geo.exportBackground(t,i)}).then(function(){return e})}else{return e}}function Jb(e){var t=e.ogma;var r=e.parameters;var i=e.canvas;var n=e.view;var a=i.getContext("2d");return Yb(t,r,n,"canvas",!r.images).then(function(i){try{i.getContext("2d").getImageData(0,0,1,1);a.drawImage(i,0,0);return e}catch(i){is(i);return Yb(t,r,n,"canvas",true).then(function(t){a.drawImage(t,0,0);return e})}})}function Qb(e){var t=e.canvas;var r=e.parameters;var i=e.type;var n=t.toDataURL("image/"+i);if(r.download){lt(n,r.filename,"dataURL")}return n}function eA(e,t,r){t=os(t,qb[r]);if(t.background===null){t.background=e.modules.graphics.getTransparentBackgroundColor()}var i=Wb(e,t);var n=it();var a={ogma:e,parameters:t,canvas:n,view:i,type:r};n.width=i.width;n.height=i.height;return Promise.resolve(a).then(Kb).then(Jb).then(Zb).then($b).then(Qb)}function tA(e,t,r,i){e.textAlign="center";e.textBaseline="middle";e.fillText(t,r,i)}function rA(e,t,r){return{width:e.measureText(t).width,height:r}}function iA(e,t,r,i,n){return{width:i===undefined?t.width:i,height:n===undefined?t.height:n}}function nA(e,t,r,i,n,a){e.drawImage(t,r-n/2,i-a/2,n,a)}function aA(e,t,r,i){if(!t){return}if(typeof t!=="object"){t={content:t}}else if(!t.content){return}var n=t.fontFamily;var a=t.fontSize;var o=t.fontStyle;var s=t.fontColor;var u=t.repeat;var l=t.angle;var f=t.alpha;var h=t.space;var v=t.content;var d=e.getContext("2d");var c=e.width;var _=e.height;var g=t.x===undefined?c/2:t.x;var p=t.y===undefined?_/2:t.y;var y=t.height;var m=t.width;l=l/180*Math.PI;Tt(d,n,a,o);d.fillStyle=s;d.globalAlpha=f;var x=i(d,v,a,m,y);if(!u){d.save();d.translate(g,p);d.rotate(l);r(d,v,0,0,x.width,x.height);d.restore()}else{var b=x.width+h,A=x.height+h,w=Math.sqrt(c*c+_*_);d.save();d.translate(0,0);d.rotate(l);for(var E=0;E<w;E+=b){for(var S=0;S<w;S+=A){r(d,v,E,S,x.width,x.height);if(S!==0){r(d,v,E,-S,x.width,x.height)}}}d.restore()}}Ogma.extend(function(e){e.export.svg=function(t){return sA(e,t)}});var oA={download:true,filename:"graph.svg",width:undefined,height:undefined,background:null,texts:true,images:true,badges:true,embedFonts:false,clip:false,margin:10,prefix:"ogma"};function sA(e,t){t=os(t,oA);if(t.background===null){t.background=e.modules.graphics.getTransparentBackgroundColor()}var r=Wb(e,t);return Yb(e,t,r,"svg",!t.images).then(function(e){e.removeAttribute("pointer-events");e.setAttribute("version","1.1");e.setAttribute("xmlns","http://www.w3.org/2000/svg");e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");return e}).then(function(r){return uA(e,r,t)}).then(function(r){return fA(e,r,t)}).then(function(e){var r='<?xml version="1.0" encoding="utf-8"?>'+rt(e);if(t.download){lt(r,t.filename)}return r})}function uA(e,t,r){var i=t.childNodes[2];var n=i.childNodes;var a={};var o=r.prefix;for(var s=0;s<n.length;s++){var u=n[s];var l=u.getAttribute(af);a[l]=a[l]||[];a[l].push(u)}var f=Object.keys(a);var h=e.modules.graph;var v=vt("g",{class:o+"-edges"});var d=vt("g",{class:o+"-nodes"});for(var c=0;c<f.length;c++){var _=f[c];var g=_.charAt(0)==="n";var p=parseInt(_.substring(1));var y=a[_];var m=Mt(h._getId(g,p));var x=vt("g");x.setAttribute("data-"+(g?"node":"edge")+"-id",m);x.setAttribute("class",o+"-"+(g?"node":"edge"));for(var b=0;b<y.length;b++){var A=y[b];x.appendChild(A);A.removeAttribute(af)}(g?d:v).appendChild(x)}i.appendChild(v);i.appendChild(d);return t}function lA(e){var t=[].concat(Array.prototype.slice.call(e.getElementsByTagName("text")||[]),Array.prototype.slice.call(e.getElementsByTagName("tspan")||[]));var r=[];var i={};for(var n=0;n<t.length;n++){var a=t[n];var o=a.getAttribute("font-family");if(typeof o==="string"){var s=o.split(",");for(var u=0;u<s.length;u++){var l=s[u].replace(/['"]/g,"");if(l!==""&&!i[l]){i[l]=true;r.push(l)}}}}return{list:r,map:i}}function fA(e,t,r){var i=lA(t).map;return kt().then(function(e){return e.filter(function(e){return i[e.name]})}).then(function(e){return It(e,!!r.embedFonts)}).then(function(e){if(e.length!==0){var r=vt("style");for(var i=0;i<e.length;i++){r.appendChild(dt(e[i]))}t.childNodes[0].appendChild(r)}return t})}var hA={what:undefined,dataProperties:undefined,download:true,filename:"graph.xlsx",nodes:undefined,edges:undefined,filter:"visible"};Ogma.extend(function(e){e.export.xlsx=function(t){var r=os(t,hA,"what");var i=r.what;var n=r.nodes;var a=r.edges;var o=r.download;var s=r.filename;var u=r.dataProperties;var l=r.filter;var f=Cb(e,{styles:"none",nodes:n,edges:a,filter:l}),h=vA(f,{what:i,dataProperties:u});if(o){lt(h,s,"blob")}return Promise.resolve(h)}});function vA(e,t){var r=t.what;var i=t.dataProperties;var n=P("xlsx",{globalVarName:"XLSX"}),a=new _A,o,s;if(!r){o=cA(n,Nb(e.nodes,true,i));s=cA(n,Nb(e.edges,false,i))}else{if(r==="nodes"){o=cA(n,Nb(e.nodes,true,i))}else if(r==="edges"){s=cA(n,Nb(e.edges,false,i))}else{throw new TypeError('Invalid argument: "what" is not "nodes" or "edges", was '+r)}}if(o){a.SheetNames.push("Nodes");a.Sheets.Nodes=o}if(s){a.SheetNames.push("Edges");a.Sheets.Edges=s}var u=n.write(a,{bookType:"xlsx",bookSST:false,type:"binary"});var l=st([gA(u)]);return l}function dA(e){if(e===undefined){return""}else if(e instanceof Date){return e.toISOString()}else{return""+e}}function cA(e,t){var r={};var i={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(var n=0;n!==t.length;++n){var a=t[n];for(var o=0;o!==a.length;++o){var value=a[o];if(i.s.r>n){i.s.r=n}if(i.s.c>o){i.s.c=o}if(i.e.r<n){i.e.r=n}if(i.e.c<o){i.e.c=o}var s={v:dA(value)},u=e.utils.encode_cell({c:o,r:n});r[u]=s}}if(i.s.c<1e7){r["!ref"]=e.utils.encode_range(i)}return r}function _A(){if(!(this instanceof _A)){return new _A}this.SheetNames=[];this.Sheets={}}function gA(e){var t=new ArrayBuffer(e.length);var r=new Uint8Array(t);for(var i=0;i!==e.length;++i){r[i]=e.charCodeAt(i)&255}return t}Ogma.default=Ogma;Ogma.geometry=To;Ogma.algorithms=es;Ogma.utils=pn;return Ogma});