# # Regarding execution order
# = requirement should come before != requirement. otherwise, !false can be raised.
#
# # Delay feature
# for both parse_if and parse_require
# true => Execute. false | optional | CustomError (empty) => Requeue.
#
# # Regarding grammar and semantics
# Whitespaces are unimportant.
# null means [''] or undefined.
#
# # Regarding grouping
# Be forgiving. Group by the spirit or the cause.
#
# # Regarding grammar of this file
# 'ref' denotes reference. 'source' denotes source. '->' denotes definition.
#
# Please note that If and Require grammars are different. I see no problem in that.
# kwname!=kwval_NoOR | !modname && !(func) || kwname !null     : kwname!=kwval|(funcname), !modname, if_exp which CANNOT BE REALIZED BY FORGOING       : optional  : explanations. colon is necessary.
#
#
# 材料元素
qd                                          : cond=insu                                                                                  :          : NEED WORK! qd -> material info applicable to any PbS QD. NEED WORK! kpoints -> G|M 5 6 7 support for band?
                                            : spin=fm|afm|ncl|para                                                                       :          :
spin=fm|spin=afm                            : magmom=(magmom)                                                                            : optional : user can specify magmom
spin=ncl || hse&npar                        : nbands=(nbands)                                                                            :          : Source of nbands -> I read from vasp source code. Not quite reliable.
spin=ncl                                    : saxis !null                                                                                :          :
pbs & bulk                                  : cond=insu                                                                                  :          :
struk=B1                                    :                                                                                            :          : struk -> Strukturbericht Symbol
# 求值元素
                                            : engine=vasp, engine internal                                                               :          :
opt                                         : ibrion=2, isif !null                                                                       :          : opt -> relaxation. Use good conjugate-gradient. Ref-> vasp guide 6.22.
opt                                         : ediffg !null                                                                               :          :
opt & fix=none                              : isif=3                                                                                     :          : Ref -> vasp guide 6.24
opt & fix=base                              : isif=0                                                                                     :          :
eigenfunction                               :                                                                                            :          :
dos                                         : nedos=1500                                                                                 : optional :
bader                                       : laechg=.TRUE.                                                                              :          :  bader website.
                                            : lorbit=11                                                                                  : optional : You almost always want to run Electron on a result. Must have a very good reason not to do lorbit=11.
band                                        : istart=1, icharg=11                                                                        :          : Has been default for my calc and https://cms.mpi.univie.ac.at/wiki/index.php/Fcc_Si_bandstructure.
# 简化近似元素
ldau                                        : ldau=.TRUE.                                                                                :          :
ldau                                        : ldauu=(ldauu), ldauj=(ldauj)                                                               : optional : user can specify u and j values
ldau | spin=ncl                             : lmaxmix=(lmaxmix)                                                                          :          : Source                                                                                                                 : https : //cms.mpi.univie.ac.at/wiki/index.php/LMAXMIX.  https : //cms.mpi.univie.ac.at/vasp/vasp/LSORBIT_tag.html
spin=ncl                                    : lsorbit=.TRUE., gga_compat=.FALSE.                                                         :          :
spin=fm | spin=afm                          : ispin=2                                                                                    :          :
spin=para                                   : ispin=1                                                                                    :          :
# 其他近似参数
                                            : kpoints !null, isym !null, prec !null, ediff !null, encut !null, lreal !null, ismear !null :          :
                                            : spin !null, cond !null, (kpointscheck)                                                     :          : spin -> para/fm/afm/ncl, cond -> metal/insu
ismear=0                                    : sigma !null                                                                                :          :
cond=insu&(ismear5check) || cond=metal&!opt : ismear=-5                                                                                  :          : Although ismear=0 and good sigma usually also works when ismear=-5 works. Source                                       : my testing.
cond=insu&!(ismear5check)                   : ismear=0                                                                                   :          : VASP Error: The linear tetrahedron method (ismear=-5) can not  be used with the KPOINTS file (generation of strings of k-points)     .
opt & cond=metal                            : ismear=1|2, sigma=0.2                                                                      :          : The infamous 3-rules. Source                                                                                           : https : //cms.mpi.univie.ac.at/wiki/index.php/ISMEAR
spin=ncl                                    : isym=-1, icharg=11                                                                         : optional : Recommend isym=-1. They used icharg=11. Source                                                                         : https : //cms.mpi.univie.ac.at/wiki/index.php/LSORBIT
# 辅助行为参数
                                            : algo=Normal                                                                                : optional : Source -> kept running into instability and inaccuracy with Algo = Fast. However, I used to endorse Algo=Fast.
                                            : npar !null, kpar !null, ncore_node !null, mem_node !null, nnode !null                      :          :
                                            : istart !null, icharg !null                                                                 :          :
dos                                         : read=cc                                                                                    : optional : Often good. Usually CHGCAR converges well with k-mesh. Source                                                          : vasp guide somewhere.
opt                                         : nsw !null                                                                                  :          :
spin=ncl                                    : istart=0                                                                                   : optional : Ncl run changes symmetry. Thus, plane-wave coefficient can change. This may produce error when reading WAVECAR. Source : http  : //cms.mpi.univie.ac.at/vasp-forum/viewtopic.php?f=3&t=10150
## ISTART, ICHARG
read=n                                      : istart=0, icharg=2                                                                         : optional : Often good. Always invoke read parameter optionally.
read=wc                                     : istart=1, icharg=1                                                                         : optional :
read=cc                                     : istart=1, icharg=11                                                                        : optional :
## 计算平台
platform=dellpc                             : nnode=1, ncore_node=20,mem_node=94                                                         :          : dellpc -> aux parameters optimal for dellpc
platform=dellpc                             : npar=20, kpar=1                                                                            : optional : Source -> benchmarks.md
platform=nanaimo                            : ncore_node=24, mem_node=128                                                                :          :
platform=irmik                              : ncore_node=12, mem_node=48                                                                 :          :
platform=hodduk                             : ncore_node=16, mem_node=64                                                                 :          :
platform=nanaimo|platform=irmik|platform=hodduk : npar=2, kpar=2                                                                             : optional :
# preset
ismear=0 & good                             : sigma=0.01                                                                                 :          :
pbs & good                                  : prec=Normal, encut=400                                                                     :          : good -> 误差合理。
pbs && good && opt | eigenfunction | dos    : kpoints=G 11 11 11                                                                         :          :
pbs & good & band                           : kpoints=L 40 G X W L                                                                         :          :
pbs & bulk & good & spin!=ncl               : ediff=1E-4, isym=2                                                                         :          :
opt & good                                  : ediffg=-0.01                                                                               :          :
pbs & bulk & good                           : lreal=.FALSE.                                                                                 :          : Source -> vasp runtime prompt. use explicit false for small supercell.
#
#
#
#
#
# Regarding internal parameters:
# Internal status is entirely unrelated to the data logic. It only has to do with writing INCAR.
#
# Regarding grammar and semantics:
# Same.
#
# kwname!=kwval|!modname && !(func) || kwname !null     : kwname internal                               : optional  : explanations. colon is necessary.
#
                                            : ncore_node internal, mem_node internal                                                     :          :
                                            : read internal                                                                              :          :
                                            : hseprec internal                                                                           :          :
                                            : spin internal, cond internal                                                               :          :
                                            : platform internal                                                                          :          :
                                            : fix internal, nnode internal                                                               :          :
                                            : kpoints internal                                                                           :          :
                                            : struk internal                                                                             :          :
icharg=10 | icharg=11 | icharg=12           : magmom internal                                                                            :          :
